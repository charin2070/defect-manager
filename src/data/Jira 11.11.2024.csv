Issue key,Issue id,Assignee,Status,Created,Labels,Labels,Labels,Labels,Issue Type,Resolved,Custom field (SLA дата наступления просрочки),Description,Custom field (description ),Custom field (Количество обращений),Custom field (Команда устраняющая проблему)
ADIRINC-1872,5841848,,NEW,08.11.2024 17:56,,,,,Дефект промсреды,,2024-12-20 00:00:00.0,"На примере AF8Y5N ГС 2825095, МТ Андройд 2.33.0

В карточке актива ВТБ (RU000A0JP5V6) в разделе новости отображаются новости не по данному активу и эмитенту.

!image-2024-11-08-17-57-49-043.png!

Будет исправлено в рамках задачи по фиксу: https://jira.moscow.alfaintra.net/browse/ADIRANALYT-14319?filter=-1",,1.0,
ADIRINC-1862,5833432,U_M25TF,NEW,07.11.2024 16:23,,,,,Дефект промсреды,,2024-12-19 00:00:00.0,"В МТ iOS 3.11 при создании уведомления по фьючерсу отображается в рублях - а должно быть в пунктах. PinEQ клиента: AMCEW5, ГС 850434. На примере GOLD-12.24.

 

 

!image-2024-11-07-16-26-54-975.png!",,,
ADIRINC-1860,5814218,U_M0DRY,NEW,05.11.2024 10:38,,,,,Дефект промсреды,,2024-12-17 00:00:00.0,"02.11.2024 наблюдали падение ЛС. Это произошло из за того что по просьбе аналитика Чикишева Д, был произведен апдейт.

Дима Чикишев пришел с [апдейтами инструментов|https://rc.alfa-bank.net/channel/adir_duty?msg=TYT9xxpHqFTjm7o3q] 837906(который привел к падению ЛС) и 837907, попросив проставить им признак того, что они просрочены (Expired = 1).
Из-за того, что в схеме bs.object и ts.objects не хранятся просроченные инструменты - они удаляются из таблицы в этих схемах.
В 16:30 были выполнены запрошенные апдейты и почти сразу же ЛС упал.



Необходимо произвести доработку ЛС которая бы не приводила к падению всего ЛС при недоступности инструмента в ts.objects 
https://rc.alfa-bank.net/channel/adir-avarii/thread/suiESiTa9Pw8mPLHc",,,
ADIRINC-1858,5809281,U_M1CUE,NEW,02.11.2024 17:33,,,,,Дефект промсреды,,2024-12-16 00:00:00.0,"Заявка *IM16847545 *

Описание дефекта со слов Глеба:

1) (+ДОРАБОТАТЬ!+) Клиенту показано не в маржу 10983 р. + столько же в маржу. (ГС 267351).
2) Тестирование:
Почему на уровне ЛК нет никакого оповещения, если клиент пытается вывести маржу.
(Заявка маржу -> ЛК инфа -> На фронте ""Пройти тестирование"".)
3) Почему бумага попала в маржу.
4) Почему числится ""-1"" штука. (_кассовый инструмент?_)
5) Как предотвратить из п.4?",,,
ADIRINC-1857,5807688,U_M1FE1,NEW,02.11.2024 14:03,,,,,Дефект промсреды,,2025-01-28 00:00:00.0,"На постоянной основе возникает ошибка на сервисе adir-dividend-info

Без влияния на клиентов 
{code:java}
""message"": ""An unhandled exception has occurred while executing the request."",    ""exception_"": ""{\""Message\"":\""A severe error occurred on the current command.  The results, if any, should be discarded.\\r\\nOperation cancelled by user.\"",\""Server\"":\""AD-P-DB-79.alfadirect.ru,1433\"",\""StackTrace\"":\""   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)\\r\\n   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)\\r\\n   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()\\r\\n   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)\\r\\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)\\r\\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)\\r\\n   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)\\r\\n   at AlfaDirect.DatabaseUtils.Connections.Logged.LoggedDbCommand.ExecuteDbDataReader(CommandBehavior behavior)\\r\\n   at System.Data.Common.DbCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)\\r\\n--- End of stack trace from previous location ---\\r\\n   at Polly.Retry.AsyncRetryEngine.ImplementationAsync[TResult](Func`3 action, Context context, CancellationToken cancellationToken, ExceptionPredicates shouldRetryExceptionPredicates, ResultPredicates`1 shouldRetryResultPredicates, Func`5 onRetryAsync, Int32 permittedRetryCount, IEnumerable`1 sleepDurationsEnumerable, Func`4 sleepDurationProvider, Boolean continueOnCapturedContext)\\r\\n   at Polly.AsyncPolicy.ExecuteAsync[TResult](Func`3 action, Context context, CancellationToken cancellationToken, Boolean continueOnCapturedContext)\\r\\n   at Dapper.SqlMapper.QueryAsync[T](IDbConnection cnn, Type effectiveType, CommandDefinition command) in /_/Dapper/SqlMapper.Async.cs:line 434\\r\\n   at AlfaDirect.DatabaseUtils.Contexts.DbContexts.Classic.AdirDbContextExtensions.GetAsync[TInput,TResult](IAdirDbContext dbContext, String storedProcedureKey, TInput input, IDbConnection connection, CancellationToken cancellationToken)\\r\\n   at DividendApi.Library.Providers.CalendarProvider.GetCalendarByAssetAsync(IEnumerable`1 assetIds, Nullable`1 startDate, Nullable`1 endDate, Boolean isPortfolio, CancellationToken cancellationToken) in C:\\\\temp\\\\src\\\\DividendApi.Library\\\\Providers\\\\CalendarProvider.cs:line 107\\r\\n   at lambda_method33(Closure, Object)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()\\r\\n--- End of stack trace from previous location ---\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextExceptionFilterAsync>g__Awaited|26_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ExceptionContextSealed context)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync()\\r\\n--- End of stack trace from previous location ---\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\\r\\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\\r\\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)\"",\""IsTransient\"":false,\""Data\"":{\""OriginalClientConnectionId\"":\""82c3e962-6f19-479e-9923-2edf27d55741\"",\""HelpLink_LinkId\"":\""20476\"",\""HelpLink_EvtSrc\"":\""MSSQLServer\"",\""HelpLink_EvtID\"":\""0\"",\""HelpLink_BaseHelpUrl\"":\""https://go.microsoft.com/fwlink\"",\""HelpLink_ProdName\"":\""Microsoft SQL Server\"",\""HelpLink_ProdVer\"":\""15.00.4385\"",\""RoutingDestination\"":\""AD-P-DB-79.alfadirect.ru,1433\""},\""TargetSite\"":\""Void ThrowExceptionAndWarning(Microsoft.Data.SqlClient.TdsParserStateObject, Microsoft.Data.SqlClient.SqlCommand, Boolean, Boolean)\"",\""LineNumber\"":0,\""Source\"":\""Core Microsoft SqlClient Data Provider\"",\""Errors\"":[{\""Message\"":\""A severe error occurred on the current command.  The results, if any, should be discarded.\"",\""Number\"":0,\""Server\"":\""AD-P-DB-79.alfadirect.ru,1433\"",\""State\"":0,\""Procedure\"":\""\"",\""Class\"":11,\""LineNumber\"":0,\""Source\"":\""Core Microsoft SqlClient Data Provider\""},{\""Message\"":\""Operation cancelled by user.\"",\""Number\"":0,\""Server\"":\""AD-P-DB-79.alfadirect.ru,1433\"",\""State\"":0,\""Procedure\"":\""\"",\""Class\"":11,\""LineNumber\"":0,\""Source\"":\""Core Microsoft SqlClient Data Provider\""}],\""Type\"":\""Microsoft.Data.SqlClient.SqlException\"",\""Number\"":0,\""HResult\"":-2146232060,\""State\"":0,\""ClientConnectionId\"":\""d109965e-5270-475e-bf87-fd0ef341c916\"",\""Procedure\"":\""\"",\""Class\"":11,\""ErrorCode\"":-2146232060}"",
{code}
!image-2024-11-02-14-00-42-563.png!

!image-2024-11-02-14-01-30-400.png!
 Ошибка обсуждалась на встрече 
ХП [actives].[match_isin]

 ",,,
ADIRINC-1856,5806613,U_M25TF,NEW,02.11.2024 12:04,,,,,Дефект промсреды,,2024-12-16 00:00:00.0,"У клиента в приложении ДТ 4.0.4263.1209 отображается некорректное отображение свечей инструмента IMOEX
!image-2024-11-02-12-03-27-210.png!
Ошибка воспроизводится только на ДТ

Связанные задачи
[https://rc.alfa-bank.net/channel/adir-terminal-support?msg=DBxoCFfo2PqjadhEW
]https://jira.moscow.alfaintra.net/browse/ADIRTERM-1768 [|https://rc.alfa-bank.net/channel/adir-terminal-support?msg=DBxoCFfo2PqjadhEW]",,1.0,
ADIRINC-1855,5806588,U_M1FE1,NEW,02.11.2024 11:52,,,,,Дефект промсреды,,2024-12-16 00:00:00.0,"Ошибка в том, что сервис Instruments-api и Fin-instruments-info получает пустое значение
[http://adirelkprod.alfadirect.ru/goto/a2fd6b1f9ddca2ebcf03771b0b160037]
[http://adlog1/kibana/goto/b893ced0-9907-11ef-9191-99b70cffc65d]




!image-2024-11-02-13-48-13-243.png!

Файл с логами во вложении

Предполагаем, что в [news_cache].[direct].[instruments] имеются пустые записи Act_id.
{code:java}
SELECT TOP (1000) act_id,*
  FROM [news_cache].[direct].[instruments] WITH (nolock)
  Where act_id is Null
{code}
Записи должны обладать данными в поле act_id
 !image-2024-11-02-11-51-45-640.png!",,,
ADIRINC-1854,5806550,U_M21WS,NEW,02.11.2024 11:41,,,,,Дефект промсреды,,2024-11-13 00:00:00.0,"У всех клиентов не отображаются ""Мои выплаты"" 
 Пин AJQK8M

!image-2024-11-02-11-38-47-566.png!

В сервисе instruments-api возвращается пустой массив данных.

Ручка /calendar/investments-calendar


{code:java}
curl -X POST adappr2:29646/calendar/investments-calendar -H 'CHANNEL-ID: I1' -H 'AUTH-USER-ID: AJQK8M' -H 'Content-Type: application/json' -d '{ ""account"" : { ""accountNumber"" : ""4461237"", ""subAccountNumber"" : ""000"" }, ""period"" : { ""startDate"" : ""2024-11-02"", ""endDate"" : ""2100-12-31"" }, ""types"" : [ ""COUPON"" ], ""bondsAssetIds"" : [""RU000A1077V4""] }'| jq
{code}

[http://adlog1/kibana/goto/f96cad70-9905-11ef-9191-99b70cffc65d]



!image-2024-11-02-13-35-46-870.png!

то есть мы получает ответ от ручки, но при этом в МТ не отображается,
файл с логами во вложении.",,,
ADIRINC-1853,5805687,U_M1QTQ,NEW,02.11.2024 10:41,,,,,Дефект промсреды,,2024-12-16 00:00:00.0,"После аукциона открытия в Стакане появляется заглушка о закрытии торгов и не исчезает после наступления времени открытия торгов. В Либе, статус у инструмента меняется 6, но заглушка не исчезает.

Необходимо доработать данную ситуацию так, чтоб заглушка пропадала сама, а не приходилось выходить из инструмента и заходить снова.",,1.0,
ADIRINC-1851,5795610,,NEW,31.10.2024 17:32,,,,,Дефект промсреды,,2024-11-11 00:00:00.0,"ГС 6975058 цб PIF13642833 (RU000A0JRXG8)
 Клиент обращается в связи с тем, что УЦ по бумаге равна 0.
 УЦ отправляется на пересчёт, расчёт корректный, новая цена ненулевая.
 но УЦ у клиента всё равно остаётся равной 0.

Обнаружен дефект в процедуре трансляции УЦ regp.export_regprices_adfront.
 !image-2024-10-31-17-30-29-639.png!
 Т.е. УЦ транслируется всегда *на инструмент в 4-ке с меньшим IdObject*.

Но в разбираемом случае инструмент в 4-ке с меньшим IdObject имеет признак, что он *выключен*:
 !image-2024-10-31-17-37-38-762.png!

В результате имеем, что УЦ протранслировалась на выключенный инструмент
 !image-2024-10-31-17-41-36-226.png!

А позиция у клиента есть на инструменте c IdObject, который включён
 !image-2024-10-31-17-44-34-330.png!

Устранение дефекта видим в исправлении кода процедуры с учётом признака IsEnabledObject и/или проверки трансляции на инструмент, на который у клиента есть позиция

Всего случаев, когда таблица ADFront.cf.RegPrices указывает на выключенный инструмент, в настоящее время 9058.  
 !image-2024-10-31-18-13-56-824.png!

 ",,,
ADIRINC-1850,5794773,U_M25TF,NEW,31.10.2024 16:27,,,,,Дефект промсреды,,2024-12-12 00:00:00.0,"*Краткое описание проблемы, ее контекст, окружение:*  

 Предварительное условие:
 # Состав МП - image-2024-10-28-11-23-20-547.png
 # Состав КП  - image-2024-10-28-11-28-28-474.png
 # В настройках МП поле ""Максимальное расхождение между МП и КП, %"" = 5%

*Шаги воспроизведения:*

1. Перейти в сваггер [http://adir-sovetnik-portfolio-rebalance.adirconfig-247.gointra.net/swagger/index.html?urls.primaryName=Statuses%20v1]

2. Ввести treaty 6818980

*Ожидаемый результат:*

REBALANCE_ME

*Фактический результат:*

PORTFOLIO_OKAY",,,
ADIRINC-1848,5791491,U_M1FE1,На исправление,31.10.2024 12:03,,,,,Дефект промсреды,,2024-12-12 00:00:00.0,"На примере ГМК Норникель (RU0007288411) был сплит:

!image-2024-10-31-12-37-42-628.png!

После сплита некорректно отображается информация по дивидендам, тянется старая информация без учета сплита:

!image-2024-10-31-12-33-02-089.png!

!image-2024-10-31-12-39-00-653.png!

В свободных источника (cbonds) прежние выплаты указаны с учетом сплита:

!image-2024-10-31-12-31-31-319.png!

!image-2024-10-31-12-32-29-136.png!

 

 

 ",,2.0,
ADIRINC-1847,5779994,U_M1AYY,На исправление,29.10.2024 17:50,,,,,Дефект промсреды,,2024-12-10 00:00:00.0,"ГС 2753067 цб Норникель (GMKN RU0007288411)

Цена в декларации указана как 189,39, хотя должна быть проставлена 18939.
 Система каким-то образом делит сумму на все бумаги, включая те, которые были начислены клиенту в результате сплита.
 Сейчас не совсем понятно, так происходит только в случае, если операция по добавленнию по сплиту 198 бумаг стоит раньше депо-перевода или это общий случай.
 !image-2024-10-29-17-37-53-999.png!
 В результате сейчас по клиенту имеем УЦ = 7,86 руб., хотя коридор УЦ по этой бумаге 170-200 руб.",,,
ADIRINC-1846,5764662,U_M27PA,На исправление,28.10.2024 10:27,,,,,Дефект промсреды,,2024-12-09 00:00:00.0,"23.10.2024 с 14:25  началась утилизация памяти сервиса rucabinet-frontandback что привело к его падению. 
!image-2024-10-28-09-52-21-208.png!",,,НТФ (ЛК)
ADIRINC-1843,5757132,U_M0SLM,На исправление,25.10.2024 13:22,,,,,Дефект промсреды,,2024-12-06 00:00:00.0,"Наблюдается фон ошибок сервиса adir-k2db-post-trade-limits-utilisation
!image-2024-10-25-13-20-07-580.png!

[http://adirelkprod.alfadirect.ru/goto/8b3be9434567600ca829f61d49dc0f74]


{code:java}
""System.Exception: Ошибка во время записи в базу. ХП: [kafka].[import_limit_utilisation_ts_a], параметры: {\""RemoveUnused\"":true,\""ParameterNames\"":[\""IdObject\"",\""IdRazdelType\"",\""AdmShortLimitUtil\"",\""Return Value\""]}\r\n ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column '[paper_id]', table '[mrgn].[limit_utilisation_ts]'; column does not allow nulls. INSERT fails.\r\n   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\r\n   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)\r\n   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)\r\n   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)\r\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)\r\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)\r\n   at Microsoft.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, Boolean sendToPipe, Int32 timeout, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String methodName)\r\n   at Microsoft.Data.SqlClient.SqlCommand.ExecuteNonQuery()\r\n   at AlfaDirect.DatabaseUtils.Logged.LoggedDbCommand.ExecuteNonQuery()\r\n   at System.Data.Common.DbCommand.ExecuteNonQueryAsync(CancellationToken cancellationToken)\r\n--- End of stack trace from previous location ---\r\n   at Dapper.SqlMapper.ExecuteImplAsync(IDbConnection cnn, CommandDefinition command, Object param) in /_/Dapper/SqlMapper.Async.cs:line 654\r\n   at DataAccess.Contexts.DbContext.SaveAsync(Dictionary`2 parameters, OperationType operationType) in C:\\BuildAgent\\work\\c8742b0c56bd3ce6\\DataAccess\\Contexts\\DbContext.cs:line 60\r\n   at DataAccess.Contexts.DbContext.SaveAsync(Dictionary`2 parameters, OperationType operationType) in C:\\BuildAgent\\work\\c8742b0c56bd3ce6\\DataAccess\\Contexts\\DbContext.cs:line 63\r\nClientConnectionId:9ae85831-7fe3-402b-b3da-db7daf6320e6\r\nError Number:515,State:0,Class:16\r\n   --- End of inner exception stack trace ---\r\n   at DataAccess.Contexts.DbContext.SaveAsync(Dictionary`2 parameters, OperationType operationType) in C:\\BuildAgent\\work\\c8742b0c56bd3ce6\\DataAccess\\Contexts\\DbContext.cs:line 71\r\n   at Service.DataTransferService.<>c__DisplayClass10_0.<<TransferAsync>b__0>d.MoveNext() in C:\\BuildAgent\\work\\c8742b0c56bd3ce6\\Service\\DataTransferService.cs:line 80\r\n--- End of stack trace from previous location ---\r\n   at Polly.AsyncPolicy.<>c__DisplayClass40_0.<<ImplementationAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Polly.Retry.AsyncRetryEngine.ImplementationAsync[TResult](Func`3 action, Context context, CancellationToken cancellationToken, ExceptionPredicates shouldRetryExceptionPredicates, ResultPredicates`1 shouldRetryResultPredicates, Func`5 onRetryAsync, Int32 permittedRetryCount, IEnumerable`1 sleepDurationsEnumerable, Func`4 sleepDurationProvider, Boolean continueOnCapturedContext)\r\n   at Polly.AsyncPolicy.ExecuteAsync(Func`3 action, Context context, CancellationToken cancellationToken, Boolean continueOnCapturedContext)\r\n   at Service.DataTransferService.TransferAsync(CancellationToken token) in C:\\BuildAgent\\work\\c8742b0c56bd3ce6\\Service\\DataTransferService.cs:line 79"",    
{code}


!image-2024-10-25-13-21-16-921.png!

Связанная задача *https://jira.moscow.alfaintra.net/browse/ADIRANALYT-14149*",,,
ADIRINC-1842,5755198,U_M1W4D,Закрыт,25.10.2024 11:17,,,,,Дефект промсреды,25.10.2024 11:18,2024-11-05 00:00:00.0,"Некорректные значения в форме принудительного закрытия по срочному рынку

[https://rc.alfa-bank.net/channel/adir-avarii?msg=LXBfgxfHeGYu84vtc]

перестали писаться знгачения портфолио кост
SELECT * from adfront.ts.MarginRequirements where PortfolioCost != 0 AND idRazdelGroup = 2",,,Сатурн 2
ADIRINC-1840,5744206,U_M0SLM,На исправление,23.10.2024 20:51,,,,,Дефект промсреды,,2024-12-05 00:00:00.0,"Пример: 4348717 (уже поправили)
 Клиента переводят с статуса заблокирован - в разблокирован, после чего права необходимые не полноценно транслируются.
{code:java}
SELECT sub.SubAccAllowLevel, acc.AccAllowLevel , * 
FROM ADFront.dbo.SubAccounts sub  
    left join ADBack.dbo.accounts acc on sub.IdAccount=acc.IdAccount  
    left join hell.dbo.accounts b on sub.idaccount=b.treaty 
WHERE 
    sub.SubAccAllowLevel=128 
    and acc.AccAllowLevel=159 
    and CodeTariffPlanFond not in ('Microinvestment') 
    and b.disable_orders='N' 
    and b.tp_code not in ('autofollow2','autofollow3','autofollow4','autofollow1','ZERO','Microinvestment') 
    and DateOfDeath is null and b.status_type not in ('W','B'){code}
 ",,,
ADIRINC-1839,5739237,U_M177U,На исправление,23.10.2024 10:50,,,,,Дефект промсреды,,2024-12-04 00:00:00.0,"У клиентов, в разделе ""Портфель"" возникает плашка ""Возникла ошибка при отображении некоторых активов""
 В логах ошибки не обнаружили.
проверяли инструменты, ошибки не выявили.

 такое впечатление, что данная плашка зашита внутри МТ и срабатывает, когда не получает некое поле.
 Был создан тред с целью найти причину:
 [https://rc.alfa-bank.net/channel/a-inv-mt?msg=dy3RtQ7DwNdQqHmA5]
 В рамках разбора было выяснено, что:
 ""подобная проблема уже имела место на обеих платформах, вероятнее всего ошибка в данных, которые приходят по бинарному протоколу""

По данной проблеме был зведен тикет:
 https://jira.moscow.alfaintra.net/browse/MTINC-60

!image-2024-10-23-10-46-55-619.png!",,46.0,
ADIRINC-1838,5735080,U_M25TF,На исправление,22.10.2024 15:08,,,,,Дефект промсреды,,2025-01-15 00:00:00.0,"ГС 159946, при переходе из раздела Портфель в ЦФА происходит редирект на авторизацию (указать карту или обратиться в ТЦ), сквозная авторизация не выполняется.

 

Видео, обсуждение и временное решение тут - [https://rc.alfa-bank.net/channel/a-inv-mt?msg=uEACWbUgo2cD75oVG]

 ",,12.0,
ADIRINC-1837,5729309,U_M1P85,Принят к исправлению,21.10.2024 19:00,,,,,Дефект промсреды,,2024-12-03 00:00:00.0,"21.10.2024 словили аварию, с трансляцией балансов клиентов.

Наблюдали следующую картину:
 # Начали расти расхождения ""*Найдено расхождений между post_trade.hell.balances и hell.dbo.balance: 1890  ""*
 #  ** Сервис трансляции в кафку -ок
 # Сервис трансляции из кафки в БД - таймауты в логах при попытке записи в БД post_trade. Microsoft.Data.SqlClient.SqlException (0x80131904): Execution Timeout Expired. The timeout period elapsed prior to completion of the operation or the server is not responding. ---> System.ComponentModel.Win32Exception (258): The wait operation timed out. !image-2024-10-21-18-56-18-054.png!

В кафке лаг на очереди достигал 25000 сообщений невычитанных

(на скрине уже после переезда на резервный сервер очередь рассосалась)

!image-2024-10-21-18-59-12-295.png!

 

5. Каких либо ручных вмешательств или инсертов не выявлено в момент устранения аварий.

Помог переезд на резервные сервер БД post_trade с adir-p-db-89 на adir-p-db-88

Дополнительно ошибки в MSSQL которые выглядели подозрительно  https://rc.alfa-bank.net/channel/adir-avarii?msg=k6YehJvkTdWzwZhZD",,,
ADIRINC-1836,5728385,U_M1W4D,Закрыт,21.10.2024 16:23,,,,,Дефект промсреды,21.10.2024 16:33,2024-12-02 00:00:00.0,"Найдена неверная переменная в сборке после релиза

отображались некорректные котировки в Веб терминале

была задача на раскатку https://jira.moscow.alfaintra.net/browse/ITINVEST-7750
[https://rc.alfa-bank.net/channel/duty-support-invest?msg=HTzfffGKHvMpKwEft]
накатывалась версия 1.4.120-AIPRO-1.8.3 08:05",,,
ADIRINC-1835,5719457,U_M0C88,На исправление,19.10.2024 13:04,,,,,Дефект промсреды,,2024-12-02 00:00:00.0,"В настоящее время возникают проблемы у клиентов при попытке открытия инвесткопилки.

!error.png!

Пример ошибки в логах:

[https://ibank/pipelog/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:'2024-10-17T01:23:00.000Z',to:'2024-10-17T01:24:00.000Z'))&_a=(columns:!(message),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'0b47b040-75a3-11ed-a9c5-974feac943d0',key:cus,negate:!f,params:(query:BDLDIB),type:phrase),query:(match_phrase:(cus:BDLDIB)))),index:'0b47b040-75a3-11ed-a9c5-974feac943d0',interval:auto,query:(language:kuery,query:''),sort:!(!(start_Time,desc)))]

В EQ установлен риск:

!image-2024-10-19-13-03-17-156.png!

Похожие проблемы возникают при указанном месте рождения клиента Крым, Феодосия Украина",,,
ADIRINC-1834,5718502,U_M25TF,На исправление,19.10.2024 09:58,,,,,Дефект промсреды,,2024-12-02 00:00:00.0,"{color:#172b4d}На примере клиента Власов Вячеслав Владимирович BFILKO ГС 7883960 логин vlasov_vv46, при в ходе в ВТ у клиента отображается чужой логин и имя:{color}

{color:#172b4d}!image-2024-10-19-10-01-06-219.png!{color}

{color:#172b4d}Логин который отображается у клиента принадлежит пререгу Филько Богдан Юрьевич BDR0A6  логин bfilko.{color}

{color:#172b4d}Т.к. логин пререга Филько Богдан Юрьевич равняется его пин, и в данном случае совпадает с пином клиента Власов Вячеслав Владимирович, то система тянет клиенту иформацию по пререгу.{color}

{color:#172b4d}!image-2024-10-19-10-03-24-517.png!{color}

Было обсуждение данной проблемы в треде: [https://rc.alfa-bank.net/channel/adir_duty?msg=FqSgNjeK9CnXJtLuP] , но к решению так и не пришли.

 *+_Требуется устранить ошибку и исключить повторения кейса в будущем по всем клиентам._+*

 ",,1.0,
ADIRINC-1833,5718570,U_M2902,На исправление,19.10.2024 09:23,,,,,Дефект промсреды,,2024-12-02 00:00:00.0,"В приложении Альфа-Инвестиции в вкладке портфель процент доходности отображается некорректно.
 872824 р это ~ 8.9 % , а не  2.6 %

Pin клиента AQJ73N

Версия приложения андроид 2.32.0

!image-2024-10-19-09-18-46-294.png|width=309,height=683!

При этом сервис позишн кипинг отдает % корректно 

!image-2024-10-19-09-22-15-836.png|width=1264,height=634!",,2.0,Montblanc
ADIRINC-1832,5714523,U_M25TF,На исправление,18.10.2024 14:41,,,,,Дефект промсреды,,2024-11-29 00:00:00.0,"У клиента на счёте 71009 больше 5000, ГО у бумаги 1286, клиент может на свои средства купить минимум 3 лота, а тут система указывает лимит 0.



ГС 71009
версия терминала 4.0.4263.1209
При выставлении заявки, терминал не отображает собственные деньги клиента. Допускает выставление заявки только в плечо.
у клиента ЕФР, выставляет заявку на продажу CNY-12.24 (CRZ4)
http://webadmin.k8s-master.alfadirect.ru/reporting/orderlimitlog/LVsyepIBjFuD9h9u55X0

Видим, что при расчете лимитов деньги учитываются.
!image-2024-10-18-14-38-25-444.png!
!image-2024-10-18-14-38-48-292.png!
!image-2024-10-18-14-39-05-237.png!",,1.0,
ADIRINC-1831,5708984,U_M1W1Y,На исправление,17.10.2024 19:19,,,,,Дефект промсреды,,2024-11-29 00:00:00.0,"На примере инструмента GG00BNZFH108, AOSJJB ГС 896742.

Текущая цена отображается 0

!image-2024-10-17-19-24-46-332.png!

Последняя цена в хранилище грязных цен от 25.02.2022:

!image-2024-10-17-19-34-49-989.png!

 

После 730 дней от даты последнего получения цены, цены перестают транслироваться в AdFront.fi.FinInfoExt

!image-2024-10-17-19-33-59-011.png!

 

 

 

 ",,16.0,
ADIRINC-1830,5707273,U_M1DKF,NEW,17.10.2024 15:57,,,,,Дефект промсреды,,2024-11-28 00:00:00.0,"Клиент при выставлении торгового поручения на первичное размещение Pre-Ipo через МТ или ЛК в маржу получает ошибку: Недостаточно рублевых средств для уплаты комиссии. У клиента отрицательный плановый остаток по рублям. Средств для выставления заявки с учетом комиссии достаточно.

Разбор в треде:

https://rc.alfa-bank.net/channel/adir-lk-pub/thread/7ZY6s4A9Jr4M2ohTP

!image-2024-10-17-15-51-39-380.png!

!image-2024-10-17-15-51-56-678.png!

[http://adirelkprod.alfadirect.ru/goto/1e9996fd76205a23b6846d49558c5fc9]

!image-2024-10-17-15-52-41-950.png!

 

!image-2024-10-17-15-54-52-124.png!",,,
ADIRINC-1829,5703045,U_M25TF,На исправление,17.10.2024 09:54,,,,,Дефект промсреды,,2024-11-28 00:00:00.0,"Сервис FE32 Prices резко начинает утилизировать RAM, после рестарта сервиса, RAM приходит в норму.


!image-2024-10-17-09-51-24-614.png|width=480,height=204!

!image-2024-10-17-09-53-45-970.png|width=447,height=122!",,,
ADIRINC-1828,5699920,U_M1AYY,На исправление,16.10.2024 17:47,,,,,Дефект промсреды,,2024-11-27 00:00:00.0,"* 
По счёту клиента 199626 с 01.09.2024 по 19.09.2024 г. был установлен ТП 'Трейдер', в соответствии с п.6 Депозитарные услуги которого комиссия за Учёт/хранение ценных бумаг не взимается.
[https://alfabank.servicecdn.ru/site-upload/56/d8/4691/tarif_treider.pdf].
20.09.2024 г. по счёту установлен ТП 'Персональный брокер и выставлена комиссия за деп. услуги.
1. Комиссия выставлена за период с 01.09.2024 по 30.09.2024 г., а должна быть рассчитана за 10 дней.
2. 09.10.2024 клиент снова изменил ТП на 'Трейдер' и была вновь выставлена комиссия в размере 1610 р. (клиент пользовался ТП 'Персональный Брокер' 8 календарных дней). В данном случае комиссия рассчитана корректно.  Скорее всего некорректный расчет включается при переходе с тарифа Трейдер на ПБ.



!image-2024-10-16-17-20-16-744.png!

Расчет комиссии в данном случае производится по формуле 

PIF_volume x rate

!image-2024-10-16-17-25-42-274.png! То есть посчитался весь месяц, а не время пользования тарифом.

!image-2024-10-16-17-46-03-039.png!

!image-2024-10-16-17-44-46-404.png!

 ",,,
ADIRINC-1827,5697653,U_M0SLM,На исправление,16.10.2024 13:37,,,,,Дефект промсреды,,2024-11-27 00:00:00.0,"У клиентов МТ версии 2.32.0 не отображаются позиции приобретенные на СБП рынке.
 Пример ГС 4594125 ISIN RU000A0JS5T7 Абрау - Дюрсо а.о. 2 в.

!image-2024-10-16-13-33-26-234.png!
 !image-2024-10-16-13-33-51-522.png!

По логам видим, что ответ поступает:
 [http://adlog1/kibana/goto/337bb060-8baa-11ef-9191-99b70cffc65d]

Запрос в Position-Keeping 
{code:java}
curl -X ""GET"" ^
  ""http://adir-position-keeping.k8s-master.alfadirect.ru/api/accounts/4594125/positions/valuation"" ^
  -H ""accept: application/json"" ^
  -H ""X-Request-Id: 00000000-0000-0000-0000-000000000001"" ^
  -H ""X-External-System-Code: adir-position-keeping"" ^
  -H ""X-External-User-Code: swagger-ui-user"" ^
  -H ""Content-Type: application/json; v=4""
{code}
Ответ Position-Keeping (Только интересующий актив) множество полей Null
{code:java}
  {
              ""actId"": 44711,
              ""name"": ""Абрау-Дюрсо"",
              ""assetCode"": ""RU000A0JS5T7"",
              ""isin"": ""RU000A0JS5T7"",
              ""regCode"": ""1-02-12500-A"",
              ""ticker"": ""ABRD"",
              ""atGroup"": ""A"",
              ""placeId"": 94,
              ""quantity"": 100,
              ""incomeQuantity"": 100,
              ""currency"": null,
              ""priceStep"": null,
              ""priceStepCost"": null,
              ""price"": null,
              ""amount"": null,
              ""amountRUB"": null,
              ""accruedInterest"": null,
              ""accruedInterestRUB"": null,
              ""accruedInterestCurrency"": """",
              ""marketBoardName"": null,
              ""objectId"": 382322,
              ""objectBaseId"": 377953,
              ""objectTypeId"": 1,
              ""objectTypeDesc"": ""Акции обыкновенные"",
              ""nameBalanceGroup"": ""РЦБ"",
              ""exchange"": null,
              ""quantityLot"": null,
              ""quantityT0"": 100,
              ""accPrices"": [
                {
                  ""currency"": ""RUB"",
                  ""value"": 212
                },
                {
                  ""currency"": ""USD"",
                  ""value"": 2.2870408
                },
                {
                  ""currency"": ""EUR"",
                  ""value"": 2.0532886
                },
                {
                  ""currency"": ""CHF"",
                  ""value"": 1.9346084
                },
                {
                  ""currency"": ""CNY"",
                  ""value"": 16.1797478
                },
                {
                  ""currency"": ""GBP"",
                  ""value"": 1.7310333
                },
                {
                  ""currency"": ""HKD"",
                  ""value"": 17.7931462
                }
              ],
              ""prevPrice"": null,
              ""accAmount"": null,
              ""accAmountRUB"": null,
              ""sessionBuyVolume"": null,
              ""sessionSellVolume"": null,
              ""trnInVolume"": null,
              ""trnOutVolume"": null,
              ""dailyPl"": null,
              ""dailyPlRUB"": null,
              ""dailyPlPercent"": null,
              ""npl"": null,
              ""nplRUB"": null,
              ""nplPercent"": null,
              ""isTradingEnabled"": false,
              ""isMoney"": false,
              ""isStruct"": false,
              ""nextCouponDate"": null,
              ""couponValue"": 0,
              ""couponPeriod"": 0,
              ""couponPercent"": null,
              ""maturityDate"": null,
              ""idFi"": null,
              ""prevAmount"": null,
              ""prevAmountRUB"": null,
              ""nominal"": 1,
              ""nominalCurrency"": """",
              ""yieldToMaturity"": null,
              ""warrantyRUB"": null,
              ""riskRate"": null,
              ""modifyRiskRate"": null,
              ""isEnabledMargin"": null
            },
{code}
лог отображающегося актива
{code:java}
{
              ""actId"": 6572,
              ""name"": ""ГМК Норникель"",
              ""assetCode"": ""RU0007288411"",
              ""isin"": ""RU0007288411"",
              ""regCode"": ""1-01-40155-F"",
              ""ticker"": ""GMKN"",
              ""atGroup"": ""A"",
              ""placeId"": 18,
              ""quantity"": 500,
              ""incomeQuantity"": 500,
              ""currency"": ""RUB"",
              ""priceStep"": 0.02,
              ""priceStepCost"": 0.02,
              ""price"": 106.94,
              ""amount"": 53470,
              ""amountRUB"": 53470,
              ""accruedInterest"": null,
              ""accruedInterestRUB"": null,
              ""accruedInterestCurrency"": """",
              ""marketBoardName"": ""МБ ЦК"",
              ""objectId"": 174423,
              ""objectBaseId"": 283660,
              ""objectTypeId"": 1,
              ""objectTypeDesc"": ""Акции обыкновенные"",
              ""nameBalanceGroup"": ""РЦБ"",
              ""exchange"": ""MICEX"",
              ""quantityLot"": 50,
              ""quantityT0"": 500,
              ""accPrices"": [
                {
                  ""currency"": ""RUB"",
                  ""value"": 110.98061313
                },
                {
                  ""currency"": ""USD"",
                  ""value"": 1.1907099
                },
                {
                  ""currency"": ""EUR"",
                  ""value"": 1.06555217
                },
                {
                  ""currency"": ""CHF"",
                  ""value"": 1.0042845
                },
                {
                  ""currency"": ""CNY"",
                  ""value"": 8.3819341
                },
                {
                  ""currency"": ""GBP"",
                  ""value"": 0.88810822
                },
                {
                  ""currency"": ""HKD"",
                  ""value"": 9.22954479
                }
              ],
              ""prevPrice"": 108.5,
              ""accAmount"": 55490.306565,
              ""accAmountRUB"": 55490.306565,
              ""sessionBuyVolume"": null,
              ""sessionSellVolume"": null,
              ""trnInVolume"": null,
              ""trnOutVolume"": null,
              ""dailyPl"": -780,
              ""dailyPlRUB"": -780,
              ""dailyPlPercent"": -1.4377880184331797,
              ""npl"": -2020.306565,
              ""nplRUB"": -2020.306565,
              ""nplPercent"": -3.640827903218487,
              ""isTradingEnabled"": true,
              ""isMoney"": false,
              ""isStruct"": false,
              ""nextCouponDate"": null,
              ""couponValue"": 0,
              ""couponPeriod"": 0,
              ""couponPercent"": null,
              ""maturityDate"": null,
              ""idFi"": 146987,
              ""prevAmount"": 54250,
              ""prevAmountRUB"": 54250,
              ""nominal"": 0.01,
              ""nominalCurrency"": """",
              ""yieldToMaturity"": 0,
              ""warrantyRUB"": null,
              ""riskRate"": null,
              ""modifyRiskRate"": null,
              ""isEnabledMargin"": null
            },
{code}
!image-2024-10-16-13-36-28-557.png!

имеется тред с проблемой, что PK отдает не все обязательные поля, тред ниже:
 [https://rc.alfa-bank.net/channel/adir_duty?msg=Nnahaet2fmEMpRaHY]

 ",,1.0,Core
ADIRINC-1826,5687087,U_M0SLM,На исправление,15.10.2024 10:42,,,,,Дефект промсреды,,2024-11-26 00:00:00.0,"В таблице hell.dbo.sub_accounts неверная привязка поля id_sub_account. Это привело к тому, что при обновлении субсчетов по задаче https://jira.moscow.alfaintra.net/browse/ADIRSQL-19061 сбились значения поля IdAccount
у 8200 записей. Проставились значения демо счетов. 

select id_sub_account, *from hell.dbo.sub_accounts sa
where 1=1
and id_sub_account = 59305

select top 100 * from ADFront.dbo.subaccounts sa
where 1=1
and IdSubAccount = 59305  !image-2024-10-15-10-41-08-696.png!",,,
ADIRINC-1825,5686707,U_M1W4D,К закрытию,15.10.2024 10:30,,,,,Дефект промсреды,,2024-11-26 00:00:00.0,"После внерелиза на сервисе возникает ошибка adir-k2db-adm-limits-adfront

[http://adirelkprod.alfadirect.ru/goto/7e769db8a0ca9e5dee358f06c1f5c462]

!image-2024-10-15-10-24-11-238.png!


{code:java}
""message"": ""Тип команды: 'StoredProcedure'\r\nТекст команды: '[dbo].[etl_error_save]'\r\nВходные параметры: '[{\""name\"":\""queue_name\"",\""value\"":\""TopicCfg\""},{\""name\"":\""error_code\"",\""value\"":\""processing_failed\""},{\""name\"":\""error_text\"",\""value\"":\""Ошибка во время записи в базу. ХП: [kafka].[ImportTsAdmLimitsDel], параметры: {\\u0022RemoveUnused\\u0022:true,\\u0022ParameterNames\\u0022:[\\u0022PlaceId\\u0022,\\u0022ActId\\u0022,\\u0022PaperId\\u0022,\\u0022AdmShortLimit\\u0022,\\u0022AdmLongLimit\\u0022,\\u0022IdObject\\u0022,\\u0022Return Value\\u0022]}\""},{\""name\"":\""request_uid\"",\""value\"":\""00000000-0000-0000-0000-000000000000\""},{\""name\"":\""msg\"",\""value\"":\""{\\u0022Type\\u0022:\\u0022D\\u0022,\\u0022NewData\\u0022:null,\\u0022OldData\\u0022:{\\u0022surrogate_key\\u0022:475,\\u0022paper_id\\u0022:214599,\\u0022act_id\\u0022:127405,\\u0022place_id\\u0022:5,\\u0022limit_short\\u0022:null,\\u0022sum_lu\\u0022:0.00000000,\\u0022object_id\\u0022:830102}}\""},{\""name\"":\""error_date\"",\""value\"":\""2024-10-15T09:51:58.1190095+03:00\""},{\""name\"":\""service_name\"",\""value\"":\""adir-k2db-adfront-ts-adm-limits\""}]'\r\n"",
{code}

ссылка на тред
https://rc.alfa-bank.net/channel/adir_duty?msg=sH6HL4aqwJiqKLKKp",,,
ADIRINC-1824,5683668,U_M25TF,Отклонен,14.10.2024 18:04,Android,,,,Дефект промсреды,14.10.2024 18:08,2024-11-26 00:00:00.0,,,,
ADIRINC-1823,5680693,U_M1PAH,NEW,14.10.2024 14:48,,,,,Дефект промсреды,,2024-11-25 00:00:00.0,"Сервис cerberus-web падает при недоступности кластера redis. Такого быть недолжно. Пример авария IM16779696. 

Размер данных в кластере redis превысил значение maxmemory, в следствии чего  Cerberus-web начал получать следующие ошибки.
Необходимо чтобы cerberus-web работал вне зависимости от доступности кластера Redis. 
Так же по достижению лимита maxmemory, cerberus должен удалять старые записи и записывать новые.
{code:java}
Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: 2024-10-12 19:38:52.524  INFO [,,34afc917fa841744] 1 --- [xecutorLoop-3-7] r.r.g.filter.AuthorizationFilter         : search client for route id adirect-webproOct 12 22:38:52 adir-p-cerb-01 docker[3304628]: 2024-10-12 19:38:52.524  INFO [,,34afc917fa841744] 1 --- [xecutorLoop-3-7] r.r.g.filter.AuthorizationFilter         : client with id adirect-webpro foundOct 12 22:38:52 adir-p-cerb-01 docker[3304628]: 2024-10-12 19:38:52.525  INFO [,,34afc917fa841744] 1 --- [xecutorLoop-3-7] r.r.g.filter.AuthorizationFilter         : authorization redirect requiredOct 12 22:38:52 adir-p-cerb-01 docker[3304628]: 2024-10-12 19:38:52.525  INFO [,,34afc917fa841744] 1 --- [xecutorLoop-3-7] r.r.g.s.ConfigurableRedirectService      : send redirect to authorization pageOct 12 22:38:52 adir-p-cerb-01 docker[3304628]: 2024-10-12 19:38:52.525 DEBUG [,,34afc917fa841744] 1 --- [xecutorLoop-3-7] o.s.w.s.adapter.HttpWebHandlerAdapter    : [d51eb7d3-14102855] Completed 302 FOUNDOct 12 22:38:52 adir-p-cerb-01 docker[3304628]: 2024-10-12 19:38:52.526 ERROR [,3150598639edd93f,4b8ed5fd911723df] 1 --- [xecutorLoop-3-2] r.n.http.server.HttpServerOperations     : [25043072-1, L:/172.21.75.141:8081 - R:/172.21.0.234:41918] Error starting response. Replying error statusOct 12 22:38:52 adir-p-cerb-01 docker[3304628]: org.springframework.data.redis.RedisSystemException: Error in execution; nested exception is io.lettuce.core.RedisCommandExecutionException: OOM command not allowed when used memory > 'maxmemory'.Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:54) ~[spring-data-redis-2.7.5.jar:2.7.5]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:41) ~[spring-data-redis-2.7.5.jar:2.7.5]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at org.springframework.data.redis.connection.lettuce.LettuceReactiveRedisConnection.lambda$translateException$0(LettuceReactiveRedisConnection.java:293) ~[spring-data-redis-2.7.5.jar:2.7.5]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.Flux.lambda$onErrorMap$28(Flux.java:6954) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onError(FluxOnErrorResume.java:94) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at ru.ratauth.gatekeeper.autoconfigure.MdcContextLifter.onError(MdcContextLifter.java:40) ~[gatekeeper-spring-boot-starter-0.0.1-SNAPSHOT.jar:na]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.MonoFlatMapMany$FlatMapManyInner.onError(MonoFlatMapMany.java:255) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at ru.ratauth.gatekeeper.autoconfigure.MdcContextLifter.onError(MdcContextLifter.java:40) ~[gatekeeper-spring-boot-starter-0.0.1-SNAPSHOT.jar:na]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.FluxConcatMap$ConcatMapImmediate.innerError(FluxConcatMap.java:309) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.FluxConcatMap$ConcatMapInner.onError(FluxConcatMap.java:875) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at ru.ratauth.gatekeeper.autoconfigure.MdcContextLifter.onError(MdcContextLifter.java:40) ~[gatekeeper-spring-boot-starter-0.0.1-SNAPSHOT.jar:na]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onError(FluxMapFuseable.java:142) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at ru.ratauth.gatekeeper.autoconfigure.MdcContextLifter.onError(MdcContextLifter.java:40) ~[gatekeeper-spring-boot-starter-0.0.1-SNAPSHOT.jar:na]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.FluxHide$SuppressFuseableSubscriber.onError(FluxHide.java:142) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onError(FluxMapFuseable.java:142) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at ru.ratauth.gatekeeper.autoconfigure.MdcContextLifter.onError(MdcContextLifter.java:40) ~[gatekeeper-spring-boot-starter-0.0.1-SNAPSHOT.jar:na]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.FluxHide$SuppressFuseableSubscriber.onError(FluxHide.java:142) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondError(MonoFlatMap.java:192) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.MonoFlatMap$FlatMapInner.onError(MonoFlatMap.java:259) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at ru.ratauth.gatekeeper.autoconfigure.MdcContextLifter.onError(MdcContextLifter.java:40) ~[gatekeeper-spring-boot-starter-0.0.1-SNAPSHOT.jar:na]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at reactor.core.publisher.MonoNext$NextSubscriber.onError(MonoNext.java:93) ~[reactor-core-3.4.24.jar:3.4.24]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.lettuce.core.RedisPublisher$OnComplete.run(RedisPublisher.java:1063) ~[lettuce-core-6.1.10.RELEASE.jar:6.1.10.RELEASE]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174) ~[netty-common-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.util.concurrent.DefaultEventExecutor.run(DefaultEventExecutor.java:66) ~[netty-common-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) ~[netty-common-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[netty-common-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[netty-common-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: Caused by: io.lettuce.core.RedisCommandExecutionException: OOM command not allowed when used memory > 'maxmemory'.Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.lettuce.core.internal.ExceptionFactory.createExecutionException(ExceptionFactory.java:147) ~[lettuce-core-6.1.10.RELEASE.jar:6.1.10.RELEASE]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.lettuce.core.internal.ExceptionFactory.createExecutionException(ExceptionFactory.java:116) ~[lettuce-core-6.1.10.RELEASE.jar:6.1.10.RELEASE]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.lettuce.core.RedisPublisher$SubscriptionCommand.doOnComplete(RedisPublisher.java:757) ~[lettuce-core-6.1.10.RELEASE.jar:6.1.10.RELEASE]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.lettuce.core.protocol.CommandWrapper.complete(CommandWrapper.java:65) ~[lettuce-core-6.1.10.RELEASE.jar:6.1.10.RELEASE]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.lettuce.core.protocol.CommandWrapper.complete(CommandWrapper.java:63) ~[lettuce-core-6.1.10.RELEASE.jar:6.1.10.RELEASE]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.lettuce.core.protocol.CommandHandler.complete(CommandHandler.java:747) ~[lettuce-core-6.1.10.RELEASE.jar:6.1.10.RELEASE]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.lettuce.core.protocol.CommandHandler.decode(CommandHandler.java:682) ~[lettuce-core-6.1.10.RELEASE.jar:6.1.10.RELEASE]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.lettuce.core.protocol.CommandHandler.channelRead(CommandHandler.java:599) ~[lettuce-core-6.1.10.RELEASE.jar:6.1.10.RELEASE]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442) ~[netty-transport-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[netty-transport-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[netty-transport-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) ~[netty-transport-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[netty-transport-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:800) ~[netty-transport-classes-epoll-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:499) ~[netty-transport-classes-epoll-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:397) ~[netty-transport-classes-epoll-4.1.84.Final.jar:4.1.84.Final]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011... 4 common frames omittedOct 12 22:38:52 adir-p-cerb-01 docker[3304628]: 2024-10-12 19:38:52.526 ERROR [,,3150598639edd93f] 1 --- [xecutorLoop-3-4] r.n.http.server.HttpServerOperations     : [d51eb7d3-1, L:/172.21.75.141:8081 - R:/172.21.0.234:41928] Error starting response. Replying error statusOct 12 22:38:52 adir-p-cerb-01 docker[3304628]: org.springframework.data.redis.RedisSystemException: Error in execution; nested exception is io.lettuce.core.RedisCommandExecutionException: OOM command not allowed when used memory > 'maxmemory'.Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:54) ~[spring-data-redis-2.7.5.jar:2.7.5]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:41) ~[spring-data-redis-2.7.5.jar:2.7.5]Oct 12 22:38:52 adir-p-cerb-01 docker[3304628]: #011at org.springframework.data.redis.connection.lettuce.LettuceReactiveRedisConnection.lambda$translateException$0(LettuceReactiveRedisConnection.java:293) ~[spring-data-redis-2.7.5.jar:2.7.5]
{code}",,,
ADIRINC-1822,5655743,U_M25TF,На исправление,10.10.2024 12:16,,,,,Дефект промсреды,,2024-11-21 00:00:00.0,"Коллеги, было обнаружено, что очень часто вызывается следующий запрос, выполнение которого создает дополнительную нагрузку на систему при открытии счетов в EQ. Просьба оптимизировать указанный ниже запрос.

{code:sql}
WITH cte (treaty, p_code, money_account, eq, result, efr_dt, place_code, is_ts_acc_prefix_missing) AS ( SELECT sa.treaty , tr.curr_code AS p_code , IIF(tr.curr_code = 'money', ac.money_account, ma.money_account) AS money_account , IIF(tr.curr_code = 'money', 'Y', ISNULL(ma.EQ, 'N')) AS eq , '' AS result , ac.efr_dt , tr.place_code , IIF(ts.treaty IS NULL, 'Y', 'N') AS is_ts_acc_prefix_missing FROM dbo.trades AS tr INNER JOIN dbo.sub_accounts AS sa ON tr.acc_code = sa.acc_code INNER JOIN dbo.accounts AS ac ON sa.treaty = ac.treaty LEFT JOIN dbo.multi_money_accounts AS ma ON ma.treaty = sa.treaty AND ma.balance_place_id = @place_id_micex AND ma.p_code_curr = tr.curr_code LEFT JOIN dbo.ts_acc_prefixes AS ts ON sa.treaty = ts.treaty AND tr.place_code = ts.place_code WHERE tr.place_code NOT LIKE 'MICEX_SELT%' AND tr.place_code <> 'FORTS' AND ((@treaty_in IS NULL AND sa.treaty BETWEEN @real_treaty_min AND @real_treaty_max) OR @treaty_in = sa.treaty) ) INSERT INTO @lost ( treaty , p_code , money_account , eq , result , efr_dt , place_code , is_ts_acc_prefix_missing , is_multi_money_accounts_missing ) SELECT DISTINCT treaty , p_code , money_account , eq , result , efr_dt , place_code , is_ts_acc_prefix_missing , 'Y' AS is_multi_money_accounts_missing FROM cte WHERE money_account IS NULL OR is_ts_acc_prefix_missing = 'Y' OR eq = '
{code}
",,,
ADIRINC-1821,5655094,U_M1DXT,NEW,10.10.2024 11:31,,,,,Дефект промсреды,,2024-10-21 00:00:00.0,"9.10 и 10.10.2024 словили аварии , затрагивающие вывод дс и пополнение дс.

Что их объединяет:

1. Массовая активность по зачислениям 9.10 - акция маркетинговая (зачисление 5к за клиентсую активность, при этом в тот же момент начинались массовые выводы тех же средств клиентами)

          10.10 - начисление кб на инвесткопилки

2. Деградация service broker SQL на hypernew3

9.10 восстановили только после применения плана DRP с перезагрузкой сервера hypernew3

10.10 проблема с выводами полечилась, после останова очередей на server broker

exch._initiatorQueue exch._TargetQueue internals.accounts_target_queue internals.calc_attributes_target_queue internals.clients_target_queue internals.hell_managers_target_queue internals.sub_accounts_target_queue internals.target_queue kafka.hell_exta_transfers_target_queue kafka.hell_trades_target_queue

Со стороны коллег развития БД Князев А. , Куликов П. у нас назрела проблема за десяток лет с конкуренцией записи в таблицу hell.dbo.extra_transfers

В нее пишутся и вводы и выводы.",,,
ADIRINC-1820,5654723,U_M1EJ8,NEW,10.10.2024 11:23,,,,,Дефект промсреды,,2025-01-03 00:00:00.0,"Метрики сервиса adir-mq2db-incoming-money-transfers отрабатывают некорректно

Пример авария 09.10.2024, за период с 17:00 судя по метрикам сервиса вычитано было около 164 000 операций, хотя по факту было меньше 100 000 операций
 [https://git.moscow.alfaintra.net/projects/ADIR_CORE/repos/adir-mq2db-incoming-money-transfers/browse]
 !image-2024-10-10-11-21-57-914.png|width=600,height=270!",,,
ADIRINC-1819,5654329,U_M177U,Отложен,10.10.2024 10:52,,,,,Дефект промсреды,,2024-11-21 00:00:00.0,"При пополнении ДС указывается некорректная сумма
 !image-2024-10-10-10-49-51-863.png!

В логах сумма подтягивается в соответствии с рублевой позицией -1902.6
 [http://adlog1/kibana/goto/e9540d90-8620-11ef-9191-99b70cffc65d]

!image-2024-10-10-10-51-45-347.png!

[

|https://rc.alfa-bank.net/channel/adir-lk-pub?msg=x8RFFf44sLEsBgE7P] [https://rc.alfa-bank.net/channel/a-inv-mt?msg=J4tkEwu4cTdqYcgxt]",,1.0,
ADIRINC-1818,5646973,U_M2614,На исправление,09.10.2024 20:09,,,,,Дефект промсреды,,2024-11-21 00:00:00.0,"9.10.2024 словили аварию с пополнением и выводом дс.

!image-2024-10-09-20-07-10-753.png!

*Симптомы:*
 # Копится очередь на стороне MQ и медленно вычитывается, затем и вовсе перестает вычитываться.
 # Выводы дс так же останавливаются.
 # 9.10.2024 Проводилась маркетинговая акция с массовым пополнением дс на брокерские счета клиентов, при этом сами клиенты в тот же момент массово их пытаются вывести. По реестрам разово загружается список клиентов с зачислениями.
 # В логах сервиса по отдельным трейсам видим, что хранимые процедуры отрабатывают быстро. 
 # Но заметили , что после того как все хп отработали на шаге коммита изменений в БД возникает большая задержка порядка 10 секунд по одной операции.

!image-2024-10-09-20-00-27-656.png!     6. В то же время работоспособность всех ХП , связанных с сервисом по отдельности показывают моментальную обработку транзакции. Список проверенных ниже:
{code:java}
 ""hell"": {
      ""StoredProcedures"": {
        ""GetTableTypeFields"": {
          ""Name"": ""[dbo].[getTableTypeFields]""
        },
        ""GetEnv"": {
          ""Name"": ""[dbo].[_get_env]""
        },
        ""GetTransfers"": {
          ""Name"": ""[ext_tran].[get_transfers]""
        },
        ""ImportOneSelfTran"": {
          ""Name"": ""[ext_tran].[aex_EQ_import_one_self_tran]""
        },
        ""ImportOneTran"": {
          ""Name"": ""[ext_tran].[import_one_tran]""
        },
        ""SaveTransfer"": {
          ""Name"": ""[ext_tran].[save_transfer]""
        },
        ""SendToCheck"": {
          ""Name"": ""[ext_tran].[send2check]""
        },
        ""UpdateTransfer"": {
          ""Name"": ""[ext_tran].[update_transfer]""
        },
        ""SaveErrorTransfer"": {
          ""Name"": ""[ext_tran].[save_error_tran]""
        },
        ""GetErrorTransfer"": {
          ""Name"": ""[ext_tran].[get_error_tran]""
        },
        ""DeleteErrorTransfer"": {
          ""Name"": ""[ext_tran].[delete_error_tran]""
        },
        ""CheckTransactionImport"": {
          ""Name"": ""[ext_tran].[transaction_import_check]""
        },
        ""DropOneTran"": {
          ""Name"": ""[dbo].[_eq_drop_one_tran]""
        },
        ""GetErrorTransfers"": {
          ""Name"": ""[ext_tran].[get_error_transactions]"",
          ""Tvp"": {
            ""IdTranList"": ""[ext_tran].[error_tran_id_list]""
          }
        },
        ""DeleteErrorTransfers"": {
          ""Name"": ""[ext_tran].[delete_error_transactions]"",
          ""Tvp"": {
            ""IdTranList"": ""[ext_tran].[error_tran_id_list]""
          }
        }
      }
    }
  },{code}
 *Допинфо:*

Между логами: `{{Загрузка сообщений в место назначения}}` и `{{Уведомляем источник об успешной обработке сообщения}}`, происходит вызов нескольких ХП внутри транзакции (которые отрабатывают очень быстро) и потом просиходит коммит транзакции. На выделенной пачке логов видно, что на коммит транзакции ушло 18 секунд

[http://adirelkprod.alfadirect.ru/goto/ced594a055d8642e3e7273d54e1fd1be]

!image-2024-10-16-12-59-31-371.png!

 

После общения с Павлом Куликовым было выдвинуто предположение, что управление транзакционной моделью происходит на стороне сервиса, а не на стороне БД. Чего быть не должно. Вероятно при массовых зачислениях такая логика работы может вызывать подобные задержки  при пополнении денежных средств и влиять на другие бизнес процессы, которые висят на service broker SQL 

 ",,,
ADIRINC-1817,5646972,U_M2614,NEW,09.10.2024 19:50,,,,,Дефект промсреды,,2024-11-21 00:00:00.0,"9.10 произошла авария , которая зааффектила на зачисления дс и выводы дс с \на брокерские счета.

Проводилась маркетинговая акция , связанная с зачислением дс на брокерские счета, за определённые действия клиента.

Данные зачисления загружались по реестрам в EQ сотрудниками подразделения маркетинга большой пачкой ~92 тысячи 

Данные зачисления стали попадать в очередь MQ EQ_WMQ_ADATR1.OP1.Q, которая предназначена для собственных зачислений клиентов. Для массовых зачислений существует выделенная очередь EQ_WMQ_ADATR2.OP1.Q, с которой работает выделенный сервис.

 

К 12.08 9.10.2024 в очереди EQ_WMQ_ADATR1.OP1.Q накопилось порядка 50000 событий (зачислений), которые не успевали вычитываться сервисом трансляции из MQ в БД.

При принудительном переносе событий с помощью сопровождения WMQ данных из очереди EQ_WMQ_ADATR1.OP1.Q в очередь массовых зачислений EQ_WMQ_ADATR2.OP1.Q данные в ней начинали потихоньку разбираться.

Необходимо , на стороне ЖМОН EQ для подобных массовых начислений поменять целевую очередь. 

 *Допинфо:*

 

*https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=682545100*

 Условие попадание в очереди описано здесь

3.2 Условие разделения
По каждому событию проверяется равенство YR6AN1 и YR6AN2.4

Если YR6AN1 = YR6AN2 и (YR6PB1 <> DEPN% или ADIR%), то изменения в YR6PF собирается сообщение с данными из YR6PF, SGPF, SAPF и отправляется в Очередь1
Во всех остальных случаях при изменениях в YR6PF собирается сообщение с данными из YR6PF, SGPF, SAPF и отправляется в Очередь2.

YR6AN1 и YR6AN2 - ПИН клиента в рамках 13-ти значного номера счета
YR6PB1 - код программного комплекса которым была заведена проводка",,,
ADIRINC-1816,5636283,U_M25TF,На исправление,08.10.2024 15:28,,,,,Дефект промсреды,,2024-11-19 00:00:00.0,"Приложение iOS 'Совпало' и веб-терминал, открытый в Safari на iOS - клиент пытается вывести средств в маржу, при нажатии кнопка 'перевести' ничего не происходит. При этом клиент спокойно выводит ДС в маржу в ДТ.

Запись проблемы предоставлена в видео в треде.

тред
[https://rc.alfa-bank.net/channel/adir-lk-pub/thread/vOPNr1Dmp8ofFdFH9]",,,
ADIRINC-1815,5634221,U_M0A0R,На исправление,08.10.2024 14:24,,,,,Дефект промсреды,,2024-11-19 00:00:00.0,"Клиент не может выставить заявку на покупку фьючерса BR-11.24 на всю сумму, которая находится на субсчёте 001.
лог: [http://webadmin.k8s-master.alfadirect.ru/reporting/orderlimitlog/T2oWZpIBjFuD9h9ujSIV]

!image-2024-10-08-14-19-46-062.png!

!image-2024-10-08-14-19-58-761.png!

т.к. это фьючерс, то расчет должен исходить из ГО
т.е. 
|74 861,92 / 100 * 12 = 8983,43 * 35 = 314420,064|

У клиента доступно ДС 2 668 141,43

но при это доступно кол-во только 35, что является не верным",,2.0,
ADIRINC-1814,5628484,U_M0A0R,Принят к исправлению,07.10.2024 18:25,,,,,Дефект промсреды,,2024-10-18 00:00:00.0,"Пи анализе обращений клиентов, которые обращаются в клиентский сервис с запросами о переводе средств со Срочного Рынка на КЦБ выяснили, что на экране для вывода средств формируется некорректный остаток - сумма ответствует позиции на разделе КЦБ, но по счетам в режиме единого рынка остатки должны суммироваться

Таким образом возникает ситуация при которой
 * В позициях клиент видит объеденную позицию, которая может существенно отличаться от суммы на экране для вывода
 * В случае если при переводе остатки на разделе КЦБ были равны нулю вывод средств будет невозможен
 * Перевести средства между рынками клиент так же не может, так как режиме единого рынка переводы заблокированы.

!image-2024-10-08-18-31-38-082.png!

!image-2024-10-07-18-27-23-547.png!",,,
ADIRINC-1811,5577121,U_M07FZ,На исправление,01.10.2024 13:23,,,,,Дефект промсреды,,2024-11-12 00:00:00.0,"ГС клиента 81806-003

Клиент выбирает 81806-003 и переходит в раздел 'Маржинальные параметры', раздел не прогружается.

Подключил клиента к своему портфелю, проблема воспроизвелась. 

По итогу обсуждения с Ермаковым С., было принято решение завести дефект.

Логи приложены

Версия приложения: 3.11.0 (6010)
Логин: blosev
Устройство: iPhone 12 Pro
Прошивка: iOS 17.6.1
Время: 01.10.2024, 11:08:27 (3)
Время сервера: 01.10.2024, 11:08:27
Статус работы серверов: + + + +
Интернет соединение: Cellular (type4G)
VPN: OFF



!image-2024-10-01-13-21-09-479.png!",,,
ADIRINC-1810,5559786,U_M2902,Отложен,30.09.2024 16:38,,,,,Дефект промсреды,,2024-11-11 00:00:00.0,"В мобильном терминале АИ не верно блокируется сумма под гарантийное обеспечение. Необходимо брать текущую ставку риска по короткой позиции, а МТ берет начальную ставку риска по короткой позиции.  !image-2024-09-30-16-37-00-790.png!!image-2024-09-30-16-37-12-471.png!",,,
ADIRINC-1808,5541595,U_M19LL,Отклонен командой,27.09.2024 18:23,,,,,Дефект промсреды,,2024-11-11 00:00:00.0,"Не верно рассчитываются форвордная позиция по сделкам которые урегулируются в Т0.

По итогу созвона с Алексеем Климовым, Дмитрием Супруном и Александром Карповым 30.09.2024 наполним дефект фактурой.

Неверный расчет влияет на некорректное отображение остатка по рублям в МТ",,,
ADIRINC-1807,5532673,U_M169D,На исправление,26.09.2024 16:53,product_report:развитие_цифровых_каналов,,,,Дефект промсреды,,2024-11-07 00:00:00.0,"Сервис adir-moex-ftp-reports не обработал файл CCX43  за 25.09.2024, предварительно потому что файл CCX43 за 25 число пришел в 25.09.2024 в 23:56:00  и следующий запуск сервиса 26.09.24 не вычитал данный файл.  
Подробности в треде https://rc.alfa-bank.net/channel/adir_admins_public?msg=NFem7KkAMELnSbPcc",,,
ADIRINC-1806,5528330,U_M1KZC,На исправление,26.09.2024 11:19,,,,,Дефект промсреды,,2024-11-07 00:00:00.0,"При попытке выставления заявки по бумаге ТКС ru000A107UL4 в приложении АИ для iOS 3.9.0 'сворачивается' окно заявки после ввода параметров заявки (ввод количества). Подробности в прилагаемом видео. Просьба проверить, исправить.
Комментарии для сотрудника: обращение на основе чата в группе СКС Сейлз

Суть запроса экспертизы: гс 144735",,,
ADIRINC-1804,5512083,U_M19LL,Отклонен командой,24.09.2024 13:06,,,,,Дефект промсреды,,2024-12-17 00:00:00.0,"По некоторым фьючерсам не отображается текущая цена в момент выставления заявки.
1. Выбрать вкладку ""Фьючерсы""
2. Тапнуть по любому фьючерсу
3. Перейти на вкладку ""Заявка""

  В верхней части экрана над кнопками смены направления ""Покупка"", ""Продажа"" отображается малый стакан в котором отображаются: цены Bid и Ask, процент изменения цены. Рыночная цена (Quote.Price) *НЕ* отображается ",,,
ADIRINC-1803,5507792,U_M19LL,Закрыт,23.09.2024 17:55,2.32,Android,,,Дефект промсреды,24.10.2024 10:58,2024-11-22 00:00:00.0,"При попытке  пополнить БС в Юанях с ТС в Юанях, счет в юанях не отображается не отображается. Нет счетов в этой валюте. 

Поговорили с Мелиховой Светланой, дефект подтвержден, будет исправлен в 2,32

 ",,,
ADIRINC-1802,5486863,U_M1QLD,Принят к исправлению,19.09.2024 17:13,Frontend,product-report,лучшая_цифровая_платформа,,Дефект промсреды,,2024-10-31 00:00:00.0,"АИ МТ AKMKIC ГС 100106 андроид версии 2.31.0 на графике не отображаются вход и выход из позиции в виде треугольников, но если нажать на 'Шестеренку', то они начинают отображаться.

!image-2024-09-19-17-29-07-515.png!

При нажатии на шестеренку треугольник появляется:

!image-2024-09-19-17-28-48-764.png!

При воспроизведении дефекта, треугольник изначально отображается, после нажатия на шестеренку, и последующего выхода, он исчезает (и затем отображается только после нажатия на шестеренку (видео во вложении).",,2.0,
ADIRINC-1800,5473139,U_M1HFE,На исправление,18.09.2024 09:48,,,,,Дефект промсреды,,2024-10-30 00:00:00.0,"В сервис adir-mq2db-incoming-money-transfers-mass-automatic-payments попало зачисление, которое должно было зачислиться на заблокированный счет

ФР: Сервис перестал разгребать очередь
ОР: Сервис должен корректно обработать ошибку и дальше продолжить разгребать очередь

!image-2024-09-18-09-49-17-603.png|width=800,height=347!

Процедура hell.[ext_tran].[save_transfer] возвращает следующий экцепшен

```
Microsoft.Data.SqlClient.SqlException (0x80131904): Недопустимо внести не нулевой баланс для счета, который уже закрыт или заблокирован (например, 4249491-000). at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose) at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady) at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted) at Microsoft.Data.SqlClient.SqlCommand.CompleteAsyncExecuteReader(Boolean isInternal, Boolean forDescribeParameterEncryption) at Microsoft.Data.SqlClient.SqlCommand.InternalEndExecuteNonQuery(IAsyncResult asyncResult, Boolean isInternal, String endMethod) at Microsoft.Data.SqlClient.SqlCommand.EndExecuteNonQueryInternal(IAsyncResult asyncResult) at Microsoft.Data.SqlClient.SqlCommand.EndExecuteNonQueryAsync(IAsyncResult asyncResult) at System.Threading.Tasks.TaskFactory`1.FromAsyncCoreLogic(IAsyncResult iar, Func`2 endFunction, Action`1 endAction, Task`1 promise, Boolean requiresSynchronization) --- End of stack trace from previous location --- at AlfaDirect.DatabaseUtils.Executor.Implementation.Ado.AdoExecutor.ExecuteAsync(CancellationToken cancellationToken) at MqToDatabase.Library.Db.Hell.HellDbContext.SaveTransferAsync(SaveTransferInput input, CancellationToken cancellationToken) in C:\BuildAgent\work\6987d3a10f53e630\MqToDatabase\Library\Db\Hell\HellDbContext.cs:line 72 at MqToDatabase.Library.Etl.Loader.LoadAsync(EtlContext context, MoneyTransferExtended transfer, CancellationToken cancellationToken) in C:\BuildAgent\work\6987d3a10f53e630\MqToDatabase\Library\Etl\Loader.cs:line 38 at EtlLibrary.Implementations.DataTransferService`2.InternalExecuteAsync(EtlContext context, CancellationToken cancellationToken) in C:\BuildAgent\work\6987d3a10f53e630\EtlLibrary\Implementations\DataTransferService.cs:line 109 at EtlLibrary.Implementations.DataTransferService`2.ExecuteAsync(EtlContext context, CancellationToken cancellationToken) in C:\BuildAgent\work\6987d3a10f53e630\EtlLibrary\Implementations\DataTransferService.cs:line 51 ClientConnectionId:31a0e77a-6a96-4991-aea5-4491d3105821 Error Number:90000,State:1,Class:16 HelpLink.ProdName: Microsoft SQL Server;HelpLink.ProdVer: 15.00.4385;HelpLink.EvtSrc: MSSQLServer;HelpLink.EvtID: 90000;HelpLink.BaseHelpUrl: https://go.microsoft.com/fwlink;HelpLink.LinkId: 20476
```",,,CoreMT
ADIRINC-1798,5437777,U_M1W4D,Отклонен,12.09.2024 12:35,,,,,Дефект промсреды,07.10.2024 08:20,2024-10-24 00:00:00.0,"Клиент AVXDVG 4642508

Клиент выставил лимитную заявку на покупку инструмента RU000A107T19 на СПБ Бирже за 3530 рублей. 
При этом в стакане не отображается лимитная заявка №62324501484 от 02 сен 2024 22:03 мск на покупку а.о. Яндекс (Isin RU000A107T19) на СПБ Бирже.
Заявка в статусе Активная
[http://webadmin.k8s-master.alfadirect.ru/reporting/orders/4642508-000/62324501484/1]

'Многодневная заявка #62324501484 переведена в статус HiddenPeriod(12) после снятия биржей, ожидает нового выставления'

т.е. заявка перестала отображаться в стакане, когда перешла в 12 статус.
!image-2024-09-12-12-33-10-032.png!
 

Тред по данной теме
https://rc.alfa-bank.net/channel/a-inv-mt?msg=aPF8BgDAYpqs7ZafS

 ",,1.0,
ADIRINC-1797,5435642,U_M0SLM,На исправление,12.09.2024 09:09,product_report:базовые_продукты,report,,,Дефект промсреды,,2024-12-05 00:00:00.0,"Коллег, наблюдаем фон ошибок по сервису adir-core.forts-positions.fact.forts.0 ""Недопустимый идентификатор счета с биржи""
предположительно от МБ поступают данные, которые ХП не может обработать.
[https://confluence.moscow.alfaintra.net/display/ADIR/adir-k2db-forts-positions-post-trade]

 
 * 
[http://adirelkprod.alfadirect.ru/goto/3fcf0226e9abe227aae2b8b90e2052bf]


 * 
{{""SqlError 1"": ""Microsoft.Data.SqlClient.SqlError: Недопустимый идентификатор счета с биржи""}}


{code:java}
      ""StackTraceString"": ""   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\r\n   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)\r\n   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)\r\n   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)\r\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)\r\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)\r\n   at Microsoft.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, Boolean sendToPipe, Int32 timeout, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String methodName)\r\n   at Microsoft.Data.SqlClient.SqlCommand.(TaskCompletionSource`1 completion, Boolean sendToPipe, Int32 timeout, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String methodName)\r\n   at Microsoft.Data.SqlClient.SqlCommand.ExecuteNonQuery()\r\n   at AlfaDirect.DatabaseUtils.Logged.LoggedDbCommand.ExecuteNonQuery()\r\n   at System.Data.Common.DbCommand.ExecuteNonQueryAsync(CancellationToken cancellationToken)\r\n--- End of stack trace from previous location ---\r\n   at Dapper.SqlMapper.ExecuteImplAsync(IDbConnection cnn, CommandDefinition command, Object param) in /_/Dapper/SqlMapper.Async.cs:line 654\r\n   at DataAccess.DbContext.SaveAsync(Dictionary`2 parameters, OperationType operationType) in C:\\BuildAgent\\work\\1490672691b5677a\\DataAccess\\DbContext.cs:line 44\r\n   at DataAccess.DbContext.SaveAsync(Dictionary`2 parameters, OperationType operationType) in C:\\BuildAgent\\work\\1490672691b5677a\\DataAccess\\DbContext.cs:line 44\r\n   at Service.DataTransferService.<>c__DisplayClass9_0.<<TransferAsync>b__0>d.MoveNext() in C:\\BuildAgent\\work\\1490672691b5677a\\Service\\DataTransferService.cs:line 62\r\n--- End of stack trace from previous location ---\r\n   at Polly.AsyncPolicy.<>c__DisplayClass40_0.<<ImplementationAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Polly.Retry.AsyncRetryEngine.ImplementationAsync[TResult](Func`3 action, Context context, CancellationToken cancellationToken, ExceptionPredicates shouldRetryExceptionPredicates, ResultPredicates`1 shouldRetryResultPredicates, Func`5 onRetryAsync, Int32 permittedRetryCount, IEnumerable`1 sleepDurationsEnumerable, Func`4 sleepDurationProvider, Boolean continueOnCapturedContext)\r\n   at Polly.AsyncPolicy.ExecuteAsync(Func`3 action, Context context, CancellationToken cancellationToken, Boolean continueOnCapturedContext)\r\n   at Service.DataTransferService.TransferAsync(CancellationToken token) in C:\\BuildAgent\\work\\1490672691b5677a\\Service\\DataTransferService.cs:line 61"",
{code}
 !image-2024-09-12-09-08-03-115.png!
 
 * !image-2024-09-12-09-08-29-347.png!",,,
ADIRINC-1796,5434443,U_M25TF,На исправление,11.09.2024 19:12,,,,,Дефект промсреды,,2024-11-13 00:00:00.0,"У клиентов Подарочные акции, Текущая цена, отображается 0
!image-2024-09-11-19-11-38-653.png!

была встреча по данному вопросу с Суслин Олег, заводим Дефект.",,11.0,
ADIRINC-1795,5430990,U_M13MK,На исправление,11.09.2024 12:53,Дефект_АИ,,,,Дефект промсреды,,2024-10-23 00:00:00.0,"По клиенту BCWUDP  4765298
 наблюдается некорректный расчет доходности в Портфельной аналитике, в данном примере ""Фонды""
 !image-2024-09-11-12-35-52-028.png!
 !image-2024-09-11-12-36-11-783.png!

сервис adir-portfolio-analytics возвращает некорректные данные доходности Фондов на главном экране Портфельной аналитики.
 т.е.
 У клиента закрытые позиции по фондам. на втором скриншоте доходность указана корректно, а вот на первом скриншоте (главный экран портфельной аналитики) доходность указывается некорректно. И причиной этому  сделки совершенные 29.12.2023, которые были рассчитаны в 03.01.2024

логи сервисов:
 !image-2024-09-11-12-39-22-021.png!
{code:java}
response body={
  ""assetsFinResult"" : [ {
    ""actId"" : 115771,
    ""shortName"" : ""БПИФ Ликвидность УК ВИМ"",
    ""name"" : ""БПИФ Ликвидность УК ВИМ"",
    ""isin"" : ""RU000A1014L8"",
    ""regCode"" : ""3915"",
    ""ticker"" : ""VTBL"",
    ""symbolObject"" : ""VTBL"",
    ""currency"" : ""RUB"",
    ""finResultTotal"" : 61500,
    ""idObject"" : 554340,
    ""idObjectBase"" : 514893
  }, {
    ""actId"" : 125232,
    ""shortName"" : ""БПИФ «Альфа-Капитал Денежный рынок»"",
    ""name"" : ""Денежный рынок Альфа-Капитал"",
    ""isin"" : ""RU000A104X08"",
    ""regCode"" : ""5012"",
    ""ticker"" : ""AKMM"",
    ""symbolObject"" : ""AKMM"",
    ""currency"" : ""RUB"",
    ""finResultTotal"" : 18611.68,
    ""idObject"" : 824318,
    ""idObjectBase"" : 517529
  } ]
{code}
!image-2024-09-11-12-41-38-300.png!
{code:java}
RESPONSE BODY 
AnalyticsReportResponse(portfolioRevenue=AnalyticsReportResponse.Report(value=-7175203.23, currency=RUB), returnOnAssets=AnalyticsReportResponse.Report(value=-6.73, currency=%), sharesRevenue=AnalyticsReportResponse.Report(value=-4892813.44, currency=RUB), bondsRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), currenciesRevenue=AnalyticsReportResponse.Report(value=0.00, currency=RUB), derivativesRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), fundsRevenue=AnalyticsReportResponse.Report(value=2122211.95, currency=RUB), dividends=AnalyticsReportResponse.Report(value=738849.96, currency=RUB), couponRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), pmetsRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), commissions=AnalyticsReportResponse.Report(value=-166964.53, currency=RUB), marginTrade=AnalyticsReportResponse.Report(value=-1135537.21, currency=RUB), taxes=AnalyticsReportResponse.Report(value=0, currency=RUB), inputs=AnalyticsReportResponse.Report(value=106691618.56, currency=RUB), outputs=AnalyticsReportResponse.Report(value=28283574.78, currency=RUB), inputsPapers=AnalyticsReportResponse.Report(value=3897, currency=RUB), outputsPapers=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyTransfersRUB=null, moneyTransfersUSD=null, moneyTransfersEUR=null, moneyInputsTotal=AnalyticsReportResponse.Report(value=106687721.56, currency=RUB), moneyInputsRUB=AnalyticsReportResponse.Report(value=106687721.56, currency=RUB), moneyInputsUSD=AnalyticsReportResponse.Report(value=0, currency=USD), moneyInputsEUR=AnalyticsReportResponse.Report(value=0, currency=EUR), moneyInputsCNY=AnalyticsReportResponse.Report(value=0, currency=CNY), moneyInputsOther=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyOutputsTotal=AnalyticsReportResponse.Report(value=28283574.78, currency=RUB), moneyOutputsRUB=AnalyticsReportResponse.Report(value=28283574.78, currency=RUB), moneyOutputsUSD=AnalyticsReportResponse.Report(value=0, currency=USD), moneyOutputsEUR=AnalyticsReportResponse.Report(value=0, currency=EUR), moneyOutputsCNY=AnalyticsReportResponse.Report(value=0, currency=CNY), moneyOutputsOther=AnalyticsReportResponse.Report(value=0, currency=RUB), isAssetsNegative=AnalyticsReportResponse.Report(value=0, currency=), beginNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), endNAV=AnalyticsReportResponse.Report(value=71232840.55, currency=RUB), sharesEndNAV=AnalyticsReportResponse.Report(value=90567212.30, currency=RUB), bondsEndNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), currenciesEndNAV=AnalyticsReportResponse.Report(value=0.00, currency=RUB), derivativesEndNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), pmetsEndNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), benchMarkRts=AnalyticsReportResponse.BenchMark(code=RTS, name=Индекс РТС, value=-42.98, currency=%), benchMarkImoex=AnalyticsReportResponse.BenchMark(code=IMOEX, name=Индекс ММВБ, value=-15.24, currency=%), benchMarkSpx=AnalyticsReportResponse.BenchMark(code=SPX, name=Индекс S&P500, value=66.39, currency=%), benchMarkIxic=AnalyticsReportResponse.BenchMark(code=IXIC, name=Индекс NASDAQ, value=82.07, currency=%), benchMarkDji=AnalyticsReportResponse.BenchMark(code=DJI, name=Индекс Dow Jones Industrial, value=41.24, currency=%), benchMarkMmvb=AnalyticsReportResponse.BenchMark(code=ММВБ10, name=Индекс ММВБ10, value=-10.81, currency=%), benchMarkIgold=AnalyticsReportResponse.BenchMark(code=IGOLD, name=Индекс GOLD, value=61.12, currency=%), benchMarkProduct=AnalyticsReportResponse.BenchMark(code=PERSONALBROKER, name=Персональный брокер, value=3.42, currency=%))
<--- body takes 363 milliseconds
{code}
По брокерскому отчету видим, что не учитываются сделки за 23 год, да и в принципе доходность указывается некорректно.

!image-2024-09-11-12-47-43-623.png!

что показывает:
 что цифра, отображаемая в ""Портфельной аналитике"" складывается из:
 4006929,83 -1097668,15 (2023г) - 848500,00 (2023г) + 61500 (БПИФ Ликвидность) = 2122211,68 (что соответствует скриншоту клиента)
 не учлась сделка по БПИФ Альфа-Капитал на сумму 18611,68

Необходимо устранить ошибку и выводить клиентам корректный расчет доходности в Портфельной Аналитике.

 ",,2.0,
ADIRINC-1793,5418921,U_M13MK,На исправление,09.09.2024 15:03,,,,,Дефект промсреды,,2024-10-21 00:00:00.0,"У клиента AVUTIN 4398758 произошла конвертация NXTR в GDEVAO дата фиксации реестра 04/09/2024.
Ошибка заключается в том, что после конвертации у клиента отображается вывод цб и дс, что является некорректной информацией.
!image-2024-09-09-15-00-22-241.png!
!image-2024-09-09-15-00-35-850.png!
!image-2024-09-09-15-00-47-551.png!
!image-2024-09-09-15-00-59-905.png!
!image-2024-09-09-15-01-12-125.png!

В логах сервиса adir-portfolio-analytics возвращается поле как вывод. лог ниже:

[http://adlog1/kibana/goto/558a3420-6ea3-11ef-a9fb-d1c5ec161b4e]
traceid f594b555f6e51978


{code:java}
""[DirectAnalyticsClient#getAnalyticsReport(String,AnalyticsReportRequest)] http://172.21.1.97:80/api/auth/portfolioanalytics?accountId=4398758&dateTo=2024-09-05&dateFrom=2024-08-05\n\nRESPONSE HEADERS\nServer: nginx/1.20.1\nDate: Thu, 05 Sep 2024 10:45:57 GMT\nContent-Type: application/json; charset=utf-8; v=1\nTransfer-Encoding: chunked\nConnection: keep-alive\nx-envoy-upstream-service-time: 343\n<--- headers takes 347 milliseconds  \nRESPONSE BODY \nAnalyticsReportResponse(portfolioRevenue=AnalyticsReportResponse.Report(value=2413295.47, currency=RUB), returnOnAssets=AnalyticsReportResponse.Report(value=657.35, currency=%), sharesRevenue=AnalyticsReportResponse.Report(value=2413281.59, currency=RUB), bondsRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), currenciesRevenue=AnalyticsReportResponse.Report(value=13.88, currency=RUB), derivativesRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), fundsRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), dividends=AnalyticsReportResponse.Report(value=0, currency=RUB), couponRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), pmetsRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), commissions=AnalyticsReportResponse.Report(value=0, currency=RUB), marginTrade=AnalyticsReportResponse.Report(value=0, currency=RUB), taxes=AnalyticsReportResponse.Report(value=0, currency=RUB), inputs=AnalyticsReportResponse.Report(value=0, currency=RUB), outputs=AnalyticsReportResponse.Report(value=2778131.98, currency=RUB), inputsPapers=AnalyticsReportResponse.Report(value=0, currency=RUB), outputsPapers=AnalyticsReportResponse.Report(value=2778131.98, currency=RUB), moneyTransfersRUB=null, moneyTransfersUSD=null, moneyTransfersEUR=null, moneyInputsTotal=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyInputsRUB=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyInputsUSD=AnalyticsReportResponse.Report(value=0, currency=USD), moneyInputsEUR=AnalyticsReportResponse.Report(value=0, currency=EUR), moneyInputsCNY=AnalyticsReportResponse.Report(value=0, currency=CNY), moneyInputsOther=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyOutputsTotal=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyOutputsRUB=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyOutputsUSD=AnalyticsReportResponse.Report(value=0, currency=USD), moneyOutputsEUR=AnalyticsReportResponse.Report(value=0, currency=EUR), moneyOutputsCNY=AnalyticsReportResponse.Report(value=0, currency=CNY), moneyOutputsOther=AnalyticsReportResponse.Report(value=0, currency=RUB), isAssetsNegative=AnalyticsReportResponse.Report(value=0, currency=), beginNAV=AnalyticsReportResponse.Report(value=367127, currency=RUB), endNAV=AnalyticsReportResponse.Report(value=2290.49, currency=RUB), sharesEndNAV=AnalyticsReportResponse.Report(value=948.95, currency=RUB), bondsEndNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), currenciesEndNAV=AnalyticsReportResponse.Report(value=392.18, currency=RUB), derivativesEndNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), pmetsEndNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), benchMarkRts=AnalyticsReportResponse.BenchMark(code=RTS, name=Индекс РТС, value=-12.03, currency=%), benchMarkImoex=AnalyticsReportResponse.BenchMark(code=IMOEX, name=Индекс ММВБ, value=-7.90, currency=%), benchMarkSpx=AnalyticsReportResponse.BenchMark(code=SPX, name=Индекс S&P500, value=6.61, currency=%), benchMarkIxic=AnalyticsReportResponse.BenchMark(code=IXIC, name=Индекс NASDAQ, value=5.78, currency=%), benchMarkDji=AnalyticsReportResponse.BenchMark(code=DJI, name=Индекс Dow Jones Industrial, value=5.77, currency=%), benchMarkMmvb=AnalyticsReportResponse.BenchMark(code=ММВБ10, name=Индекс ММВБ10, value=-8.59, currency=%), benchMarkIgold=AnalyticsReportResponse.BenchMark(code=IGOLD, name=Индекс GOLD, value=-99.96, currency=%), benchMarkProduct=AnalyticsReportResponse.BenchMark(code=MARGIN, name=Маржинальная торговля, value=986.02, currency=%))\n<--- body takes 347 milliseconds"",    ""container_id"": ""invest_portfolio-analytics-api.fea9a32b-6ac0-11ef-b5c3-3e52beeb5f94""
{code}
outputs=AnalyticsReportResponse.Report(value=2778131.98, currency=RUB)
outputsPapers=AnalyticsReportResponse.Report(value=2778131.98, currency=RUB)

!image-2024-09-09-15-03-20-999.png!",,1.0,Montblanc
ADIRINC-1792,5417536,U_M0WVN,Отклонен,09.09.2024 12:33,,,,,Дефект промсреды,18.09.2024 11:17,2024-10-21 00:00:00.0,"Пожаловались клиенты на то , что 6.09.24 перестали видеть часть своих инструментов в портфеле.

Примерно в 5.50 утра пошли ошибки по микросервису multi-market-api о том , что невозможно распарсить борд по определенному objectid.

Выглядело так:

!image-2024-09-09-12-09-47-704.png!

Далее данный микросервис обращался в кор сервис adir-multi-markets-asset-info, в котором повысился фон ошибок типа ""Актив не имеет ни одного дефолтного рынка на бирже"", они были и ранее но их количество выросло в разы:

!image-2024-09-09-12-25-11-502.png!

Заметили, что утром пришла информация с СПБ биржи по 99 инструментам, которые завелись автоматически на 331 борд, однако возник конфликт с определением ликвидного рынков по ним, тк вероятно требутся почему то какие то ручные дополнительные манипуляции для их корректной донастройки.

 

В итоге после жалоб клиентов было принято решение о добавлении информации по данным инструментам adfront.[Liquidity].[DisabledTradeMarketBoards] и был сделан пересчет ликвидного рынка по ним

Подробнее тут https://rc.alfa-bank.net/channel/adir-avarii?msg=d2oQ3HFf4ritJ89bb

 

Просьба доработать механизм ,для того чтобы заведение данных инструментов проходило бесшовно автоматически , без ручных манипуляций

 ",,,Марс
ADIRINC-1791,5408170,U_M1QLD,Принят к исправлению,06.09.2024 13:36,Дефект_АИ,,,,Дефект промсреды,,2024-10-18 00:00:00.0,"В приложении МТ 2.31.0 Не обновляется график в онлайн просмотре (новые данные приходят только при смене вкладки)
 !image-2024-09-06-13-35-24-806.png!

График появляется только при смене вкладки.
 Ошибка воспроизводится на разных устройствах под разными УЗ
 прикладываем логи со своего устройства во вложении ниже",,1.0,Appalachians
ADIRINC-1790,5407612,U_M1W4D,Отклонен командой,06.09.2024 12:56,Дефект_АИ,,,,Дефект промсреды,,2024-10-18 00:00:00.0,"В приложении Мт 2.31.0 Некорректное отображение графика со сделкой.
!image-2024-09-06-12-53-54-527.png!

 во кладке Обзор на графике клиент видит кружок, обозначающий сделку, в 16-50 (часовой пояс от мск +2 часа), поэтому цена указана как 180,30 руб. 
Фактически у клиента сделка была в 14:47 по мск и позиция открыта по цене 182 руб.
но при этом Сделка отображается с ценой 182, а позиция ""Кружочка"" ниже 181.50
!image-2024-09-06-12-55-39-078.png!",,1.0,Appalachians
ADIRINC-1789,5403313,U_M1BFA,На исправление,05.09.2024 16:34,,,,,Дефект промсреды,,2024-10-17 00:00:00.0,"В процессе работы в веб-терминале возникает ошибка авторизации клиента и соединение с сервером.
!image-2024-09-05-16-33-04-667.png!

Ошибка правится в рамках задачи https://jira.moscow.alfaintra.net/browse/APOLLO-6",,4.0,
ADIRINC-1788,5401980,U_M20N2,Отклонен командой,05.09.2024 14:19,,,,,Дефект промсреды,,2024-10-17 00:00:00.0,"На примере клиента AR6WPE ГС 2467444:

Клиент пополнил инвесткопилку 31.08.2024 8:20 на сумму 500 рублей, вывода ДС с ИК не было:

!image-2024-09-05-14-20-46-289.png!

Покупка БПИФ прошла только 03.09.2024:

!image-2024-09-05-14-26-24-052.png!

http://adirelkprod.alfadirect.ru/goto/b23c980127d297a6f11ce88d86518108

!image-2024-09-05-14-39-03-217.png!  

Лимиты также начали рассчитываться только 03.09.2024:

  !image-2024-09-05-14-29-26-406.png!

По логам также нет попыток запросов на покупку за 02.03.2024 :

http://adirelkprod.alfadirect.ru/goto/be6c393f2e9661532d3849b4ed797d6e

Покупка БПИФ может не попасть в ближайший период выставления, но покупка в течение всего дня так и не произошла.

[Инвесткопилка от Альфа-Инвестиций|http://infobrb/Finance/AlphaDirect/Pages/AllDocs/Investkopilka-ot-Aljfa-Investicij-.aspx]

!image-2024-09-05-14-34-17-854.png!

 *+_Требуется устранить ошибку и исключить повторения кейса в будущем по всем клиентам._+*

 ",,2.0,
ADIRINC-1787,5400097,U_M20N2,Закрыт,05.09.2024 10:53,,,,,Дефект промсреды,07.11.2024 18:24,2024-10-17 00:00:00.0,"На примере ISIN RU000A0D8PB4, act_id 9215 ТНС энерго Ростов:

!image-2024-09-05-10-57-21-554.png!

В [https://nsddata.ru/ru/news/view/1164395] не указаны даты выплаты и фиксации:

!image-2024-09-05-10-58-02-922.png!

В по данному референсу в [hell_cache].[dividends].[history] дата выплаты указана 01.01.2111 

!image-2024-09-05-11-00-17-082.png!

Доработка ADIRINC-1641 по данной проблеме переоткрыта, т.к. проблема не решена.

 ",,2.0,Core
ADIRINC-1786,5387956,U_M1W4D,Отклонен командой,03.09.2024 13:09,,,,,Дефект промсреды,,2024-10-15 00:00:00.0,"АИ Web-terminal. в поле ""Ожидаемая доходность"" доступен ввод символов отличных от типа int
В данное поле был внесен символ ""%"", что привело к ошибкам сервиса, так как он не воспринимает данный символ и некорректного отображения портфеля.
!image-2024-09-03-13-06-50-775.png!
{code:java}
""stack_trace"": ""j.l.NumberFormatException: Character % is neither a decimal digit number, decimal point, nor \""e\"" notation exponential mark.\n\tat j.math.BigDecimal.<init>(BigDecimal.java:586)\n\tSuppressed: r.c.p.FluxOnAssembly$OnAssemblyException: \nError has been observed at the following site(s):\n\t*__checkpoint ⇢ Handler ru.alfabank.mobile.invest.model.portfolio.controller.PortfoliosController#getDetailedPortfolios(Headers, String, Continuation) [DispatcherHandler]\nOriginal Stack Trace:\n\t\tat j.math.BigDecimal.<init>(BigDecimal.java:586)\n\t\tat j.math.BigDecimal.<init>(BigDecimal.java:471)\n\t\tat j.math.BigDecimal.<init>(BigDecimal.java:900)\n\t\tat r.a.m.i.m.p.u.Utils.formatAmount(Utils.kt:12)\n\t\tat r.a.m.i.m.p.s.c.PortfoliosAutoConverter.convertToPortfolios(PortfoliosAutoConverter.kt:43)\n\t\tat r.a.m.i.m.p.s.PortfoliosAutoService$getPortfolios$2$models$5.invoke(PortfoliosAutoService.kt:49)\n\t\tat r.a.m.i.m.p.s.PortfoliosAutoService$getPortfolios$2$models$5.invoke(PortfoliosAutoService.kt:49)\n\t\tat k.s.TransformingSequence$iterator$1.next(Sequences.kt:210)\n\t\tat k.s.SequencesKt___SequencesKt.toCollection(_Sequences.kt:787)\n\t\tat k.s.SequencesKt___SequencesKt.toMutableList(_Sequences.kt:817)\n\t\tat k.s.SequencesKt___SequencesKt.toList(_Sequences.kt:808)\n\t\tat r.a.m.i.m.p.s.PortfoliosAutoService$getPortfolios$2.invokeSuspend(PortfoliosAutoService.kt:50)\n\t\tat k.c.j.i.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)\n\t\tat k.c.DispatchedTaskKt.resume(DispatchedTask.kt:234)\n\t\tat k.c.DispatchedTaskKt.resumeUnconfined(DispatchedTask.kt:190)\n\t\tat k.c.DispatchedTaskKt.dispatch(DispatchedTask.kt:161)\n\t\tat k.c.CancellableContinuationImpl.dispatchResume(CancellableContinuationImpl.kt:397)\n\t\tat k.c.CancellableContinuationImpl.resumeImpl(CancellableContinuationImpl.kt:431)\n\t\tat k.c.CancellableContinuationImpl.resumeImpl$default(CancellableContinuationImpl.kt:420)\n\t\tat k.c.CancellableContinuationImpl.resumeWith(CancellableContinuationImpl.kt:328)\n\t\tat k.c.r.AwaitKt$awaitOne$2$1.onComplete(Await.kt:272)\n\t\tat r.c.p.StrictSubscriber.onComplete(StrictSubscrib..."",
    ""logger_name"": ""ru.alfabank.mobile.logger.ServiceExceptionLogger"",
{code}
сервис portfolio-model-api-v2

!image-2024-09-03-13-07-31-531.png!",,,
ADIRINC-1785,5387938,U_M1F32,Принят к исправлению,03.09.2024 13:03,,,,,Дефект промсреды,,2024-10-15 00:00:00.0,"АИ МТ. Логирование сервиса portfolio-model-api-v2 по traceID отображает не всю цепочку логов, а только ошибку.
Необходимо показывать всю цепочку по traceID
!image-2024-09-03-13-02-46-674.png!

 http://adlog1/kibana/goto/afd28b20-69db-11ef-a9fb-d1c5ec161b4e",,,Meribel
ADIRINC-1784,5378785,U_M1W4D,Закрыт,02.09.2024 11:53,,,,,Дефект промсреды,07.10.2024 08:24,2024-11-25 00:00:00.0,"При поиске инструмент RU000A0JS942 инструмент находит и сразу же пропадает.
Запись с экрана
[^Screenrecorder-2024-09-02-11-46-49-563.mp4]

на сайте МБ инструмент не торгуемый
[https://www.moex.com/n23768?ysclid=m0kqbs54z311638891]


в логах сервиса ошибок нет.
[http://adlog1/kibana/goto/614bff00-6908-11ef-a9fb-d1c5ec161b4e]
!image-2024-09-02-11-50-49-884.png!

Логи с устройства.
[^pasurguchiov_samsung-SM-N985F_07eca087-801e-3417-b389-ceda174346ad_2024-09-02_113444.zip]",,1.0,Сатурн
ADIRINC-1783,5371676,U_M25TF,На исправление,30.08.2024 19:16,,,,,Дефект промсреды,,2024-12-09 00:00:00.0,"На примере клиента AUXYPS ГС 5999418:

В версии 2.31.0 android в разделе Рынок в карточке бумаги раздел Сводка не отображается Оборот:

!image-2024-08-30-19-19-11-393.png!

На других версиях отображение корректное:

!image-2024-08-30-19-20-01-198.png!

 ",,70.0,
ADIRINC-1781,5361409,U_M1CUE,Отклонен командой,29.08.2024 13:55,,,,,Дефект промсреды,,2024-10-10 00:00:00.0,"У клиента AANF81 В терминале Альфа-инвестиции на ПК не загружаются графики
Сборка клиента 4.0.4209.1629

Воспроизводится на 4.0.4257.1312

При загрузке конфигурации присланной клиентом, открыты табы с графиками, в графиках отсутствуют инструменты.

Конфиг клиента во вложении в приложенной задаче",,,
ADIRINC-1779,5342041,U_M13MK,На исправление,26.08.2024 15:46,,,,,Дефект промсреды,,2024-10-07 00:00:00.0,"В приложении МТ версии 2.30.4 отображаются некорректные данные по позиции RU000A1089W7
 Клиент VIP ACEDF6 142539-001

!image-2024-08-26-15-36-43-827.png|width=845,height=226!

 

Номинал бумаги CHF, а отображается валюта в рублях.
 Произвели расчеты и подтвердилась данная версия.
 [https://rc.alfa-bank.net/channel/ocenka_aktivov?msg=DB7dMJYtR2Hn3q6ch]

В логах возвращается рублевая позиция
 !image-2024-08-26-15-45-40-658.png!
 [http://adlog1/kibana/goto/21845c00-63a9-11ef-890a-e97f280311e8]

Необходимо устранить ошибку",,2.0,
ADIRINC-1778,5337610,U_M0SLM,На исправление,26.08.2024 10:18,Дефект_АИ,,,,Дефект промсреды,,2024-10-07 00:00:00.0,"Сервис adir-tariff-synchronization-etl течет по памяти , необходимо устранить утечку. [https://confluence.moscow.alfaintra.net/display/ADIR/adir-tariff-synchronization-etl] 
!image-2024-08-26-10-17-28-180.png|width=797,height=397!",,,Core
ADIRINC-1777,5328967,U_M0C88,ТРЕБУЕТ УТОЧНЕНИЯ,23.08.2024 16:09,Дефект_АИ,,,,Дефект промсреды,,2024-10-04 00:00:00.0,"Клиент ЗАВЬЯЛОВ СЕРГЕЙ ВАСИЛЬЕВИЧ BGNXHW

При открытии брокерского счёта через приложение АМ появляется окно, что паспорт РФ просрочен:

!image-2024-08-23-16-11-18-509.png!

По логам в  [http://amlog/kibana/goto/3ef5b6e0-5f8e-11ef-b7f8-8d4e65c1e584] ошибка та же:

!image-2024-08-23-16-13-45-115.png!

У клиента действующий паспорт:

!image-2024-08-23-16-25-18-362.png!

Но дата выдачи совпадает с датой рождения:

!image-2024-08-23-16-29-04-553.png!

По логам в [http://adirelkprod.alfadirect.ru/goto/d2e58d76c00747a2fead77219c87b973] видим ошибку:

!image-2024-08-23-16-19-05-430.png!

Ранее считалось, что такие паспорта не действительны, т.к. он действует 1 день (с даты выдачи до дня рождения). 

На запрос в OSTO_ZAPROS@alfabank.ru , был получен ответ:

!image-2024-08-23-16-23-01-309.png!

 *+_Требуется устранить ошибку и исключить повторения кейса в будущем по всем клиентам._+*

 ",,5.0,K2
ADIRINC-1775,5319445,U_M1FE1,На исправление,22.08.2024 13:10,instruments-api,Дефект_АИ,Производительность,,Дефект промсреды,,2024-11-14 00:00:00.0," После релиза у сервиса увеличилось потребление ресурсов, из-за чего 22.08 в 10:36 перестали идти вызовы к core-сервису  difidend-info
 При откате, утилизация нормализовалась

https://jira.moscow.alfaintra.net/browse/ADIRINC-1775
 [http://admon/grafana/goto/5lX3F6jIg?orgId=1]

!image-2024-08-22-13-23-32-475.png!

!image-2024-08-22-13-35-54-290.png!",,,Elbrus
ADIRINC-1774,5309745,U_M0SLM,На исправление,21.08.2024 10:04,,,,,Дефект промсреды,,2024-10-02 00:00:00.0,"У клиента не выставилась заявка после недоступности со стороны МБ.

http://webadmin.k8s-master.alfadirect.ru/reporting/orders/7141065-000/61533906184/1

Возникла ошибка
!image-2024-08-21-10-01-45-950.png!
!image-2024-08-21-10-02-07-577.png!

Ошибка на нашей стороне.
Обсуждение в треде [https://rc.alfa-bank.net/channel/adir_duty?msg=p33GMDEfwLQm6y3rw]
задача на проблему https://jira.moscow.alfaintra.net/browse/ADIRSVC-4061",,1.0,Core
ADIRINC-1770,5309106,U_M1W4D,Закрыт,21.08.2024 09:52,,,,,Дефект промсреды,12.09.2024 07:57,2024-10-24 00:00:00.0,"Вечером 20.08.2024 в 21:20 начался фон ошибок сервиса daily-summary-api
http://adlog1/kibana/goto/7c80aa60-5f89-11ef-890a-e97f280311e8

!image-2024-08-21-09-49-04-846.png!


{code:java}
""message"": ""Server response. Body={\n  \""errorId\"" : \""2d94e685-621b-4e07-ab27-514f5129e35a\"",\n  \""application\"" : \""daily-summary-api\"",\n  \""errorCode\"" : \""BAD_REQUEST\"",\n  \""level\"" : \""ERROR\"",\n  \""messages\"" : {\n    \""en\"" : \""400 BAD_REQUEST \\\""Required query parameter 'assetCodes' is not present.\\\""\"",\n    \""ru\"" : \""Извините, что-то пошло не так, попробуйте позднее.\""\n  }\n}"",
{code}

как оказалось, сервис вызывал news-api, но данная интеграция не описана в документах сервиса 
[https://binary.moscow.alfaintra.net/artifactory/releases/ru/alfabank/mobile/invest/daily/summary/docs/0.0.11/docs-0.0.11-docs.zip!/index.html]

Требуется исправить ошибку сервиса.",,,Olympus
ADIRINC-1767,5305752,U_M1W4D,Закрыт,20.08.2024 13:56,Дефекты_АИ,История,,,Дефект промсреды,07.10.2024 08:24,2024-10-01 00:00:00.0,"Обсудили с Чикишевым Дмитрием, принято решение завести Дефект
У клиента 3636940 некорректно отображается история операций по 844


{code:java}
SELECT TOP (1000) *
  FROM [a_hell_opers].[dbo].[a_fin_transactions] with (nolock)
  Where treaty = '4339200'
  and p_code = 'FXUS'
  order by a_date desc
{code}
{code:java}
 
SELECT TOP (1000) ts_time ,* FROM [operations_cache].[hell].[trades] WITH (nolock) Where treaty = '4339200' and act_id = '14605'
{code}

!image-2024-08-20-13-55-01-537.png!
!image-2024-08-20-13-55-11-774.png!",,12.0,Сатурн
ADIRINC-1765,5305088,U_M1FE1,На исправление,20.08.2024 13:24,0,Дефект_АИ,Дивиденды,Отображение,Дефект промсреды,,2024-10-01 00:00:00.0,"В МТ АИ версии 2.30.0 во вкладке отображается 0 доходность в истории.

обговорили с Чикишевым Дмитрием, заведен Дефект по итогу анализа.

!image-2024-08-20-13-23-49-513.png!",,,
ADIRINC-1760,5296923,U_M1W4D,Отклонен,19.08.2024 13:46,Дефект_АИ,,,,Дефект промсреды,26.08.2024 10:25,2024-09-30 00:00:00.0," Воспроизводится по бумаге OFZ-PD 26247

При заполнении поля ""шт"" (сколько хотим купить) система некорректно рассчитывает сумму для пополнения для покупки.

!image-2024-08-19-13-41-12-198.png!

При это в МТ отображается корректно.

!image-2024-08-19-13-45-37-194.png!

Необходимо отображать корректную сумму для пополнения клиентам.

Вместо ""Для совершения сделки не хватает 899 367,51 ₽"" для совершения сделки клиенту необходимо иметь на балансе счета Итог 857 040,00 ₽",,1.0,Pro terminal
ADIRINC-1756,5283390,U_M16MW,На исправление,16.08.2024 12:39,,,,,Дефект промсреды,,2024-09-27 00:00:00.0,"На примере облигации Завод КЭС 001P-02 ISIN RU000A102AB8:

!image-2024-08-16-12-44-04-855.png!

С 03.07.2024 торгуется в режиме TQRD:

!image-2024-08-16-12-46-14-520.png!

У клиента AVW5L4 ГС 4595413 купон от 25.07.2024 отображается как выплаченный,  облигация дефолтная выплату не зачислили:

!image-2024-08-16-12-47-30-113.png!

 В разделе купоны по данному инструменту отображается ближайшая выплата 22.08.2024

!image-2024-08-16-12-54-51-315.png!

 И будущие выплаты:

!image-2024-08-16-12-55-10-978.png!

 На мосбирже этих данных о выплатах нет:

  !image-2024-08-16-19-57-37-995.png!

 Данный дефект будет решен в рамках задачи: ADIRANALYT-12057",,2.0,Core
ADIRINC-1753,5260686,U_M20N2,Закрыт,14.08.2024 20:07,,,,,Дефект промсреды,01.10.2024 17:37,2024-09-26 00:00:00.0,"Клиент AXL34I  ГС 5897457 пытается вывести денежные средства через АМ и ВТ с текущего счета МИР (типа MH)

!image-2024-08-14-20-21-44-456.png!

При попытке вывода через ВТ клиент может выбрать данный счет для перевода, но отсутствует кнопка перевода:

!image-2024-08-14-20-27-12-268.png!

 

По логам видим, что не определяется имя счета:

[http://adirelkprod.alfadirect.ru/goto/72dfe0f87d22e056897f127d32b8529c]

 

!image-2024-08-14-20-35-16-254.png!

Проходит запрос лимита:

!image-2024-08-19-14-22-50-715.png!

!image-2024-08-14-20-42-17-944.png!

Но поручение на вывод ДС не формируется:

[http://adirelkprod.alfadirect.ru/goto/662ccd7cf3991af2d346196e734b51db]

!image-2024-08-14-20-38-03-642.png!

 При попытке вывода через АМ возникает ошибка:

!image-2024-08-14-20-44-26-668.png!

 По логам причину ошибки определить  не удалось:

[http://adirelkprod.alfadirect.ru/goto/4b002d42b8c0d7e951babbd5e59c26ef]

[http://amlog/kibana/goto/1cfdd170-5e22-11ef-bf47-e9bc53c05f52]

[http://adlog1/kibana/goto/36f24200-5e22-11ef-890a-e97f280311e8]

 

 *+_Требуется устранить ошибку и исключить повторения кейса в будущем по всем клиентам._+*",,2.0,Core
ADIRINC-1751,5254837,U_M1FE1,Принят к исправлению,14.08.2024 12:49,Frontend,Стакан,,,Дефект промсреды,,2024-10-15 00:00:00.0,"Клиент 4253435 or brisin_a or ANGAJ2
Андроид 2.30.4
Переходит в раздел История - находит выплату купона по облиге или дивидендов по акциям - проваливается - нажимает на инструмент :
ФР: открывается некорректный инструмент с пустым графиком и пустым стаканом
ОР: открывается корректный инструмент с графиком и стаканом
Проблема возникает в том, что перекидывает на инструмент с бордом КЦБ ММВБ, который только для хранения и на нем торгов нет, от того и график со стаканом пустой",,1.0,Montblanc
ADIRINC-1750,5254006,U_M2AB7,На исправление,14.08.2024 11:50,Frontend,,,,Дефект промсреды,,2024-09-25 00:00:00.0,"Клиенты не могут выставить заявку в приложении 3.9.0
для отправки заявки клиенты переключаются между вкладками, после чего заявка уходит.
не работает кнопка ""купить""
логи во вложении:
!image-2024-08-14-11-49-33-597.png!

[^IMG_0.MOV]
[^Logs (1).zip]",,1.0,Everest
ADIRINC-1748,5225311,U_M19LL,Отклонен командой,09.08.2024 17:50,открытие_счетов,,,,Дефект промсреды,,2024-09-20 00:00:00.0,"При попытке открыть детский счет через SFA, после подписания документов по ссылке из смс, происходит отказ в открытии счета. !image-2024-08-09-17-48-52-846.png!",,,Core
ADIRINC-1747,5223912,U_M1W4D,Отклонен,09.08.2024 14:38,Client-Risks-API,Дефект_АИ,покупка,,Дефект промсреды,07.10.2024 08:21,2024-09-20 00:00:00.0,"В приложении МТ 2.30.4
 Клиент AOE154 1626947 пытается выставить заявку на покупку инструмента.
 У клиента возникает ошибка:

*ELK Core:* [http://adirelkprod.alfadirect.ru/goto/db06bf6507e2bfc7241bc5e5c0649e28]
*ELK Middle:* [http://adlog1/kibana/goto/09650e30-5643-11ef-a005-cd1178b68c3a]
 !image-2024-08-09-14-31-07-743.png!

при расчете лимит сервиса ошибок нет.
 [http://webadmin.k8s-master.alfadirect.ru/reporting/orderlimitlog/XFrrLZEBS5SikRmBemvg]

!image-2024-08-09-14-31-50-794.png!

В логах видим ошибку сервиса client-risks-api: 
 *Не найдены маржинальные параметры для актива c ИД «RU000A102E78» на рынке «MOEX_TQ_RUB*

[http://adlog1/kibana/goto/09650e30-5643-11ef-a005-cd1178b68c3a]
{code:java}
    ""app_id"": ""client-risks-api"",    ""@timestamp"": ""2024-08-07T17:38:04.547Z"",    ""thread_name"": ""reactor-tcp-epoll-7"",    ""traceId"": ""b4de511901012ecf"",    ""logger_name"": ""ru.alfabank.mobile.invest.client.risks.service.ClientRisksService"",    ""level"": ""ERROR"",    ""level_value"": 40000,    ""spanId"": ""b4de511901012ecf"",    ""app_host"": ""adapp1"",    ""syslog_timestamp"": ""2024-08-07T20:38:04+03:00"",    ""syslog_tag"": ""apps,forwarding,json"",    ""message"": ""Failed to get margin params for account=1626947, asset=RU000A102E78, market=MOEX_TQ_RUB{\""errorMessage\"":\""Не найдены маржинальные параметры для актива c ИД «RU000A102E78» на рынке «MOEX_TQ_RUB».\"",\""errorCode\"":\""INSTRUMENT_MARGIN_NOT_FOUND\"",\""requestId\"":\""1e782609-2d05-4845-9fb9-26b8104eb46f\"",\""apiVersion\"":\""1\""}"",    ""container_id"": ""invest_client-risks-api.19f8baf0-52f9-11ef-983e-86f615bf05fc"",    ""@version"": ""1""
{code}
 

 

!image-2024-08-09-14-32-49-047.png!

на CORe сервисе аналогично
 [http://adirelkprod.alfadirect.ru/goto/db06bf6507e2bfc7241bc5e5c0649e28]

 
{code:java}
 {code}
 

!image-2024-08-09-14-33-40-078.png!
{code:java}
""_index"": ""adir-production-dotnet-fin-instrument-info-000242"",  ""_type"": ""_doc"",  ""_id"": ""fFnrLZEBS5SikRmBWvyM"",  ""_score"": 1,  ""_ignored"": [    ""exception.keyword""  ],  ""_source"": {    ""@timestamp"": ""2024-08-07T20:38:04.5890697+03:00"",    ""level"": ""ERROR"",    ""message"": ""An unhandled exception has occurred while executing the request."",    ""time"": ""2024-08-07 20:38:04.5890"",    ""category"": ""Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware"",    ""exception"": ""AlfaDirect.NetCoreServiceInfrastructure.Exceptions.NotFoundException: Не найдены маржинальные параметры для актива c ИД «RU000A102E78» на рынке «MOEX_TQ_RUB».\r\n   at BusinessLogic.Services.Implementation.InstrumentServiceV2.GetMarginByAssetCodeV2Async(String assetCode, String universalMarketCode, Int32 accountId, CancellationToken cancellationToken) in C:\\temp\\src\\BusinessLogic\\Services\\Implementation\\InstrumentServiceV2.cs:line 153\r\n   at FinInstrumentInfo.Controllers.V2.InstrumentsController.GetMarginByAssetCodeAsync(String assetCode, String universalMarketCode, Int32 accountId) in C:\\temp\\src\\FinInstrumentInfo\\Controllers\\V2\\InstrumentsController.cs:line 94\r\n   at lambda_method121(Closure , Object )\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextExceptionFilterAsync>g__Awaited|26_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ExceptionContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware.<Invoke>g__Awaited|6_0(ExceptionHandlerMiddleware middleware, HttpContext context, Task task)"",    ""host"": ""com-fin-instrument-info-76957d7477-wpwb7"",
{code}
Маржинальных параметров действительно нет, НО
 !image-2024-08-09-14-35-26-683.png!
 Инструмент должен быть доступен для приобретения или выдать инфомарцию клиенту.
 За доп. инфо обратитесь к Супрун Дмитрий. Ошибки быть не должно.

+_*Требуется устранить ошибку*_+ 
  ",,4.0,Everest
ADIRINC-1746,5223579,U_M1FE1,На исправление,09.08.2024 13:32,,,,,Дефект промсреды,,2024-09-20 00:00:00.0,"Клиент AMTP5K 3202578 в приложении нет информации о выпуске ГК Самолет БО-П14 RU000A1095L7 (act_id 128442)

!image-2024-08-09-13-34-06-459.png!

В hell_cache.info.bonds информация по инструмент присутствует:

!image-2024-08-09-13-37-37-045.png!

Находим по act_id инструмент в news_cache.direct.instruments. Видим, что информация по данной облигации привязана к другому isin:

!image-2024-08-09-13-40-17-356.png!

Ищем инструмент по isin. По нужному isin отсутствует act_id и at_code:

!image-2024-08-09-13-41-42-113.png!

Проблема возникает при изменении isin после первичного размещения:

!image-2024-08-09-16-52-26-489.png!

[http://adirelkprod.alfadirect.ru/goto/b2903db03235beebdbf4c95eefb2a3ac]

По логам видим, что вводные параметры тянутся с правильным isin и act_id.

!image-2024-08-09-16-54-55-504.png!

Но затем возникает ошибка: не удается вставить повторяющуюся ключевую строку в объект

!image-2024-08-09-17-00-28-500.png!

Проблема массовая на 09.08.2024 1086 инструментов с пустым act_id:

*_!image-2024-08-09-18-40-30-978.png!_*

*+_Требуется устранить ошибку и исключить повторения кейса в будущем._+*

 

 

 

 ",,12.0,Kailash
ADIRINC-1745,5222777,U_M1W4D,К закрытию,09.08.2024 12:10,,,,,Дефект промсреды,,2024-09-20 00:00:00.0," 
{code:java}
// code placeholder
{code}
Приложение МТ 2.30.1
 У клиента AGQ38D 8096595
 некорректно отображается сумма пополнения в портфельной аналитике на счёт ИИС
 !image-2024-08-09-11-50-54-623.png!
 При этом в брокерском отчете сумма указана корректно.
 !image-2024-08-09-11-51-42-672.png!

 
{code:java}
 Select *
 from [hell].[dbo].[a_all_transfers] with(nolock)
   Where acc_code = '8096595-000'
  and p_code = 'money'
  and tran_type = 'EXTRA'
  and db_date between '2024-07-06 00:00:00.000' and '2024-08-06 00:00:00.000'
{code}
 

 

В логах получаем некорректную информацию.
 [http://adlog1/kibana/goto/de063d90-562e-11ef-a005-cd1178b68c3a]

!image-2024-08-09-12-08-31-741.png!
{code:java}
 ""app_id"": ""portfolio-analytics-api"",    ""@timestamp"": ""2024-08-06T10:29:45.083Z"",    ""thread_name"": ""reactor-tcp-epoll-16"",    ""traceId"": ""b36fedd412b48785"",    ""logger_name"": ""ru.alfalab.starter.logging.reactive.feign.ReactiveLogger"",    ""level"": ""INFO"",    ""level_value"": 20000,    ""spanId"": ""b36fedd412b48785"",    ""app_host"": ""adappr3"",    ""syslog_timestamp"": ""2024-08-06T13:29:45+03:00"",    ""syslog_tag"": ""apps,forwarding,json"",    ""message"": ""[DirectAnalyticsClient#getAnalyticsReport(String,AnalyticsReportRequest)] http://172.21.1.97:80/api/auth/portfolioanalytics?accountId=8096595&dateTo=2024-08-06&dateFrom=2024-07-06\n\nRESPONSE HEADERS\nServer: nginx/1.20.1\nDate: Tue, 06 Aug 2024 10:29:44 GMT\nContent-Type: application/json; charset=utf-8; v=1\nTransfer-Encoding: chunked\nConnection: keep-alive\nx-envoy-upstream-service-time: 343\n<--- headers takes 348 milliseconds  \nRESPONSE BODY \nAnalyticsReportResponse(portfolioRevenue=AnalyticsReportResponse.Report(value=-67665.17, currency=RUB), returnOnAssets=AnalyticsReportResponse.Report(value=-1.35, currency=%), sharesRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), bondsRevenue=AnalyticsReportResponse.Report(value=-59934.09, currency=RUB), currenciesRevenue=AnalyticsReportResponse.Report(value=-6885.67, currency=RUB), derivativesRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), fundsRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), dividends=AnalyticsReportResponse.Report(value=0, currency=RUB), couponRevenue=AnalyticsReportResponse.Report(value=9145.07, currency=RUB), pmetsRevenue=AnalyticsReportResponse.Report(value=0, currency=RUB), commissions=AnalyticsReportResponse.Report(value=-7480.17, currency=RUB), marginTrade=AnalyticsReportResponse.Report(value=0, currency=RUB), taxes=AnalyticsReportResponse.Report(value=0, currency=RUB), inputs=AnalyticsReportResponse.Report(value=5010645.43, currency=RUB), outputs=AnalyticsReportResponse.Report(value=0, currency=RUB), inputsPapers=AnalyticsReportResponse.Report(value=0, currency=RUB), outputsPapers=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyTransfersRUB=null, moneyTransfersUSD=null, moneyTransfersEUR=null, moneyInputsTotal=AnalyticsReportResponse.Report(value=5006963.58, currency=RUB), moneyInputsRUB=AnalyticsReportResponse.Report(value=5006963.58, currency=RUB), moneyInputsUSD=AnalyticsReportResponse.Report(value=0, currency=USD), moneyInputsEUR=AnalyticsReportResponse.Report(value=0, currency=EUR), moneyInputsCNY=AnalyticsReportResponse.Report(value=0, currency=CNY), moneyInputsOther=AnalyticsReportResponse.Report(value=0.00, currency=RUB), moneyOutputsTotal=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyOutputsRUB=AnalyticsReportResponse.Report(value=0, currency=RUB), moneyOutputsUSD=AnalyticsReportResponse.Report(value=0, currency=USD), moneyOutputsEUR=AnalyticsReportResponse.Report(value=0, currency=EUR), moneyOutputsCNY=AnalyticsReportResponse.Report(value=0, currency=CNY), moneyOutputsOther=AnalyticsReportResponse.Report(value=0, currency=RUB), isAssetsNegative=AnalyticsReportResponse.Report(value=0, currency=), beginNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), endNAV=AnalyticsReportResponse.Report(value=4942980.26, currency=RUB), sharesEndNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), bondsEndNAV=AnalyticsReportResponse.Report(value=5144482.94, currency=RUB), currenciesEndNAV=AnalyticsReportResponse.Report(value=7692.47, currency=RUB), derivativesEndNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), pmetsEndNAV=AnalyticsReportResponse.Report(value=0, currency=RUB), benchMarkRts=AnalyticsReportResponse.BenchMark(code=RTS, name=Индекс РТС, value=-6.81, currency=%), benchMarkImoex=AnalyticsReportResponse.BenchMark(code=IMOEX, name=Индекс ММВБ, value=-10.18, currency=%), benchMarkSpx=AnalyticsReportResponse.BenchMark(code=SPX, name=Индекс S&P500, value=-0.21, currency=%), benchMarkIxic=AnalyticsReportResponse.BenchMark(code=IXIC, name=Индекс NASDAQ, value=-5.35, currency=%), benchMarkDji=AnalyticsReportResponse.BenchMark(code=DJI, name=Индекс Dow Jones Industrial, value=2.96, currency=%), benchMarkMmvb=AnalyticsReportResponse.BenchMark(code=ММВБ10, name=Индекс ММВБ10, value=-5.50, currency=%), benchMarkIgold=AnalyticsReportResponse.BenchMark(code=IGOLD, name=Индекс GOLD, value=0.61, currency=%), benchMarkProduct=AnalyticsReportResponse.BenchMark(code=null, name=null, value=null, currency=null))\n<--- body takes 348 milliseconds"",    ""container_id"": ""invest_portfolio-analytics-api.67d3fa91-5091-11ef-983e-86f615bf05fc"",
{code}
+_*Необходимо устранить ошибку и отображать клиенту корректное пополнение баланса в портфельной аналитике.*_+",,1.0,
ADIRINC-1744,5219486,U_M25NK,Отклонен,08.08.2024 16:21,,,,,Дефект промсреды,24.10.2024 10:52,2024-09-19 00:00:00.0,"У клиента запрашивает пройти тестирование при покупке актива. При выставлении заявки указан текущий счёт списания, денежных средств достаточно. 

ФИО клиента: Субуханкулова Юлия Александровна

PinEQ клиента: BFTNGV  (ГС:7936141)  версия приложения: МТ IOS 3.9.0

 

!image-2024-08-08-16-25-55-119.png!

Данный дефект будет решен в рамках задачи ADIRMT-5559",,4.0,Core
ADIRINC-1743,5218473,U_M1W4D,Закрыт,08.08.2024 14:34,Отображение_данных,Портфель,,,Дефект промсреды,15.10.2024 08:11,2024-09-19 00:00:00.0,"в онлайн версии по ссылке https://invest.alfabank.ru/ на iOs в разделе Портфель → Все счета отображается общая информация по всем счетам.
И общая доходность по всем счетам указана 18,86%. Что не соответствует действительности и общей доходности по рублям. Приблизительно она должна составлять 6.85%.
!image-2024-08-08-13-51-42-630.png!

+_*Необходимо исправить ошибку некорректного отображения доходности портфеля в веб-терминале*_+",,2.0,Montblanc
ADIRINC-1742,5215771,U_M1FE1,На исправление,08.08.2024 09:33,,,,,Дефект промсреды,,2024-09-19 00:00:00.0,"МТ 2.30.1
На примере AVTQ53 ГС 4338069
по облигациям ИНК-Капитал 1Р-1 Isin RU000A104A39

Суть  ошибки в том, что не отображается история сделок на странице самой облигации, а в общей истории отображается.

!image-2024-08-08-09-24-12-352.png!

на странице облигации история отсутствует:
!image-2024-08-08-09-24-49-566.png!

Логи:
[http://adlog1/kibana/goto/f177e030-554e-11ef-a005-cd1178b68c3a]

При детальном анализе выявлено, что:
при запросе 
{code:java}
curl -X GET --location ""http://172.21.1.97:80/api/operations-history?accCode=4338069-000&assetIdType=SYMBOL_OBJECT&operationDateEnd=2024-08-05T15%3A28%3A45.000596351&codeOperationType=E&codeOperationType=D&codeOperationType=S&codeOperationType=CT&codeOperationType=CS&codeOperationType=CP&codeOperationType=CE&codeOperationType=BE&codeOperationType=DE&codeOperationType=DP&codeOperationType=TP&codeOperationType=IE&codeOperationType=OE&assetId=INKKBO1P01&maxElements=100"" -H ""application/json"" -H ""Content-Type: application/json;v=2"" | jq
{code}
История возвращается:
!image-2024-08-08-09-26-22-477.png!

при запросе 
{code:java}
curl -X GET --location ""http://172.21.1.97:80/api/operations-history?accCode=4338069-000&assetIdType=SYMBOL_OBJECT&operationDateEnd=2024-08-05T15%3A27%3A53.430375387&codeOperationType=E&codeOperationType=D&codeOperationType=S&codeOperationType=CT&codeOperationType=CS&codeOperationType=CP&codeOperationType=CE&codeOperationType=BE&codeOperationType=DE&codeOperationType=DP&codeOperationType=TP&codeOperationType=IE&codeOperationType=OE&assetId=RU000A104A39&maxElements=100"" -H ""application/json"" -H ""Content-Type: application/json;v=2"" | jq
{code}
история не возвращается
!image-2024-08-08-09-27-21-829.png!

При первом запросе используется assetId=INKKBO1P01, при втором assetId=RU000A104A39

почему в первом случае, запроса assetId=INKKBO1P01 возвращается история, когда данные совсем иные ? и наоборот, почему не возвращается, когда assetId=RU000A104A39 ?
хотя параметр INKKBO1P01 относится к полю symbolObject
!image-2024-08-08-09-29-44-922.png!


+_*Необходимо отображать историю сделок облигаций в разделе самой облигации, не только в общей истории.*_+",,2.0,Core
ADIRINC-1741,5215737,U_M1W0J,На исправление,08.08.2024 08:30,,,,,Дефект промсреды,,2024-09-19 00:00:00.0,"В веб-терминале  https://invest.alfabank.ru/
При просмотре индекса IMOEX2 ММВБ, в графике информация зависает и не обновляется. По другим инструментам проблем нет. Данные отображаются на на моменте открытия индекса. 
График обновляется только при обновлении страницы.
Клиент использовал браузер Google/Mozila
!image-2024-08-08-08-27-48-697.png!",,,Web
ADIRINC-1739,5182888,U_M19LL,Закрыт,06.08.2024 10:56,,,,,Дефект промсреды,06.08.2024 10:58,2024-09-17 00:00:00.0,"|Во время релиза торговых сервисов автоматически запускается скрипт, который поменял конфиг nginx, в этом скрипте был код который выставляет параметр client_max_body_size отвечающий за размер тела запроса =1024 байта |",,,Core
ADIRINC-1738,5179278,U_M25NK,К закрытию,05.08.2024 18:16,Дефект_АИ,,,,Дефект промсреды,,2024-09-17 00:00:00.0,"Клиент Михайлов Владимир Юрьевич (AAS6F4) ( гс 193487) пытался выставить заявку на срочном рынке на покупку SBRF-9.24, у клиента на счете более 70тыс. рублей, программа позволяет купить лишь 2 лота, (го 5032/17% ставка риска), хотя денежных средств достаточно для покупки более 2 контрактов

!image-2024-08-05-18-18-11-490.png!!image-2024-08-05-18-17-34-120.png!

 ",,10.0,Core
ADIRINC-1737,5178050,U_M173X,Закрыт,05.08.2024 16:08,,,,,Дефект промсреды,14.08.2024 09:28,2024-09-16 00:00:00.0,"Проблема с загрузкой логотипов в ВТ при отсутствии корсов в сервисе adir-lk-logotypes. На данный момент корсы ""Access-Control-Allow-Origin: * "" добавлены на стороне nginx, необходимо их будет добавить на стороне сервиса adir-lk-logotypes",,,Core
ADIRINC-1736,5172665,U_M1QX4,Отклонен,05.08.2024 10:17,,,,,Дефект промсреды,19.08.2024 10:36,2024-09-16 00:00:00.0,"У части клиентов с os android версии 2.30.4 не отображается баннер с игрой ""в поисках акций""
!image-2024-08-05-10-15-21-731.png!

Логи по мне AR7ISH, у меня данный баннер в версии 2.30.4 отображается, в логах также есть информация об игре
!image-2024-08-05-10-15-51-016.png!
!image-2024-08-05-10-16-05-362.png!

Подскажите, пожалуйста, производились ли какие-то изменения в последнее время? Возможно проблема в отсутствии gamesEntryPoint в фт?
!image-2024-08-05-10-16-36-285.png!",,1.0,
ADIRINC-1735,5153244,U_M0WVN,Закрыт,01.08.2024 14:21,,,,,Дефект промсреды,22.08.2024 13:32,2024-08-12 00:00:00.0,"Воспроизводится в версии Совпало 3.9 IOS

В версиях IOS старше не воспроизводится

*Фактический результат:*

Клиент заходит в раздел рынки

Выбирает любой инструмент

Заходит в его стакан

Стакан ""замер"", данные в нем не обновляются, статичны.

После перещелкивания подвкладок, например График-Стакан и обратно, статичные данные уже отображаются новые но в динамике ничего не происходит

*Ожидаемый результат:*

Клиент видит движение сделок в стакане онлайн.

Прикладываю видео во вложении

*Дополнительно:*

*Лог* FE3 по коллеге ГС 1138532 (Коржов Сергей Юрьевич), у которого проблема так же воспроизвелась
 * idDevice: 97D6E405-9B6B-4C8A-97A5-624200CDD2B6
  

 *  
 08:18:29.484 AD.Core.SessionState onUserCredentials UserCredentialsEntity: login=siukorzhov, fullName=Коржов Сергей Юрьевич, message=NoErrors, protocolVersion=1.0.0.0, orderPrefix=P3YEO1-97D6E405-9B6B-4C8A-97A5-624200CDD2B6, idAccount=7166551, pin=AS912J, idLogin=101474341, idSession=24639403371, environmentType=Prod, systemType=AlfaDirect
  

 *  
 08:19:54.482 AD.Core.FrontEnd.RealTimeBirzInfoDelayedServer onClientMessageEntity entity=ClientMessageEntity: message=FrontEndAuthenticationSuccess, objects=[502]

08:19:57.154 AD.Core.FrontEnd.RealTimeBirzInfoDelayedServer enqueue DataFlowSubscribeEntity: dataFlowType=AvailableOrderBook, flowKeys=[761278], subscribtionType=Subscribe
  
 * а потом внезапно
 08:19:57.507 AD.Core.Source.OrderBookSource switch OrderBookWithYieldEntity -> OrderBookEntity get: OrderBookEntity: idFI=761278, flags=IsInit
  

Есть проблемы с получением подписки стакана с доходностью.

Кроме того данная проблема в этой версии приложения упоминалась в дефекте https://jira.moscow.alfaintra.net/browse/ADIRINC-1688 15.07 в комментарии",,,Ядро
ADIRINC-1734,5149775,U_M1QX4,Отклонен,01.08.2024 10:04,,,,,Дефект промсреды,18.09.2024 11:18,2024-09-12 00:00:00.0,"PinEQ клиента: G17411  ГС 7194
ФИО клиента: Шичалин Владимир Вячеславович
У клиента постоянно всплывает сообщение 'Архивный сервер - неверные параметры команд' в терминале 4.0
 Судя по скриншоту все сервера подключены. Сообщения всплывают постоянно при работе в терминале

 
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|vshichalin|4.0.4209.1629|9.106|10.0|1 - Windows|To Be Filled By O.E.M. To Be Filled By O.E.M.|7085C2D8CC8F|31.07.2024 12:44:23|95.79.211.163|31.07.2024 23:58:38|31.07.2024 23:58:39|31.07.2024 23:58:45|31.07.2024 23:58:39|",,4.0,Pro terminal
ADIRINC-1733,5136966,U_M1W4D,Отклонен,30.07.2024 12:51,,,,,Дефект промсреды,06.09.2024 11:02,2024-08-08 00:00:00.0,"h1. Описание

У сервиса adir-microinvest.sell.withdraw.many.service в метриках не отображаются ошибки, в логах ошибки видим, в метриках не наблюдаем 
 Мониторинг у нас настроен на level:""ERROR"", если бы данное событие передавалось корректно, мы бы обнаружили проблему раньше

Но по данной проблеме был заведен значительный инцидент
 [https://rc.alfa-bank.net/channel/adir-avarii?msg=XdHaPa9FPLyAkMNue] 

 
h1. Ожидаемый результат

В логах данные +ошибочные+ события ""Запрос на создание поручения для treaty: 5964068-000 вернул ошибку с кодом RequestEntityTooLarge""
 Должны передаваться с level:""ERROR""

 
h1. Фактический результат

В логах данные события ""Запрос на создание поручения для treaty: 5964068-000 вернул ошибку с кодом RequestEntityTooLarge""
 Передаются с level:""TRACE""
 !image-2024-07-30-12-06-47-604.png!",,,Core
ADIRINC-1732,5126282,U_M1CUE,Отклонен,29.07.2024 14:49,,,,,Дефект промсреды,27.09.2024 12:58,2024-09-09 00:00:00.0,"Добрый день!

Просьба провести экспертизу по сбою 23.07 и уточнить корневую причину проблемы.

Время сбоя - 20:14 - 21:08

У части клиентов наблюдались частичные проблемы со входами в АИ (МТ, ВТ, ДТ)

Предварительная причина - сбой на стороне торговых сервисов

Решение: Перезапуск ADWAUTH02

Тред по решению аварии - [https://rc.alfa-bank.net/channel/adir-avarii?msg=pFc5j8gWWyQp2qF6K]",,,
ADIRINC-1730,5090450,RUM1BPH,Отклонен,26.07.2024 09:56,,,,,Дефект промсреды,02.09.2024 10:40,2024-09-26 00:00:00.0,"Клиент ГС 165028 присылает скрин, на котором сумма портфеля не соответствует сумме позиций.
Или поясните, почему такое происходит
 !image-2024-07-26-09-56-21-274.png!",,5.0,
ADIRINC-1729,5078007,U_M25NK,Закрыт,24.07.2024 13:20,,,,,Дефект промсреды,11.09.2024 10:21,2024-09-04 00:00:00.0,"Клиент: BCRPTF, 4050883 при выставлении заявки на продажу турецкой лиры видит ошибку.

!image-2024-07-24-13-22-03-396.png!

 

По логам запроса лимитов видим следующую ошибку:

 

*!image-2024-07-24-13-32-10-345.png!*",,30.0,
ADIRINC-1726,5048205,U_M1W4D,Отклонен,19.07.2024 10:29,,,,,Дефект промсреды,19.08.2024 10:40,2024-08-30 00:00:00.0,"Не траслируется сессия по фортсу в потс трейд.
 После поставки по обновлению  сервисов BOAgent https://jira.moscow.alfaintra.net/browse/ITINVEST-6130

Не включается ФТ SendFortsExchangeSessionToKafka_2991

Поставку откатили, не помогло

[https://rc.alfa-bank.net/channel/duty-support-invest/thread/3krggHa4BP8K2KCZm?msg=3krggHa4BP8K2KCZm]",,,
ADIRINC-1725,5048152,U_M1W4D,Отклонен командой,19.07.2024 10:04,,,,,Дефект промсреды,,2024-07-30 00:00:00.0,"Выявлены ошибки при работе сервиса Candles-api 
 Запросы обрабатывались более 10000ms, что приводило к деградации работы приложений и отображения графиков

[http://adirelkprod.alfadirect.ru/goto/07c740b7b8e122f7e4f2ef2d864650db]
 !image-2024-07-19-10-00-20-712.png!
{code:java}
Конец запроса GET /api/candles/full - 408 - 10041ms{code}
{code:java}
 ""exception"": {      ""ErrorDetails"": {        ""ErrorMessage"": ""Не были полученны необходимые данные из Архива за время 10000ms"",        ""ErrorCode"": ""REQUEST_TIMEOUT"",        ""RequestId"": ""7392910a-f364-4b08-a7b0-2a4af5d961be"",        ""ApiVersion"": ""1""      },      ""ClassName"": ""AlfaDirect.Logging.AspNet.Exceptions.ApplicationLogicException"",      ""Message"": ""Не были полученны необходимые данные из Архива за время 10000ms"",      ""Data"": {},      ""StackTraceString"": ""   at CandlesService.Code.CandlesProcessor.RequestArchiveAsync(IEntity request, ReceiveState state, Int32 id) in C:\\BuildAgent\\work\\48f0ed4431221259\\CandlesService\\Code\\CandlesProcessor.cs:line 316\r\n   at CandlesService.Code.CandlesProcessor.RequestArchiveAsync(IEntity request, ReceiveState state, Int32 id) in C:\\BuildAgent\\work\\48f0ed4431221259\\CandlesService\\Code\\CandlesProcessor.cs:line 316\r\n   at CandlesService.Code.CandlesProcessor.GetMainCandlesAsync(CandlesCacheKey key, DateTime startDate, TimeFrame timeFrame) in C:\\BuildAgent\\work\\48f0ed4431221259\\CandlesService\\Code\\CandlesProcessor.cs:line 257\r\n   at CandlesService.Code.CandlesProcessor.GetFullCandlesAsync(String assetId, DateTime startDate, DateTime endDate, TimeFrame timeFrame, Int32 count) in C:\\BuildAgent\\work\\48f0ed4431221259\\CandlesService\\Code\\CandlesProcessor.cs:line 175\r\n   at CandlesService.Controllers.V1.CandlesController.GetFullCandles(String assetId, DateTime startDate, DateTime endDate, TimeFrame timeFrame) in C:\\BuildAgent\\work\\48f0ed4431221259\\CandlesService\\Controllers\\V1\\CandlesController.cs:line 80\r\n   at lambda_method22(Closure , Object )\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)\r\n   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware.<Invoke>g__Awaited|6_0(ExceptionHandlerMiddleware middleware, HttpContext context, Task task)"",      ""RemoteStackIndex"": 0,      ""HResult"": -2146232832,      ""Source"": ""CandlesService"",      ""Type"": ""AlfaDirect.Logging.AspNet.Exceptions.ApplicationLogicException""{code}
{code:java}
Полное время обработки 10040ms{code}
В рамках срочных мер был перезапущен сервис, что привело к стабилизации работоспособности сервиса.
Требуется оптимизировать работу сервиса.",,,
ADIRINC-1724,5046691,U_M25TF,NEW,18.07.2024 21:18,,,,,Дефект промсреды,,2024-08-30 00:00:00.0,"После технические перерывы 13:45-14:05, 18:35-19:10, в первые минуты старта сервиса adir-moex-account-opening-service Наблюдаются ошибки при регистрации.
 т.е. система ругается на уже зарегистрирована клиента, хотя по факту это не так.
adir-production-dotnet-moex-account-opening-service
{code:java}
select status_change_time, treaty as gen_sogl,operation, reg_status, error_msg from hell.exch.exchange_reg_history   select status_change_time, treaty as gen_sogl,operation, reg_status, error_msg from hell.exch.exchange_reg_history               --0where status_change_time >= DATEADD(MINUTE, -180, GETDATE()) where status_change_time between '2024-07-18 19:10:50.230' and '2024-07-18 19:25:50.230' and reg_status = 'Z'
{code}
  !image-2024-07-18-21-12-27-179.png!

[http://adirelkprod.alfadirect.ru/goto/a6f3216f7f948a62e24cdb435c76dcd8]
 в логах у нас ошибка после формирования документа 7297005

!image-2024-07-18-21-13-46-196.png!

!image-2024-07-18-21-14-38-775.png!

после детального Анализа, было выявлено, что МБ не успевает обработать наш документ за 300 секунд. лог во вложении в файле.
 !image-2024-07-18-21-16-08-539.png!

т.е. получается, что после тех. перерыва был сформирован файл 7297003, далее ***04 и ****05
 по причине таймаута, наш сервис снова отправил тех-же клиентов на регистрацию в новом файле.
 Необходимо увеличить таймаут для нас. На МосБиржу запрос отправлен.
 [^Timeout_reg_clients.txt]",,,
ADIRINC-1723,5035178,U_M1CE2,Отклонен,17.07.2024 12:22,Дефект_АИ,,,,Дефект промсреды,09.10.2024 10:23,2024-08-28 00:00:00.0,"||Login||ClientVersion||ProtocolVersion||OSVersion||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|agets|4.0.4209.1629|9.106|10.0|CHUWI Innovation And Technology(ShenZhen)co.,Ltd CoreBook X|687A6454547A|08.07.2024 16:24:59|31.173.80.57|08.07.2024 17:02:56|08.07.2024 16:43:05|08.07.2024 17:08:45|08.07.2024 16:44:16|

В торговом терминале Альфа-Инвестиции 4.0 версии 4.0.4105.1618 с периодичностью возникает уведомление: 'Нарушено бизнес-ограничение по получению OrderBookEntity'. Во время отображения ошибки не отображается стакан по выбранному инструменту.
 Со слов клиента открыто всего 8 стаканов и 1 график. Просьба уточнить причину возникновения уведомления.
 Клиент в РФ.
 !image-2024-07-17-12-31-59-542.png|width=611,height=138!
 !image-2024-07-17-12-32-22-819.png!",,2.0,
ADIRINC-1722,5034625,U_M1W4D,Закрыт,17.07.2024 12:03,,,,,Дефект промсреды,12.09.2024 16:51,2024-08-28 00:00:00.0,"Некорректно отображается линейный график по пятницам.
График отображается до 18:05 при работе в приложении в вечернее время.
Пример:
!image-2024-07-17-12-02-09-948.png!
!image-2024-07-17-12-02-28-344.png!",,2.0,Appalachians
ADIRINC-1721,5034194,U_M1CUE,Отклонен,17.07.2024 10:50,,,,,Дефект промсреды,19.08.2024 12:09,2024-08-28 00:00:00.0,"Клиент BE2CL5 гс 3582990
версия мт: 3.9.0.
ос: iOS
Клиент пытается пополнить своей детский брокерский счет тип 2N в приложении Альфа-Инвестиции. Получает ошибку со скриншота. 
В логах не получается создать фейк карту, тк к данному типу счетов нельзя привязывать данный тип карт.
ПС: Была такая же проблема с новым ИИС, Заботина Олеся вроде тогда писала в МПК чтобы доработку сделали и потом все исправилось ",,3.0,
ADIRINC-1718,5029510,U_M0WVN,Отклонен,16.07.2024 14:22,,,,,Дефект промсреды,18.09.2024 11:45,2024-08-27 00:00:00.0,"ФР:
1. Клиент хочет выставить заявку но сумма свободных дс у него отображается неактуальная. 
Допинформация:
Причина в том, что по заявкам на размещения у клиента блокируется сумма. Средства заблокированы пока: 
а) идет временной прмежуток между датой закрытия реестра и \\\\\\\\\\\\\\\""техникой\\\\\\\\\\\\\\\""(датой сделки с контрагентом по выставленным заявкам прошедшим по условиям)  
б) какие -то заявки не прошли по условиям и по ним сделок не будет. НО процесс отмены таких производится вручную человеком в вебадмин, регламента четкого нет по времени, но как привило к дате сделок по заявкам с контрагентом их отменяют. То есть день-два они находятся в подвешенном состоянии  и тоже влияют на доступный остаток у клиента при выставлении заявки в МТ
Пока ответственный за мониторинг (в данном случае по размещениям Раков Евгений Владимирович не переведет их в конечный статус ), клиенты видят некорректно свои доступные дс в МТ
!image-2022-12-16-17-02-32-452.png!
!image-2022-12-16-17-25-23-004.png!
 ",,13.0,Core
ADIRINC-1717,5023274,U_M1W4D,Закрыт,15.07.2024 16:02,,,,,Дефект промсреды,15.07.2024 16:08,2024-09-13 00:00:00.0,"После релиза БД наблюдаются задержки ввода ДС.
 в процедуре hell.[dbo].[_eq_drop_one_tran] возникает ошибка 
{code:java}
The EXECUTE permission was denied on the object '_eq_drop_one_tran', database 'hell', schema 'dbo'.{code}
!image-2024-07-15-16-01-28-174.png!

В логах ошибка: The EXECUTE permission was denied on the object '_eq_drop_one_tran', database 'hell', schema 'dbo'.

 

Ссылка на внерелиз
 [https://rc.alfa-bank.net/channel/adir_duty?msg=gItEIRdmw2GAU8kja]

Ссылка на тред в авариях

[https://rc.alfa-bank.net/channel/adir-avarii?msg=clfFWFfOBFQuFLxG1] ",,,Core
ADIRINC-1716,5021445,U_M1DCS,Закрыт,15.07.2024 13:09,,,,,Дефект промсреды,12.09.2024 11:23,2024-08-26 00:00:00.0,"При запросе календаря по погашениям в период с 01.07.2024 по 31.07.2024 возвращается пустой массив. Если дергать запросы по дням, то данные в ответе возвращаются. ",,,Kailash
ADIRINC-1715,5019636,U_M1W4D,Отклонен,15.07.2024 10:53,,,,,Дефект промсреды,16.09.2024 09:30,2024-08-26 00:00:00.0,"Падает investments-api по ООМ
!image-2024-07-15-10-52-20-023.png!",,,
ADIRINC-1714,5019006,U_M1QX4,Закрыт,15.07.2024 10:40,,,,,Дефект промсреды,09.08.2024 10:45,2024-07-24 00:00:00.0,"При входе в терминал на ПК - вход осуществляется автоматически без возможности ввода логина и пароля. Клиент из-за этого не может выйти и зайти с другого аккаунта.

Обращения поступают массово, просьба уточнить дату исправления проблемы 

https://jira.moscow.alfaintra.net/browse/ADIRTERM-1591",,13.0,Pro terminal
ADIRINC-1713,5008248,U_M1W4D,Закрыт,12.07.2024 10:32,Дефект_АИ,,,,Дефект промсреды,16.09.2024 08:20,2024-08-23 00:00:00.0,"В ремонтной очереди лежал ордер по закрытому счету и рулз евент для него. Какой-то джоб зареборнил ордер в 15 статус. Делит по реборну заменил ордер в ремонтной очереди (ошибка №1 - по делиту надо было просто удалить ордер из ремонтной очереди). Дальше, при разборе ремонтной очереди, функция обработки этого делита не вернула false, хотя ордера для удаления не нашла (ошибка №2 - должна была вернуть false). Затем, поскольку ЛС решил, что ордер починился, он попытался обработать его рулз евенты. Поскольку ордера для евента не нашлось, то евент просто удалился (вернули в аллокатор). Но при этом из мапы rulesEventsForOrdersInRepairQueue его не удалили (ошибка №3). Через некоторое время ордер зареборнили еще раз, всё повторилось до момента удаления рулз евента. Но поскольку его уже вернули в аллокатор, его vptr был затерт служебной информацией аллокатора, и ЛС упал.

К падению привела ошибка №3. Но остальные тоже надо исправить.",,,Core
ADIRINC-1711,5002120,U_M1QLD,Ретест дефекта,11.07.2024 13:40,Frontend,,,,Дефект промсреды,,2024-08-22 00:00:00.0,"На примере клиента AAM451 33245, и облигации Бизнес-Альянс 001Р-02 (RU000A106XJ4).

У клиента некорректно отображается доходность к погашению по облигации Бизнес-Альянс 001Р-02 (RU000A106XJ4).

В разделе Сводка и О выпуске указаны разные доходности к погашению.

!image-2024-07-11-14-08-28-417.png!

Дефект будет устранен в рамках задач:

[STOCKTRADE-31] Карточка инструмента. Облигации. Объединить ""О выпуске"" + ""Сводка"" - Alfa-bank Issue Tracker (alfaintra.net)

[STOCKTRADE-32] Карточка инструмента. Облигации. ""О выпуске"" добавить параметры и настроить логику для типов облиг - Alfa-bank Issue Tracker (alfaintra.net)",,6.0,Appalachians
ADIRINC-1710,5000010,U_M1W4D,Закрыт,11.07.2024 09:57,,,,,Дефект промсреды,11.09.2024 10:13,2024-08-22 00:00:00.0,"После раскатки релиза https://jira.moscow.alfaintra.net/browse/ITINVEST-6059
 [https://jira.moscow.alfaintra.net/projects/ADIRLK/versions/133508]

перестали отображаться логотипы в приложении

!image-2024-07-11-10-08-30-064.png!",,,НТФ (ЛК)
ADIRINC-1709,4992729,U_M1QX4,Отклонен,10.07.2024 08:32,,,,,Дефект промсреды,11.07.2024 16:05,2024-08-21 00:00:00.0,"Наблюдаются задержки при пополнении дс из-за релиза БД пропали права на EXECUTE у процедуры hell.dbo._eq_drop_one_tran

!image-2024-07-10-09-41-36-640.png!

В логах ошибка: The EXECUTE permission was denied on the object '_eq_drop_one_tran', database 'hell', schema 'dbo'.

Проблему устранили, прописав процедуре hell.dbo._eq_drop_one_tran права на EXECUTE ролям
@-DIRECT\srvc-adir-mq2db-imt-mass-automatic-payments
@-DIRECT\srvc-adir-mq2db-imt-own-client-payments

Ссылка на внерелиз
[https://rc.alfa-bank.net/channel/adir_duty?msg=gItEIRdmw2GAU8kja]

Ссылка на тред в авариях

[https://rc.alfa-bank.net/channel/adir-avarii?msg=clfFWFfOBFQuFLxG1] ",,,
ADIRINC-1708,4975977,U_M1QX4,Отклонен,08.07.2024 09:55,,,,,Дефект промсреды,30.09.2024 12:52,2024-08-19 00:00:00.0," 

ФИО клиента: Латышев Сергей Анатольевич
||Login||PinEQ||гс||FE4DisconnectTime||
|sa_latishev3|BBCLR3|2513463|06.07.2024 17:12:52|

Суть обращения: Проблема с установкой терминала Альфа-Инвестиции 4.0.
После создания электронной подписи окно не исчезает. нажимаю ничего не происходит. Клиент смотрит через диспетчер задач. Там через несколько секунд отменяется и исчезает данная задача

Коллеги, просьба уточнить, какую дополнительную информацию требуется запросить у клиента? 

 ",,1.0,
ADIRINC-1707,4966460,U_M20N2,Закрыт,05.07.2024 12:42,,,,,Дефект промсреды,27.09.2024 19:23,2024-08-16 00:00:00.0,"Android 2.29.2 (2.30.0) В разделе 'Рынки' > 'Избранное' > Графа 'Ищите инструменты по заданным параметрам' > 'Россия' > 'IT' > 'Эффективность' > 'Показать' - не отображается логотип компании, а так же информация в карточке инструмента.

Заходим в приложение раздел Рынки - Избраное - Ищите инструменты:

!image-2024-07-05-12-55-30-298.png!

В параметрах поиска выбираем Россия - IT - Показать:

!image-2024-07-05-12-56-56-366.png!

Внизу списка видим не прогрузившийся инструмент:  

!image-2024-07-05-13-29-35-692.png!

Проваливаемся в инструмент - все вкладки пустые - во вкладке история отображается история операций с портфелем:

!image-2024-07-05-13-31-48-845.png!

 По логам видим, что не прогрузился инструмент US5603172O82:

[http://adlog1/kibana/goto/1dc30ba0-3a93-11ef-b76b-d51065e95bec]

  !image-2024-07-05-13-35-35-613.png!

 Видео и логи с устройства приложены.",,1.0,Appalachians
ADIRINC-1706,4958405,U_M16Z9,На исправление,04.07.2024 14:15,,,,,Дефект промсреды,,2024-08-15 00:00:00.0,"При отправке сообщений ""Идеи гуру"" с помощью сервиса UWSDistributeSendPushSMS13#POST передается externalSystemCode RECO, который принадлежит AM/AO.

Необходимо изменить значение передаваемого externalSystemCode на тот, который был выделен системе Альфа-Инвестиции.",,1.0,АПИ\Интеграции
ADIRINC-1705,4951262,U_M20N2,Закрыт,03.07.2024 12:50,,,,,Дефект промсреды,04.09.2024 10:07,2024-10-15 00:00:00.0,"АИ МТ если войти в приложение android 2.29.2 (2.30.0) через приложение АМ, то во вкладке Ещё - Управление счетами - отсутствует вкладка Инвестиционный профиль, при входе через логин и пароль вкладка инвестиционный профиль отображается.

При входе в приложение через ""Войти через приложение банка"" :

!image-2024-07-03-13-02-55-485.png!

Вкладка Ещё - Управление счетами:

!image-2024-07-03-13-03-59-293.png!

Отсутствует вкладка Инвестиционный профиль:

!image-2024-07-03-13-04-46-435.png!

Если войти в приложение через логин и пароль:

!image-2024-07-03-13-06-09-521.png!

Вкладка инвестиционный профиль отображается:

!image-2024-07-03-13-07-30-723.png!

При анализе логов, причину определить, не удалось.

Логи профиль не отображается:
 [http://adirelkprod.alfadirect.ru/goto/4f014ad730da179b379f56ea442ed63f]
 [http://adlog1/kibana/goto/147c4580-3920-11ef-b76b-d51065e95bec]

Логи профиль отображается:
 [http://adirelkprod.alfadirect.ru/goto/5c0a0687e718d91a6d9901b8b2ff0f5a]
 [http://adlog1/kibana/goto/2acc8d40-3920-11ef-b76b-d51065e95bec]

Логи с устройства приложены:

Версия приложения: 2.29.2
 Логин: pasurguchiov
 Устройство: samsung SM-N985F
 Прошивка: 13
 Время: 1719997960727 (3)
 Время сервера (OperServer): 1720008760884
 Статус работы серверов: + + + +
 Connected: true
 DataEnabled: true
 Is 4G: true
 WiFi enabled: false
 WiFi connected: false
 Available by ping: true
 Network operator name: MegaFon pre-5G
 Network type name: NETWORK_4G
 IP address: 12.142.97.92",,6.0,K2
ADIRINC-1704,4948756,U_M1W4D,Закрыт,03.07.2024 04:39,,,,,Дефект промсреды,04.09.2024 08:21,2024-08-14 00:00:00.0,"* 
После рестарта не поднялись Аусы
!image-2024-07-03-04-37-09-465.png!
Не работали входы
!image-2024-07-03-04-33-42-935.png!
 
!image-2024-07-03-04-28-42-657.png!
Долго стартовали аусы( один стартовал уже больше часа) из-за долгого зачитывания данных с ДК
04:03 Помогло решить проблему: рестарт ДК03
04:06 последующий рестарт первого ауса (после этого он поднялся за 7 минут)
 
Также пока ДК03 был в процессе старта перезапустили и аус2 и он тоже поднялся быстро (5 минут)
[~U_M12WM] [~U_M0DRY] 
Просьба ознакомиться с тредом:
[https://rc.alfa-bank.net/channel/adir-avarii?msg=dzRp6meKjvufQbKgj]
И уточнить причину возникновения проблемы",,,Core
ADIRINC-1702,4905050,U_M1CE2,Закрыт,26.06.2024 11:35,,,,,Дефект промсреды,24.10.2024 10:27,2024-08-07 00:00:00.0,"ОР: Клиент после регистрации подаёт заявку на СПБ, заявка исполняется если наступили условия по заяке
 ФР: Заявка отклоняется и удаляется с комментарием 'Счет не зарегистрирован на бирже.'

Заявка http://webadmin.k8s-master.alfadirect.ru/reporting/orders/805526-000/59668403384/1

ранее вопрос рассматривался, но не урегулирован до конца 
https://jira.moscow.alfaintra.net/browse/ADIRSKS-5442

!image-2024-06-27-10-54-54-596.png!",,13.0,Уран
ADIRINC-1701,4904109,U_M20N2,Закрыт,26.06.2024 10:42,,,,,Дефект промсреды,05.07.2024 08:10,2024-08-07 00:00:00.0,"При входе через мобильный браузер в ВТ по номеру телефона, после ввода ФИО кнопка ""Продолжить"" неактивна, и войти в ВТ не удается.

Вводим номер телефона, нажимаем ""Войти"":

!image-2024-06-26-10-53-10-464.png!

После ввода ФИО кнопка продолжить неактивна:

!image-2024-06-26-10-55-26-848.png!

Если вернуться в предыдущее окно то после ввода номера телефона кнопка ""Войти"" не реагирует (видео приложено).

При попытки входа через номер телефона логи не записываются.

  !image-2024-06-26-11-07-12-629.png!

С авторизацией через логин и пароль проблем нет, также если заходить в ВТ через браузер компьютера, то  авторизоваться предлагает сразу через логин и пароль:

  !image-2024-06-26-11-10-42-186.png!

 ",,2.0,K2
ADIRINC-1699,4875875,U_M19LL,Закрыт,20.06.2024 18:49,Дефект_АИ,,,,Дефект промсреды,12.07.2024 07:46,2024-08-02 00:00:00.0,"Цена входит в коридор, но правила не срабатывают, заявки не выставляются, клиенты расстраиваются",,,Core
ADIRINC-1698,4874764,U_M1W4D,Закрыт,20.06.2024 16:22,,,,,Дефект промсреды,05.09.2024 11:22,2024-08-01 00:00:00.0,"PinEQ клиента: K19427 \ 1415573
ФИО клиента: Белов Константин Александрович
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||
|k_belov1|3.9.0|9.104|17.5.1|5 - iOS|iPhone|557A6022-6305-42C3-8F91-74F93170B211|20.06.2024 16:12:12|46.228.113.98|


Суть обращения: В приложении Совпало версии 3.9.0 не отображается раздел «купоны» и «дивиденды» в карточках выпусков.

Проблематику клиент выявил 19 июня, со слов клиента ранее разделы отображались по всем инструментам.",,6.0,Everest
ADIRINC-1697,4873175,U_M1QX4,Закрыт,20.06.2024 13:54,,,,,Дефект промсреды,15.08.2024 12:03,2024-08-21 00:00:00.0,"""Краш на экране заявки"" а он находится в разделе ""Рынки""
PinEQ клиента: AP55GY \ 1713786 
 ФИО клиента: Чижов Алексей Парисович
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||ClientIP||
|apchizhov1|2.29.2|9.105|14|4 - Android|samsung SM-A546E|ca04cb03-3ac0-338e-902e-60b438369355|62.176.26.201|

При переходе на страницу заявки по акциям ВТБ (Isin RU000A0JP5V6) в приложении Альфа-Инвестиции возникает уведомление 'Приложение не отвечает'. 
 Версия мт 2.29.2 Android

Со слов клиента проблема актуальна по портфелю 1713786 - на остальных все ок.
 Повторная авторизация по логину и паролю не помогла.",,1.0,Everest
ADIRINC-1693,4865655,U_M214D,На исправление,19.06.2024 12:30,Дефект_АИ,,,,Дефект промсреды,,2024-07-31 00:00:00.0,"ФИО клиента: СОЛОВЬЕВ ДМИТРИЙ СЕРГЕЕВИЧ PinEQ клиента: AVUL87 \ 4387833

У клиента в приложении Альфа-Инвестиции не загружается вкладка: Рынок.
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|solovev_ds12|2.29.2|9.105|13|4 - Android|Xiaomi M2101K6G|a705d467-e282-3dc5-ae33-ddbeb1207046|19.06.2024 9:49:43|31.173.83.150|19.06.2024 11:06:01|19.06.2024 11:06:05|19.06.2024 11:06:16|19.06.2024 11:06:03|

Обращения поступают массово, все с версией 2.29.2, устройства:
|Xiaomi M2101K6G|
|ZTE Blade V10 Vita RU|
|HUAWEI AKA-L29|
|Xiaomi Redmi Note 9 Pro|

логи запросила, как поступят приложу к задаче.",,5.0,Fuji
ADIRINC-1692,4864729,U_M1QX4,Отклонен,19.06.2024 11:21,,,,,Дефект промсреды,03.07.2024 11:21,2024-07-31 00:00:00.0,"ФИО клиента: СОЛОВЬЕВ ДМИТРИЙ СЕРГЕЕВИЧ PinEQ клиента: AVUL87 \ 4387833

У клиента в приложении Альфа-Инвестиции не загружается вкладка: Портфель.
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|solovev_ds12|2.29.2|9.105|13|4 - Android|Xiaomi M2101K6G|a705d467-e282-3dc5-ae33-ddbeb1207046|19.06.2024 9:49:43|31.173.83.150|19.06.2024 11:06:01|19.06.2024 11:06:05|19.06.2024 11:06:16|19.06.2024 11:06:03|

Обращения поступают массово, все с версией 2.29.2, устройства:
|Xiaomi M2101K6G|
|ZTE Blade V10 Vita RU|
|HUAWEI AKA-L29|
|Xiaomi Redmi Note 9 Pro|

логи запросила, как поступят приложу к задаче.",,10.0,Montblanc
ADIRINC-1691,4858949,U_M1QX4,Отклонен,18.06.2024 10:53,,,,,Дефект промсреды,03.09.2024 11:14,2024-07-30 00:00:00.0,"Клиент: Коробов Антон Сергеевич, AN75WA \ 5395991
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|askorobov3|4.0.4105.1618|9.106|10.0|1 - Windows|ASUSTeK COMPUTER INC. ASUS TUF Gaming F17 FX706HF_FX706HF|08BFB8D07BE0|13.06.2024 8:56:44|178.184.181.144|13.06.2024 8:57:29|13.06.2024 8:57:30|13.06.2024 8:57:27|13.06.2024 8:57:30|

Клиент обратился по вопросу ""прыгания"" фокусировки отображения списка акций на виджете ""Акции"".
Среда воспроизведения проблемы:
Конфигурация стандартная Black 1920x1080, в ней данная проблема проявляется стабильно.

Действия для воспроизведения проблемы
1. На виджете ""Акции"" набрать под сотню аrций, чтобы активировался скролл списка.
2. Ставим отображение списока акции в режиме ""%Изм.""
3. Выбрать акцию, которая активно меняет свое положение в списке. На момент описания задачи, такой акцией являлся Diodes (в приложении с видео использован этот тикер).
4. От выбранной акции скролл вниз, чтобы видимость данной акции была за пределом отображение списком

Ожидаемый результат
- Фокусировка отображения списка не меняется, вне зависимости от изменения выбранной из списка акции

***
Клиент удалял конфиг после чего проблема не решилась.
Логи, конфигурацию, видео прикладываю
Видео, которое не поместилось в таску, приложу в рокет",,0.0,Pro terminal
ADIRINC-1690,4858415,U_M1QX4,Отклонен,18.06.2024 10:35,,,,,Дефект промсреды,03.09.2024 10:06,2024-07-30 00:00:00.0,"Клиент: СЕНАЧИН СЕМЁН ВЛАДИМИРОВИЧ AF4TWK\62574
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|senachin_s|4.0.4105.1618|9.106|6.3|1 - Windows|Microsoft Corporation Virtual Machine|022B2D00F506|18.06.2024 3:12:52|194.87.92.20|18.06.2024 9:57:40|18.06.2024 9:51:08|18.06.2024 9:57:40|18.06.2024 9:58:41|

 

Суть обращения:
ДТ запускается с минимальным количеством ОЗУ (1 ГБ). Сам терминал функционирует нормально, но возникает проблема со входом (вводом логина и пароля). Форма входа никак не реагирует, затем появляется окно 'Web Browser. Stop running this script?' (см. приложенный скриншот), клиент нажимает 'Нет', форма снова не реагирует. И так продолжается раз 10-15.

После таких регулярных нажатий на 'Нет' минут через 20-40 окно начинает реагировать, появляется возможность ввести логин/пароль, авторизоваться в терминале и начать работу.

Подскажите, можно ли как-то исправить эту проблему с формой входа? Например, на форме написано 'При проблемах со входом воспользуйтесь резервной авторизацией'. Может быть как-то можно стартовать терминал сразу с резервной авторизацией, допустим, при помощи параметров командной строки... Или какие-то другие варианты есть.


С интернет-соединением все в порядке.
Ошибка сохраняется уже несколько месяцев.

папка логов была очищена по рекомендации ранее.
клиент не может «воспользоваться резервной авторизацией».
У него «тормозит» форма авторизации, ссылка «Воспользоваться резервной авторизацией» не работает при нажатии.",,1.0,Pro terminal
ADIRINC-1688,4853500,U_M1UN1,Закрыт,17.06.2024 14:07,,,,,Дефект промсреды,06.08.2024 10:11,2024-08-16 00:00:00.0,"В приложении ""Совпало"" по инструментам RU000A107U40 и RU000A106QS9 при переходе в раздел стакан происходит вылет приложения.

*Как воспроизвести:* 
 # Переходим в раздел рынки.
 # Вбиваем в поиск указанные в начале задачи ISIN
 # Открываем инструмент (Завод КЭС 001Р-05/Завод КЭС 001Р-04) 
 # Переход в раздел ""Стакан""

*ОР:* Раздел открывается корректно, видна информация по объемам сделок

*ФР:* При открытии раздела тут же происходит вылет из приложения.

Во вложении видео воспроизведения проблемы, логи устройства собрать не удается из-за вылета.

В прошлой версии 3.6.0 не воспроизводится ",,8.0,Everest
ADIRINC-1686,4833077,U_M1AYE,Отклонен,11.06.2024 18:25,,,,,Дефект промсреды,03.09.2024 09:11,2024-07-25 00:00:00.0,У клиентов отклоняются заявки на питерской биржи из-за проблем с регистрацией ,,,Уран
ADIRINC-1685,4829587,U_M0WVN,Закрыт,11.06.2024 11:51,,,,,Дефект промсреды,01.08.2024 18:25,2024-07-24 00:00:00.0,"*Шаги воспроизведения:*

Поступают обращения от клиентов о долгой загрузке экрана  Главный-Рынки-Облигация- Купоны (до 30 сек-1 мин)

*Допинфо:*

Проблему по себе проверили, воспроизводится только на Android

Так же заметили, что аффект дает виджет с Калькулятором доходности на экран Купонов.

В логах мидла видим, что данные приходят быстро с бека за миллисекунды

Отключили фт bond_profit_calculator_enabled , скрыли его с экрана. В настоящее время живем без него, экран Купонов загружается штатно

Видео долгой загрузки во вложениим[^WhatsApp Video 2024-06-11 at 11.22.23.mp4]

 

^Необходимо помимо устранения причины долгой загрузки будет сделать возможным подгрузку данных для калькулятора ассинхронно, чтобы не аффектило на весь экран.^ 

^Так же по всей видимости не настроены таймауты нормально, иначе если этот виджет в следующих версиях приложения вытащат на Главную или Обзор можем получить еще хуже влияние^",,,Elbrus
ADIRINC-1684,4804680,RUM1BPH,Отклонен,05.06.2024 18:22,,,,,Дефект промсреды,20.09.2024 14:58,2024-11-01 00:00:00.0,"ГС 499534 цб RU000A108JQ4

Из-за того, что в ХЧЦ нет котировок по данной цб, клиент видит доходность -100%, что является неверным.
 При отсутствии котировок нужно оценивать бумагу по номиналу.
 Особенно это верно для новых, ещё не торгуемых, бумаг.",,2.0,
ADIRINC-1683,4802585,U_M1W4D,Отклонен,05.06.2024 14:20,,,,,Дефект промсреды,06.06.2024 15:50,2024-08-07 00:00:00.0,"У клиентов, в истории, не отображаются операции по погашению купонов.
 На примере VIP клиента: ACDAKK 99181

Клиент произвел погашение купона по облигации Сэтл Групп RU000A1084B2 в размере 9695,14 руб
 !image-2024-06-05-14-11-47-220.png!

В БД видим транзакцию, подтверждающую данную операцию:
{code:java}
SELECT TOP (1000) *
FROM [a_hell_opers].[dbo].[a_fin_transactions]
where 1=1
and acc_code='99181-000'
and a_date>='2024-05-28 00:00:00.000'
{code}

 !image-2024-06-05-14-13-44-408.png!



в МТ 3.6.0 IPhone клиент не видит данной операции, что в общей истории, что в истории самого инструмента.

!image-2024-06-05-14-14-49-458.png!
 !image-2024-06-05-14-15-01-128.png!

В логах МТ в  историю не попадает данная операция
 [http://adlog1/kibana/goto/f0f2ec80-232c-11ef-9332-85dd56de5bf0]
 [http://adlog1/kibana/goto/1961b930-232d-11ef-9332-85dd56de5bf0
 ]
 Запрос:
{code:java}
[AlfaDirectHistoryOperationsClient#getHistoryOperations(String,OperationRequest)] http://172.21.1.97:80/api/operations-history?accCode=99181-000&assetIdType=SYMBOL_OBJECT&operationDateEnd=2024-05-29T02%3A59%3A59.999&codeOperationType=E&codeOperationType=D&codeOperationType=S&codeOperationType=CT&codeOperationType=CS&codeOperationType=CP&codeOperationType=CE&codeOperationType=BE&codeOperationType=DE&codeOperationType=DP&codeOperationType=TP&codeOperationType=IE&codeOperationType=OE&assetId=SETLBO002R03&maxElements=100&operationDateStart=2024-05-28T03%3A00
{code}
Ответ:
{code:java}
RESPONSE BODY 
OperationResponse(cursor=null, operations=[OperationResponse.Operation(operationId=767404468, symbolObject=SETLBO002R03, objectId=830676, issuerId=283544, name=Сэтл Групп о.к.б. серии 002Р-03, assetId=RU000A1084B2, objectTypeId=4, objectTypeDesc=Облигации РФ корпоративные, direction=1, universalMarketCode=MOEX_TQ1_RUB, placeCode=MICEX_SHR_T, codeOperationType=E, quantity=50, price=96.11000000, priceCurrency=%, value=48076.00, currency=RUB, operationDate=2024-05-28T12:15:20, settlementDate=2024-05-29T00:00, orderId=58358227584, operationSubType=null, taxRub=14.42, tax=14.42, placeCodeTarget=null, accCodeSource=null, accCodeTarget=null, marketGroupSource=null, marketGroupTarget=null, userLogin=lkosinov, nkd=21.00, couponRate=15.5000), OperationResponse.Operation(operationId=767404468, symbolObject=SETLBO002R03, objectId=830676, issuerId=283544, name=Сэтл Групп о.к.б. серии 002Р-03, assetId=RU000A1084B2, objectTypeId=4, objectTypeDesc=Облигации РФ корпоративные, direction=-1, universalMarketCode=MOEX_TQ1_RUB, placeCode=MICEX_SHR_T, codeOperationType=CT, quantity=null, price=null, priceCurrency=null, value=14.42, currency=RUB, operationDate=2024-05-28T12:15:20, settlementDate=null, orderId=null, operationSubType=trades, taxRub=null, tax=null, placeCodeTarget=null, accCodeSource=null, accCodeTarget=null, marketGroupSource=null, marketGroupTarget=null, userLogin=lkosinov, nkd=21.00, couponRate=15.50
{code}
 

!image-2024-06-05-14-18-41-326.png!

_+*Необходимо устранить ошибку и отображать полную историю операций по различным видам транзакций.*+_

 ",,1.0,Core
ADIRINC-1681,4791766,U_M1FE1,На исправление,03.06.2024 17:20,,,,,Дефект промсреды,,2024-07-16 00:00:00.0,"На примере клиента ANIFHT 355308 и инструментов ISIN RU000A0ZZFS9 и RU000A1002V2.

При переходе во вкладку дивиденды по активам Европлан RU000A0ZZFS9 и Евротранс RU000A1002V2 ближайшая выплата дивидендов не отображается.

Информация о выплатах была.

!image-2024-06-03-17-22-22-347.png!!image-2024-06-03-17-23-10-138.png!

!image-2024-06-03-17-25-25-902.png!

 

 

+_*Проблема наблюдается по разным инструментам.*_+ 
 +_*Необходимо автоматизировать отображение дивидендов по инструментам в целом.*_+ ",,210.0,Сатурн
ADIRINC-1680,4790500,U_M194K,Закрыт,03.06.2024 15:31,,,,,Дефект промсреды,03.06.2024 15:35,2024-08-05 00:00:00.0,"Наблюдаются проблемы между своими брокерскими счетами.
Ошибка в процедуре transfer_money_order_save

Ошибка № 515 в строке 515 модуля: dbo.transfer_money_order_save. Текст ошибки: Cannot insert the value NULL into column 'balance_price', table 'hell.dbo.intra_transfers'; column does not allow nulls. INSERT fails.",,,
ADIRINC-1679,4788118,U_M1W4D,Закрыт,03.06.2024 13:03,,,,,Дефект промсреды,26.07.2024 12:20,2024-08-05 00:00:00.0,"У клиентов наблюдается некорректное отображение Дивидендов в разделе ""Мои выплаты""
на примере клиента P48137 4212663 
Роснефти RU000A0J2Q06

!image-2024-06-03-13-00-22-342.png!

В логах так-же отображается кол-во в 1 бумагу 
[http://adlog1/kibana/goto/24202b70-2190-11ef-9332-85dd56de5bf0]
возвращает gifts-api

!image-2024-06-03-13-01-42-602.png!

Но при этом, в портфеле клиента, 60 бумаг.
!image-2024-06-03-13-02-21-465.png!

В БД так-же 60 бумаг.
{code:java}
SELECT TOP (1000) *
  FROM [a_hell_balance].[dbo].[a_balance] with(nolock)
  Where treaty = '4212663'
  and p_code = 'ROSN'
{code}

!image-2024-06-03-13-02-57-625.png!

+_*Необходимо устранить ошибку некорректного отображения кол-во бумаг в разделе ""Мои выплаты""*_+",,22.0,Everest
ADIRINC-1678,4783540,U_M1W4D,Закрыт,02.06.2024 09:58,,,,,Дефект промсреды,06.06.2024 13:45,2024-07-16 00:00:00.0,"в МТ по всем инструмента, каждое начало месяца попадающие на выходной день, не отображается график за месяц.
ниже примеры:
ошибка воспроизводится в выходные дни на начало месяца

!image-2024-06-02-09-57-33-956.png!
!image-2024-06-02-09-58-08-784.png!",,5.0,
ADIRINC-1677,4779692,U_M1QX4,Отклонен,31.05.2024 14:00,,,,,Дефект промсреды,16.08.2024 11:37,2024-07-15 00:00:00.0,"При обнаружении проблемы с формированием ЭЦП

!image-2024-05-31-13-52-39-968.png! 
Был произведен рестарт сервиса com-sign-service-fe, рестарт данного сервиса не производился около 2 недель, после рестарта пошли ошибки,

Из-за сжатия DC возвращалось 2764
 !image-2024-05-31-13-55-31-751.png!

После отключения сжатия 876к

!image-2024-05-31-13-56-18-596.png!  
 Просьба произвести проверку некорректной обработки сжатия",,,Core
ADIRINC-1675,4775647,U_M1FE1,Отклонен,30.05.2024 17:15,,,,,Дефект промсреды,10.09.2024 14:25,2024-07-12 00:00:00.0," в заключенном с НРД договоре, прописан конкретный список isin, по которым АД получает дивиденды.
 соотоветсвенно по новым бумагам данные просто не приходят от НРД

ToDo сделать так, чтобы по новым бумагам не было необходимости перезаключать договор",,,Сатурн
ADIRINC-1674,4770801,U_M1QX4,Отклонен,30.05.2024 10:24,,,,,Дефект промсреды,03.09.2024 10:03,2024-07-12 00:00:00.0,"AAYWKF Мельников Алексей Валерьевич 25955 
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|melnikov_av|4.0.4105.1618|9.106|10.0|1 - Windows|Acer Aspire A315-56|1063C8CABC71|30.05.2024 8:05:25|178.177.37.40|30.05.2024 8:10:37|30.05.2024 8:10:36|30.05.2024 8:10:34|30.05.2024 8:10:38|

Клиент торгует в терминале 4.0. График по норникель в терминале 4.0 и на Мосбирже отличается в период с 28,29 марта и 1 апреля.

В терминале свечи ниже отметки 150, в на графике Мосбиржи выше отметки 150 (скриншот 1)

Просьба проверить, корректно ли отображается график в терминале 4.0",,2.0,Pro terminal
ADIRINC-1673,4766362,U_M0C88,На исправление,29.05.2024 13:44,,,,,Дефект промсреды,,2024-07-11 00:00:00.0,"Клиент 5872709 Савенкова Регина Рамазановна BEE5NR
2024-05-27 14:12:51 подает заявку на вывод ДС с инвесткопилки 5636,86 референс - OB42705240022325

!image-2024-05-29-13-49-06-985.png!

Клиенту приходит только 5616.97 рублей.

!image-2024-05-29-13-51-04-150.png!

С учетом вычета комиссий после продажи БПИФ и вывода ДС, у клиента на счете остается 17,38.

!image-2024-05-29-14-58-26-939.png!

Далее клиент пытается вывести данный остаток со своего счета, и получает ошибку:

!image-2024-05-29-14-29-59-565.png!

В amlog та же ошибка:

http://amlog/kibana/goto/0a0d37b0-1db1-11ef-a8ae-27b7fc9f844f

!image-2024-05-29-14-45-50-623.png!

В референсе видим ошибку:

!image-2024-05-29-14-28-55-160.png!

Активных заявок по клиенту нет:

!image-2024-05-29-15-00-36-554.png!

По логам  видим ошибку: ""Вывод средств невозможен. Доступные лимиты : 0 , 0""

http://adirelkprod.alfadirect.ru/goto/6f15389db5eba6a3f6aa00f3ab604088

!image-2024-05-29-14-48-08-097.png!

Клиент несколько раз пытается вывести остаток средств, после основного вывода, но все они одинаково не успешные, с лимитом на вывод 0.

!image-2024-05-29-14-50-52-123.png!

Остаток средств можно вывести на следующий день, после основного вывода, и если клиент хочет вывести средства со счета под 0, то нужно это сделать с 10:00 до 10:20, т.к. в 10:20 будут куплены БПИФ (при условии если остатка ДС хватит на покупку), и тогда клиент не сможет вывести всю сумму, и при последующих попытках вывести остаток ошибка повториться.

*+_Требуется устранить ошибку и исключить повторения кейса в будущем по всем клиентам._+*

 ",,34.0,
ADIRINC-1672,4761601,U_M20N2,Отклонен,28.05.2024 16:12,,,,,Дефект промсреды,12.08.2024 17:04,2024-07-10 00:00:00.0,"Клиент создал операцию на вывод ДС на сумму 9000 из инвесткопилки, операция была успешно выполнена, ДС были выведены.

!image-2024-05-29-10-12-10-552.png!
 Затем была создана нелегальная (ошибочная) операция на вывод ДС на сумму 5189.87. *+Данный вывод клиент не запрашивал, он был создан системой автоматически без ведома клиента.+*

  !image-2024-05-29-10-24-16-701.png!

В ibank в разделе операции клиента отображается одна операция на вывод ДС, которую создал клиент, вторая операция которую клиент не создавал, здесь не отображена.

!image-2024-05-28-16-16-09-860.png!

В референсе по данной операции сумма вывода, и дата создания платежа указаны корректно, и относятся к выводу который создал клиент.

+*НО дата смены статуса, т.е. время когда референс был выполнен соответствует времени второго, ошибочного, вывода, который клиент не создавал.*+ 

!image-2024-05-28-16-17-10-904.png!

 

*В логах по данному референсу отображается два запроса на вывод ДС, 1й который запросил клиент, и 2й ошибочный, который был создан без ведома клиента.*

*[http://adirelkprod.alfadirect.ru/goto/3d40cb281f679f89d20326653ab123f4]*

*!image-2024-05-28-16-25-49-770.png!*

*По логам видно, что тело двух поручений идентичные.*

*[http://adirelkprod.alfadirect.ru/goto/fb2165b552b2e2ec58956ef7f39a418f]*

!image-2024-05-28-16-28-35-448.png!

[http://adirelkprod.alfadirect.ru/goto/4052fd5fdabe453ff663bf611e100c0c]

!image-2024-05-28-16-35-42-836.png!
 *К**од подтверждения из смс, высланный клиенту, на первый запрошенный клиентом вывод, при вводе в окно подтверждения вывода - Системой был взят автоматически для подтверждения второго ошибочного вывода.*

*!image-2024-05-29-11-00-02-896.png!*

По amlog видно, что клиент подавал только одно поручение на вывод:

[http://amlog/kibana/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:'2024-05-28T07:00:00.000Z',to:'2024-05-28T07:15:00.000Z'))&_a=(columns:!(app_id,message,level),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:faf83f20-300b-11ed-bd49-fb82f754d165,key:app_id,negate:!f,params:(query:brokerage-account-api),type:phrase),query:(match_phrase:(app_id:brokerage-account-api))),('$state':(store:appState),meta:(alias:!n,disabled:!f,index:faf83f20-300b-11ed-bd49-fb82f754d165,key:user_id,negate:!f,params:(query:AP2XL7),type:phrase),query:(match_phrase:(user_id:AP2XL7)))),index:faf83f20-300b-11ed-bd49-fb82f754d165,interval:auto,query:(language:kuery,query:''),sort:!(!('@timestamp',desc])))

!image-2024-05-28-16-44-45-351.png!

 

*Т.е. второй нелегальный(ошибочный) вывод ДС был создан системой без ведома клиента, и подтвержден поручением и кодом из смс, от первого вывода который создавал клиент.* 

*Предположительно проблема возникает из-за того, что вторая заявка прошла по референсу заявки, которую создал клиент.*

*+_Требуется устранить ошибку и исключить повторения кейса в будущем по всем клиентам._+*

 

Первый вывод, который запросил клиент на сумму 9000.0:

!image-2024-05-28-16-40-44-061.png!

И второй нелегитимный вывод, который клиент не создавал на сумму 5189.87:

!image-2024-05-28-16-41-57-629.png!

Были две заявки на вывод ДС, которую создал клиент, и вторая ошибочная, которую клиент не создавал:

!image-2024-05-28-16-48-28-769.png!

 

 

 

 ",,2.0,
ADIRINC-1671,4751733,U_M12WM,Закрыт,27.05.2024 12:39,,,,,Дефект промсреды,04.06.2024 00:07,2024-07-09 00:00:00.0,"Недоступен вход в терминалы из-за падения сервисов авторизации (auth)
 В 11:28 упали сервисы авторизации, предположительно дефект после доработки 
 https://jira.moscow.alfaintra.net/browse/ADIRSVC-3829 

Авария IM16280839  
https://rc.alfa-bank.net/channel/adir-avarii?msg=oyCgX67Xo5TpZGXrm",,,
ADIRINC-1670,4744125,U_M17SM,Отклонен,24.05.2024 14:27,,,,,Дефект промсреды,04.06.2024 17:11,2024-07-08 00:00:00.0,"ASOUPH \ 715076
Сёмин Борис Владимирович
В терминале 4.0 перестали отображаться позиции на графиках
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|bsiomin|4.0.4105.1618|9.105|6.1|1 - Windows|SAMSUNG ELECTRONICS CO., LTD. RF712|E0CA944F31BD|22.05.2024 22:50:09|62.217.184.166|23.05.2024 20:51:13|23.05.2024 20:48:50|23.05.2024 20:49:06|23.05.2024 20:48:50|

Базовые рекомендации клиенту не помогли

 ",,1.0,
ADIRINC-1666,4729314,U_M12WM,На исправление,22.05.2024 10:16,,,,,Дефект промсреды,,2024-05-31 00:00:00.0,"В результате проблем с ahesus на авторизационных хостах сервисы AUTH не получили креды для авторизации в паспорте, из-за чего не могли запуститься

Авария https://rc.alfa-bank.net/channel/adir-avarii?msg=dK235wu3tKkwDoaqz",,,Core
ADIRINC-1665,4723900,U_M1W4D,Закрыт,21.05.2024 11:41,,,,,Дефект промсреды,11.09.2024 10:25,2024-08-14 00:00:00.0,"В приложении версии 2.29.2 наблюдается некорректное отображение данных в разделе Рынки - Облигации- Стакан - Объем в лотах, в случае, когда клиент увеличивает шрифт на устройстве.
Ниже приведены скриншоты с искажением отображения.

Корректно отображение при шрифте L и ниже
!image-2024-05-21-11-38-13-065.png!
!image-2024-05-21-11-39-02-610.png!

Некорректное отображение при шрифте выше L
!image-2024-05-21-11-39-42-540.png!
!image-2024-05-21-11-40-06-724.png!
+_*Необходимо устранить ошибку.*_+",,3.0,Everest
ADIRINC-1664,4709022,U_M13MK,NEW,17.05.2024 10:51,,,,,Дефект промсреды,,2024-07-01 00:00:00.0,"Наблюдаются ошибочное отображение расчетов доходности в Портфельной Аналитике в МТ 2.29.1
 В разделе Аналитика отображаем отрицательную доходность по разделу Облигации и купоны.

На примере клиента ABV0AG 153780

В разделе Аналитика - Доход по Активам - Облигации и купоны
 отображается минусовой доход.
 !image-2024-05-17-10-40-13-826.png!

Но при этом, проваливаясь в сам раздел, видим отображения положительного дохода.
 !image-2024-05-17-10-40-54-964.png!

В логах мидл сервиса [http://adlog1/kibana/goto/d672a000-1420-11ef-bdb5-4f0f6aec1972]
 portfolio-analytics-api

Видим получение ошибочных данных из Бека.
 !image-2024-05-17-10-44-57-656.png!
 _Запрос:_
{code:java}
[DirectAnalyticsClient#getAnalyticsReport(String,AnalyticsReportRequest)]--->GET http://172.21.1.97:80/api/portfolioanalytics?accountId=153780&dateTo=2024-05-16&dateFrom=2024-04-16 HTTP/1.1
REQUEST HEADERS
X-Request-Id: 15a518cb-e6f6-4f9d-8585-aba080ade85e
PIN: ABV0AG
X-External-System-Code: ADMT
X-External-User-Code: PORTFOLIO-ANALYTICS-I1
Content-type: application/json;v=1{code}
_Ответ:_
{code:java}
response body={
  ""portfolioRevenue"" : {
    ""value"" : 4006.09,
    ""currency"" : ""RUB""
  },
  ""returnOnAssets"" : {
    ""value"" : 0.55,
    ""currency"" : ""%""
  },
  ""sharesRevenue"" : {
    ""value"" : -685.65,
    ""currency"" : ""RUB""
  },
  ""bondsRevenue"" : {
    ""value"" : -19977.86,
    ""currency"" : ""RUB""
  },
{code}
Логи для второго скриншота:
 !image-2024-05-17-10-47-07-663.png!
 _Запрос:_
 __
{code:java}
[DirectFinancialClient#getFinancialResults(String,DirectFinancialResultRequest)]--->GET http://172.21.1.97:80/api/portfolioanalytics/financial-result-period?accountId=153780&actGroup=3&dateTo=2024-05-16&dateFrom=2024-04-16 HTTP/1.1
REQUEST HEADERS
X-Request-Id: 5b4f7494-56d2-4cfb-8cd8-e5134827fceb
PIN: ABV0AG
X-External-System-Code: ADMT
X-External-User-Code: PORTFOLIO-ANALYTICS-I1
Content-type: application/json;v=1
{code}
_Ответ:_
 __
{code:java}
response body={
  ""assetsFinResult"" : [ {
    ""actId"" : 120713,
    ""shortName"" : ""Литана о.к.б. 00028-L-001P"",
    ""name"" : ""ЛИТАНА 001P-01"",
    ""isin"" : ""RU000A1032S5"",
    ""regCode"" : ""4B02-01-00028-L-001P"",
    ""ticker"" : ""LITA001P01"",
    ""symbolObject"" : ""RU000A1032S5"",
    ""currency"" : ""RUB"",
    ""finResultTotal"" : 111500.28,
    ""idObject"" : 623229,
    ""idObjectBase"" : 623224
  }, {
    ""actId"" : 122028,
    ""shortName"" : ""Аквилон-Лизинг БО-01-001P"",
    ""name"" : ""Аквилон-Лизинг БО-01-001P"",
    ""isin"" : ""RU000A104107"",
    ""regCode"" : ""4B02-01-00057-L-001P"",
    ""ticker"" : ""AQVLEZ4107"",
    ""symbolObject"" : ""RU000A104107"",
    ""currency"" : ""RUB"",
    ""finResultTotal"" : 2478,
    ""idObject"" : 660286,
    ""idObjectBase"" : 660283
  }, {
    ""actId"" : 121380,
    ""shortName"" : ""МВ ФИНАНС 001Р-02"",
    ""name"" : ""МВ ФИНАНС о.к.б., серия 001Р-02"",
    ""isin"" : ""RU000A103HT3"",
    ""regCode"" : ""4B02-02-00590-R-001P"",
    ""ticker"" : ""MVFINR001P02"",
    ""symbolObject"" : ""MVFINR001P02"",
    ""currency"" : ""RUB"",
    ""finResultTotal"" : 302.85,
    ""idObject"" : 635499,
    ""idObjectBase"" : 622345
  }, {
    ""actId"" : 121751,
    ""shortName"" : ""ООО \""ТЕХНО Лизинг\"" о.к.б., 001P-05"",
    ""name"" : ""ТЕХНО Лизинг 001P-05"",
    ""isin"" : ""RU000A103TS0"",
    ""regCode"" : ""4B02-05-00455-R-001P"",
    ""ticker"" : ""TECHLIZ1P05"",
    ""symbolObject"" : ""00455R05-BO-001P"",
    ""currency"" : ""RUB"",
    ""finResultTotal"" : 47.25,
    ""idObject"" : 648398,
    ""idObjectBase"" : 519554
  }, {
    ""actId"" : 127053,
    ""shortName"" : ""АБЗ-1 001Р-05"",
    ""name"" : ""АБЗ-1 001Р-05"",
    ""isin"" : ""RU000A1070X5"",
    ""regCode"" : ""4B02-05-01671-D-001P"",
    ""ticker"" : ""ABZDOP05"",
    ""symbolObject"" : ""ABZDOP05"",
    ""currency"" : ""RUB"",
    ""finResultTotal"" : 13.15,
    ""idObject"" : 829177,
    ""idObjectBase"" : 827420
  } ]
{code}
17.05.2024 дернули свагер, который так-же показывает, что расчеты доходности в Беке некорректны и не бьются друг с другом.

!image-2024-05-17-10-48-31-203.png!
!image-2024-05-17-10-54-15-646.png!
  
 +_*Требуется исправить ошибки по клиентам и отображать клиентам корректную доходность в портфельной Аналитике.*_+",,47.0,
ADIRINC-1663,4708221,U_M1QX4,Закрыт,17.05.2024 08:36,,,,,Дефект промсреды,24.05.2024 16:43,2024-07-01 00:00:00.0,"После изменения типа поля ADFront.ipo.instruments по задаче релиза https://jira.moscow.alfaintra.net/browse/ADIRSQL-16444 по изменению числовых значений на соответствующие типы VARCHAR(50) в базе обновление производилось, а сервис не раскатан, изменения по таске https://jira.moscow.alfaintra.net/browse/ADIRANALYT-9561 производилось ли тестирование, авария IM16245356 ",,,
ADIRINC-1662,4706317,U_M19LL,Закрыт,16.05.2024 16:26,,,,,Дефект промсреды,26.07.2024 12:21,2024-06-28 00:00:00.0,"При попытке пополнить по СБП крашится терминал

https://jira.moscow.alfaintra.net/browse/ADMT-5570 - 2.29.1 и 2.30.0

[https://console.firebase.google.com/project/alfadirect-b2c7a/crashlytics/app/android:ru.alfadirect.app/issues/d0f0892313d7782d11ae30b05b8a9120?time=1714435200000:1715817599000&sessionEventKey=66386F77007C00015E523DBFBDBA50DE_1944205393011993415&sessionTab=data&userInfoQuery=6dc84632-d284-3834-a382-5e80d95f01fc%09]",,,Elbrus
ADIRINC-1661,4699894,U_M18HF,Отклонен,15.05.2024 15:09,,,,,Дефект промсреды,20.05.2024 16:09,2024-06-27 00:00:00.0,"На примере клиента 72963, AD2MMU выявили проблему с применением понеженной ставки комиссии за сделки в рамках тарифного плана Профессионал, в частности. Согласно условиям данного тарифа предусмотренно снижение ставки комиссии при достижении определенных значений оборота сделок за день:
 !image-2024-05-15-18-38-20-154.png|thumbnail! 
Данный клиент выполнял эти условия в текущем месяце, ниже запрос подтверждающий это:

SELECT
	CASE 
		WHEN (trades_vol > 50000000) THEN 0.03 
		WHEN (trades_vol <= 50000000) AND (trades_vol > 10000000) THEN 0.04
		ELSE 0.5
	END AS 'размер комиссии',
	* 
FROM
	hell.dbo.tarif_data 
WHERE
	treaty = 72963 
	and a_date >= '2024-05-01'
 !image-2024-05-15-18-49-26-391.png|thumbnail! 

Однако комиссия удерживалась стандартная, 0,05. Ниже запросы, иллюстрирующие это:
SELECT tar.tp_id, tar.payment_tax, tar.descr, * 
FROM a_hell_opers.dbo.a_trades a_tr
JOIN hell.dbo.tarifs tar ON a_tr.tp_id = tar.tp_id
WHERE 
	1=1
	AND acc_code = '72963-000'
	AND a_date >= '2024-05-01'
	AND place_code <> 'FORTS'

Запрос, показывающий историю изменения тарифа:
SELECT * 
FROM hell.dbo.account_change_log 
WHERE 
	treaty = 72963  
	AND	tbl = 'ACCOUNTS' 
	AND db_time > '2024-01-01'
ORDER BY
	db_time DESC

 !image-2024-05-15-19-01-04-386.png|thumbnail! 

Есть предположение, что это связано с тем, что в процедуре, которая отвественна за корреткировку тарифных планов - job.tarif_change, отсутствует привязка к trade_group = 'DailyTradeVolChg' - это тарифы, по которым изменение зависят от объема торгов за день
 !image-2024-05-15-19-06-14-722.png|thumbnail! 
",,1.0,
ADIRINC-1659,4691201,U_M17SM,На исправление,14.05.2024 11:28,,,,,Дефект промсреды,,2024-06-26 00:00:00.0,"AAE5WB Кириченко Екатерина Михайловна 1179658 терминал 4.0
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|kirichenko_em|4.0.4105.1618|9.106|6.1|1 - Windows|HP HP ProBook 470 G3|unknown|13.05.2024 22:59:13|89.23.116.107|14.05.2024 0:25:02|14.05.2024 0:25:03|14.05.2024 0:25:10|14.05.2024 0:25:03|

На графике IRAO в терминале для ПК уже несколько версий подряд не работает установка alert-ов. 0 реакции в правом поле. Все алерты выставлены через мобильное приложение.",,4.0,
ADIRINC-1658,4689082,U_M19LL,Закрыт,13.05.2024 18:00,,,,,Дефект промсреды,10.09.2024 15:57,2024-08-07 00:00:00.0,"На вкладке о выпуске при отсутствии данных с бека вместо заглушки экран не загружается и остается черным

Пример инструмента RU000A0JRH43

воспроизводится в версии 2.29.1",,,Appalachians
ADIRINC-1656,4677912,U_M0A0R,На исправление,08.05.2024 11:46,,,,,Дефект промсреды,,2024-06-24 00:00:00.0,"В АИ МТ андроид 2.29.0 и 2.29.1.

Условия для воспроизведения деффекта:
 # На брокерском счете недостаточно средств на покупку инструмента.
 # На счете АМ средств достаточно для покупки инструмента.
 # У клиента не пройден тест по ""Необеспеченные (маржинальные) сделки"".
 # Не торговое время.

В не торговое время клиент хочет выставить заявку на покупку актива, выбирает в режиме Lite покупку со счетом списания ""текущий счет"" (любой не брокерский).

Нажимает ""Купить"", появляется окно:

  !image-2024-05-08-14-31-37-257.png!

После чего появляется окно о Необходимости пройти тест. Судя по логам тест ""Необеспеченные (маржинальные) сделки"".

[http://adlog1/kibana/goto/b3a254d0-0d36-11ef-bdb5-4f0f6aec1972]

  !image-2024-05-08-14-32-20-553.png!

!image-2024-05-08-14-35-40-602.png!

После этого происходит автоматическое зачисление ДС (на сумму стоимости активов, которые пробует купить) с текущего счета на брокерский.

 

  !image-2024-05-08-14-33-29-348.png!

  !image-2024-05-08-15-32-01-290.png!

 Будет исправлено в рамках задачи ADMT-3533 в 2.30. 

( тред: [https://rc.alfa-bank.net/channel/a-inv-mt/thread/Yrphnu4KyFWYAD8YX] )",,1.0,Core
ADIRINC-1655,4670780,U_M1HFE,Закрыт,06.05.2024 17:46,,,,,Дефект промсреды,06.05.2024 17:48,2024-06-06 00:00:00.0,"После раскатки на бой 3.05.24 в 1:30 (после закрытия дня), задачи по трансляции client_money_accounts в hell_cache

 https://jira.moscow.alfaintra.net/browse/ADIRADMIN-14079.  Был  заменен  индекс hell.client_money_accounts. из за этого выросла утилизация по ЦПУ сервера ad-p-db-79. Необходимо вернуть индекс.",,,Core
ADIRINC-1654,4669676,U_M1QX4,Отклонен,06.05.2024 16:15,,,,,Дефект промсреды,30.08.2024 08:21,2024-06-20 00:00:00.0,"Косарев Сергей Владимирович AVTQGY 4336753
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|svkosarev4|4.0.4105.1618|9.106|10.0|1 - Windows|ASUSTeK COMPUTER INC. G56JR|AC50431AEEFD|03.05.2024 10:45:27|188.162.64.145|03.05.2024 11:21:09|03.05.2024 11:21:07|03.05.2024 11:21:08|03.05.2024 11:21:07|

При нажатии кнопки прервать скачивание начинается заново, а не прерывается полностью.
 При этом отменят обновление клиент не собирается.

Клиент нажимает на обновление, после нажимает на кнопку «Прервать» - не на «Отменить» .
 После у него появляется сообщение об отмене обновления, хотя он не отменял обновление, он хотел прервать

 

https://rc.alfa-bank.net/channel/adir-terminal-support?msg=tMzQ7kG2joYvqd3CG",,1.0,Pro terminal
ADIRINC-1653,4669647,U_M25TF,На исправление,06.05.2024 16:05,,,,,Дефект промсреды,,2024-06-20 00:00:00.0,"СПАСИБОВ КОНСТАНТИН АЛЕКСЕЕВИЧ A30746 2064
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|kspasibov|4.0.4105.1618|9.105|10.0|1 - Windows|Acer Aspire V3-551G|9C2A704F7001|06.05.2024 9:23:45|46.164.237.234|06.05.2024 14:47:04|06.05.2024 14:47:15|06.05.2024 14:48:37|06.05.2024 14:46:56|

В окне ""История операций"" не были отражены покупка 1 контракта GLDRUBF от 11.09.2023 11:31:07 и продажа 3 контрактов GLDRUBF от 03.01.2024 8:59:13. Из-за чего у клиента не сходилось расчетное количество контрактов с тем, что было в окне ""Позиции"". Сейчас ""История операций"" показывает только с 18.09.2023 и продажу 3 контрактов GLDRUBF от 03.01.2024 8:59:13 по прежнему не показывает.

 

Проблемные же строки в ""История операций"" были 12.09.2023 8:59:32 и 03.01.2024 8:59:13.
Сслыка на логи https://disk.yandex.ru/d/twn3_c6oZqvm6A",,20.0,Pro terminal
ADIRINC-1652,4667337,U_M18H1,Закрыт,06.05.2024 11:30,,,,,Дефект промсреды,13.05.2024 09:28,2024-07-10 00:00:00.0,"При скачивание документов в разделе О счете отображается ошибка

Пользователь находится в разделе О счете
1) Тап документ Анкета инвестиционного счета, Анкета счета депо",,,
ADIRINC-1651,4667070,RUM1BPH,Закрыт,06.05.2024 11:19,,,,,Дефект промсреды,01.08.2024 17:24,2024-06-20 00:00:00.0,"Коллеги, ГС 195870 цб GMKN
 После неоднократных пересчётов УЦ процедурой пересчёта [regp].[recalc_pos_current_zeros]
 через какое-то время (примерно на следующий день) восстанавливается неправильная УЦ.

тред в рокете [https://rc.alfa-bank.net/channel/adir_uchetn_cenyi_2_2_14/thread/pQcZYw4Rb8h72We4c]",,82.0,
ADIRINC-1649,4654790,U_M0R67,Закрыт,02.05.2024 10:51,,,,,Дефект промсреды,02.05.2024 10:53,2024-07-08 00:00:00.0," В релизе торговых сервисов https://jira.moscow.alfaintra.net/browse/ADIRSVC-3730 поменяли контракт для копилочных заявок, к чему не был готов фасад. Он не мог обработать доп.поля. 

 Тестирование проводили, но не интеграционное вроде. ТК нет такой интеграции на интеграционном контуре вроде",,,Core
ADIRINC-1647,4652952,U_M1CUE,Закрыт,30.04.2024 19:24,Matterhorn,,,,Дефект промсреды,24.07.2024 14:23,2024-07-08 00:00:00.0,"Версия МТ AI: 2.29.0

Only ANDROID

Шаги воспроизведения:
 # Авторизоваться в приложении
 # Провалиться в любой актив
 # Нажать на колокольчик в верхнем правом углу со знаком + 
 # Попытаться выставить уведомление о достижении цены или другое.

*Полученный результат:* 
Выкидывает на окно авторизации или закрывает приложение вовсе 

*Ожидаемый результат:*

Не вылетает приложение. Успешно дает поставить уведомление",,10.0,Matterhorn
ADIRINC-1646,4652461,U_M1W4D,Закрыт,30.04.2024 15:15,,,,,Дефект промсреды,10.06.2024 09:24,2024-06-18 00:00:00.0,"Возникает ошибка у клиентов по результатам тестирования при подключении стратегии ""Вечный Портфель"". - Ошибка запроса риск профиля.
Клиенты проходят тестирование через раздел "" Главный"" → "" Вечный портфель""→Подключение→Пройти тест.

На примере клиента AVEJ8M  3434200
Клиент запустил процесс подключения стратегии
!image-2024-04-30-15-07-47-005.png!
!image-2024-04-30-15-08-16-731.png!
!image-2024-04-30-15-08-45-125.png!
!image-2024-04-30-15-09-25-607.png!

Ошибка связана с тем, что RiskProfilingApiService не может обработать полученные данные из формы.
Ниже логи подтверждают ошибку:
[http://adirelkprod.alfadirect.ru/goto/e9e2421ff028a6e3c131db6396f99ade]
Logs
{code:java}
2024-04-30 14:02:17.2686|ERROR|Error|WT RiskProfilingApiService -> CalculateProfile. Url: ""iprofile-gateway-api/external/iprofile-api/profile/AVEJ8M/calculate""; RequestId: ""fe94dd05-b280-41d4-aec5-80b420d7ccba""; Elapsed: 110; StatusCode = BadRequest; RequestBody: ""{""formVersion"":""riskProfile-2.1"",""answers"":{""goals"":[""MULTIPLICATE""],""horizon"":[""FROM_3_TO_5""],""education"":[""HIGHER_ECONOMICS""],""income"":[""FROM_700K_TO_1M""],""expenses"":[""FROM_91%_TO_100%""],""loansShareExpenses"":[""FROM_41%_TO_60%""],""assets"":[""FROM_100K_TO_500K""],""investmentExperienceBroker"":[""LIFE_INSURANCE"",""PIF"",""BONDS""],""riskRatio"":[""RISK_RATIO_3""]}}""; ResponseBody: ""{""errors"":[{""status"":400,""code"":""validationError"",""detail"":""Invalid form answers: Для поля \""expenses\"" заданы не допустимые значения: [FROM_91%_TO_100%]."",""title"":""Ошибка обработки данных"",""meta"":{""jexceptionMsg"":""class org.springframework.validation.beanvalidation.SpringValidatorAdapter$ViolationObjectError: [org.springframework.context.support.DefaultMessageSourceResolvable: codes [calculateProfileRequest.,]; arguments []; default message [], true]""}}]}"";{code}
Request:
{code:java}
{""formVersion"":""riskProfile-2.1"",""answers"":{""goals"":[""MULTIPLICATE""],""horizon"":[""FROM_3_TO_5""],""education"":[""HIGHER_ECONOMICS""],""income"":[""FROM_700K_TO_1M""],""expenses"":[""FROM_91%_TO_100%""],""loansShareExpenses"":[""FROM_41%_TO_60%""],""assets"":[""FROM_100K_TO_500K""],""investmentExperienceBroker"":[""LIFE_INSURANCE"",""PIF"",""BONDS""],""riskRatio"":[""RISK_RATIO_3""]}}{code}
Response:
{code:java}
{""errors"":[{""status"":400,""code"":""validationError"",""detail"":""Invalid form answers: Для поля \""expenses\"" заданы не допустимые значения: [FROM_91%_TO_100%]."",""title"":""Ошибка обработки данных"",""meta"":{""jexceptionMsg"":""class org.springframework.validation.beanvalidation.SpringValidatorAdapter$ViolationObjectError: [org.springframework.context.support.DefaultMessageSourceResolvable: codes [calculateProfileRequest.,]; arguments []; default message [], true]""}}]}{code}

+_*Необходимо устранить ошибку*_+",,5.0,Meribel
ADIRINC-1645,4652460,U_M1CE2,Закрыт,30.04.2024 14:42,,,,,Дефект промсреды,20.06.2024 12:39,2024-06-27 00:00:00.0,"Уточнению по механизму учета оборота,  если брать в расчет сделки от с settlemet date=01.04 у клиента перешел оборот на 26ое апреля, переход комиссии случился но сразу же откатился. Учитывая, что 27 и 29, 30 выходные дни по произв. календарю возможно влияния выходных дней на процедуру

Оборот от 1го:
 select sum(abs(money_volume)) as 'Оборот' --a_tr.bank_tax, a_tr.ex_board, tar.tp_id, * --SUM(bank_tax) --sum(bank_tax), count(bank_tax_pay) --bank_tax, bank_tax_pay, *
 from a_hell_opers.dbo.a_trades a_tr
 join hell.dbo.tarifs tar ON a_tr.tp_id = tar.tp_id
 WHERE
 1=1
 AND acc_code = '142697-000'
 AND a_date >= '2024-04-01'
 !image-2024-04-30-16-56-33-229.png!
 Оборот от 2-го в данном случае не хватает
 select sum(abs(money_volume)) as 'Оборот' --a_tr.bank_tax, a_tr.ex_board, tar.tp_id, * --SUM(bank_tax) --sum(bank_tax), count(bank_tax_pay) --bank_tax, bank_tax_pay, *
 from a_hell_opers.dbo.a_trades a_tr
 join hell.dbo.tarifs tar ON a_tr.tp_id = tar.tp_id
 WHERE
 1=1
 AND acc_code = '142697-000'
 AND a_date >= '2024-04-02'
 !image-2024-04-30-16-59-45-637.png!

По логам у клиента случился переход но на следующий день откатился
 !image-2024-04-30-16-50-35-499.png!
 !image-2024-04-30-14-44-47-831.png!
 !image-2024-04-30-14-44-52-565.png!",,,Марс 2
ADIRINC-1644,4652364,U_M1AYE,Отклонен,30.04.2024 00:15,,,,,Дефект промсреды,15.05.2024 11:25,2024-07-08 00:00:00.0,"При выставлении алерта на цену актива вылетает на экран авторизации

[https://console.firebase.google.com/project/alfadirect-b2c7a/crashlytics/app/android:ru.alfadirect.app/issues/a88a9936046a668dee2e7c4b19a7cc0c?time=last-seven-days&sessionEventKey=662ffdbc00c600015a59ce9076ab238f_1941841617899883517&sessionTab=data&userInfoQuery=11a8c7eb-10ac-3b46-b1da-0ff61688457a]

2.29.0, android",,,Matterhorn
ADIRINC-1643,4652446,U_M1W4D,Отклонен,29.04.2024 13:13,,,,,Дефект промсреды,06.05.2024 12:42,2024-06-18 00:00:00.0,"в приложении МТ в разделе Портфель клиентам транслируются некорректные данные 
стоимость инструмента на момент закрытия дня.
на примере клиента BCJMXI  3873260 и ISIN RU000A1002V2

на конце дня за 27.04.2024 мы транслируем 228.00
!image-2024-04-29-13-05-25-976.png!
!image-2024-04-29-13-05-40-944.png!
когда данные с МБ совсем другие, составляет 230,7
мhttps://www.moex.com/ru/issue.aspx?board=TQBR&code=EUTR&utm_source=www.moex.com&utm_term=RU000A1002V2

!image-2024-04-29-13-04-41-910.png!


Это подтверждается логами следующего торгового дня
http://adlog1/kibana/goto/d74e96f0-0610-11ef-a0bf-b5f866e3062c

!image-2024-04-29-13-11-41-532.png!

+_*Необходимо клиентам транслировать корректные цены на момент закрытия дня, соответствующие данным с МБ*_+",,1.0,
ADIRINC-1642,4649710,U_M1CUE,Отклонен,27.04.2024 15:13,Appalachi,,,,Дефект промсреды,01.07.2024 10:52,2024-06-17 00:00:00.0,"Добрый день, коллеги. 
У клиентов на ANDROID версия ОС 13 и 14, Версия приложения: 2.29.0 при переходе в инструмент, пример, ТКС Холдинг, при нажатии на ""прицел"" и выборе свечки, чтобы посмотреть сводку, после нажатия еще раз на этот значок для отображения полной сводки за данную свечу, на фронте идет сильное округление до одного первого символа.
На IOS воспроизвести не удается. ",,8.0,
ADIRINC-1640,4643479,U_M1W4D,Закрыт,26.04.2024 13:34,,,,,Дефект промсреды,19.09.2024 11:41,2024-06-14 00:00:00.0,"У клиента 928318, 4674838, AVZX8Y при смене счёта, позиции на графике не меняются.
Версия МТ, 2.29.0, android

При смене счета на 928318 информация остается по счёту 4674838
 !image-2024-04-26-13-32-27-479.png!
 !image-2024-04-26-13-32-42-284.png!

+_*Необходимо устранить ошибку.*_+
 +_*К сожалению, логи с ошибками не обнаружены.*_+",,1.0,Appalachians
ADIRINC-1639,4637357,U_M1W4D,Закрыт,25.04.2024 13:49,,,,,Дефект промсреды,10.06.2024 09:24,2024-06-13 00:00:00.0,"У клиента ABR8HT 156369 не доступна функция для отмены заявок в новом веб-терминале на графике, Кнопки отмены ""крестик"" функционально недоступен.
В разделе Портфель → Заявки корректно отменяются.
логов снять не удается, т.к. функционал в принципе не доступен.

!image-2024-04-25-13-47-54-295.png!  ",,1.0,Web
ADIRINC-1638,4636563,U_M20N2,Закрыт,25.04.2024 12:31,,,,,Дефект промсреды,23.05.2024 12:12,2024-06-13 00:00:00.0,"В веб-мт и ЛК при подаче заявки на участие в IPO (на примере  IPO МТС Банк RU000A0JRH43), система просит пройти тест

!image-2024-04-25-12-43-32-450.png!   

 

!image-2024-04-25-12-45-42-030.png!

Тест 4 Акции не включенные в котировальные списки:

!image-2024-04-25-12-46-32-441.png!

Сама бумага тестирования не требует по веб-адм.

!image-2024-04-25-12-44-10-714.png!

По итогам обсуждения в треде [https://rc.alfa-bank.net/channel/adir-lk-pub?msg=7tPBK2Byq4H858TBM]

будет исправлено в рамках задачи https://jira.moscow.alfaintra.net/browse/ADIRLK-5331

 ",,6.0,НТФ (ЛК)
ADIRINC-1637,4635262,U_M20N2,Отклонен,25.04.2024 10:07,,,,,Дефект промсреды,15.05.2024 15:57,2024-06-13 00:00:00.0,"МТ андроид 2.29.0 раздел Рынок - Карточка актива - вкладки График и Дивиденды.

При горизонтальном расположении устройства, вкладки График и Дивиденды не переходят в горизонтальный вид, и во вкладке График на телефоне идет постоянная загрузка, а на планшете начинает мерцать экран.

Планшет:

Версия приложения: 2.29.0
 Логин: rnegru
 Устройство: TECNO LH7n
 Прошивка: 13
 Время: 1713968075300 (3)
 Время сервера (OperServer): 1713978875136
 Статус работы серверов: + + + +
 Connected: true
 DataEnabled: false
 Is 4G: false
 WiFi enabled: true
 WiFi connected: true
 Available by ping: true
 Network operator name: Tele2
 Network type name: NETWORK_WIFI

 Логи с устройства приложены.",,,
ADIRINC-1636,4632002,U_M1DCS,Закрыт,24.04.2024 14:08,,,,,Дефект промсреды,13.05.2024 09:56,2024-05-07 00:00:00.0,"При тапе на конкретное размещение ЦФА, отрабатывает кросс-автроизация в ЛК, но открывается старая форма входа в паспорт.
Логи с устройства чистые, приложу логи с монлога.
Версии 2.29.0-2.29.1
Версии android не принципиальны.
Воспроизвести можно на  аккаунте
login: ve_matveev1
password: shRjEpn9",,,Core
ADIRINC-1635,4631858,U_M1W4D,Закрыт,24.04.2024 13:21,,,,,Дефект промсреды,17.06.2024 09:19,2024-06-11 00:00:00.0,"У клиентов наблюдается некорректное отображение суммы продажи облигаций, отличающаяся от истории и ЛС.
Ниже приведен пример по клиенту ATRZ46 4044532
Клиент продал актив на сумму RU000A105Q97 4 023,36 рубля.
В брокерском отчёте информация подтверждена
!image-2024-04-24-13-10-54-713.png!

Так-же мы видим подтверждение и в ЛС
[http://webadmin.k8s-master.alfadirect.ru/reporting/orderlimitlog/4139232265]
!image-2024-04-24-13-11-34-874.png!

При этом в МТ, в разделе Заявки отображается некорректная стоимость продажи облигации, при этом, НКД на текущий момент 666,67 при 99,65%
!image-2024-04-24-13-18-41-713.png!

!image-2024-04-24-13-19-09-244.png!

логи найти не удалось, но ошибка явна на скриншотах.

+_*Необходимо устранить некорректное отображение стоимости по заявкам и отображать клиентам корректные данные.*_+",,1.0,Core
ADIRINC-1634,4628263,U_M1AYE,Закрыт,23.04.2024 17:42,,,,,Дефект промсреды,20.05.2024 09:51,2024-05-28 00:00:00.0,"Если выбрать на аднроид 2.29 в окне заявки тип стоп-лимит и после стереть проскок, то выдает ошибку функциональности",,1.0,Everest
ADIRINC-1633,4622944,U_M19LL,Отклонен,22.04.2024 22:23,,,,,Дефект промсреды,02.09.2024 10:46,2024-06-10 00:00:00.0,"У клиента 2 активные заявки по одному инструменту, но в стакане их не видно, при этом заявки видно в расширенном стакане, но показывает, как нет предложений по такой цене

Клиент 225044-000 выставил заявку по RU000A105VP7 на продажу по цене 100.960000

Номер 56550199784

Версия Андроид 2.29",,7.0,Core
ADIRINC-1632,4621832,U_M16Z9,На исправление,22.04.2024 16:39,,,,,Дефект промсреды,,2024-06-07 00:00:00.0,"У клиента AB6UW1 2198488 была отменена заявка на покупку акций Черкизово ГК RU000A0JL4R1



!image-2024-04-22-16-36-10-775.png!

http://webadmin.k8s-master.alfadirect.ru/reporting/orders/2198488-000/56215868484/1
!image-2024-04-22-16-37-08-085.png!

номер заявки 56215868484, но в ""Дзынь"" пришло уведомление о покупке, что является некорректным.
!image-2024-04-22-16-37-41-788.png!

+_*Требуется настроить уведомления таким образом, чтобы учитывался статус по заявкам.*_+",,1.0,АПИ\Интеграции
ADIRINC-1631,4620552,U_M1UN1,Закрыт,22.04.2024 14:40,ОТЭИСФЛ,,,,Дефект промсреды,11.06.2024 09:25,2024-07-22 00:00:00.0,"В версии 2.29 при заходе в карточке инструмента в раздел ""Сводка"" у некоторых инструментов наблюдается некорректное отображение валюты номинала и купона.

Приложен скриншот на примере RU000A105RH2. По самому инструменту обнаружено, что в таблицах adfront.dbo.objects и adfront.fi.fininfoext отличаются значения полей IdObjectFaceUnit и IdObjectCurrency соответственно, однако подобное поведение не является некорректным. 

В версии 2.28 отображение корректное. Вероятно в версии 2.29 взяли другое поле для определения валюты инструмента.

Потенциально проблемы с отображением имеются у *159* инструментов

*Шаги воспроизведения:*
 # Найти в МТ инструмент из запроса SQL, например, RU000A105RH2
 # Зайти во вкладку ""Сводка""

*ОР:*

Во вкладке ""Сводка"" в полях ""Номинал"" и ""Купон"" валюта отображения - доллары

*ФР:*

Во вкладке ""Сводка"" в полях ""Номинал"" и ""Купон"" валюта отображения - рубли

 

Запрос со списком инструментов:
{code:java}
select obj.IdObjectFaceUnit, lf.IdObjectCurrency, * from adfront.bs.objects obj
join [AdFront].[intrfc].[LinkedFi] lf on obj.IdFiBalance = lf.IdFI
where obj.IdObjectFaceUnit != lf.IdObjectCurrency
and obj.CodeObjectType in ('BC'
,'BB'
,'BG'
,'BS'
,'BM'
,'BR'
,'BI'
,'BE'
,'BF'
,'SB')
--and obj.ISIN = 'RU000A105RH2'
{code}",,1.0,Appalachians
ADIRINC-1629,4614411,U_M1DKL,На исправление,21.04.2024 12:48,,,,,Дефект промсреды,,2024-08-09 00:00:00.0,"Добрый день.
 Клиента ADKNSW Демьянов Вадим Александрович 612368 
 При попытке прикрепить файл в приложении Fresh ideas кнопка не активна, на более старой версии приложения все работает корректно.
Версия IpadOS 17.4.1",,1.0,Matterhorn
ADIRINC-1628,4614233,U_M13MK,Принят к исправлению,19.04.2024 21:36,Дефект_АИ,История,,,Дефект промсреды,,2024-06-07 00:00:00.0,"Коллеги, обратился клиент ГС 4633591 по цб GLSR (RU000A0JPFP0).
 На 18.04 был открыт шорт в 24 шт. Клиент откупил их и докупил 5 шт. в плюс.
 УЦ на этот момент должна быть равна цене 5 штук – 1093,8 руб.
 А клиенту отображалась УЦ 1113,4 руб., как если бы он сначала откупил 5 шт., а затем 24 штуки. 

проверяем по базе и видим, что порядок trd_no не соответствует порядку ts_no
 при совпадающем db_time
 !image-2024-04-19-21-35-43-715.png!
 CСчитаем, что сортировка сделок при расчёте УЦ должна вестись не по trd_no, а по ts_no, т.к. ts_no отражает действительный порядок совершения сделок на бирже.",,3.0,Марс
ADIRINC-1627,4612521,U_M1W4D,Закрыт,19.04.2024 16:29,,,,,Дефект промсреды,22.05.2024 10:37,2024-06-06 00:00:00.0,"При Выводе ДС ""Перевод средств в другой Банк"" возникает ошибка. ""Что-то сломалось""
!image-2024-04-19-16-14-24-430.png!
!image-2024-04-19-16-14-50-974.png!
Видео воспроизведение ошибки:
[^Screen_Recording_20240417_125416_A-Investments.mp4]

При проведении Анализа выяснили, что сервис _+dotnet-facade-limitservice+_ при отправке запроса в сервис _+dotnet-limitservice+_ не дожидается ответа и отваливается по таймауту 30 секунд. Ниже приведены логи воспроизведения ошибки:

[http://adirelkprod.alfadirect.ru/goto/7ffeca36320bd316c226bd0537d8ffd4]

 _+dotnet-facade-limitservice+_
!image-2024-04-19-16-18-53-828.png!

запрос не был обработан _+dotnet-limitservice
http://adirelkprod.alfadirect.ru/goto/aad42f024e8dab55f6e4320781527cc5+_
!image-2024-04-19-16-20-19-909.png!

При разборе кейса, было выявлено, что передаются данные в поле ""comment""
предположительно, это и {color:#de350b}является причиной{color} невозможности обработки запроса Лимит сервисом.
ниже фактура:
{code:java}
Request: http://172.21.1.118/api/moneywithdraw?idlogin=104624135, from ip: 172.21.0.20 
{""payload"":{""clientOrderNum"":84953716,""idAccount"":4628478,""idSubAccount"":2811244,""idRazdel"":19633607,""moneyAccount"":""30601810300024628478"",""idObjectCurrency"":174368,""branchId"":0,""bic"":""044030707"",""accNo"":""40817810119364000384"",""corAcc"":""30101810240300000707"",""beneficiary"":""\u0411\u0443\u0448\u0430\u043D\u0441\u043A\u0438\u0439 \u0418\u0432\u0430\u043D \u0412\u0430\u0441\u0438\u043B\u044C\u0435\u0432\u0438\u0447"",""amount"":9398,""binaryEDocument"":""MIIEkAYJKoZIhvcNAQcCoIIEgTCCBH0CAQExDzANBglghkgBZQMEAgEFADCCAtQGCSqGSIb3DQEHAaCCAsUEggLB3evl6vLw7u3t7uUg7+7w8/fl7ejlIO/uIPHo8fLl7OUgq8Dr/PTgLcTo8OXq8rsNCsru7PM6IMDOIKvA6/z04C3B4O3quw0KzvHt7uLg7ejlOiDD5e3l8ODr/O3u5SDR7uPr4Pjl7ejlILkgNDYyODQ3OA0Kyuvo5e3yOiDB8/jg7fHq6OkgyOLg7SDC4PHo6/zl4uj3DQrI7ej26ODy7vAg7+7w8/fl7ej/OiDB8/jg7fHq6OkgyOLg7SDC4PHo6/zl4uj3IChpYnVzaGFuc2tpeSkNCs/u8PP35e3o5Tog7/Du6Ofi5fHy6CDu8uf74iDk5e3l5u379SDx8OXk8fLiIPEg6+j25eLu4+4g4fDu6uXw8eru4+4g8ffl8uANCsvo9uXi7ukgKOHw7url8PHq6OkpIPH35fI6IDMwNjAxODEwMzAwMDI0NjI4NDc4DQrR8+zs4DogOTM5OC4wMA0KwuDr/vLgOiBSVUINCtLl6vP55eUg7OXx8u4g8OXn5fDi6PDu4uDt6P8g8fDl5PHy4g0KCc/u8PL05ev8OiA0NjI4NDc4LTAwMA0KCdLu8OPu4uD/IPHo8fLl7OAgKPD77e7qKTogytbBIMzMwsENCtDl6uLo5+jy+yDx9+Xy4CAg5Ov/IOfg9+jx6+Xt6P8g4vvi7uTo7Pv1IPHw5eTx8uI6DQoJz+7r8/fg8uXr/DogwfP44O3x6ujpIMji4O0gwuDx6Ov85eLo9w0KCbkg8ffl8uA6IDQwODE3ODEwMTE5MzY0MDAwMzg0DQoJweDt6iAo7OXx8u4g7vLq8Pvy6P8g8ffl8uApOiDUyMvIwMsguSA3ODA2IMHAzcrAIMLSwSAoz8DOKQ0KCcHIyjogMDQ0MDMwNzA3DQrE4PLgIOgg4vDl7P8g7+7k4PfoOiAxNS8wNC8yMDI0IDE0OjQ3MYIBjTCCAYkCAQEwYjBLMRIwEAYKCZImiZPyLGQBGRYCcnUxGjAYBgoJkiaJk/IsZAEZFgphbGZhZGlyZWN0MRkwFwYDVQQDExBBbGZhLURpcmVjdCBDQSAzAhM0AEQOrHYwfBe7qBt3AAEARA6sMA0GCWCGSAFlAwQCAQUAMA0GCSqGSIb3DQEBAQUABIIBAJrKIbv7ClECOQ95ipP7tqkXGZDb4AXCHvbrczDBB7VzN+CC5SOrUAxFtcXfp3umm3Gs50hTeSin/eSnKSI2OrYwoCcWfKtHgmC6wRaAG98S26FAbfRlPnrnOQp7VL76+Tgb/6lqrMLdJYWW3WNY/C4uKwPQxp485AsSjhwYXXi13bKcOflg9cFqHtRhhrqKntKus9818exvs8foOEMtQblRJp3MK+fBvmyQTIQ8hmybcyyQg1fGf6ATNga31nYnuu2+CZt6BYE7AXY/YF/j1aZSj6NGRTlBiCD4Kup96dQjjDOWzwRkQvThwtdGo5DBVnz8DxH0Ih1DD9LePj7a9V8="",""channel"":5,""signType"":1,""signTime"":""2024-04-15T14:47:28.4723052+03:00"",""orgCode"":""PERS"",""idCertificate"":5090312,""comment"":""\u0411\u0418\u041A \u0411\u0430\u043D\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0430\u0442\u0435\u043B\u044F\n044030707\n\n\u0418\u041D\u041D \u0411\u0430\u043D\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0430\u0442\u0435\u043B\u044F\n7702070139\n\n\u041A\u041F\u041F \u0411\u0430\u043D\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0430\u0442\u0435\u043B\u044F\n783543012\n\n\u041A/\u0421 \u0411\u0430\u043D\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0430\u0442\u0435\u043B\u044F\n30101810240300000707\n\n\u041F\u043E\u043B\u0443\u0447\u0430\u0442\u0435\u043B\u044C\n\u0411\u0443\u0448\u0430\u043D\u0441\u043A\u0438\u0439 \u0418\u0432\u0430\u043D \u0412\u0430\u0441\u0438\u043B\u044C\u0435\u0432\u0438\u0447"",""flags"":0,""tin"":""""},""activations"":[{""type"":""Login"",""pin"":"""",""login"":""ibushanskiy"",""idAccount"":0}]}
{code}
Что мы и видим в сервисе _+adir-moneywithdraw+_
http://adirelkprod.alfadirect.ru/goto/4d9ce7d27cf35d1328727fb2193ea8ea

!image-2024-04-19-16-24-20-961.png!

Откуда тянутся данные из БД выяснить не удалось.
*+_Требуется устранить ошибку и исключить повторения кейса в будущем по всем клиентам._+*",,3.0,НТФ (ЛК)
ADIRINC-1625,4604020,U_M0SLM,На исправление,18.04.2024 16:36,Дефект_АИ,,,,Дефект промсреды,,2024-06-05 00:00:00.0,"*Шаги воспроизведения:*

После проведения плановых работ по обновлению Windows на adir-p-core-13 все сервисы ребутнулись и корректно поднялись, в том числе и FE32Prices

Однако не поднялся коннект FE32Prices с портом соответствующего фронтенда. (см скрин с примером запроса и логами кибаны)

*Фактически:*

После ручного рестарта сервиса FE32Prices, подключение было установлено и проблема ушла

*Необходимо:*

После рестарта сервиса, необходимо всегда проверять и устанавливать коннект с FE автоматически без ручного рестарта сервиса.",,,Core
ADIRINC-1624,4602835,U_M1UN1,Закрыт,18.04.2024 13:50,ОТЭИСФЛ,,,,Дефект промсреды,17.05.2024 15:15,2024-04-27 00:00:00.0,"В Android версии приложения 2.29 при открытии карточки фьючерса из раздела рынки происходит бесконечная загрузка, либо вылет приложения. Инструмент в итоге не открывается, нет доступа к графику, заявкам и тд. В логах со стороны бэка при этом никаких ошибок обнаружено не было.

Во вложении видео воспроизведения ошибки, а также логи с устройства клиента

*Шаги воспроизведения:*
 - Зайти в рынки
 - Выбрать раздел Фьючерсы
 - Открыть любой инструмент

*ОР:* При нажатии на любой фьючерс прогружается его карточка
*ФР:* При нажатии на любой фьючерс происходит бесконечная загрузка из-за чего дальнейший клиентский путь невозможен",,61.0,Appalachians
ADIRINC-1623,4602722,U_M1UN1,Отклонен,18.04.2024 13:43,ОТЭИСФЛ,,,,Дефект промсреды,18.04.2024 13:45,2024-04-27 00:00:00.0,"В Android версии приложения 2.29 при открытии карточки фьючерса из раздела рынки происходит бесконечная загрузка. Инструмент в итоге не открывается, нет доступа к графику, заявкам и тд. В логах при этом никаких ошибок обнаружено не было.

Во вложении видео воспроизведения ошибки, воспроизводится стабильно.

*Шаги воспроизведения:*
 - Зайти в рынки
 - Выбрать раздел Фьючерсы
 - Открыть любой инструмент

*ОР:* При нажатии на любой фьючерс прогружается его карточка
*ФР:* При нажатии на любой фьючерс происходит бесконечная загрузка из-за чего дальнейший клиентский путь невозможен",,12.0,Appalachians
ADIRINC-1622,4601676,U_M19LL,Закрыт,18.04.2024 12:10,,,,,Дефект промсреды,20.06.2024 11:42,2024-06-26 00:00:00.0,"2.29.0 андроид

При  попытке вывести доллары в МТ (видео прилагаю), и нажатие на кнопку ""Перевести"" ничего не происходит, просто закрывается данное окно, а доллары не переводятся.
Но в приложение банка клиент смог вывести доллары через раздел Все продукты → Выбираете брокерский счёт → Вывести.[^document_5262475852712527232.mp4]",,,Montblanc
ADIRINC-1621,4601078,U_M19YV,Отклонен,18.04.2024 11:21,,,,,Дефект промсреды,23.04.2024 11:42,2024-07-18 00:00:00.0,"При переводе ДС с БС в другой банк, возникает ошибка ""Кое-что сломалось. На нашей стороне, но мы уже чиним"". ДС клиенту не отправились.Ошибка плавающая.Также после ввода реквизитов и суммы перевода, после нажатия на кнопку ""Перевести"" на долю секунды на экране телефона появляются логи (логи появляются даже при успешном переводе).

 ",,1.0,
ADIRINC-1620,4595758,U_M19LL,Закрыт,17.04.2024 12:38,,,,,Дефект промсреды,20.05.2024 09:58,2024-06-04 00:00:00.0,"Веб-терминал для ПК.
Окно ""Позиции"", колонка ""КупДата"" применительно к облигациям - неправильно сортирует по дате купона, учитывает первую цифру даты предстоящей выплаты, т.е. ранжирует по дню, а не по году-месяцу-дню, список строится по убыванию/возрастанию 1...31 (количество дней месяца), чт оневерно.
Если добавлять облигации во вкладку ""Инструменты"", то там та же сортировка, колонка, имеет чуть другое название ""Дата купона"" и сортирует нормально.
Проверили на своих счетах - в [invest.alfabank.ru|http://invest.alfabank.ru/]. скрин прилагаю.
Скрин клиента сделан с [trade.alfabank.ru|http://trade.alfabank.ru/], но он так же пробовал и с верного адреса тоже. В обоих адресах одинаково неправильно сортирует по ""КупДата"".

 

!image-2024-04-17-12-38-08-540.png!

!image-2024-04-17-12-38-18-409.png!",,,Web
ADIRINC-1619,4594873,U_M1W4D,Отклонен,17.04.2024 11:36,,,,,Дефект промсреды,13.05.2024 08:32,2024-06-04 00:00:00.0,"У клиентов в ""портфель"" в разделе ""История"" отображается задублированная история операций. Хотя операция была совершена только одна.

Пример клиента: AMT9CV 1434140
 У клиента за 15.04.2024 указана сделки в двойном экземпляре, по активам Астра ГК RU000A106T36 и Совкомфлот RU000A0JXNU8

!image-2024-04-17-11-23-36-511.png!
 !image-2024-04-17-11-25-07-099.png!
 !image-2024-04-17-11-25-30-476.png!

В логах приходит одна запись:
 [http://adlog1/kibana/goto/815d5180-fc94-11ee-b234-3dcc39667669]
 !image-2024-04-17-11-28-55-316.png!

Так-же при запросе CURL, получаем одну запись.
{code:java}
curl -X GET --location ""http://172.21.1.97:80/api/operations-history?accCode=1434140-000&assetIdType=ID_OBJECT&operationDateEnd=2024-04-16T23%3A59%3A59.999&codeOperationType=E&codeOperationType=D&codeOperationType=S&codeOperationType=VP&codeOperationType=X&maxElements=100&operationDateStart=2024-03-15T00%3A00"" -H ""application/json"" -H ""Content-Type: application/json;v=2""{code}
ответ, в файле:
 [^ответ.txt]

!image-2024-04-17-11-32-08-742.png!

так-же записи в БД в единичном экземпляре.
{code:java}
  SELECT *  FROM [hell].[dbo].[trades] with(nolock)    where acc_code = '1434140-000'{code}
!image-2024-04-17-11-35-57-963.png!

+_*Требуется устранить ошибку отображения задублированной истории*_+",,2.0,
ADIRINC-1618,4594952,U_M1UN1,Отклонен,17.04.2024 11:18,ОТЭИСФЛ,,,,Дефект промсреды,19.04.2024 09:51,2024-04-26 00:00:00.0,"В Android версии приложения 2.29 при открытии карточки фьючерса из раздела рынки происходит бесконечная загрузка. Инструмент в итоге не открывается, нет доступа к графику, заявкам и тд. В логах при этом никаких ошибок обнаружено не было.

Во вложении видео воспроизведения ошибки, воспроизводится стабильно.

*Шаги воспроизведения:*
 - Зайти в рынки
 - Выбрать раздел Фьючерсы
 - Открыть любой инструмент

*ОР:* При нажатии на любой фьючерс прогружается его карточка
*ФР:* При нажатии на любой фьючерс происходит бесконечная загрузка из-за чего дальнейший клиентский путь невозможен",,12.0,Appalachians
ADIRINC-1617,4594529,U_M1W4D,Закрыт,17.04.2024 11:06,,,,,Дефект промсреды,22.05.2024 08:54,2024-07-17 00:00:00.0,"У клиентов возникает ошибка ""При формировании документа произошла ошибка"" при формировании документа ""Анкета инвестиционного счета""
 на примере клиента
 BB8DR4 3482726 
 Клиент выбирает формирование Анкеты, начинается загрузка
 !image-2024-04-17-10-34-26-170.png!
 После выходит ошибка
 !image-2024-04-17-10-34-43-570.png!

При разборе логов ошибок нет.
 [http://adirelkprod.alfadirect.ru/goto/cad61997386494247d210613ee773e8b]
 !image-2024-04-17-10-35-55-317.png!

Message:
{code:java}
2024-04-17 09:42:28.1786|INFO|Info|MT LK Request true ""GET"" https://lk.alfadirect.ru/api/client/documents/broker/3482726/Анкета счёта №3482726.pdf; Elapsed: 10644; StatusCode: 200; RequestBody: """"; ResponseBody: ""[Binary]""; RequestHeaders: ""Connection: close; Accept: */*; Accept-Encoding: gzip,deflate,br,zstd; Accept-Language: ru,ru-RU; q=0.9,en-US; q=0.8,en; q=0.7; Cookie: cus=BB8DR4; _sp_ses.8edd=*; isMt=[%22mt%22%2C%22mt%22]; sign=sign; .AD4AuthCookie=A070C1CACC0E4079A6B21191252D35826823E6023D4CCD3C828D66BC93095BBE9A6CA1F7A38C83F5275F1ADD45C97232DD23B14E1F3EF73730AA0EA97135CF9A37366E1E4CBDBBD72707E0FEDF356023287A9A282785201C898A88C0FB837B0642B9BDF378074233AFEA81C4EC9DDC5DB9CC70E8; _sp_id.8edd=4399a054-bc52-4f9d-a318-3848cd39e9b3.1713335555.1.1713336131.1713335555.a6a003c3-cd05-42a1-bfce-bb6b6f5e4709; Host: lk.alfadirect.ru; Referer: https://lk.alfadirect.ru/documents/info?mt=mt&mt=mt&sign=sign&treaty=3482726&theme=dark; User-Agent: Mozilla/5.0,(Linux; Android 10; Mi 9T Pro Build/QKQ1.190825.002; wv),AppleWebKit/537.36,(KHTML, like Gecko),Version/4.0,Chrome/123.0.6312.99,Mobile,Safari/537.36; X-Real-IP: 172.21.18.102; X-Forwarded-For: 172.21.18.102; X-Forwarded-Proto: https; sec-ch-ua: ""Android WebView"";v=""123"", ""Not:A-Brand"";v=""8"", ""Chromium"";v=""123""; sec-ch-ua-mobile: ?1; sec-ch-ua-platform: ""Android""; X-Requested-With: ru.alfadirect.app; Sec-Fetch-Site: same-origin; Sec-Fetch-Mode: cors; Sec-Fetch-Dest: empty""; ResponseHeaders: ""Content-Disposition: attachment; filename=""Анкета счёта № 3482726.pdf""; filename*=UTF-8''%D0%90%D0%BD%D0%BA%D0%B5%D1%82%D0%B0%20%D1%81%D1%87%D1%91%D1%82%D0%B0%20%E2%84%96%203482726.pdf; Content-Type: application/pdf""; ContentType: ""application/pdf""Treaty: ""3482726""; WrongApiUrl: false; RouteTemplate: ""api/client/documents/broker/{treaty}/{filename}""{code}
RequestHeaders:
{code:java}
Connection: close; Accept: */*; Accept-Encoding: gzip,deflate,br,zstd; Accept-Language: ru,ru-RU; q=0.9,en-US; q=0.8,en; q=0.7; Cookie: cus=BB8DR4; _sp_ses.8edd=*; isMt=[%22mt%22%2C%22mt%22]; sign=sign; .AD4AuthCookie=A070C1CACC0E4079A6B21191252D35826823E6023D4CCD3C828D66BC93095BBE9A6CA1F7A38C83F5275F1ADD45C97232DD23B14E1F3EF73730AA0EA97135CF9A37366E1E4CBDBBD72707E0FEDF356023287A9A282785201C898A88C0FB837B0642B9BDF378074233AFEA81C4EC9DDC5DB9CC70E8; _sp_id.8edd=4399a054-bc52-4f9d-a318-3848cd39e9b3.1713335555.1.1713336131.1713335555.a6a003c3-cd05-42a1-bfce-bb6b6f5e4709; Host: lk.alfadirect.ru; Referer: https://lk.alfadirect.ru/documents/info?mt=mt&mt=mt&sign=sign&treaty=3482726&theme=dark; User-Agent: Mozilla/5.0,(Linux; Android 10; Mi 9T Pro Build/QKQ1.190825.002; wv),AppleWebKit/537.36,(KHTML, like Gecko),Version/4.0,Chrome/123.0.6312.99,Mobile,Safari/537.36; X-Real-IP: 172.21.18.102; X-Forwarded-For: 172.21.18.102; X-Forwarded-Proto: https; sec-ch-ua: ""Android WebView"";v=""123"", ""Not:A-Brand"";v=""8"", ""Chromium"";v=""123""; sec-ch-ua-mobile: ?1; sec-ch-ua-platform: ""Android""; X-Requested-With: ru.alfadirect.app; Sec-Fetch-Site: same-origin; Sec-Fetch-Mode: cors; Sec-Fetch-Dest: empty{code}
Судя по ответу, мы получаем файл, который не можем отобразить в приложении МТ в разных версиях Android

+_*Необходимо устранить ошибку*_+",,6.0,НТФ (ЛК)
ADIRINC-1616,4592357,U_M19LL,Закрыт,16.04.2024 17:43,,,,,Дефект промсреды,01.07.2024 10:54,2024-06-24 00:00:00.0,"{panel}
В веб терминале МТ текущая цена по инструментам, которые  торгуются на ОТС: Акции (ОТС режим Т+1 с расчетами в RUB),  отображается =0

Для примера

Инструмент Softline GDR

Счет: 361156

Еще счета с подобной проблемой:

12975-000, 22275-000
24271-000, 24956-000
27660-000, 32374-000

Необходимо чтобы ВТ АИО поддерживал борд ОТС: Акции (ОТС режим Т+1 с расчетами в RUB) 
{panel}
 
{panel}
Шаги воспроизведения{panel}",,,Montblanc
ADIRINC-1615,4589444,U_M1W4D,Закрыт,16.04.2024 13:21,,,,,Дефект промсреды,05.08.2024 08:39,2024-06-24 00:00:00.0,"На примере клиента AVR4NF 4377989 и инструмента ISIN RU0009046452 

При переходе во вкладку дивиденды по активу НЛМК RU0009046452 дивидендная доходность отражается 19,11%

Хотя если сумму в дивидендах пересчитать в рублях, то ориентировочная сумма будет 11,13%.
 !image-2024-04-16-13-20-28-730.png!

[http://adlog1/kibana/goto/d95303d0-fbdb-11ee-8d9e-af90c1c1d254]
!image-2024-04-16-13-27-38-070.png!



+_*Проблема наблюдается по разным инструментам.*_+ 
 +_*Необходимо автоматизировать корректный расчет % дивидендов по инструментам в целом.*_+ ",,65.0,CoreMT
ADIRINC-1614,4588867,U_M1782,Закрыт,16.04.2024 12:45,,,,,Дефект промсреды,14.05.2024 10:33,2024-06-03 00:00:00.0,"Клиент AA7SCU 21437 установил приложение на планшет Xiaomi Redmi Pad SE.
При выполнении различных действий, в приложении, работа нарушается.
Экран мигает и приложение ни на что не реагирует. После перезагрузки открывается штатно, но со временем проблема повторяется",,3.0,Appalachians
ADIRINC-1613,4585548,U_M1BDA,Закрыт,15.04.2024 19:17,,,,,Дефект промсреды,15.04.2024 19:22,2024-06-24 00:00:00.0,"Первая фаза закрытия дня"" который запускается вручную примерно в 22-00 возникает блокировка с джобом ""=15s Запуск aex_eq_import2transfers"" который запускается каждые 15 секунд.

В результате зависает процесс выгрузки проводок в таблицу dbo.EQ_export.

В связи с этим возможна ситуация не успеть провести обмен данными с EQ в отведенное для этого временное окно в рамках закрытия дня.

Что приведет к большим проблемам.

На данный момент, при возникновении такой ситуации дежурный выполняет kill блокирующего процесса, прерывает выполнение джобов  ""23:00 Первая фаза закрытия дня"" и  ""=15s Запуск aex_eq_import2transfers"" и далее запускает повторно процедуру закрытия дня штатно.

Необходимо исключить возникновение блокировок при работе джобов ""23:00          Первая фаза закрытия дня"" и ""=15s Запуск aex_eq_import2transfers""",,,Меркурий 1
ADIRINC-1612,4584138,U_M173X,Закрыт,15.04.2024 16:20,,,,,Дефект промсреды,06.05.2024 13:02,2024-05-31 00:00:00.0,"После добавления площадок SPBEX_FSHR_CLR и SPBEX_CLR_NOTRADE в процедуры adback.dbo.ImportRestFromHell и adback.dbo.ImportRestFromHellOnline, которые используются для импорта, перестали импортироваться позиции по площадке SPBEX_FSHR, авария IM16121725 ",,,Уран
ADIRINC-1611,4581449,U_M18JH,Закрыт,15.04.2024 12:51,,,,,Дефект промсреды,17.06.2024 10:15,2024-06-21 00:00:00.0,"В АИ ВТ при попытке ввести номер телефона, который начинается с 977 происходит автозамещение цифр и клиент не может войти. Цифра 7 вводится только со 2 нажатия, и после продолжения ввода номера, 7ки замещаются следующими цифрами.",,1.0,K2
ADIRINC-1610,4576378,,Отклонен,14.04.2024 14:45,,,,,Дефект промсреды,15.04.2024 16:44,2024-04-24 00:00:00.0,"ГС 4643471. При простановке в экстра-трансфере bps_usd ставится цена, отличная от налоговой детализации.

Пример:
 select top 100 bps_usd,*select top 100 bps_usd,*from a_hell_opers.dbo.a_all_transfers trf left join hell.tax.interface_income_detail iid on iid.trn_no = trf.trn_no where trf.trn_no = 20585501and trf.a_date >= '2022-02-01'

В налоговой детализации $52.6
 После расчёта УЦ bps_usd = 31.75047700
Позиции до этого не было, поэтому ожидается, что bps_usd будет равна $52.6

В результате неверно рассчитывает УЦ в целом по позиции.",,,
ADIRINC-1609,4569291,U_M1CUE,Закрыт,11.04.2024 19:37,,,,,Дефект промсреды,24.05.2024 08:03,2024-05-30 00:00:00.0,"Клиент пытается вывести Армянские Драмы на свой текущий счет в той же валюте.
В МТ ошибка ""Перевод недоступен. Попробуйте через 5 мин.""
В АМ ошибка ""Что-то пошло не так. Попробуйте позже""
В логах ЛС ошибка, которая предназначена для перерыва с 23 до 3, но ошибка по AMD возникает и в рабочее время



https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=1049194819",,2.0,Уран
ADIRINC-1608,4566675,U_M1CE2,Закрыт,11.04.2024 14:27,Android,Android_2.30.0,АФБ,,Дефект промсреды,24.07.2024 19:35,2024-06-19 00:00:00.0,"AHU4A1 ГС 66660 
ОР: после нажатия кнопки перевести, открывается окно подписания поручения
ФР: При нажатии кнопки, перевести ничего не происходит

 В МТ они отображаются, но после нажатие кнопки ""Перевести"" просто закрывается окно с переводом и ничего не происходит. Запросили видео
 Претрейд  контроль проходит :
Лог [http://webadmin.k8s-master.alfadirect.ru/reporting/orderlimitlog/4048630152]

По логам запроса нет, на подписание документа по  переводу нет

[Discover - Elastic (alfadirect.ru)|http://adirelkprod.alfadirect.ru/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:'2024-04-11T08:32:27.110Z',to:'2024-04-11T08:58:37.755Z'))&_a=(columns:!(message),filters:!(),index:'52f3edb0-e375-11ed-b7a3-9f153aaa74b0',interval:auto,query:(language:kuery,query:'%2266660%22%20or%20%22AHU4A1%22%20or%20%22ktsibulskiy%22'),sort:!(!('@timestamp',desc)))]

 
 Воспроизводится в версии 2.29 Android.
 На версии  2.22 все ок",,9.0,Montblanc
ADIRINC-1607,4566938,U_M1CYD,На исправление,11.04.2024 14:26,,,,,Дефект промсреды,,2024-05-29 00:00:00.0,"Добрый день, коллеги.
Нередко при закрытии дня у нас остается после РЕПО шорт. 
Как воспроизводится, на примере:
Клиент 4585101 участвует в длительном размещении юаневой облигации SLECO001P03Y
Его счет КАССОВЫЙ
ЛС учитывает то, сколько стоит облига и какую комиссию клиент выплатит за нее. Но при длительном размещении клиенту необходимо так же выплатить накопившейся купонный доход. Этот НКД не идет в расчет, то есть дс не резервируются и по итогу клиент получает шорт по юаням имея кассовый счет",,2.0,Риски
ADIRINC-1606,4566153,U_M19YV,Закрыт,11.04.2024 13:48,,,,,Дефект промсреды,22.04.2024 16:28,2024-05-29 00:00:00.0,"Не взымается комиссия по сделкам по валютам CNY по тарифу ""Трейдер""
 на примере клиента: AP9FXN 3356552
 Клиент приобрел инструмент ISIN RU000A107RH8
 Клиент использует тариф:
{code:java}
TRADE_0m_0049{code}
{code:java}
SELECT tp_code,next_tp_code,tp_code_selt,next_tp_code_selt, * FROM hell.dbo.accounts WHERE treaty = 3356552{code}
!image-2024-04-11-13-35-06-866.png!

По которой не была взыскана комиссия
 !image-2024-04-11-13-35-58-214.png!
 !image-2024-04-11-13-36-53-761.png!

 
{code:java}
SELECT tp_id,bank_tax,bank_tax_pay,* FROM a_hell_opers.dbo.a_trades WHERE a_date>'20240101'
AND acc_code ='3356552-000' 
AND settlement_date ='2024-02-07 00:00:00.000'
AND tp_id = '259'
and p_code = 'OKRUSBO06'{code}
В соответствии с описанием тарифов, на сайте Банка, от 02.04.2024 пункта 6
 [https://alfabank.ru/make-money/investments/help/docs/]
 Должна взыматься комиссия 
 6.1. Тарифные планы «Трейдер», «Оптимальный» 0,1%
 !image-2024-04-11-13-39-49-015.png!

В итоге, по клиенту комиссия была не списана.
 А так-же, подобная ситуация  наблюдается и по другим клиентам:
{code:java}
SELECT tp_id,bank_tax,bank_tax_pay,* FROM a_hell_opers.dbo.a_trades WHERE a_date>'20240101'
--AND acc_code ='3356552-000' 
AND settlement_date >='2024-01-01 00:00:00.000'
AND tp_id = '259'
and p_code = 'OKRUSBO06'{code}
 
 +_Необходимо устранить ошибку и корректно рассчитать комиссии по сделкам_+

 ",,1.0,Марс 2
ADIRINC-1605,4560293,U_M1DKF,На исправление,10.04.2024 14:12,,,,,Дефект промсреды,,2024-05-28 00:00:00.0,"При выдаче прав на пользованиt счетом одним клиентом другому через:

Сведения о счете -> Оформить доверенность. После заполнения всех полей и подписания поручения,  права выдаются только на 000 субсчет, даже если у клиента их несколько.  Хотя при заполнении полей есть примечание что: 

_Права на 000 субсчет по умолчанию распространяются на все иные субсчета, открытые в рамках Соглашения._

!image-2024-04-10-14-14-43-451.png!

После выдачи прав видно что доступ есть только на 000, хотя у меня имеется еще и 001 субсчет. 

  !image-2024-04-10-14-15-13-749.png!

 

В денежных переводах также нет инфы о 001 счете 

  !image-2024-04-10-14-15-33-479.png!

 ",,,НТФ (ЛК)
ADIRINC-1604,4553032,U_M1W4D,Закрыт,10.04.2024 09:03,,,,,Дефект промсреды,09.09.2024 16:11,2024-05-28 00:00:00.0,"В версии приложения МТ 2.29.0 Не отображается информация на графике ""Свечка""
не отображаются данные ""Перекрестие"" и ""Сводка""
!image-2024-04-10-09-02-00-186.png!
!image-2024-04-10-09-02-11-101.png!

+_*Необходимо устранить ошибку и отображать корректные данные*_+",,6.0,Appalachians
ADIRINC-1603,4548470,U_M1CUE,Закрыт,09.04.2024 12:22,Android_2.30.0,,,,Дефект промсреды,01.08.2024 12:21,2024-06-04 00:00:00.0,"Версия МТ AI: 2.29.0


Only ANDROID

Шаги воспроизведения:
 # Авторизоваться в приложении
 # Выбрать актив с отрицательным значение спроса/предложения (VTBL, но его починили, проверять надо на моках) -> Произошел переход на вкладку обзор

*Полученный результат:* 

Происходит краш приложения (смотри видео во вложении). 

Биржа нам присылает корректную информацию по суммарному количеству лотов на покупку, это количество превышает 2 147 483 647 лотов. Происходит переполнение типа и приложение не может обработать такое количество.

*Ожидаемый результат:*

Не вылетает приложение


На IOS показывается отрицательное значение но не вылетает.",,87.0,АПИ\Интеграции
ADIRINC-1602,4547635,U_M1FE1,Закрыт,09.04.2024 10:51,,,,,Дефект промсреды,09.04.2024 10:53,2024-05-27 00:00:00.0,"В пятницу выкатили доработку с исправлением логики записи сделок. Кусок кода, который поменяли, привел к тому, что вместо поиска по индексу в таблице hell.dbo.positions (почти 70 млн. записей) стал использоваться скан по другому индексу на этой таблице, что привело к резкому возрастанию времени работы процедуры.

Необходимо исправить ХП micex_raw_data.hell.TradesSave",,,Сатурн
ADIRINC-1601,4545612,U_M0WVN,Закрыт,08.04.2024 20:41,,,,,Дефект промсреды,10.04.2024 12:38,2024-05-27 00:00:00.0,"*Шаги воспроизведения:*

*1.* Клиент смотрит вкладку новости в любом инструменте с витрины или портфеле.

2. Видит новости за 5 апреля 2024

*Ожидаемый результат:*

Увидеть актуальные новости за текущий день

*Фактически* новости новости больше не актуализируются.

Наблюдается аналогичная ситуация во всех каналах

!image-2024-04-08-20-37-50-530.png!

 

Допинфо:

 

Сервис ETL Interfax последняя запись в логах от 5.04 в районе 12 дня

[http://adirelkprod.alfadirect.ru/goto/01fa4963f39940b14fea98fdac252d82]

!image-2024-04-08-20-39-49-389.png!

 *В топик _adir-core.news.fact.news-received-interfax.0 данные последний раз писались тоже 5.04.2024_*

*_!image-2024-04-08-20-40-39-846.png!_*

 В бд соответственно тоже записей после 5 числа нет

!image-2024-04-08-20-50-15-920.png!",,15.0,Сатурн
ADIRINC-1600,4544326,U_M1FE1,Закрыт,08.04.2024 16:47,,,,,Дефект промсреды,05.06.2024 09:21,2024-05-24 00:00:00.0,"Сервис com-instruments-idea отрабатывает с большой задержкой, требуется оптимизация сервиса, сейчас для работы необходимо 12 инстансов, для отработки 10 рпс. Дефект производительности

!image-2024-04-08-16-51-37-630.png!

!image-2024-04-08-16-51-51-794.png!

!image-2024-04-08-16-52-03-198.png!!image-2024-04-08-16-52-31-304.png!

 

 ",,,Сатурн 2
ADIRINC-1599,4541603,U_M00ZM,Отклонен,08.04.2024 12:42,,,,,Дефект промсреды,25.04.2024 11:25,2024-05-24 00:00:00.0,"АИ МТ. Вкладка портфель - Переводы - По реквизитам.
 При нажатии на кнопку ""Сохранить реквизиты"" появляется ошибка: ""При загрузке документ произошла ошибка. Пожалуйста, попробуйте еще раз"".
 При нажатии на кнопку ""Сохранить QR-код"" появляется ошибка: ""Ошибка загрузки документа""

",,1.0,
ADIRINC-1598,4541385,U_M1QX4,Закрыт,08.04.2024 12:22,,,,,Дефект промсреды,24.04.2024 09:33,2024-05-24 00:00:00.0,"Клиент обращается в чат

У клиента в терминале на ПК не появляться новости с 05.04.2024 последняя новость в 12:27

 

AU9HFP Комаров Олег Александрович 4341183 
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|komarov_oa1|4.0.4105.1618|9.105|10.0|1 - Windows|Gigabyte Technology Co., Ltd. H310M H 2.0|18C04D15C0FA|08.04.2024 9:39:24|109.252.215.2|08.04.2024 11:25:33|08.04.2024 11:25:34|08.04.2024 11:25:30|08.04.2024 11:25:34|

AA8LTM 30319 Осмачек Сергей Владимирович отсутствие новостей в 4.0
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|sosmachek|4.0.4069.1652|9.106|10.0|1 - Windows|HP HP ProDesk 400 G6 SFF|9C7BEFB66C68|08.04.2024 10:47:30|172.21.1.6|08.04.2024 10:48:41|08.04.2024 10:48:40|08.04.2024 10:48:40|08.04.2024 10:48:40|",,24.0,Pro terminal
ADIRINC-1597,4538252,U_M1AYE,Закрыт,07.04.2024 22:43,,,,,Дефект промсреды,21.05.2024 11:31,2024-04-17 00:00:00.0,"У клиентов нет возможности закрыть шорт по бумаге, которая перестала быть маржинальной из-за требования большого обеспечения",,,Core
ADIRINC-1596,4537889,U_M1AYE,Отклонен,07.04.2024 14:30,,,,,Дефект промсреды,19.04.2024 09:58,2024-07-26 00:00:00.0,"У клиентов на экране маржинального кредитовая отображается некорректная информация

Для клиента со скрина 


{
 ""displayStatus"": ""testCompleted"",
 ""marginParams"": [
 {
 ""nameBalanceGroup"": ""РЦБ"",
 ""liquidActivesCost"": 272659.56191,
 ""adjustedLiquidActivesCost"": 272231.48659663,
 ""adjustedMargin"": 115484.725133693,
 ""startMargin"": 115442.768543376,
 ""startMarginThreshold"": 40404.9689901816,
 ""minMargin"": 57721.384271688,
 ""requirements"": 0,
 ""immediateRequirements"": 0,
 ""fundingCost"": 663.075901369863,
 ""moneyAvailable"": 156083.68556156714,
 ""moneyAvailableLS"": 0,
 ""mkLongMin"": 821493.0819,
 ""mkShortMin"": 743255.64553,
 ""mkLongCurrent"": 0.19,
 ""isinLong"": ""RU0009033591"",
 ""mkShortCurrent"": 0.21,
 ""isinShort"": ""RU0009033591""
 }
 ],
 ""isUfsr"": false
}",,2.0,Montblanc
ADIRINC-1595,4537881,U_M177U,Закрыт,06.04.2024 22:18,,,,,Дефект промсреды,06.06.2024 14:38,2024-06-14 00:00:00.0,"В портфеле не отображается позиция, если количество бумаг не целое.

При этом инструмент заведен корректно, трансляция из hell в adfront корректна

Пример такой позы у клиента 705321 , бумага RU000A103ZD9",,,Montblanc
ADIRINC-1594,4532600,U_M1QX4,Отклонен,05.04.2024 10:14,,,,,Дефект промсреды,17.06.2024 08:14,2024-05-23 00:00:00.0,"AVVRCY 4493577 Синюк Виталий Петрович, пропала кнопка ""Новости и тренды""

Коллеги привет
чат
android
МТ-2,29,0
У клиента пропала кнопка ""новости и тренды, аналитика для инвесторов"", был на версии 2.28.1, после рекомендации по обновлению проблема сохранилась и на версии 2.29.0
Скрин как должно быть и как у клиента отправляю, на личном телефоне проверил, данная кнопка так же отсутствует.
Проверяли настройку главного экрана, все пункты включены, изменений в базе по версии 2.29.0 нет, на данный момент.",,5.0,Etna
ADIRINC-1592,4524613,U_M1CUE,Закрыт,03.04.2024 19:47,,,,,Дефект промсреды,08.08.2024 15:14,2024-08-28 00:00:00.0,"ОР: Клиент заходит в приложение и видит корректный НКД по облигации RU000A103SC6 в портфеле, во вкладке позиция и во вкладке купоны
ФР: Клиент заходит в приложение и видит НКД 0 в портфеле по RU000A103SC6 и во вкладке позиция, а во вкладке купоны НКД отображается нормально
За день до этого и обычно на следующий день НКД начинает нормально отображаться
 На бирже НКД отображается корректно",,53.0,Core
ADIRINC-1591,4523198,U_M1BFA,Отклонен,03.04.2024 15:57,,,,,Дефект промсреды,04.04.2024 15:18,2024-05-21 00:00:00.0,"Клиент Лихачев Владимир Александрович ABO63F 778964 
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|lihachev_va2|4.0.4105.1618|9.105|10.0|1 - Windows|IRBIS 17NBC2004|8812AC790590|03.04.2024 13:33:31|146.158.104.130|03.04.2024 14:09:40|03.04.2024 14:09:49|03.04.2024 14:09:18|03.04.2024 14:09:23|

У клиента в терминале 4.0 (версия 3982.1644) не работает график новая версия.
И В окне ""Рисование"" функция ""Измерить"" не показывает параметры.

 ",,1.0,Pro terminal
ADIRINC-1590,4521397,U_M173X,NEW,03.04.2024 13:23,,,,,Дефект промсреды,,2024-12-09 00:00:00.0,"Апи invest-exams-api - спамит 500 ошибками по некоторым инструментам, например RU000A0JNAB6 
[http://adlog1/kibana/goto/cbd10320-f1a3-11ee-8d9e-af90c1c1d254] - логи
Ошибка только на андройде. На фронте ошибки нет, инструмент свободно покупается и продается 
Возникает из-за того что с биржи по инструменту приходит параметр ComplexProduct=0, а в [ADFront].[Training].[ActiveCategories] такое значение отсутствует
[https://fs.moex.com/f/16829/markup-2022-08.pdf] - коды с описанием с биржи

0 - Предназначено для КИ согласно 39-ФЗ или
эмиссионным документам

select ComplexProduct,category,IdFiBalance, * from Adfront.ts.Objects where isin = 'RU000A0JNAB6'",,,Core
ADIRINC-1589,4521394,U_M13MK,NEW,03.04.2024 13:19,,,,,Дефект промсреды,,2024-05-21 00:00:00.0,"Наблюдаются ряд инструментов с 0 УЦ.
Что является некорректным поведением системы.
При этом, в отчете, УЦ проставляется корректно.
!image-2024-04-03-13-14-49-367.png!
!image-2024-04-03-13-15-06-439.png!
!image-2024-04-03-13-15-22-736.png!

В соответствии с выгрузкой из БД, таких 702 инструмента.
{code:java}
select Ob.ISIN,count(Ob.Isin) --rp.IdObject, Ob.IdObject, Ob.NameObject, 
FROM ADFront.cf.RegPrices as rp with(nolock)
inner join ADFront.bs.Objects as Ob with(nolock) on rp.IdObject = Ob.IdObject
where rp.fRegPrice = '0' and rp.fClearPos >= '1'
--and ISIN = 'IE00BD3QJN10'
Group by Ob.ISIN
Order by count(Ob.Isin) desc{code}
+_*Требуется исправить ошибку и отображать корректную УЦ*_+",,25.0,Montblanc
ADIRINC-1588,4512955,U_M1FE1,На исправление,02.04.2024 11:43,,,,,Дефект промсреды,,2024-05-20 00:00:00.0,"У клиента AOKH7I  830367 была списана комиссия по сделкам за 26.03.2024 в 19:34:30 мск - согласно брокерскому отчёту.
Но у клиента в приложении отображается время списания 26.03.2024 00:00
что является некорректным отображением данных.
судя по всему, сервис подтягивает данные из другого поля в БД

!image-2024-04-02-11-41-44-028.png!
!image-2024-04-02-11-42-04-306.png!

+_*Необходимо клиентам отображать корректные данные. Клиент должен видеть реальное время, а не системное.*_+",,1.0,Сатурн
ADIRINC-1587,4500235,U_M13MK,NEW,30.03.2024 17:14,,,,,Дефект промсреды,,2024-05-17 00:00:00.0,"*Ожидаемый результат:*

1. Клиент смотрит раздел Портфель–Аналитика портфеля-Отчет- Пополнения

2. Видит сумму пополнений за выбранный период

*Фактический результат:*
 # Клиент видит в разделе Портфель–Аналитика портфеля-Отчет- Пополнения сумму пополнений больше , чем есть на самом деле

 Допинфо:

Пример ГС  4520243

!image-2024-03-30-17-06-37-149.png!

 

При этом сумма непосредственно пополнений дс на брокерский счет с 1.01.2023 по 31.12.2023 составляла 390000 по информации в тройке

!image-2024-03-30-17-07-48-013.png!

Однако сервис портфельной аналитики , метод [GET /portfolio-analytics/report|http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=769692260] действительно возвращает общую сумму пополнений за данный период 400000р

Прикладываю OUT вызова во вложении

""moneyInputsTotal"": {
 ""value"": 400000,
 ""currency"": ""RUB""
 },
 ""moneyInputsRUB"": {
 ""value"": 400000,
 ""currency"": ""RUB""
 },

 ",,31.0,Марс
ADIRINC-1585,4499795,U_M1W4D,Закрыт,30.03.2024 08:26,,,,,Дефект промсреды,09.09.2024 16:08,2024-05-17 00:00:00.0,"Искажается график, свеча и позиции при сворачивании приложения

Открываем месячный график - одна цена, сворачиваем приложение и открываем вновь - другая. Наглядное расхождение графика, свечей и позиции на скриншоте ниже.
На примере Газпром.
!image-2024-03-30-08-25-21-121.png!
!image-2024-03-30-08-25-41-107.png!

+_*Необходимо устранить баг и корректно отображать данные клиентам.*_+",,9.0,Appalachians
ADIRINC-1584,4499793,U_M1W4D,Закрыт,30.03.2024 07:52,,,,,Дефект промсреды,06.06.2024 12:11,2024-06-06 00:00:00.0,"У клиентов некорректно отображается доходность в портфеле.
 Отображается за 1 акцию, а не 6 260 штук (на примере Газпрома)
 Клиент видит доходность позиции как -2,23 руб, а должен видеть - 13 959,80 руб (-2,23 руб* кол-во акций 6 260 шт = - 13 959 руб)

Аналогично со Сбербанком - доход рассчитан на 1 акцию, а у клиента в Портфеле 2 050 акций

!image-2024-03-30-07-54-54-306.png!

+_*Необходимо отображать клиентам корректную доходность.*_+",,1.0,Montblanc
ADIRINC-1583,4498842,RSRamazanov@investlab.tech,Отклонен,29.03.2024 16:30,,,,,Дефект промсреды,04.06.2024 10:24,2024-05-16 00:00:00.0,"Платаформа МВТ
 При попытке удалить инструмент из Мой список, он не удаляется. Добавить инструменты можно, но потом их нельзя удалить. !image-2024-03-29-16-12-04-821.png!!image-2024-03-29-16-12-14-807.png!!image-2024-03-29-16-12-18-505.png!",,3.0,
ADIRINC-1582,4490266,U_M173X,Закрыт,28.03.2024 17:53,,,,,Дефект промсреды,18.04.2024 15:04,2024-05-15 00:00:00.0,"При повышении кол-ва входов в ЛК процедура  [cabinet].на[GetTreatyData] начинает выедать ресурсы сервера hypernew3 из-за этого начинаются деградации выводов с инвесткопилки, открытии БС и выставлении заявок в мобайле, а ттак же навешиваются блокировки на БД.

Проблемная часть процедуры

SELECT @last_date = IIF(@last_date >= MAX(acl.db_time), @last_date, MAX(acl.db_time))
FROM dbo.account_change_log AS acl
WHERE (acl.treaty = @treaty AND acl.client_id = @client_id AND acl.tbl = 'ACCOUNTS' AND acl.text LIKE '%tp_code%')
OR (acl.ank_no = @ank_no AND acl.tbl = 'ANKET_PERSON')",,,Web
ADIRINC-1581,4489578,U_M1DKF,Повторный,28.03.2024 17:07,,,,,Дефект промсреды,,2024-07-22 00:00:00.0,"Клиент авторизовывается в ЛК. После ввода логина и пароля ему присылается смс.
При разборе удалось воспроизвести проблему. Возникает ошибка ""Код введен неверно"" если код из смс будет введена автозаполнением из смс, а не вручную. Введя этот же код вручную вход осуществляется без проблем, но если использовать автозаполнение, то появится данная ошибка.
Важное уточнение, автозаполнение из пуша нет, именно надо из смс.
При попытке воспроизвести иногда возникает эта ошибка и не впускает, иногда возникает ошибка и впускает после(пример на видео). На видео долго приходит смс, тк идет сначала пуш(для воспроизведения отключил пуш), потом досылка смс, потому надо подождать))",,5.0,НТФ (ЛК)
ADIRINC-1580,4488252,U_M1EP6,Закрыт,28.03.2024 15:10,,,,,Дефект промсреды,30.05.2024 09:52,2024-05-15 00:00:00.0,"Наблюдаются несоответствия отображения стоимости инструмента и показаниям графика по инструментам.
 В качестве примера ISIN IE00BD3QHZ91
 т.е. показатель цены 67,49 а показатель на графике в районе 60.
 !image-2024-03-28-15-09-35-626.png!

+_*Стоимость инструмента и позиция на графике должны соответствовать друг другу, не в зависимости от того, торгуемый инструмент или нет, и является ли бумагой иностранного эмитента.*_+",,3.0,Appalachians
ADIRINC-1579,4487569,U_M1PAH,Закрыт,28.03.2024 14:07,,,,,Дефект промсреды,28.03.2024 14:12,2024-05-15 00:00:00.0,"После релиза Datacache был выявлен дефект в веб-терминале альфа-инвестий

Логика на фронте для справочника orderParams была из за работы с флагами inserted и updated

Предполагалось что orderParam с флагом inserted это параметры которые приходят после установления нового соединения
updated флаг который показывает что данные изменились во время работы в терминала

проблема возникла после того как записи orderParams вместо inserted стали приходить как updated при инициализации, на что не было расчитана логика приложения
Тред https://rc.alfa-bank.net/channel/adir-avarii?msg=387Za2SMufjHH5BRo",,,Web
ADIRINC-1578,4487633,U_M1EP6,Закрыт,28.03.2024 13:57,,,,,Дефект промсреды,27.05.2024 14:00,2024-06-27 00:00:00.0,"У клиентов некорректно отображается объем торгов по валюте с 19.03.2024
На скриншотах пример CNY, но такая же картина и по всем другим валютам кроме тенге.
В день торгов объем отображается корректно, но на следующий день все снова отображается некорректно",,4.0,Appalachians
ADIRINC-1577,4487283,U_M19LL,Закрыт,28.03.2024 13:37,,,,,Дефект промсреды,11.09.2024 10:50,2024-05-15 00:00:00.0,"У клиента AL92SP 2473203 на счёте срочного рынка не указано, что свободные деньги находятся именно на срочном рынке. (снимок экрана 2)
 !image-2024-03-28-13-35-21-233.png!

Ошибка возникает, только тогда, когда все свободные деньги находятся на срочке. Если часть денег находится и на РЦБ, то такой проблемы нет (снимок экрана 4)

!image-2024-03-28-13-35-44-776.png!

На android 2.28.1 такой проблемы нет. Если все деньги клиента находятся на срочном рынке, то информация отображается корректно (снимок экрана 3)
 !image-2024-03-28-13-36-08-909.png!

+_*необходимо клиентам предоставить корректное отображение стоимости портфеля на срочном рынке в IOS*_+",,1.0,Montblanc
ADIRINC-1576,4486623,U_M1AYE,Закрыт,28.03.2024 13:07,,,,,Дефект промсреды,16.04.2024 10:52,2024-05-15 00:00:00.0,"У клиента при попытке зайти в ДТ пишет ошибку соединения из-за другого соединения

 https://rc.alfa-bank.net/channel/adir-terminal-support?msg=dBhgyRqFjWJNYAAJX",,,Pro terminal
ADIRINC-1575,4486569,U_M0SE7,Закрыт,28.03.2024 12:29,,,,,Дефект промсреды,08.05.2024 09:51,2024-04-08 00:00:00.0,"После того, как один из двух сервисов создания ЭЦП стал недоступен, FE2 не сделали активным подключение к работающему SNS. Из-за чего при падении одного сервиса стало недоступно создание ЭП 

В правильном сценарии FE2 должны должны переключиться на рабочий SNS без недоступности

https://rc.alfa-bank.net/channel/adir_duty?msg=kvLvoeMY5nAaQSSEb",,,Ядро
ADIRINC-1574,4484876,U_M1QX4,Отклонен,28.03.2024 09:40,,,,,Дефект промсреды,03.09.2024 10:04,2024-05-15 00:00:00.0,"Клиент Пономарь Виктор Николаевич AQJ44O 736015 терминал 4.0
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|vnponomar|4.0.4069.1652|9.106|10.0|1 - Windows|System manufacturer System Product Name|107B444A54A0|27.03.2024 13:10:18|178.47.140.108|27.03.2024 15:19:16|27.03.2024 15:19:16|27.03.2024 15:19:13|27.03.2024 15:19:14|

проблемы с работой в торговом терминале 4.0
Не откликаются кнопки.



 ",,1.0,Pro terminal
ADIRINC-1570,4458135,U_M1W4D,Закрыт,22.03.2024 13:18,,,,,Дефект промсреды,06.05.2024 13:20,2024-05-07 00:00:00.0,"По клиенту 6226363 AR5S9K наблюдается ошибка при смене риск профиля в Веб-терминале
!image-2024-03-22-12-58-56-866.png!

В логах имеется расхождение в запросах между WT и LK. См. детальнее ниже:
[http://adirelkprod.alfadirect.ru/s/osikorb/goto/c8567b6be481a50cdb3ea4750902244b]
!image-2024-03-22-13-00-22-926.png!


Подозрение на formVersion
 * 
 в ЛК тело этого запроса выглядит вот так
 {{
}}
{code:java}
{""pin"":""BB8DR4"",""segment"":null,""businessUserId"":null,""formVersion"":""riskProfile-2.2"",""answers"":{""goals"":[""SAVE_AND_INCREASE""],""horizon"":[""FROM_1_TO_3""],""education"":[""HIGHER""],""income"":[""FROM_500K_TO_700K""],""expenses"":[""FROM_41%_TO_50%""],""loansShareExpenses"":[""BELOW_20%""],""assets"":[""FROM_1M_TO_6M""],""investmentExperienceBroker"":[""LIFE_INSURANCE""],""riskRatio"":[""RISK_RATIO_1""]},""insertDate"":""2024-01-25T11:09:34.646+03:00"",""riskProfile"":4,""expectedIncome"":""22-24% в рублях / 10.5-11.5% в долларах США / 9.5-10.5% в евро"",""riskCapacity"":3.5,""riskTolerance"":3.5,""acceptableLossRisk"":55,""investmentHorizon"":1,""iteration"":0,""outdated"":false,""accepted"":null,""modified"":true,""signType"":null,""skdDocumentInfo"":null,""rejectPfpReason"":null,""updateDate"":""2024-01-25T11:09:46.686+03:00"",""profileTitle"":""Умеренно-агрессивный"",""profileDescription"":""Вы готовы принять высокий уровень риска, чтобы потенциально заработать в несколько раз больше, чем по вкладам. При этом сумма ваших вложений может существенно меняться из-за колебаний на фондовом рынке, в том числе в отрицательную сторону.""} {code}
 
В то время как ВТ всегда отправляет это поле пустым
{{
}}
{code:java}
{""pin"":""AR5S9K"",""segment"":null,""businessUserId"":null,""formVersion"":null,""answers"":{""goals"":[""INVEST""],""horizon"":[""FROM_1_TO_3""],""education"":[""SECONDARY""],""income"":[""FROM_500K_TO_700K""],""expenses"":[""FROM_41%_TO_50%""],""loansShareExpenses"":[""NONE""],""assets"":[""FROM_1M_TO_6M""],""investmentExperienceBroker"":[""LIFE_INSURANCE"",""PIF"",""BONDS""],""riskRatio"":[""RISK_RATIO_2""]},""insertDate"":""2024-03-11T05:25:19.863+03:00"",""riskProfile"":null,""expectedIncome"":null,""riskCapacity"":null,""riskTolerance"":null,""acceptableLossRisk"":null,""investmentHorizon"":0,""iteration"":0,""outdated"":false,""accepted"":null,""modified"":true,""signType"":null,""skdDocumentInfo"":null,""rejectPfpReason"":null,""updateDate"":null,""profileTitle"":"""",""profileDescription"":""""} {code}


+_*Необходимо устранить ошибку не только по клиенту, но и проработать кейс для устранения самой причины и гарантировать исключения подобных ошибок.*_+",,,Meribel
ADIRINC-1569,4456655,U_M17SM,На исправление,22.03.2024 11:03,,,,,Дефект промсреды,,2024-05-07 00:00:00.0,"ДТ посылает некорректную дату истечения заявки на ЛС, из-за чего они так и создаются. 

После эта дата транслируется клиенту

Prepared storedOrder SrvOrd={Ord={[IdAcc=3092][c][OrdStRev=0][Rest=9][Px=94.82][XSesId=0][XOrdN=0][ConfQnt=9][CltNStgy=0][IdOrdT=LMT][IdQntT=QTY][IdPxT=QUO][IdLfTm=D30][IdExeT=ASL][IdPxCtrlT=N][IdSttlCod=65][IdObj=479532][IdMktBrd=150][IdOrdSt=New][IdRzd=165572][LmtPx=94.82][StpPx=0][LmtLvlAlt=0][SigTm=2024-03-19T15:40:30.950624][BuySell=Sell][Ctrag=][CtragRef=][Qnt=9][OpnQnt=9][ActvTm=][WdTm=2024-04-13T23:59:59][IdFIActv=0][ActvPxDir=Und][Val=0][Cmt=][IdCmdT=Ent][IdDocT=TRD][Lgn=anechaev][CltOrdN=1760595053][CltNED=G6H-000C2953B5BD-1760595053][NED=54931555284][AcTm=2024-03-19T15:40:30.955588][NEDB=0][F=Unk][IdFI=594798]}[CameTsTm=0][CameFeTm=638464596309554327][IdCert=3971128][FiCod=RU000A0ZYUW3][SttlD=1][IdGt=2][IdFinT=N][IsinId=0][FrFEN=206][IdLgn=22264][SesID=22032565572][IdAlwOrdPrm=1671][IdSigSrc=StrnSig][SigT=UEP][OrdChnl=AD4DT]}

НАпример 54931555284 является 30 дневной, но WdTm=2024-04-13 при SigTm=2024-03-19",,1.0,Pro terminal
ADIRINC-1568,4455652,U_M173X,Закрыт,21.03.2024 23:25,,,,,Дефект промсреды,29.05.2024 10:02,2024-05-29 00:00:00.0,При включении отправки метрик в паспорте перестает работать авторизация по номеру телефона. Проблема только на Андройд,,,K2
ADIRINC-1567,4454389,RUM1BPH,Закрыт,21.03.2024 17:16,,,,,Дефект промсреды,20.05.2024 11:16,2024-05-06 00:00:00.0,"Клиент ГС 4242411 по всем инструментам (кроме денежных).
 Клиент снимает брокерский отчёт за один и тот же интервал (20.03.22-01.01.23).
 Отчёты, выпущенные в разные дни 17.02.23 и 31.01.24, показывают разную оценку портфеля.
 !image-2024-03-21-16-57-01-042.png!
 !image-2024-03-21-16-57-44-517.png!
 Как видно, на конец периода (01.01.2023) разнятся цены, оценка позиций и суммарно всего портфеля.

Расцениваем это как дефект.",,1.0,Pro terminal
ADIRINC-1566,4452274,U_M1QLD,Отклонен,21.03.2024 13:32,,,,,Дефект промсреды,03.06.2024 10:42,2024-06-20 00:00:00.0,"В связи с тем, что от бизнеса пожелание следующее - показываем на графике только данные внутри периода, в котором даем торговать, мы не отображаем на графике свечи аукциона закрытия торгов - у нас некорректно отображается цена закрытия инструмента, если он не торгуется в этот день после аукциона закрытия.
 Как я понимаю, логика заложена так, что последняя сделка на свече отображает цену закрытия. Но когда за аукцион закрытия цена по инструменту меняется, то на бирже сохраняется иная цена закрытия.
 Пример по активу Tal Education US8740801043 на скринах показан график где инстурмент закончил торговаться по цене 3.17 , но при это в портфеле и в позиции последняя цена показывается 3.70
 Пример ЮГК RU000A0JPP37:
 Цена закрытия на мосбирже за 20.03.2024 - 0.7589, когда у нас отображается по свечам на графике цена закрытия 0.7588

Вся фактура в приложенных ссылках на рокет и прошлый дефект",,,
ADIRINC-1565,4451667,U_M1QX4,Отклонен,21.03.2024 12:05,,,,,Дефект промсреды,03.09.2024 10:04,2024-05-06 00:00:00.0,"В чат обратился клиент: Муллаянов Азамат Ришатович AEPEYP 245802 
У клиента терминал долго подгружает данные.

Видео https://skr.sh/vOMFhtEwSa2 
Настройки терминала https://skr.sh/sOMHa5GJCbW 
Статистика https://skr.sh/sOM96hm6CbU 

Появляется ошибка - Бэк офис сервер: Очередь исходящих данных переполнилась.
Не подгружаются разделы ""Позиции"" ""Баланс""

 ",,2.0,Pro terminal
ADIRINC-1564,4451137,U_M1QX4,Закрыт,21.03.2024 11:18,,,,,Дефект промсреды,03.09.2024 10:05,2024-05-06 00:00:00.0,"Клиент Громов Борис Владимирович AVVHQ8 4439010

В инструментах есть линейка ""Measure"". Раньше можно было с помощью нее замерить в процентах изменение цены от точки до точки на графике. Сейчас этот инструмент работает не корректно - не показывает никакой информации. 

 
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|gromov_b|4.0.4069.1652|9.105|6.1|1 - Windows|MSI MS-7788|448A5B205E85|20.03.2024 9:17:02|128.75.248.159|20.03.2024 17:18:50|20.03.2024 17:18:48|20.03.2024 17:18:52|20.03.2024 17:18:49|",,2.0,Pro terminal
ADIRINC-1561,4446758,U_M262S,На исправление,20.03.2024 14:29,Отображение_инструмента,Стакан,,,Дефект промсреды,,2024-09-23 00:00:00.0,"Стакан инструментов
 на примере инструмента RU0009257075 по клиенту APTZ8J 250655
 В веб терминале
!image-2024-03-20-14-31-41-374.png!

в Desctop версии АИ 4.0 для ПК
!image-2024-03-20-14-31-57-926.png!

+_*Необходимо отображать Стакан в АИ 4.0 корректно.*_+",,10.0,Montblanc
ADIRINC-1560,4446757,RSRamazanov@investlab.tech,Отклонен,20.03.2024 14:29,,,,,Дефект промсреды,20.03.2024 16:26,2024-05-03 00:00:00.0,"Стакан инструментов
 на примере инструмента RU0009257075 по клиенту APTZ8J 250655
 В веб терминале
 !image-2024-03-20-10-44-46-899.png!

в Desctop версии АИ 4.0 для ПК
 !image-2024-03-20-10-46-02-432.png!

+_*Необходимо отображать Стакан в АИ 4.0 корректно.*_+",,,
ADIRINC-1559,4446756,RSRamazanov@investlab.tech,Отклонен,20.03.2024 14:29,,,,,Дефект промсреды,20.03.2024 16:26,2024-05-03 00:00:00.0,"Стакан инструментов
 на примере инструмента RU0009257075 по клиенту APTZ8J 250655
 В веб терминале
 !image-2024-03-20-10-44-46-899.png!

в Desctop версии АИ 4.0 для ПК
 !image-2024-03-20-10-46-02-432.png!

+_*Необходимо отображать Стакан в АИ 4.0 корректно.*_+",,,
ADIRINC-1558,4445009,U_M1CUE,Закрыт,20.03.2024 12:00,,,,,Дефект промсреды,14.05.2024 16:34,2024-06-19 00:00:00.0,"Клиент AKKVD3 253623 заходит в приложение версии 2.28.1 - раздел еще - Безопасность :
 ОР: видит список из разных настроек в том числе ""использование биометрической аутентификации запрещено для данного приложения. Дайте разрешение в настройках телефона"" и ползунок
 ФР: видит список из разных настроек без ползунка описанного в ОР",,1.0,Core
ADIRINC-1556,4443366,RUM1BPH,Отклонен,19.03.2024 23:17,,,,,Дефект промсреды,18.09.2024 11:20,2024-08-14 00:00:00.0,"Клиент ГС 40577 по активу YNDX видит неправильную УЦ.



При разборе выясняется, что у экстра-трансфера в отсутствие налоговой детализации при заполнении полей bps_* может неправильно определяться валюта цены.

 

Запрос:
select top 100 curr=a.p_code,curr.ts_p_code,balance_price,bps_rub,bps_eur,trf.*
from a_hell_opers.dbo.a_all_transfers trf
 join hell.dbo.papers curr on curr.no = trf.money_paper_no
 join hell.dbo.actives a on a.act_id = curr.act_id
where trn_no in (85764504)
and a_date in ('2024-03-06')

!image-2024-03-19-23-16-24-134.png!",,2.0,
ADIRINC-1555,4441228,U_M1W4D,Отклонен,19.03.2024 16:15,,,,,Дефект промсреды,15.05.2024 16:24,2024-05-02 00:00:00.0,"Коллеги, к нам обратился клиент ГС 262907 по поводу неправильной УЦ по активу YNDX (ISIN NL0009805522).
При разборе ситуации обнаружено, что в налоговых детализациях неверно указана валюта – цены указаны в рублях, а валюта указана EUR.
!image-2024-03-19-16-08-17-808.png!
Прошу исправить этот кейз и пояснить, каким образом ошибочные детализации проходят проверку.",,3.0,
ADIRINC-1553,4439171,U_M1W4D,Закрыт,19.03.2024 12:16,,,,,Дефект промсреды,20.06.2024 12:46,2024-05-02 00:00:00.0,"По клиенту наблюдается обнуление суммы портфеля.
AVZNFS 6910069
При входе в приложение баланс портфеля отображается корректно.
!image-2024-03-19-12-12-40-610.png!

Затем клиент проваливается в сам Портфель и баланс обнуляется
!image-2024-03-19-12-13-16-469.png!
!image-2024-03-19-12-13-32-160.png!
!image-2024-03-19-12-14-06-743.png!

по логам мы видим, что баланс клиенту приходит корректно:
[http://adlog1/kibana/goto/1699ae40-e5d1-11ee-8d9e-af90c1c1d254]

!image-2024-03-19-12-14-53-518.png!
!image-2024-03-19-12-15-46-381.png!

+_*Необходимо устранить ошибку обнуления баланса Портфеля клиентов.*_+",,17.0,Core
ADIRINC-1552,4438806,U_M1AYE,Закрыт,19.03.2024 11:53,,,,,Дефект промсреды,19.04.2024 09:58,2024-05-24 00:00:00.0,"После релиза https://jira.moscow.alfaintra.net/browse/ITINVEST-4410 у части клиентов перестал загружаться портфель. По логам микросервиса проблем не было, по системным метрикам проблем не было. 

Была выявлена корреляция с фронтовыми ошибками: небольшой рост с момента раскатки и заметное снижение после отката поставки 

В файле приложены фронтовые метрики, по которым можно собрать данные по клиентам

Также приложены балансы по нескольким проблемным клиентам

'AVUCHW',
'AVVCBW',
'AJOHHT',
'AAY084',
'ACISX5'",,,Montblanc
ADIRINC-1550,4436198,U_M1P85,Закрыт,18.03.2024 22:11,,,,,Дефект промсреды,18.03.2024 22:15,2024-03-21 00:00:00.0,"При изменении расписания запуска  джоба ""TRUNCATE TABLE cabinet.EqAccountData"". (Джоб отвечает за начало получения данных из EQ и обновление таблицы cabinet.EqAccountData), также изменилось расписание запуска джоба закрытия торгов.

Необходимо изменить расписание джоба ""TRUNCATE TABLE cabinet.EqAccountData"", отдельно от запуска джоба закрытия дня.",,,Montblanc
ADIRINC-1549,4434864,RSRamazanov@investlab.tech,Отклонен,18.03.2024 16:25,,,,,Дефект промсреды,04.04.2024 15:18,2024-04-27 00:00:00.0,"Коллеги, клиент ГС 1921391 обращается по поводу некорректной УЦ по CNY.
 В результате анализа выявлено неправильное значение УЦ, 16.03.2024 запущен новый скрипт ""починки"". 
 После этого новая цена была записана в таблицу cash.bp.Prices со значением getdate() в поле DtUpdate.
 Сегодня клиент снова обращается с той же проблемой.
 И сейчас в таблице cash.bp.Prices лежит старая неправильная УЦ и DtUpdate = 2024-03-17 10:00:25.9188247.
 Т.е. пересчёт имеет кратковременный эффект и перезатирается старыми данными.
 !image-2024-03-18-16-27-51-134.png!

Новое значение
!image-2024-03-18-16-41-36-360.png!
Просьба объяснить каким образом старые УЦ возвращаются, и, либо устранить эту трансляцию, либо при пересчёте надо модифицировать УЦ ещё и в этом месте.
 Не первый раз это замечаем. Но сегодня это вылезло явно.",,,
ADIRINC-1548,4430204,U_M177U,Закрыт,18.03.2024 10:59,,,,,Дефект промсреды,03.06.2024 07:58,2024-05-23 00:00:00.0,"Наблюдаются дублирование истории по заявкам в разделе ""Операции"".
На примере клиента 5787176 BCQVWO
Клиент осуществил продажу 20 бумаг (ISIN RU0009084396 - ММК) 15.03.2024 на сумму 1107.1
!image-2024-03-18-10-51-14-790.png!

Но в МТ отображается дублирование истории
!image-2024-03-18-10-53-45-055.png!

При анализе логов и запроса ошибок не выявлено
[http://adlog1/kibana/goto/b3e9a770-e4fc-11ee-8d9e-af90c1c1d254]

!image-2024-03-18-10-54-38-406.png!

При курле так-же ошибок нет.
{code:java}
curl -X GET --location ""http://172.21.1.97:80/api/operations-history?accCode=5787176-000&assetIdType=ID_OBJECT&operationDateEnd=2024-03-16T23%3A59%3A59.999&codeOperationType=E&codeOperationType=D&codeOperationType=S&codeOperationType=VP&codeOperationType=X&maxElements=100&operationDateStart=2024-02-15T00%3A00"" -H ""application/json"" -H ""Content-Type: application/json;v=2"" | jq{code}

!image-2024-03-18-10-57-16-308.png!

+_*Необходимо устранить ошибку некорректного отображения истории.*_+",,4.0,Montblanc
ADIRINC-1547,4427118,U_M13MK,Отклонен,16.03.2024 14:43,,,,,Дефект промсреды,25.06.2024 12:58,2024-04-27 00:00:00.0,"Обратился клиент ГС 1198558 по поводу неправильной УЦ по бумаге WLMR (US9311421039).
 После реорганизации WLMR в WLMR дата фиксации реестра 01/03/2024 УЦ не пересчитаны в соответствии с новым количеством.
 Бумаг у клиента стало вместо 2 шт. - 6 шт.
 УЦ осталась прежняя. Пересчёт УЦ не помог.
 Записи о сплите в таблице hell.dbo.splits нет. И непонятно, должна ли быть такая запись.",,,
ADIRINC-1546,4425737,U_M0WVN,Закрыт,15.03.2024 16:35,,,,,Дефект промсреды,18.04.2024 17:39,2024-04-26 00:00:00.0,"*Шаги воспроизведения:*
 # На мониторингах увидели увеличение количества ошибочных операций выставления заявок на биржу в Альфа-Мобайл.
 # На шине WAS заметили ошибочные вызовы /adir/orders/v13/rest#POST

пример во вложении 

!image-2024-03-15-16-22-25-652.png!

[^orders_v13.txt]

 3. В логах сервиса adir-trade-orders те же ошибки:

[http://adirelkprod.alfadirect.ru/goto/91566154ceac9a2f4f8bd0a69a09e61b]

 

Текст тут:

{""Type"":""TradingOrders.Clients.LsRestApi.Exceptions.LsRestApiResponseException"", ""HttpStatusCode"":""InternalServerError"", ""ErrorDetails"":\{""ErrorMessage"":""Could not generate text document [Error=Заявка #0 отклонена. Таймаут истек.]"", ""ErrorCode"":""40050"", ""RequestId"":""2e325482-89b1-4a72-9f74-52dbc4af54df"", ""ApiVersion"":""1""}, ""TargetSite"":""Void MoveNext()"", ""Message"":""Could not generate text document [Error=Заявка #0 отклонена. Таймаут истек.]"", ""Data"":{}, ""Source"":""Clients.LsRestApi"", ""HResult"":-2146232832, ""StackTrace"":"" at TradingOrders.Clients.LsRestApi.OrdersClient.PostHttpMessageAsync[TRequest,TResponse](String path, TRequest body, SubmitOrderParams submitOrderParams, CancellationToken cancellationToken) in C:\\temp\\src\\Clients.LsRestApi\\OrdersClient.cs:line 175\r\n at TradingOrders.LsRestApiService.LsRestApiServiceClient.GenerateEnterTextAsync(SubmitOrderReq request, CancellationToken cancellation) in C:\\temp\\src\\LsRestApiService\\LsRestApiServiceClient.cs:line 58\r\n at TradingOrders.BL.RequestHandlers.AlfaMobileOrderRequestHandler.DoRequestAsync(SubmitOrderReq innerRequest, CancellationToken cancellation) in C:\\temp\\src\\TradingOrders.BL\\RequestHandlers\\AlfaMobileOrderRequestHandler.cs:line 43\r\n at TradingOrders.BL.RequestHandlers.RequestHandlerBase`4.SubmitInternalAsync(TRequest request, CancellationToken cancellation) in C:\\temp\\src\\TradingOrders.BL\\RequestHandlers\\LimitServiceRequestHandlerBase.cs:line 71\r\n at TradingOrders.BL.RequestHandlers.RequestHandlerBase`4.SubmitAsync(TRequest request, CancellationToken cancellation) in C:\\temp\\src\\TradingOrders.BL\\RequestHandlers\\LimitServiceRequestHandlerBase.cs:line 34\r\n at TradingOrders.Api.Controllers.V2.OrderController.PostAlfaMobile(TradingOrderRequest request) in C:\\temp\\src\\TradingOrders.Api\\Controllers\\V2\\OrderController.cs:line 59\r\n at lambda_method22(Closure , Object )\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.g__Awaited|26_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ExceptionContextSealed context)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n at Microsoft.AspNetCore.Routing.EndpointMiddleware.g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)\r\n at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware.g__Awaited|6_0(ExceptionHandlerMiddleware middleware, HttpContext context, Task task)""}

 

По приложенному логу выше в кибане, если смотреть вызовы по шагам видно , что где то примерно 7 секунд висит запрос при попытке записать документ в бд.

!image-2024-03-15-16-29-33-735.png!

После того как он отрабатывает и пытается далее обратиться к rapi для подачи поручения по какой то причине отклоняется. предположительно на это влияет потерянное время на запись 

Рестарт дотнет сервиса и мидл сервиса мобайла не помогли.

Через несколько часов операции стабилизироваться начали самостоятельно, без явного нашего вмешательства",,,Сатурн
ADIRINC-1545,4424382,U_M1W4D,Закрыт,15.03.2024 15:11,,,,,Дефект промсреды,03.07.2024 08:30,2024-05-22 00:00:00.0,"У клиентов расходятся стоимость портфеля и доходности использующие разные приложения.
 На примере клиента 99181 ACDAKK
 В приложении IPhone 1.8.0 
 стоимость портфеля 93 994 523
 доходность 8 426 291
 !image-2024-03-15-15-06-59-680.png!

В приложении IPad 2.1.0
 стоимость портфеля 94 089 766
 доходность 8 313 067
 !image-2024-03-15-15-07-52-511.png!

В итоге у клиента образуется некорректная (Огромная) разница стоимости портфеля, что недопустимо.
 94 089 766 - 93 994 523 = {color:#de350b}95 243{color} (Разница в баланса)
 8 313 067 - 8 426 291 = - {color:#de350b}113 224{color} (Разница в доходности)

 

+_*Необходимо устранить ошибку и отображать стоимость портфеля и доходности, во всех приложениях, одинаково. Разницы быть недолжно.*_+

 ",,42.0,Montblanc
ADIRINC-1544,4424148,U_M19LL,Закрыт,15.03.2024 14:57,,,,,Дефект промсреды,17.06.2024 08:18,2024-04-26 00:00:00.0,"Линейка не показывает % изменений и выглядит просто как прямая линия, версия терминала 4.0. 4069.1652

 [^Logs.rar]
!image-2024-03-15-14-56-04-365.png!",,,Pro terminal
ADIRINC-1543,4423183,U_M1W4D,Закрыт,15.03.2024 13:30,,,,,Дефект промсреды,25.04.2024 08:20,2024-03-26 00:00:00.0,"в Веб-версии АИ клиенты видят некорректное кол-во подарочных акций.
На примере клиента 6325998 BDZCYI
!image-2024-03-15-13-23-18-806.png!

При этом клиенту начислены только по одной акции. 
т.е. ошибка заключается в том, что клиенту отображается +1 акция.
!image-2024-03-15-13-24-56-926.png!

По логам мы получаем так-же одну акцию
[http://adlog1/kibana/goto/4f306140-e2b6-11ee-8d9e-af90c1c1d254]

!image-2024-03-15-13-26-53-390.png!

_+*Необходимо устранить ошибку отображения подарочных акций +1.*+_",,14.0,НТФ (ЛК)
ADIRINC-1542,4420508,U_M10NX,Отклонен,15.03.2024 09:52,ОТЭИСФЛ,,,,Дефект промсреды,29.03.2024 07:31,2024-04-15 00:00:00.0,"Периодически падает AUTH. Колосков Андрей должен был снять логи для поиска проблемы. 

Проблема началась после большого релиза.
https://rc.alfa-bank.net/channel/adir-avarii?msg=IasJOLswFn5WkJ31E",,,
ADIRINC-1541,4415755,U_M17SM,NEW,14.03.2024 11:18,,,,,Дефект промсреды,,2024-04-25 00:00:00.0,"У клиентов (пример C30181 17264) возникла ошибка даты отображения к которой рассчитывается доходность.
ISIN RU000A0ZYAP9
В ДТ отображается дата 20.12.2017, что является некорректным.
!image-2024-03-14-11-14-26-287.png!


В соответствии с данными с МБ, должна отображаться дата к дате погашения.
!image-2024-03-14-11-13-59-546.png!
При проведении анализа, было выяснено, что данное значение ДТ тянет из бд 
 * 
{{FinInfoExt.BuyBackDate}}`
 
  !image-2024-03-14-11-15-55-576.png!


+_*Необходимо устранить ошибку не только некорректных данных в БД по всем инструментам, но и исправить механизм заполнения этих данных в соответствии с требованиями МБ*_+",,2.0,Pro terminal
ADIRINC-1540,4402348,U_M1YQ3,Повторный,12.03.2024 11:11,,,,,Дефект промсреды,,2024-12-06 00:00:00.0,"Ошибка наблюдается по клиенту AD4DXK 774491
при входе в Портфель → три точки → Маржинальная торговля у него появляется окно о необходимости подтвердить статус квал.инвестора, а должен открываться
 раздел ""Маржинальное кредитование""
!image-2024-03-12-10-59-12-727.png!
!image-2024-03-12-10-59-31-497.png!

тест клиентом пройдены.
!image-2024-03-12-10-58-30-563.png!

В соответствии с описанием сервиса 
[https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=685886004]
в БД ошибок не выявлено.

Но при Анализе логов выявлено получение пустого массива. При проведении теста по успешным клиентам, результат запроса иной. Ниже описано подробнее:

У проблемного клиента возвращается пустой массив: service *_+invest-exams-api+_*
http://adlog1/kibana/goto/afa7e5a0-e047-11ee-a3e2-d9151e23dd0a
!image-2024-03-12-11-08-07-063.png!

У Успешных клиентов, возвращается результат пройденного теста:
[http://adlog1/kibana/goto/de68e420-e047-11ee-a3e2-d9151e23dd0a]

!image-2024-03-12-11-10-27-463.png!

+_*Требуется устранить ошибку по клиенту и исключить повторные кейсы.*_+",,22.0,Montblanc
ADIRINC-1539,4401769,U_M18HF,Закрыт,12.03.2024 10:26,Дефект_АИ,Купоны,Отображение,,Дефект промсреды,19.04.2024 11:59,2024-04-23 00:00:00.0,"Отсутствует информация о купонах в МТ по инструменту (вкладка ""Купоны""), хотя информаци яна сайте биржи уже есть: [https://www.moex.com/ru/issue.aspx?board=TQCB&code=RU000A107RZ0&utm_source=www.moex.com&utm_term=RU000A107RZ0#/bond_4]. 
 При этом в БД информации о купонах также нет. Просьба уточнить сроки, в которые данная информация будет по инструментам попадать в автоматическом режиме. Наличие информации в БД проверялись следующими запросами:

SELECT
 act.isin, act.p_name, act.act_id, shed.*
 FROM
 hell.actives.couponredemptionschedule shed
 INNER JOIN hell.dbo.actives act ON act.p_code = shed.p_code
 WHERE
 1=1
 AND act.ISIN = 'RU000A107RZ0'
 ORDER BY
 DtUpdate DESC

:CONNECT LTRhell_cache.alfadirect.ru

SELECT
 ado.isin, ado.name, redm.*
 FROM
 hell_cache.coupon.redemption redm
 INNER JOIN hell_cache.actives.match_objects amo ON redm.act_id = amo.act_id
 INNER JOIN hell_cache.adfront.objects ado ON ado.object_Id = amo.object_id
 WHERE
 1=1
 AND ado.isin = 'RU000A107RZ0'",,,Core
ADIRINC-1538,4400332,U_M20XK,На исправление,11.03.2024 18:29,,,,,Дефект промсреды,,2024-03-21 00:00:00.0,"В выходные дни идут выводы средств. Одновременно с формированием трансфера для вывода денег, формируется налоговый платеж. А урегулируется налоговый платеж когда приходит подтверждение от EQ что списание прошло. 
 Проблема в том, что при урегулировании платежа проводки формируются текущей датой независимо от того, что день праздничный.
 Нам нужно, чтобы дата урегулирования была завязана на производственный календарь. Так как в праздничные нерабочие дни никакие проводки формироваться не должны. 

Процедура [dbo].[cl_op_extra_tran_set_tax_payment] проверяет торговый ли день 8 марта. и выдает, что торговый. Для проверки используется функция [hell].[dbo].[f_get_is_trade] - эта функция работает не корректно

Работает она так, очевидно потому, что в параметр функции не передается площадка(gate). В этом случае, с пустым гейтом, не учитывается справочник торговых дней. Определяются только выходные.*!image-2024-03-11-18-28-47-523.png!* 
 !image-2024-03-11-18-28-24-368.png!

 ",,,Core
ADIRINC-1537,4399797,U_M0WVN,Закрыт,11.03.2024 17:54,,,,,Дефект промсреды,18.04.2024 17:41,2024-03-20 00:00:00.0,"Шаги воспроизведения:
 # В 2:20 произошёл рестарт Auth2
 # на 7 минуте сервис завис в состоянии Unavailable.
 # в 3:20 начал плавновый рестарт Auth1, и завис в стостоянии starting.
 # в 4:15 сервис рестартнули вручную Auth1
 # в 4:35 сервис стартанул, входы заработали и аварию закрыли
 # параллельно с поднятием Auth1 выяснилось что Auth2 положил сервер, на котором он крутится отъев всю память. Сервер перезагрузили, Auth2 поднялся на 2 минуты и снова упал. 
 # В 4:50 финальный раз отрестартили Auth2, после чего он поднялся и начал стабильно работать

 ",,,Core
ADIRINC-1536,4399108,U_M0R67,Закрыт,11.03.2024 16:57,АФБ,,,,Дефект промсреды,18.03.2024 13:38,2024-04-22 00:00:00.0,"У клиентов при выводе возникает ошибка.
 В логах видим увеличение количества ошибок:
 Клиент не активирован. Причина: Нет прав доступа
 select cast([Date] as date) as [Date1], * from adfront.unk.edocuments where ErrorTextServer like '%Причина: Нет прав доступа.' and Date > '2024-03-01'
 Разбивка по дням :
 !image-2024-03-11-16-59-43-591.png!

Решение: 
 Перезачитать в данные  в SubAccountAccesses

Ранее была задача: 
 ADIRSVC-1369 Периодический ресет таблиц в DC - Alfa-bank Issue Tracker (alfaintra.net)

Выяснили, что данный механизм отключен.
Проблема возникла из-за релиза 05,03 на торговых сервисах. Готовится фикс",,,Core
ADIRINC-1535,4398553,U_M1UN1,Отклонен,11.03.2024 15:27,ОТЭИСФЛ,,,,Дефект промсреды,17.05.2024 15:20,2024-06-07 00:00:00.0,"В результате выкладки изменения по сжатию данных на DataCache в рамках релиза торговых сервисов начали наблюдаться проблемы с производительностью SignService, что приводило к большим задержкам создания ЭЦП.

Подробности по аварии тут: [https://rc.alfa-bank.net/channel/adir-avarii?msg=zd5D8qgXkRPGfm859]
Обсуждение целевого решения тут:  [https://rc.alfa-bank.net/channel/Problemy-s-SignService] ",,,CoreMT
ADIRINC-1534,4393250,U_M1CE2,Закрыт,07.03.2024 22:26,,,,,Дефект промсреды,14.05.2024 16:04,2024-04-22 00:00:00.0,"Из-за синхронизации данных в рамках релиза БД между hell и post_trade, привел к добавлению данных в таблицу в бд hell mrgn.PaperCoeffs (добавление доп. рынков), что повлияло на задвоение операций при отработке процедуры свопа.
 То есть если в таблице hell по одному инструменту было две записи, своп по данному инструменту проводился дважды( если записи три -то три свопа)
 Починка: указание конкретного рынка(что в выборке процедуры сделало один инструмент -один своп)

Во время аварии внесли доработку:
Доработка процедуры repo.f_get_REPO_price в stage3 - repo.f_get_instrument_settle_params

 ",,,Ядро
ADIRINC-1533,4390619,U_M1P1L,NEW,07.03.2024 13:26,,,,,Дефект промсреды,,2024-03-19 00:00:00.0,"У клиента пин совпадает с логином другого клиента, Из за этого он видит чужой портфель.

Для примера: 

В чат обратилась клиентка ГС 4284145 Страукас Яна Сергеевна пин AVSAGA видит портфель клиента у которого логин avsaga  Сага Александр Владимирович

Клиент попробовал восстановить логин и пароль -вылетает ошибка, что приложение только для клиентов

Ссылка на обсуждение https://rc.alfa-bank.net/channel/adir_duty?msg=FqSgNjeK9CnXJtLuP

 

 ",,,Меркурий 7
ADIRINC-1532,4385511,U_M177U,Отложен,06.03.2024 19:26,,,,,Дефект промсреды,,2024-06-27 00:00:00.0,"У клиента C86999 падает с ошибкой раздел маржинального кредитования, когда он заходит туда из кассового счета, тк бэк отдает на мидл пустой список, из-за чего мидл падает в ошибку

Результат расследования: с фронта вызывается portfolio-analytics метод /margin-params, который получает информацию из  com-fin-instrument-info из ХП [mrgn].[liquid_instruments_by_treaty_get].

Тк у счета 171060 не проставлен IdPaperGroup в hell.accounts ХП отдает пустой список. Параметр не проставлен из-за немаржинальности счёта - корректно. Проблема на фронт-миддл слоях",,2.0,Montblanc
ADIRINC-1531,4376752,U_M1QX4,Отклонен,05.03.2024 16:44,,,,,Дефект промсреды,17.06.2024 08:20,2024-04-17 00:00:00.0,"Клиент: Романов Александр Викторович 4422746 AVU8LD
Не прогружаются графики, со слов клиента перезагрузка конфигурации и чистка кэша не помогли


||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|avromanov49|4.0.4069.1652|9.106|10.0|1 - Windows|Gigabyte Technology Co., Ltd. H310M S2 2.0|B42E9905952A|05.03.2024 11:55:48|85.140.114.19|05.03.2024 12:44:35|05.03.2024 12:44:34|05.03.2024 12:44:35|05.03.2024 12:44:32|",,8.0,Pro terminal
ADIRINC-1530,4376059,U_M1UN1,Закрыт,05.03.2024 15:38,ОТЭИСФЛ,,,,Дефект промсреды,25.04.2024 13:36,2024-05-13 00:00:00.0,"У клиента 1072668-000 в ВТ отображается списание по вар.марже, хотя по факту должно отображаться зачисление

При этом при вызове [http://adir-client-operation-history.k8s-master.alfadirect.ru/api/operations-history?CodeOperationType=VP&AccCode=1072668-000]

Возвращается значение direction: 1

!image-2024-03-05-15-44-46-649.png!

 

select top 10 * from a_hell_opers.dbo.a_payments
 where a_date > '2024-02-28'
 and acc_code = '1072668-000'

!image-2024-03-05-15-44-58-714.png!

!image-2024-03-05-15-45-06-770.png!

!image-2024-03-05-15-45-14-646.png!

ОР: При просмотре истории у клиента по вар.марже отображается зачисление средств

ФР:  При просмотре истории у клиента по вар.марже отображается *списание* средств",,2.0,Montblanc
ADIRINC-1529,4375346,U_M1CVV,NEW,05.03.2024 14:38,,,,,Дефект промсреды,,2024-04-17 00:00:00.0,"Некорректно рассчитывается стоимость заявок по облигациям.
 на примере облигации  Мясничий БО-П03 RU000A1006B5
 была выставлена лимитная заявка на продажу стоимостью 2000,25 (т.е. 57,15*35=2000,25) (*_+это некорректно+_*)
 !image-2024-03-05-14-31-27-895.png!

Данный инструмент является облигацией.
 Расчет должен учитывать номинальную стоимость (см. информацию на МБ [https://www.moex.com/ru/issue.aspx?code=RU000A1006B5])
 !image-2024-03-05-14-35-32-442.png!

т.е. расчет должен быть по формуле:
 (31*57,15)/100*35=620,0775 = 620,08

+_*Необходимо устранить ошибку в формуле расчета и проводить корректный расчет стоимости облигаций.*_+",,6.0,Плутон 1
ADIRINC-1526,4370264,U_M1QX4,Отклонен,04.03.2024 17:12,,,,,Дефект промсреды,03.09.2024 10:05,2024-04-16 00:00:00.0,"Игнатова Вера Владимировна 166255 APQ2RX
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|vvignatova|4.0.4069.1652|9.106|6.1|1 - Windows|SAMSUNG ELECTRONICS CO., LTD. 355V4C/356V4C/3445VC/3545VC|E8039ACC1252|04.03.2024 10:22:37|95.24.25.193|04.03.2024 10:34:24|04.03.2024 10:34:15|04.03.2024 10:34:27|04.03.2024 10:34:19|

Клиента интересует информация по графику RU0009029540
По цене 298,48 отображается объем 182 бумаги. А продано 50000 бумаг.
Где сделка с объемами в рынке?
Почему на секундном графике в объемах в 14:09 нет сделки клиента по сбербанку. На графике указана сделка с объемом 50000, но в объемах биржи она не учтена.

[http://webadmin.k8s-master.alfadirect.ru/reporting/orderlimitlog/3758970332]

 

 ",,3.0,Pro terminal
ADIRINC-1523,4362909,U_M1DLC,Принят к исправлению,04.03.2024 09:48,,,,,Дефект промсреды,,2024-06-03 00:00:00.0,"В процедуру [Objects].[SPBEX_Issue_New_Adapter_SaveData] приходят объект 
SELECT * FROM ADFront.dbo.Objects WHERE SymbolObject = 'AHI' 
 объект с {{SymbolObject = 'AHI' уже есть в ADfront.dbo.objects}}

ОР: Система работает штатно
 ФР: Падает очередь Adfront.[Objects].[_TargetQueue]



Подробности в тредах 
 [https://rc.alfa-bank.net/channel/adir_duty?msg=MMjNSWgvMhYWKtcR9]
 [https://rc.alfa-bank.net/channel/adir-avarii?msg=DS5QE0MNJTqPsuPVJ]
 [https://rc.alfa-bank.net/channel/adir_sqldev_run?msg=CEAc7iFQgRjdCbeMX]",,,Core
ADIRINC-1522,4361415,RUM1BPH,Отклонен,02.03.2024 15:52,,,,,Дефект промсреды,23.05.2024 11:50,2024-04-16 00:00:00.0,"Коллеги, дефект создан для привязки кейзов, где пересчёт не устанавливает правильную УЦ.

Клиент ГС 2501523 обратился по поводу неправильного расчёта УЦ по инструменту TRNFP (RU0009091573).
Рассчитана УЦ 1437,11914257, по нашему анализу должна быть 1362,500000",,10.0,
ADIRINC-1521,4359641,U_M1UN1,Закрыт,01.03.2024 15:50,ОТЭИСФЛ,,,,Дефект промсреды,29.03.2024 09:37,2024-04-15 00:00:00.0,"В AdFront.[ts/fi].FinInfoExt и AdFront.intrfc.LinkedFi не протранслировались изменения лотности следующих инструментов: RU0008992318, RU0006914488 и RU0006914488

Это привело к тому, что в AdFront.cf.Operations поле Quantity было больше, чем должно быть, что приводило к расхождениям позиций клиентов между Hell и AdFront

https://rc.alfa-bank.net/channel/adir_duty?msg=fYCEi6XaxJ4L5Qzs3",,25.0,CoreMT
ADIRINC-1519,4338694,U_M1W4D,Отклонен,27.02.2024 11:42,,,,,Дефект промсреды,13.05.2024 07:54,2024-04-10 00:00:00.0,"Клиент 3049610 
|2024-02-26 18:07:06|

 и 
|2024-02-26 18:10:04|

пытался вывести ДС с инвесткопилки (1000 рублей). OB42602240033344 и OB42602240035955 соответственно.
БПИФ продаются, но деньги не выводятся и остаются на инвесткопилке. 53923706684 - номер исполненной заявки на продажу БПИФ. ",,46.0,
ADIRINC-1518,4336246,U_M17SM,NEW,26.02.2024 17:46,,,,,Дефект промсреды,,2024-07-29 00:00:00.0,"Сейлз клиент Кравцов Николай Николаевич B66845 148640 
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|nnkravtsov|4.0.4052.1158|9.106|10.0|1 - Windows|ASUSTeK COMPUTER INC. VivoBook_ASUSLaptop X515EA_X515EA|141333A94C25|22.02.2024 4:39:25|178.23.226.216|22.02.2024 13:22:56|22.02.2024 13:22:54|22.02.2024 13:22:56|22.02.2024 13:22:56|

При входе терминал не подключается к серверу авторизации.

Ранее были даны рекомендации: ""Рекомендуйте клиенту зайти в настройки терминала → соединение, уберите галочку с поля «использовать протокол HTTP для подключения к серверам». Затем нажмите «применить».

Также у клиента необходимо уточнить каким способом авторизации он пользуется. Если подключается по основной авторизации, то рекомендовать воспользоваться резервной, и наоборот.""
После выполнения указанных выше действий ситуация не изменилась. Просьба помочь в решении.",,24.0,Pro terminal
ADIRINC-1517,4335584,U_M1FE1,Принят к исправлению,26.02.2024 16:42,saturn_team,,,,Дефект промсреды,,2024-07-02 00:00:00.0,"У клиента AMU4SI 745096 по вкладке ""О Выпуске"" некорректно отображается дата погашения по инструменту RU000A1070X5
!image-2024-02-26-16-33-37-182.png!
тогда как на МБ, данные другие:
!image-2024-02-26-16-34-25-895.png!

Сервис adir-fin-instruments возвращает мидл сервису instruments-api некорректное значение в поле ""maturityDate"" : ""2024-01-14"",
!image-2024-02-26-16-32-59-907.png!
логи:

[http://adlog1/kibana/goto/ffe35a10-d4ab-11ee-b963-8f2ab4e67d2d]

а например во вкладке ""Сводка"", данные отображаются корректно.
!image-2024-02-26-16-37-14-586.png!

в БД дата корректная.
{code:java}
select at_code,act_id,* from hell_cache.dbo.actives da with(nolock)
 where da.isin = 'RU000A1070X5'{code}
 


+_*Требуется устранить ошибку отображения некорректной даты погашения.*_+
+_*Необходимо отображать идентичные данные сервиса com-fin-instruments-info и  вкладке ""Сводка""*_+
+_*Требуется в последствии указать, из какой таблицы и поля подтягивались некорректные данные.*_+",,9.0,Сатурн
ADIRINC-1516,4329082,U_M17SM,Отклонен,22.02.2024 20:00,,,,,Дефект промсреды,15.05.2024 11:25,2024-05-27 00:00:00.0,У клиента зависает цена актива в стакане: цена в окне не меняется пока не обновишь окно,,,Pro terminal
ADIRINC-1514,4327020,U_M1AYY,Отклонен,22.02.2024 14:16,,,,,Дефект промсреды,21.03.2024 11:28,2024-04-08 00:00:00.0,"У клиентов после прошедшего сплита по транснефти некорректно рассчиталась УЦ

https://rc.alfa-bank.net/channel/adir_duty?msg=SgZz5njJcgf6h5c9o

 ",,,Ядро
ADIRINC-1513,4326295,U_M1W4D,Закрыт,22.02.2024 12:54,,,,,Дефект промсреды,14.05.2024 17:44,2024-04-08 00:00:00.0,"Клиент: Назаренко Ольга Юрьевна 5555350 BDHNX2

Платорма: АД
4.0.3982.1644
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|oiu_nazarenko|4.0.4052.1158|9.104|6.1|1 - Windows|Hewlett-Packard HP Pavilion g6 Notebook PC|E4D53D20D212|09.02.2024 10:26:04|188.124.117.2|09.02.2024 23:31:42|09.02.2024 23:31:39|09.02.2024 23:31:40|09.02.2024 23:31:41|

Описание: При открытии терминала не подключается сервер авторизации.
Переустановка не помогла.

В России.
Vpn не использует.
До этого работала с раздачей сети через вай фай с домашнего роутера. Пробовала подключать через кабель (проводной интернет) на прямую бук. Еще пробовала через точку доступа подключать через телефон (мобильный интернет).

Проблемы начались 09.02.",,,Pro terminal
ADIRINC-1512,4326037,U_M1W4D,Закрыт,22.02.2024 12:02,,,,,Дефект промсреды,17.05.2024 12:08,2024-04-08 00:00:00.0,"У клиента некорректно отображается сумма сделки.
!image-2024-02-22-12-00-51-365.png!

В отчете сумма сделки корректная.
!image-2024-02-22-12-01-22-891.png!

Необходимо клиенту отображать корректную сумму сделки.",,1.0,Kailash
ADIRINC-1511,4316020,U_M19LL,Закрыт,20.02.2024 17:50,,,,,Дефект промсреды,15.04.2024 18:57,2024-02-22 00:00:00.0,"Коллеги, часто,  во время выпонения процедур закрытия дня при выполнении джоба  ""23:00                 

Первая фаза закрытия дня""который запускается вручную примерно в 22-00 возникает блокировка с джобом ""=15s Запуск aex_eq_import2transfers"" который запускается каждые 15 секунд.

В результате зависает процесс выгрузки проводок в таблицу dbo.EQ_export.

В результате этого возможна ситуация не успеть провести обмен данными с EQ в отведенное для этого временное окно в рамках закрытия дня.

Что приведет к большим проблемам.

На данный момент, при возникновении такой ситуации дежурный выполняет kill блокирующего процесса, прерывает выполнение джобов  ""23:00                 

Первая фаза закрытия дня""и ""=15s Запуск aex_eq_import2transfers"" и запускает руками процедуру экспорта в EQ: EXEC support.eq.export_to_eq     @db_date = '2024-02-06'     , @type = 'A'     , @treaty_in = NULL     , @tran_no_in = NULL     , @place_code_in = NULL     , @session_no    = NULL     , @show_result = 'Y'     , @show_only = 'N'     , @force_export = 'N'; далее производится запуск вышеуказанных джобов.

Прошу решить вопрос с блокировками при работе джобов ""23:00                 

Первая фаза закрытия дня"" и ""=15s Запуск aex_eq_import2transfers""",,,
ADIRINC-1510,4315185,U_M1TP0,Отклонен,20.02.2024 16:10,,,,,Дефект промсреды,21.02.2024 13:46,2024-03-01 00:00:00.0,пусто,,,
ADIRINC-1509,4312546,U_M19YV,Отклонен,20.02.2024 11:34,,,,,Дефект промсреды,26.02.2024 11:02,2024-04-04 00:00:00.0,"Клиенту не открывается счет из-за по ошибке просроченного паспорта, но паспорт не просрочен

Проверка актуальности паспорта вернула ошибку: Паспорт РФ просрочен. Дата рождения клиента: 2002-11-25. Дата выдачи паспорта: 2022-11-25",,3.0,Ядро
ADIRINC-1508,4310127,RUM1BPH,Отклонен,20.02.2024 01:03,,,,,Дефект промсреды,18.09.2024 12:40,2024-09-27 00:00:00.0,"Коллеги, джобы закрытия дня имеют высший приоритет, ничто не должно мешать их выполнению, т.к. существует вероятность возникновения блокировок.

В настоящее время *джоб* пересчёта УЦ (""signal Расчет учетных цен"") *стартует* непосредственно сразу после *старта джоба* под названием ""00:02:00 Продолжение закрытия дня"", в результате чего эти два джоба выполняются одновременно.

!image-2024-02-20-01-10-09-663.png!

При этом джоб пересчёта УЦ существенно расходует ресурсы сервера, практически не оставляя ресурсов джобу Продолжения закрытия дня.
 !image-2024-02-20-01-16-00-353.png!

*Прошу изыскать возможности и перенести старт джоба по пересчёту УЦ последним шагом выполнения джоба Продолжения закрытия дня.*

!image-2024-02-20-01-04-34-978.png!",,,
ADIRINC-1507,4301537,U_M0WVN,Отклонен,16.02.2024 18:05,,,,,Дефект промсреды,19.04.2024 12:38,2024-05-21 00:00:00.0,"Ожидаемый результат:
 # Клиент выводит дс с инвесткопилки
 # Сразу же видит средства на целевом счете

Фактический результат:

При выводе в Альфа-Мобайл видит Успех (но тут ок, тк статус никто не запрашивает)

!image-2024-02-16-18-01-05-465.png!

В hell нет операции вывода у клиента

!image-2024-02-16-18-01-57-626.png!

*Допинфо:*

 

В логах сервиса adir-microinvest-sell-and-withdraw-service вижу данную попытку вывода и по ней нет ошибок [http://adirelkprod.alfadirect.ru/goto/2cce3d8aa9c7671f072fa12f895e7ed5]

!image-2024-02-16-18-00-36-268.png!

 

 ",,6.0,Уран 2
ADIRINC-1506,4301341,U_M1MST,Закрыт,16.02.2024 17:52,,,,,Дефект промсреды,22.02.2024 13:50,2024-04-02 00:00:00.0,"[^stdout]Клиент: Виниченко Илья Николаевич 4336862 AVTQIZ - раздел избранное
 Платформа: МТ
 Ос, версия: android 2.28.1
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|vinichenko_in|2.28.1|9.104|12|4 - Android|samsung SM-M315F|44efa945-1089-35bb-8787-fb7add1195a8|16.02.2024 16:12:55|212.108.138.4|16.02.2024 16:31:06|16.02.2024 16:31:08|16.02.2024 16:31:09|16.02.2024 16:31:10|

Описание:
 В разделе избранное задвоились актив:

""isin"": ""RU000A107JV6"",
 ""name"": ""АЛЬФА-БАНК Б1Р11"",

[http://adlog1/kibana/goto/77995b60-ccda-11ee-b963-8f2ab4e67d2d] ",,1.0,Kilimanjaro
ADIRINC-1505,4298776,U_M1SK9,Отклонен,16.02.2024 13:24,,,,,Дефект промсреды,19.02.2024 09:58,2024-04-22 00:00:00.0,"Пример:
 Клиент 2399830 AQI2E3 обращается с проблемой, что не отображается погашение в истории.
 У клиента было погашение облигаций RU000A101DU4 Вита Лайн БО-01 3 февраля на сумму 22 тыс. рублей
 В истории погашение не отображается



Пример 2:
 Клиент AEL662 4405176 в истории не отображается погашение облигаций RU000A101D13 от 30.01

Проблема возникает из-за отсутствия income_type в hell.extra_transfers

[https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=7a5qgZX4bHxh2DMt7] [
https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=TYuRXPNTLE5J3e5pB
]http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=858114865",,49.0,Core
ADIRINC-1504,4296971,U_M1W4D,Закрыт,16.02.2024 10:30,,,,,Дефект промсреды,14.05.2024 17:44,2024-04-02 00:00:00.0,"|Кизелев Сергей Викторович E22900 188280|
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|skizelev|4.0.4052.1158|9.106|10.0|1 - Windows|LENOVO 20KG0022US|A4F933A02058|16.02.2024 0:35:11|82.64.9.162|16.02.2024 1:52:14|16.02.2024 1:52:22|16.02.2024 1:52:15|16.02.2024 1:52:18|

Просьба сообщить какие порты необходимы для работы терминала А-Инвестиции 4.0 за файрволом.
Версия 470.4052.1158
Я открыл на роутере дополнительно порт
state NEW tcp dpt:448
По нему пакеты приходят, но терминал на компьютере всё равно не работает и присылает системное сообщение:
За установленное время не получен ответ от сервера
Ошибка соединения с сервером 217.12.99.21",,,Pro terminal
ADIRINC-1503,4296418,RUM1BPH,Закрыт,16.02.2024 09:46,,,,,Дефект промсреды,17.05.2024 11:49,2024-04-02 00:00:00.0,"Коллеги, к нам обратился клиент ГС 2035731. При выпуске отчёта в МТ получает документ без даты заключения ГС в последней строке текста.
 Получает так:
 !image-2024-02-16-09-53-48-169.png!

Должно быть так:
 !image-2024-02-16-09-51-17-989.png!

Данные, насколько можно понять, приходят из следующей процедуры:
 declare  @ret_code  INT, @ret_msg VARCHAR(255) ,@user varchar(255)
 select @user = sys_nameFROM dbo.acc_access AS aaWHERE aa.acc_code = '2035731-000' 
 exec [cabinet].[GetTreatyData]    @ret_code  = @ret_code    , @ret_msg = ret_msg    , @user    = @user , @treaty  = 2035731

Шаблон отчёта находится здесь: [https://git.moscow.alfaintra.net/projects/ADIR_SQLDB/repos/reports/browse/%D0%9A%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D1%81%D0%BA%D0%B8%D0%B5%20%D0%BE%D1%82%D1%87%D0%B5%D1%82%D1%8B%20%D0%90%D0%BB%D1%8C%D1%84%D0%B0%20%D0%91%D0%B0%D0%BD%D0%BA/%D0%90%D0%BD%D0%BA%D0%B5%D1%82%D0%B0%20%D0%B8%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE%20%D1%81%D1%87%D0%B5%D1%82%D0%B0.rdl#320]

Судя по шаблону, в настоящее время дата заключения ГС вставляется в отчёт как отдельное поле.

!image-2024-02-16-10-14-07-622.png!



 ",,2.0,Меркурий 4
ADIRINC-1500,4287416,U_M1UN1,Закрыт,14.02.2024 14:48,ОТЭИСФЛ,,,,Дефект промсреды,24.04.2024 12:15,2024-03-29 00:00:00.0,"Сервис: [com-new-password-provider|https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=976063432]

В очереди [hell].[kafka].[hell_clear_text_passwords_target_queue] наблюдаются записи с символом 謟 в поле casted_message_body на которых сервис ""зависает"", не обрабатывая дальнейшие записи, и не отсылая их в топик kafka для отправки СМС клиентам с паролем. 

Запрос для просмотра сообщений в очереди:
{code:java}
SELECT TOP (1000) *, casted_message_body =
CASE message_type_name WHEN 'X'
THEN CAST(message_body AS NVARCHAR(MAX))
ELSE message_body
END
FROM [hell].[kafka].[hell_clear_text_passwords_target_queue] WITH(NOLOCK)
order by queuing_order {code}
В логах сервиса наблюдаются массовые ошибки из приложенного файла

 ",,,АПИ\Интеграции
ADIRINC-1496,4279585,U_M1CUE,Отклонен,13.02.2024 11:42,,,,,Дефект промсреды,03.09.2024 10:07,2024-09-05 00:00:00.0,"Клиент BA81QN 3207440 не может авторизоваться в МТ. Возникает ошибка ""Сервис недоступен. Проверьте интернет соединение"" или ""Произошла ошибка. Попробуйте еще раз"" при попытке авторизоваться через ВайФай. При входе через мобильный интернет все работает корректно.
 В метриках ошибка A6I1L444 

Поступают аналогичные обращения, уточните, пожалуйста, если потребуется какая-то дополнительная информация
У клиентов воспроизводится данная проблема при использовании wifi, при переключении на мобильный интернет проблема не воспроизводится:
 1) IM16433526
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||
|aapligin|2.30.0|9.105|12|4 - Android|wheatek WP19|78d0e5bb-aefb-3707-9949-25c10f910b7c|04.07.2024 14:45:48|5.138.138.206|

2) IM16431074
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||
|sibileva_e|2.30.0|9.105|13|4 - Android|realme RMX3151|339c5531-a707-30f4-97e8-4e3d9af3e4fa|04.07.2024 11:12:45|95.71.189.53|

3) IM16369986
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||
|abastrigin|2.17.0|9.93|17.4.1|5 - iOS|iPhone|5C0C9790-27FB-4726-A539-88C94423921B|19.06.2024 6:10:12|176.59.137.187|

4) IM16401715
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||
|lebedev_kv5|2.29.2|9.105|14|4 - Android|OnePlus LE2115|5a8d755e-81a2-372c-a407-ad81155a5d34|26.06.2024 12:35:18|85.140.8.191|

5) IM16404221 (присутствуют логи по данному обращению, приложила)
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||
|fhafizov1|2.29.2|9.105|14|4 - Android|samsung SM-G996B|52d9c205-2ecc-37cc-b023-ead646a57fdf|27.06.2024 11:38:55|85.140.0.21|

6) IM16424118 
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||
|liahova_oa|2.30.0|9.105|12|4 - Android|Xiaomi M2010J19SY|73590eb1-0616-33ea-a88f-38497650efee|02.07.2024 17:16:00|85.249.162.161|

7) IM16427776 
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||
|apodachin|2.30.0|9.105|9|4 - Android|samsung SM-G950F|db0c7477-b421-39a6-8be0-273458e0a53a|03.07.2024 14:37:27|62.118.81.47|",,40.0,K2
ADIRINC-1494,4271383,U_M1MTV,Отклонен,11.02.2024 18:04,,,,,Дефект промсреды,06.03.2024 15:38,2024-06-03 00:00:00.0,"Клиент при попытке выставить заявку в ВТ проверяет лимит на покупку 1 шт, Клиенту пишут, что сделка будет совершена в маржу,  за собственные средства ему доступно 779,00

Необходимо исправить отображение",,,Everest
ADIRINC-1493,4269114,RSRamazanov@investlab.tech,Закрыт,09.02.2024 15:11,,,,,Дефект промсреды,22.02.2024 15:50,2024-02-27 00:00:00.0,"Пример по клиенту:
 AGQHZ4 5890233
 Возникает ошибка ""При формировании текста поручения произошла ошибка"" при переводе с рцб на фортс, срочный рынок был зарегистрирован 07.02.2024
 !image-2024-02-09-15-01-33-400.png!

В процессе анализа, выявили ошибку в логах:
 [http://adirelkprod.alfadirect.ru/goto/1836cbed055bab43fa6796cffd69a719]
 !image-2024-02-09-15-02-44-907.png!
{code:java}
[POST: /rest/moneytransfer/document, application/json; v=1] Severity: Minor. Message: Объект c idAccount:5890233 не найден. Провайдер:MoneyAccountDtoProvider, Ключ:MoneyAccountKey, Значение:MoneyAccountDto, Ext:{""IdAccount"":5890233,""IdRazdelGroup"":1,""IdObjectCurrency"":174368}{code}
message:
{code:java}
2024-02-09 09:40:10.4359|ERROR|Error|LK MarginWithdrawApiService -> GetInternalTransferOpText. response.StatusCode = NotFound. Url: ""http://alfainvest02:8103/rest/moneytransfer/document""; RequestId: ""e6bafc27-f4a3-48fc-9f58-f9d20e0942fc""; Elapsed: 3009; StatusCode = NotFound; RequestBody: ""{""clientOrderId"":667726706,""authType"":""Login"",""authToken"":""dapechnikov"",""initiatorFullName"":""Печников Денис Александрович"",""initiatorLogin"":""dapechnikov"",""account"":5890233,""subAccount"":0,""RGroup"":""MAIN"",""bankRequisites"":{""settleAccount"":""30601810200045890233"",""BIC"":null,""corrAccount"":null,""beneficiary"":""Печников Денис Александрович""},""destAccount"":5890233,""destSubAccount"":0,""destRGroup"":""FORTS"",""assetCode"":""RUB"",""amount"":366000.0,""comment"":""""}""; ResponseBody: ""{""requestId"":""e6bafc27-f4a3-48fc-9f58-f9d20e0942fc"",""errorDateTime"":""2024-02-09T09:40:10.7348069+03:00"",""serviceName"":""MTRA"",""errorCode"":""RAZDEL_NOT_FOUND"",""errorMessage"":""Объект c idAccount:5890233 не найден. Провайдер:MoneyAccountDtoProvider, Ключ:MoneyAccountKey, Значение:MoneyAccountDto, Ext:{\""IdAccount\"":5890233,\""IdRazdelGroup\"":1,\""IdObjectCurrency\"":174368}"",""severity"":""Minor""}"";{code}
request:
{code:java}
{""clientOrderId"":667726706,""authType"":""Login"",""authToken"":""dapechnikov"",""initiatorFullName"":""Печников Денис Александрович"",""initiatorLogin"":""dapechnikov"",""account"":5890233,""subAccount"":0,""RGroup"":""MAIN"",""bankRequisites"":{""settleAccount"":""30601810200045890233"",""BIC"":null,""corrAccount"":null,""beneficiary"":""Печников Денис Александрович""},""destAccount"":5890233,""destSubAccount"":0,""destRGroup"":""FORTS"",""assetCode"":""RUB"",""amount"":366000.0,""comment"":""""}{code}
Далее, было выявлено, что у клиента в таблице [ADFront].[dbo].[ClientMoneyAccounts] отсутствует брокерский рублевый счет:
 30601810200045890233
 При этом в АА и EQ счет имеется:
 !image-2024-02-09-15-05-44-276.png!
 !image-2024-02-09-15-06-07-434.png!

отсутствует счет в БД:
{code:java}
SELECT TOP (1000) *
 FROM [ADFront].[dbo].[ClientMoneyAccounts] with(nolock)
 Where idaccount = '5890233'{code}
  !image-2024-02-09-15-06-58-311.png!

в данной таблице должен присутствовать счет 30601810200045890233
 с параметрами 
{code:java}
{\""IdAccount\"":5890233,\""IdRazdelGroup\"":1,\""IdObjectCurrency\"":174368}{code}
Было применено решение, которое ошибку не устранило:
 решение из [https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=503366387] пункт 13.

+_*Требуется устранить Ошибку не только по клиента, а в целом причину возникновения рассинхрона данных, а так-же автоматизировать и обеспечить процесс синхронизации данных в БД.*_+
 +**+",,4.0,
ADIRINC-1492,4266233,RUM1BPH,Отклонен,08.02.2024 23:57,,,,,Дефект промсреды,23.08.2024 11:12,2024-02-20 00:00:00.0,"Коллеги, к нам поступают обращения (на сегодняшний день как минимум 2).
 ГС 4338625, 4257762 по цб GEMA (RU000A100GC7).

07.02.2024 произошло дробление бумаги. Сегодня 08.02.2024 учётные цены ещё не пересчитаны. Должны оказаться в 10 раз меньше.
 !image-2024-02-08-23-55-06-126.png!

УЦ *должны пересчитываться как максимум на следующий день*, потому что остатки уже отображаются по-новому, 
 а, следовательно, это приводит *к некорректному отображению портфеля и доходности*. ",,86.0,Марс
ADIRINC-1490,4263686,U_M1W4D,Отклонен,08.02.2024 15:48,,,,,Дефект промсреды,25.04.2024 12:54,2024-03-25 00:00:00.0,"На примере клиента
 ASYRQR 2641025 

Клиенту не поступают Уведомления по зачисление Дивидендов по акциям.
 Клиентом были получены Дивиденды за 9 месяцев 2023 г. по акциям ПАО ""Совкомфлот"" (1-01-10613-A). (Удержан налог 255 руб.)
 ISIN RU000A0JXNU8

!image-2024-02-08-15-39-03-055.png!

При этом, в приложении МТ версии 2.17.0 iOS Уведомления не отображаются.
 !image-2024-02-08-15-41-16-771.png!

В логах, по сервису _*notification-center-api*_ получаем пустой массив данных

 лог:
 [http://adlog1/kibana/goto/7afb9b80-c67f-11ee-b963-8f2ab4e67d2d

!image-2024-02-08-15-53-18-587.png!]

{color:#de350b}_*Запрос/Ответ:*_{color}
 !image-2024-02-08-15-43-00-979.png!
{code:java}
response body={
  ""filters"" : [ {
    ""id"" : 1,
    ""name"" : ""Счёт"",
    ""messageTypes"" : [ ""AI5"", ""AI6"", ""A17"" ]
  }, {
    ""id"" : 2,
    ""name"" : ""Сделки"",
    ""messageTypes"" : [ ""AI8"" ]
  }, {
    ""id"" : 3,
    ""name"" : ""Изменение цены"",
    ""messageTypes"" : [ ""AI7"" ]
  }, {
    ""id"" : 4,
    ""name"" : ""Информация"",
    ""messageTypes"" : [ ""AI4"", ""AI9"", ""A12"", ""A16"", ""A18"" ]
  } ]
}{code}
{color:#de350b}
 _*Запрос/Ответ:*_{color}
 !image-2024-02-08-15-44-16-988.png!
{code:java}
response body={
 ""hasNextMessages"" : true,
 ""messages"" : [ ]
}{code}
Был отправлен запрос на шину (в соответствии с документацией по сервису)
 получили успешный ответ:
 !image-2024-02-08-15-45-56-203.png!

+_*Необходимо отображать уведомление клиентам*_+
 +_*Необходимо устранить ошибку и исключить повторения ошибки.*_+",,5.0,
ADIRINC-1489,4256015,U_M1L8T,Закрыт,07.02.2024 14:00,,,,,Дефект промсреды,11.04.2024 16:33,2024-02-16 00:00:00.0,"*Шаги воспроизведения:*
 # Клиент хочет восстановить пароль в МТ или через менеджера в АА классик
 # До клиента смс не доходит

*Ожидаемый результат:*
 # Получить смс и ввести пароль из нее для входа

*Допинфо:*

Сервис client-notifications-sender вычитывает сообщение из топика adir-core.client-notifications.cmd.compose.0 и отправляет его на шлюз через шинный сервис 
|http://esbws.moscow.alfaintra.net/sms/distribute/send/push/sms/v13/rest|

[http://adirelkprod.alfadirect.ru/goto/9d27a6a52fe65cd9abd0e59b023905ff]

!image-2024-02-07-13-56-36-118.png!

Сообщение дошло до шлюза, но не было отправлено

!image-2024-02-07-13-56-17-869.png! Причина:

Клиент ни разу не заходивший в приложение не имеет связки с усройством на шлюзе. В частном случае либо их нет , либо они есть только для Альфа-Мобайл

!image-2024-02-07-13-58-46-477.png!

Соответственно при попытке отправить сообщение шлюз ищет строку с app_code = ADM, которая отсутствует. В ней обычно указан столбец address  с номером телефона.",,38.0,АПИ\Интеграции
ADIRINC-1488,4253101,RUM1BPH,Отклонен,07.02.2024 00:49,ОТЭИСФЛ,,,,Дефект промсреды,18.09.2024 11:08,2024-03-22 00:00:00.0,"Коллеги, ГС  7138884, цб SBER3. После заведения и проверки налоговой детализации по прошествии недели УЦ не пересчитана.
Дефектом считаем отсутствие механизма автоматического пересчёта по заведённым и проверенным налоговым детализациям.
     !image-2024-02-07-00-57-31-913.png!

 ",,50.0,Марс
ADIRINC-1487,4252096,U_M1MST,Отклонен,06.02.2024 17:22,,,,,Дефект промсреды,07.02.2024 15:31,2024-04-10 00:00:00.0,"выполняя по sync-user-settings-api по ручке /favorite-assets выполняя запрос curl 'https://adappn3:22895/favorite-assets' -i -X GET -H 'AUTH-USER-ID: AB2HUU'
 получаю ошибку о том что ответ слишком большой",,,Kilimanjaro
ADIRINC-1486,4251135,U_M1FE1,Закрыт,06.02.2024 15:16,,,,,Дефект промсреды,16.04.2024 12:33,2024-05-06 00:00:00.0,"Не загружается информация по инструменту во вкладке ""О Выпуске""
 на примере клиента AV2K3X 3804956
 ISIN RU000A107HG1
 !image-2024-02-06-14-56-09-525.png!

В результате анализа выявили, что по запросу сервиса _*api-instruments,*_ получаем пустые параметры.
 [http://adlog1/kibana/goto/f153b0a0-c4e6-11ee-b963-8f2ab4e67d2d]

!image-2024-02-06-14-58-22-708.png!

!image-2024-02-06-14-58-56-475.png!

Запрос:
|[FinInstrumentDetailedInfoClient#getBondDetailedInfo(String)|#getBondDetailedInfo(String)] [http://172.21.1.97/api/fin-instrument-info/RU000A107HG1] RESPONSE HEADERS Server: nginx/1.20.1 Date: Mon, 05 Feb 2024 12:14:30 GMT Content-Type: application/json; charset=utf-8; v=2 Transfer-Encoding: chunked Connection: keep-alive x-envoy-upstream-service-time: 27 <--- headers takes 32 milliseconds RESPONSE BODY {color:#de350b}BondDetailedInfoResponse(assetId=null, instrumentTypeId=null, instrumentInfo=null{color}) <--- body takes 32 milliseconds|

Текст ошибки:
|j.l.NullPointerException: Cannot invoke ""ru.alfabank.mobile.invest.instruments.client.dto.instrument.BondDetailedInfoResponse$InstrumentInfo.getIsin()"" because ""info"" is null at r.a.m.i.i.c.c.FinInstrumentsConverter.getBondInstrumentInfo(FinInstrumentsConverter.java:59) at r.a.m.i.i.c.c.FinInstrumentsConverter.bondInfoToDto(FinInstrumentsConverter.java:52) at r.c.p.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:113) at r.c.p.Operators$MonoSubscriber.complete(Operators.java:1839) at r.c.p.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:249) at r.c.p.FluxPeekFuseable$PeekFuseableSubscriber.onNext(FluxPeekFuseable.java:210) at r.c.p.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539) at r.c.p.Operators$MonoSubscriber.complete(Operators.java:1839) at r.c.p.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:151) at r.c.p.FluxContextWrite$ContextWriteSubscriber.onNext(FluxContextWrite.java:107) at r.c.p.FluxMapFuseable$MapFuseableConditionalSubscriber.onNext(FluxMapFuseable.java:299) at r.c.p.FluxFilterFuseable$FilterFuseableConditionalSubscriber.onNext(FluxFilterFuseable.java:337) at r.c.p.Operators$MonoSubscriber.complete(Operators.java:1839) at r.c.p.MonoCollect$CollectSubscriber.onComplete(MonoCollect.java:160) at r.c.p.FluxMap$MapSubscriber.onComplete(FluxMap.java:144) at o.s.c.s.i.r.ScopePassingSpanSubscriber.onComplete(ScopePassingSpanSubscriber.java:103) at r.c.p.FluxPeek$PeekSubscriber.onComplete(FluxPeek.java:260) at o.s.c.s.i.r.ScopePassingSpanSubscriber.onComplete(ScopePassingSpanSubscriber.java:103) at r.c.p.FluxMap$MapSubscriber.onComplete(FluxMap.java:144) at r.n.c.FluxReceive.onInboundComplete(FluxReceive.java:415) at r.n.c.ChannelOperations.onInboundComplete(ChannelOperations.java:424) at r.n.c.ChannelOperations.terminate(ChannelOperations.java:478) at r.n.h.c.HttpClientOperations.onInboundNext(HttpClientOperations.java:712) at r.n.c.ChannelOperationsHandler.channelRead(ChannelOperationsHandler.java:113) at i.n.c.AbstractChannelHandlerContext...|

По результатам анализа, выявлено расхождение между двумя таблицами:
 Родительская
{code:java}
select at_code,act_id,* from hell_cache.dbo.actives da with(nolock)
 where da.isin = 'RU000A107HG1'{code}
дочерняя
{code:java}
SELECT TOP (10) at_code,act_id, *
 FROM [news_cache].[direct].[instruments] WITH (nolock)
where isin = 'RU000A107HG1'{code}
в дочерней таблице отсутствует информация по полям
{code:java}
at_code
act_id{code}
!image-2024-02-06-15-05-37-392.png!
 т.е. не произошла передача данных из Родительской таблицы в Дочернюю
 Проблема массовая, т.к. общее кол-во инструментов, по которым отсутствует информация, на текущий момент, составляет 3676
{code:java}
Select at_code,act_id, isin, * from [news_cache].[direct].[instruments] with(nolock)
 Where at_code is Null
 or act_id is Null{code}
!image-2024-02-06-15-19-42-860.png!

+_*Необходимо устранить ошибку, а так-же обеспечивать корректную передачу данных в дочернюю таблицу.*_+
 +_*Необходимо выполнить ремонт всех инструментов, по которым выявлена ошибка.*_+

 

 

 ",,22.0,Сатурн
ADIRINC-1485,4248920,U_M1HFE,Закрыт,06.02.2024 12:30,,,,,Дефект промсреды,12.02.2024 13:19,2024-02-13 00:00:00.0,"При смене трансляции счетов с адбека на кафку, поле Qlevel не считается как раньше - сумма двух полей.",,,Ядро
ADIRINC-1482,4234587,U_M1HFE,Закрыт,02.02.2024 15:02,,,,,Дефект промсреды,04.06.2024 10:24,2024-03-19 00:00:00.0,"02.02.2024 был раскатан новый сервис *com-k2db-adfront-dbo-accounts* в рамках задачи
https://jira.moscow.alfaintra.net/browse/ITINVEST-3765

После релиза данного сервиса наблюдается искажение графика в метриках и долгая обработка запросов (см. фактуру ниже)
Метрика:
{code:java}
https://grafana.alfadirect.ru/d/OJGbvT8nk/metriki-dlia-etl-servisov-net?orgId=1&var-datasource=gLBdput7z&var-env=prod&var-service=adir-k2db-adfront-dbo-accounts&var-instances=All&var-status=All&var-actions=All&var-perc=50&from=1706874036376&to=1706874936376&refresh=10s{code}
!image-2024-02-02-14-55-29-887.png!

Логи:
[http://adirelkprod.alfadirect.ru/goto/5379cafa32057484d1c9b9b1e6082f19]

!image-2024-02-02-14-58-17-216.png!

По результатам проверки ХП, ошибок не выявлено, запросы выполняются быстро:
!image-2024-02-02-15-00-38-327.png!


Так-же, дополнительная информация находится в треде:
[https://rc.alfa-bank.net/channel/duty-support-invest/thread/DyudCAbajYXPNuvc3]


+*_Прошу устранить проблему и урегулировать скорость обработки запросов сервисом._*+",,,Ядро
ADIRINC-1481,4232725,U_M1W4D,Закрыт,02.02.2024 12:08,USD,Доллар,Отчёты,,Дефект промсреды,18.09.2024 11:51,2024-03-19 00:00:00.0,"На примере клиента *4386375 AVULA9* 
 При формировании отчета MyPortfolio 
 [http://reporting.alfadirect.ru/reports/report/Cabinet/Release/MyPortfolio]

В разделе ""Финансовый результат"" в валюте USD  отображается рублевая сумма, должна быть сумма в USD.
 Отчет сформирован за 2023 год.
 инструмент *US71646E1001* (PetroChina Company Limited)

В поле 
!image-2024-02-02-12-53-23-553.png!
 отображается рублевая сумма, хотя при этом должна отображаться сумма в USD
 Из-за этого у клиента рассчитывается некорректная общая статистика.

Отчет формируется по алгоритму ХП:
 БД ssrs_reports
 ХП RA.FinancialResults

  !image-2024-02-02-12-52-48-605.png!

!image-2024-02-02-12-53-00-511.png!

 
 Клиент покупал 2 инструмента по цене 3823

!image-2024-02-02-12-52-33-056.png!

 
 * _*Требуется исправить ошибку отображения некорректной суммы в валюте.*_
 * _*Необходимо найти и исправить остальные некорректные позиции по клиентам.*_
 * _*Указать, из каких таблиц и каких полей сформирована данная сумма из приведенного в описании кейса.*_

 ",,1.0,НТФ (ЛК)
ADIRINC-1480,4217168,U_M1W4D,Закрыт,30.01.2024 19:17,,,,,Дефект промсреды,25.04.2024 13:38,2024-04-26 00:00:00.0,"Клиент пытается выпустить ЭЦП в мобильном терминале, нажимает создать подпись. После чего есть 2 случая:
 # У клиента зависает экран о создании подписи, при этом по логам FE2 видно, что запросы на создание подписи уходят без поручения, то есть пустыми.
 # При попытке создать подпись на другом устройстве уже видно, что текст поручения приходит с устройства, но при этом нет никаких логов с отправкой смс в Sign Service, в итоге также висит на экране создания 

UPD: после исследования логов сайн сервиса стало понятно, что сертификат не записывается в cl.Certificates, а попадает в таблицу удаленных сертификатов. Из-за того, что в целевой таблице созданного сертификата, то процесс ломается",,,Ядро
ADIRINC-1479,4216925,U_M1DKF,Отклонен,30.01.2024 18:21,,,,,Дефект промсреды,01.02.2024 10:04,2024-03-01 00:00:00.0,"При запросе лимита на вывод ЛС возвращает доступные средства для вывода в плечо, но в форме вывода отображается, что доступно 0",,,Pro terminal
ADIRINC-1477,4214780,U_M1EJ8,Закрыт,30.01.2024 14:18,,,,,Дефект промсреды,24.04.2024 15:04,2024-04-25 00:00:00.0,"Возникают ошибки Токена при запросе в сторону МБ со стороны сервиса adir-validata-api
Данная ошибка влияет на работу сервисов потребилетей:
 * [CheckIIA Сервис проверки ИИС (adir-moex-iia-check)|https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=521719717]
 * [MAOS (adir-moex-account-opening-service)|https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=480946161]

{noformat}
Не удалось получить новый AuthToken (StatusCode:Unauthorized, Response: {""error"":""invalid_request"",""error_description"":""The given signature is invalid""}){noformat}
Начало воспроизведения ошибки в 05:20:39
ссылка на логи: 
{code:java}
http://adirelkprod.alfadirect.ru/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:'2024-01-29T02:15:11.658Z',to:'2024-01-29T03:00:24.084Z'))&_a=(columns:!(message,level,host),filters:!(),hideChart:!t,index:a898b3c0-20d7-11ec-81d9-f956519bb053,interval:auto,query:(language:kuery,query:'_index:%20%22adir-production-dotnet-validata-api%22'),sort:!(!('@timestamp',asc))){code}
 

!image-2024-01-30-13-44-21-208.png!



Текст ошибки:
{noformat}
System.InvalidOperationException: Не удалось получить новый AuthToken (StatusCode: BadRequest). at ValidataApi.Integration.Moex.Providers.MoexProvider.InternalGetAuthTokenAsync(DateTime requestTime, AuthTokenType authTokenType, String oldAccessToken) in C:\BuildAgent\work\b8ec77c36f4fb3ae\ValidataApi.Integration.Moex\Providers\MoexProvider.cs:line 170 at ValidataApi.Integration.Moex.Providers.MoexProvider.GetAuthTokenAsync(AuthTokenType authTokenType, String oldToken) in C:\BuildAgent\work\b8ec77c36f4fb3ae\ValidataApi.Integration.Moex\Providers\MoexProvider.cs:line 123 at ValidataApi.RestApi.Service.Controllers.AuthController.GetRegistrationToken(String oldToken) in C:\BuildAgent\work\b8ec77c36f4fb3ae\ValidataApi\Controllers\AuthController.cs:line 22 at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextExceptionFilterAsync>g__Awaited|26_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ExceptionContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope) at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger) at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware.<Invoke>g__Awaited|6_0(ExceptionHandlerMiddleware middleware, HttpContext context, Task task){noformat}

Так-же, в рамках разбора инцидента необходимо проверить следующие гипотезы:
1) Необходимо разобраться, все ли у сервиса в порядке с локальным кэшом и процессом получения токенов при наличии множества потребителей
2) Почему на alfaweb01 у сервиса такое количество обращений от заббикса по эжому порту 8263. (см скрин ниже)
Кажется что сервис испытвает трудности с получением токена (работа со своим локальным кэщом) при наличии множества потребителей. 
!image-2024-01-30-14-07-05-133.png!


 * 
Сервис alfaweb02 смогли поднять только тогда - когда отключили основных его потребителей (Moex Account Opening и Moex IIA Check)
 
 * 
 К alfaweb01 по факту эти сервисы не обращались, однако видно что это компенсируется так называемым ""паразитным"" трафиком. Т.е. не трафиком первой очереди, а побочными сервисами





 ",,,Ядро
ADIRINC-1476,4214016,U_M1UN1,Закрыт,30.01.2024 12:47,ОТЭИСФЛ,,,,Дефект промсреды,27.04.2024 09:48,2024-04-03 00:00:00.0,"В МТ в разделе ""Позиция"" при нажатии на кнопку *""Продать""* происходит переход на раздел ""Заявка"", при этом не происходит автоматического выбора режима продажи, а не покупки инструмента. Однако, если произвести аналогичный переход повторно, то тип сделки уже подтягивается корректно.

ОР: При перебрасывании в раздел ""Заявки"" подхватывается соответствующий тип сделки(покупка/продажа)

ФР: При перебрасывании в раздел ""Заявки"" по умолчанию остается тип сделки ""Покупка""

Стабильно воспроизводится на версии Fresh Ideas 3.6.0 iOS. 
На версии Visionary 3.5.0 iOS дефект не воспроизводится",,4.0,Everest
ADIRINC-1475,4208159,U_M1AYY,Отклонен,29.01.2024 13:48,АФБ,,,,Дефект промсреды,24.04.2024 16:38,2024-03-13 00:00:00.0,"У клиента 4245879/AKFD6I в SFA отображается некорректные значения по инструменту US4039491000(202 позиции а бд по данному инструменту), тянется так с position-keepeing c ""currency"": ""USD""
 ОР: Стоимость позиции по HF Sinclair Corporation, а.о. 989123.60 $
 ФР: Стоимость позиции по HF Sinclair Corporation, а.о. 11152 $
 !image-2024-01-29-14-05-57-733.png!
 Предполагаем, что в position-cache тянется инфа в рублях, но т.к. валюта инструмента в $ отображается в них
 Исходя из того что мы видим ""price"": 4700.00503 это `{{цена в $ * на курс $}}` . Но используя данную сумму РК оставляет валютой отображения $ из-за чего у клиента отображается баланс позиции в $, но с рублевой стоимостью
 Аналогично сadfront
 use ADfront declare @idAccount int set @idAccount = 4245879 select o.idobjectfaceunit as [валюта отображения],o.pricerur as [Цена в руб.],o.price as [Цена в $],o.currate as курс,(o.price*o.currate) as [Курс*$],* from [bs].[SubAccPositions] sap join adfront.bs.objects o on o.IdObject = sap.IdObject --o.IdMarketBoardBalance where 1=1 and sap.idAccount = @idAccount and o.IdObject = 822786

Ответ от position kepping

!image-2024-01-29-14-08-06-366.png!",,5.0,Марс
ADIRINC-1474,4194767,U_M1CE2,Закрыт,25.01.2024 15:17,АФБ,,,,Дефект промсреды,29.04.2024 11:31,2024-03-11 00:00:00.0,"* Клиент Карпенко Александр Олегович ГС 3084776 ПИН AI4CS3 вчера пытался выставить заявку на участие в размещение НОТЫ ""Структурные облигации Альфа-Банк С-1-190""
 При этом ЛС рассчитывается корректно и видит баланс 12 454 384,94 руб., но почему то у клиента на скрине Свободные средства отображаются некорректно 8 852 750 руб., а вот сколько доступно к выставлению 12 441 бумага рассчитана верно.
*ОР*: Возможность выставить размещение на 12 454 384,94 руб
*ФР*: Возможность выставить размещение на 8 852 750 руб.

 
 В ходе анализа выяснилось, что размещения в данный момент в ЛК доступны в рамках собственных средств
!image-2024-01-25-18-57-38-109.png!
!image-2024-01-25-18-56-59-414.png!!image-2024-01-25-18-57-10-362.png!",,4.0,НТФ (ЛК)
ADIRINC-1473,4193022,U_M1W4D,Отклонен,25.01.2024 12:39,,,,,Дефект промсреды,22.04.2024 08:13,2024-03-11 00:00:00.0,"на примере 122043 ALJ6V3
ISIN RU000A106E90 
Во вкладке ""О Выпуске"" указывается некорректное значение доходности. 
!image-2024-01-25-12-33-05-823.png!
!image-2024-01-25-12-33-19-461.png!


Данное значение должно меняться каждую ночь в соответствии с документом:
[https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=945273828]

При проведении анализа выявлена ошибка:
[http://adlog1/kibana/goto/e20b0200-bb64-11ee-b963-8f2ab4e67d2d]
!image-2024-01-25-12-34-41-627.png!


{code:java}
Select top(10)* from hell_cache.info.bonds with(nolock)
Where act_id = '126559'{code}
!image-2024-01-25-12-35-36-429.png!

+_*Необходимо устранить ошибку и возобновить обновление данного параметра каждую ночь*_+",,32.0,Сатурн
ADIRINC-1470,4182748,RUM1BPH,Закрыт,23.01.2024 20:57,,,,,Дефект промсреды,18.09.2024 11:50,2024-03-07 00:00:00.0,"Коллеги, к нам обратился клиент ГС 5540 по поводу неотображения УЦ по инcтрументу SBER3.

Пересчёт учётных цен по новому алгоритму не приводит к желаемому результату. 

!image-2024-01-23-20-55-04-678.png!  
 Клиент считает, что УЦ должна быть на уровне 12,11, и это подтверждается отчётами:
 !image-2024-01-23-21-01-22-892.png!

Инструмент дважды конвертировался:
 1) 2006-07-25 из SBER1 в SBER
 2) 2007-07-20 из SBER в SBER3",,8.0,Марс
ADIRINC-1468,4172992,U_M1CE2,Отклонен,22.01.2024 17:51,,,,,Дефект промсреды,03.09.2024 10:08,2024-04-17 00:00:00.0,"2.27.1  Android
 15.12.2023 были совершены сделки по фьючерсам.  Клиент на следующий день заходит в МТ, в историю операций
  ОР: В истории эта операция отображается c суммой сделки в рублях
  ФР: В истории эта операция отображается с *суммой сделки = 0*

Исходя из анализа данные берутся из поля trade_volume, которое для Срочного рынка нулевое. Необходимо для СР использовать другой механизм для отображения.
 SELECT TOP (1000) [act_id],treaty,trade_volume,*
 FROM [operations_cache].[hell].[trades] 
 WITH (SNAPSHOT) where 1=1
 and treaty = 7102663 
 and act_id = 126678
 order by price
 !image-2024-01-22-17-52-49-551.png!",,5.0,Ядро
ADIRINC-1467,4171175,U_M214D,Закрыт,22.01.2024 14:54,Фронт,,,,Дефект промсреды,16.04.2024 09:53,2024-03-05 00:00:00.0,"Клиент ACDAKK 99181 в новой версии ios fresh ideas пытается выставить фильтры в разделе Рынки. Ни в лидерах оборота, ни в лидерах роста инструмента нет, хотя он должен быть в топе исходя из данных.
Хотя в старой версии АИ 2.17 инструмент отображается корректно под всеми фильтрами. 
Запрос по 
|instruments-search-api|

 по ручке /filters/assets 
не возвращает эту бумагу",,11.0,Fuji
ADIRINC-1466,4168194,U_M1BFA,Закрыт,22.01.2024 11:27,,,,,Дефект промсреды,17.04.2024 17:49,2024-03-05 00:00:00.0,"У клиента AR6OWY 372298 в ДТ процессор  Intel Core i9-13900K загружается более чем на 60 %. 
ChartIQ (график ""новая версия"") на фьючерсах даёт такую нагрузку",,4.0,Pro terminal
ADIRINC-1465,4165514,U_M0WVN,Закрыт,21.01.2024 20:10,,,,,Дефект промсреды,12.02.2024 18:56,2024-03-26 00:00:00.0,"*Ожидаемый результат:*
 Kafka to Database Extratransfers пишет трансферы клинетов в топик adir-core.asset-extra-transfers.cdc.hell.dbo.extra-transfers.0
 После отаботки процедуры kafka.import_extra_transfers_u обновляет запись в базе

*Фактический результат:*
 В логах видим в TRACE (не ERROR) записи типа
 _Тип команды: 'StoredProcedure'_
 _Текст команды: 'dbo.etl_error_save'_
 _Входные параметры: '[\{""name"":""queue_name"",""value"":""adir-core.asset-extra-transfers.cdc.hell.dbo.extra-transfers.0""},\{""name"":""error_code"",""value"":""TRANSFER_IS_FAILED""},\{""name"":""error_text"",""value"":""Процедура kafka.import_extra_transfers_u не обновила ни одной записи""}_

При этом по метрикам ситуация следующая наблюдалась

!image-2024-01-22-19-18-51-755.png!

Всплеск успешных - это рестарт сервиса, который на короткое время позволял разобрать сообщения в топике, но через некоторое время снова очередь переставала разбираться.

Лаг в топике копился быстрее , чем обрабатывались сообщения. На момент разбора аварии картина была следующая

!image-2024-01-22-19-21-59-699.png!

*Что было предпринято:*

Смотрели логику хранимой процедуры и пришли к выводу, что в текущей реализации процедура обновления в базе возвращала 1 при отсутствии записи и необходимости её добавить. Не смотря на корректное добавление записи процедурой, сервис воспринимал 1 как ""ошибку"", обработка которой значительно снижала скорость (и возможно приводила к многочисленным ретраям). Так как при обычной работе ситуация с попыткой ""обновить"" запись, которой еще НЕТ в базе: возникает редко, данная ошибка не была замечена, но в ситуации возникшей на момент плановых работ по переключению реплик бд, в топике появилось значительное к-во сообщений на обновление, часть из которых на самом деле отсутствовали в целевой БД (например более 100К трансферов по замороженным активам от января прошлого 2023 года) + процессинг нагенерил более 200к трансферов по копилке для сдачи.

Почистили весь топик, разобрали трансферы на небольшие пачки и перезачитали их. При попытке перезачитать пачку более 2к трансферов начинали возникать ошибки выше и метрики сервиса по rps падали до 0.

Было принято решение менять логику (условие ниже) процедуры на ходу, чтобы сервис мог корректно обработать ее ответ.

После этого перезачитали несколько сот трансферов сразу, которые были обработаны за несколько минут.

Вернули код процедуры обратно.

 

*Вывод , который был сделан во время аварии 20.01.2023:*

сервис Kafka to Database Extratransfers 
 некорректно обрабатывает ответ процедуры kafka.import_extra_transfers_u
 RETURN IIF(@row_count <> 0, 0, 0); вот так сервис правильно обрабатывает ответ
 RETURN IIF(@row_count <> 0, 0, 1); вот такое условие делали, чтобы быстро починить ситуацию. Так как мы точно знаем, что возврат 1 обрабатывался как ""ошибка"".",,,Марс
ADIRINC-1464,4164352,U_M1QX4,Закрыт,19.01.2024 17:35,,,,,Дефект промсреды,12.04.2024 09:56,2024-03-04 00:00:00.0,"Клиент А-Клуб Геворкян Завен Багратович AHV8VX 103117 - пользуется 3.6.0 свежие идеи для iPhone, отображение так же проверено подключением к клиенту в ТТ 4.0 для ПК.

У клиента в портфеле рядом два неторгуемых сейчас ETF: IE00BDFL4P12 и IE00B53SZB19

Стоимость по IE00BDFL4P12 отображается в рубле, текущая динамика примерно соответствует тому, что можно видеть на графике на cbonds, если пересчитать на курс: https://cbonds.ru/etf/3557/

Но стоимость IE00B53SZB19 отображается уже в долларе, а динамика вообще не вяжется с открытыми источниками, у клиента цена текущая 10,9932$ за 1 шт., что прямо таки драматически отличается от свободных источников, сравните сами: https://cbonds.ru/etf/7407/ - цена 967$ за 1 шт., у клиента должна быть прибыль, а показан непонятный совершенно убыток.

 

 ",,42.0,Марс
ADIRINC-1463,4160792,U_M1QX4,Закрыт,19.01.2024 11:55,,,,,Дефект промсреды,07.08.2024 10:40,2024-04-16 00:00:00.0,"VIP клиент Сидоренко Юрий Сергеевич C61717 5744 зависает приложение при переходе в стакан на срочном рынке

Платформа: МТ Андроид (Версия: 2.27.1)

Описание:
Во время вечерней сессии в приложении зависают стаканы срочного рынка.
Клиент наблюдал ситуацию неоднократно, почти каждый день.
""Заходишь в стакан, он виснет и появляется сообщение подождите. Реанимировать можно только перезапуском приложения. Происходит только в рамках вечерней сессии""

 

Подскажите, пожалуйста, в каком случае может возникать данная проблема?",,4.0,Appalachians
ADIRINC-1462,4158202,U_M00ZM,Закрыт,19.01.2024 00:29,,,,,Дефект промсреды,22.01.2024 09:23,2024-01-23 00:00:00.0,"При попытке открытия БС счету присваиваться депо анкета, в процедуре выбора депо анкеты dbo._get_free_depo_anket проводится проверка уникальности депо счёта, если он уже используется в dbo.positions, то процедура выдает ошибку и счет не открывается",,,Ядро
ADIRINC-1460,4154671,U_M1AYE,Закрыт,18.01.2024 13:04,,,,,Дефект промсреды,01.07.2024 10:55,2024-03-01 00:00:00.0,"При отбивке биржей запроса на обновление лимита на фортс Агент не отправляет запрос повторно:

Клиент пополнил ДС на фортс на 21 млн 17.01.2024 14:00:06, но при выставлении заявки в 17.01.2024 14:55 биржа ее отклонила по лимитам

С биржи пришли данные по позициям клиента 

Jan 17 14:54:27.163499 adwasforts02 asforts[2981059:2981319]/debug(tf): [Part] - (in) part=\{[replid=846486][replrev=4944864][replact=0][client_code=A000O4I][money_free=1306982.81][money_blocked=18448897.2][vm_reserve=0][fee=4825.5][limits_set=1][money_old=10877871.51][money_amount=19523596.51][money_pledge_amount=0][vm_intercl=237109][is_auto_update_limit=0][broker_fee=0][penalty=0][premium_intercl=0][net_option_value=0]}

 где money_amount=19523596.51

В Jan 17 14:00:17.975365 с ДК на агента пришло обновление баланса, но биржа отбила неторговую операцию из-за клиринга

 Jan 17 14:00:17.975365 adwasforts02 asforts[2981059:2981077]/debug(tf): [sock:0x7feba1e8ec40 FD:22 DataCache 172.21.10.104] - (in-tcp) [L=46]ChngTrdLmtReq=\{[Id=3897724][TrdAcc=A000][CltCod=O4I][VolTrdLmt=40590765.35]Ver={[Ver=9703157371][Op=Updd]}[Mod=12]}
Jan 17 14:00:17.975396 adwasforts02 asforts[2981059:2981791]/debug(tf): [EnterTradeLimit] - (out) change_client_money=\{[broker_code=A000][mode=12][code=O4I][coeff_im=][is_auto_update_limit=0][check_limit=0][limit_money=40590765.35]}
Jan 17 14:00:17.977357 adwasforts02 asforts[2981059:2981325]/debug(tf): [LmtFortsMsg187] - (in) forts_msg187=\{[code=383][message=Идет пром. клиринг, нельзя совершать неторговые операции.]}

Больше попыток обновить баланс не было",,2.0,Уран
ADIRINC-1459,4153889,U_M1DJV,Закрыт,18.01.2024 11:47,,,,,Дефект промсреды,24.01.2024 12:46,2024-03-22 00:00:00.0,"4950792 ALSC2P
 При проведении анализа выявлено некорректное отображение суммы ликвидного портфеля в маржинальном кредитовании.
 У клиента в портфеле 2474822р
 !image-2024-01-18-11-39-00-564.png!

В веб терминале расчет ликвидного портфеля корректный.
 !image-2024-01-18-11-39-55-311.png!

а в приложении МТ сумма указана гораздо больше
 !image-2024-01-18-11-40-28-613.png!

В последствии было выяснено, что расчет должен проводиться по следующему сценарию:
 ([https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=1329243850#id-[Front]V2%D0%9C%D0%B0%D1%80%D0%B6%D0%B8%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B-2.%D0%9E%D1%82%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5%D0%BB%D0%B8%D0%BA%D0%B2%D0%B8%D0%B4%D0%BD%D0%BE%D0%B3%D0%BE%D0%BF%D0%BE%D1%80%D1%82%D1%84%D0%B5%D0%BB%D1%8F%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8FUC2)]

В соответствии с пунктом _*1.4.1. Отображение блока: Состояние №2*_
 _*!image-2024-01-18-11-43-21-395.png!*_

должен отображаться параметр _+liquidActivesCost+_ т.к. 
 * liquidActivesCost => startMargin

 (см. ниже лог), а в итоге отображается +_{color:#172b4d}adjustedLiquidActivesCost{color}_+

Лог запроса: [http://adlog1/kibana/goto/d1079900-b5dd-11ee-b963-8f2ab4e67d2d]

traceId: dd2466593caccb9c

!image-2024-01-18-11-46-56-355.png!

{color:#de350b}*+_Требуется устранить ошибку и корректно отображать ликвидность портфеля клиентам_+*{color}

 ",,1.0,Montblanc
ADIRINC-1457,4148429,U_M192K,Закрыт,17.01.2024 13:02,Главная,,,,Дефект промсреды,18.01.2024 17:02,2024-03-21 00:00:00.0,"Из-за изменений в БД по инструменту PHOR2 в разделе ""Популярно Сегодня"" возникает ошибка отображения актива

!image-2024-01-17-12-53-44-587.png!

!image-2024-01-17-12-54-14-455.png!

При изменении symbol_object инструмента с PHOR2 на PHOR в базе - из-за хардкода в списке ""Популярно Сегодня"" - идет обращение к несуществующему инструменту. 

https://rc.alfa-bank.net/channel/a-inv-mt?msg=iABniGKjnyLhECSyf",,1.0,Everest
ADIRINC-1453,4140324,U_M1W6T,Отклонен,16.01.2024 09:07,,,,,Дефект промсреды,12.02.2024 12:24,2024-02-28 00:00:00.0,"+_AOMZ34 109569 Калькулятор доходности облигации._
 +В калькуляторе доходности рассчитывается некорректная прибыль.

В соответствии с ""*Описанием бизнес-процессов*"" [https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=1473656385|https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=1473656385)]
 расчет должен проходить следующим образом:

1.3. Если код ответа не равно 200, то виджет *не* показываем.
 Стейты (заглушки) виджета а ля ""Не удалось загрузить..."" также не показываем.

2. Анализируем поле calculable:

2.1. Если поле отсутствует ИЛИ calculable = false, то виджет *не* показываем.
 2.2. Если calculable == true, то отображаем виджет калькулятора:

3. Анализируем объект instrumentInfo.offert:
 3.1. Если offert.yieldToOffert не равно Null *И* offert.date не равно Null:
   *yield* = offert.yieldToOffert 
   *date* = offert.date
 3.2. В противном случае:
   *yield* = instrumentInfo.yieldToMaturity
   *date* = instrumentInfo.maturityDate

4. Описание виджета:
 4.1. Заголовок: текст ""Калькулятор доходности"".
 4.2. Валюту брать из instrumentInfo.Currency (мапим во внутренних моделях до символа)
 4.2. Текст ""Если вложу сейчас"" <*inputSum*>.
 4.3. Ползунок с суммой:
 * минимальное значение (и оно же шаг изменения) = instrumentInfo.nominalValue
 * максимальное = instrumentInfo.nominalValue * значение ФТ *yield_calculator_sum_multiplier*
 хардкодим дефолт 100
 * *inputSum* = установленное значение
 * Дефолтное *inputSum* = instrumentInfo.nominalValue * значение ФТ *yield_calculator_default_input
 *хардкодим дефолт 50*
 *

например, номинал 1000, мультипликатор 200, дефолт 100, на ползунке значения от 1000 до 200 000 с шагом 1000, дефолт будет 100 000.

4.3. ""Получу к "" <*date*>  <*inputSum+income*>.
 4.4. ""Прибыль"" <*income*>.
 *totalDays* = количество полных календарных дней от текущей даты (берем ADTQuote.ExTime) до *date.*
 *!image-2024-01-16-08-43-44-501.png!*

В процессе проведения Анализа по клиенту AOMZ34 109569 (ISIN RU000A105NL3)
 обнаружен некорректный расчет прибыли. 
 !image-2024-01-16-08-45-41-022.png!

ссылка на логи:
 [http://adlog1/kibana/goto/992901b0-b432-11ee-9fe4-77fadf634ec0]

!image-2024-01-16-08-47-38-334.png!
 !image-2024-01-16-08-48-44-279.png!

В соответствии с пунктом 3.1 и 4.4 ""*Описания бизнес-процессов*""
 получаем значения:
 3.1. Если offert.yieldToOffert не равно Null *И* offert.date не равно Null:
   *yield* = offert.yieldToOffert  = {color:#de350b}*7,37*{color}
   *date* = offert.date = {color:#de350b}*2025-12-25*{color}
 3.2. В противном случае:
   *yield* = instrumentInfo.yieldToMaturity = *{color:#de350b}10,92{color}*
   *date* = instrumentInfo.maturityDate = {color:#de350b}*2026-08-18*
 {color}*Расчет по формуле из пункта 4.4 - totalDays ({color:#de350b}*2024-01-10*{color}) т.к. запрос был 10.01.2024
 *!image-2024-01-16-08-52-49-883.png!*
 по пункту 3.1 ----- 50000 * (7,37/100) * (348/365) = *{color:#de350b}3511,805{color}*
 Если даже рассчитаем по пункту 3.2 ----- 50000 * (10,92/100) * (960/365) = *{color:#de350b}14359,8
{color}*{color:#172b4d}когда у клиента отображается в МТ{color} *{color:#de350b}7208,46{color}* {color:#172b4d}+_*Необходимо исправить ошибку некорректного расчета прибыли в калькуляторе доходности.*_+{color}",,6.0,Elbrus
ADIRINC-1452,4137750,U_M0YQB,Повторный,15.01.2024 15:17,,,,,Дефект промсреды,,2024-07-25 00:00:00.0,"В МТ отображается некорректный расчет итоговой сделки по валютным облигациям.
на примере ISIN RU000A1059A6

данная облигация на МосБирже имеет валюту фунты ""GBP""
!image-2024-01-15-15-07-35-460.png!

При этом в ""Сводка"" по облигации данные отображаются корректно:
!image-2024-01-15-15-08-48-049.png!

При заведении сделки по данному инструменту отображается некорректная итоговая сделка, т.е. система считает Номинал в 1000 GBP как 1000 руб.
По формуле расчета НКД + %Номинала
В нашем случае: 1000 / 100 * 99.1397 = 997,397 
Итоговая сделка: 991,397 + 1 293,27 (НКД) = 2 284,667 (что является некорректным учитывая валюту) расчет идет в рублях, это некорреткно.
см. скриншот.
!image-2024-01-15-15-16-21-188.png!

+_*Необходимо отображать клиентам корректный расчет по валютным облигациям*_+",,3.0,Уран
ADIRINC-1451,4137408,U_M1QLD,Отклонен,15.01.2024 14:41,,,,,Дефект промсреды,16.01.2024 16:51,2024-02-27 00:00:00.0,"Клиент проваливается в бумагу, заходит в график, выбирает lite режим. Ставя любой таймфрейм, доходность отображается за сегодня. 

Приложение версии 2.27.1 - Android

ОР: Отображение доходности меняется в зависимости от выбранного таймфрейма
ФР: Доходность при любом таймфрейме отображается за сегодня",,3.0,Мобильный терминал
ADIRINC-1449,4132431,U_M1AYY,NEW,12.01.2024 17:47,,,,,Дефект промсреды,,2024-02-26 00:00:00.0,"Прошу выяснить и устранить на будущее причину сбоя в расчёте УЦ, в результате которой по большому количеству позиций (129 тыс.) установилась УЦ $22,85 или €19,751069 по иностранным бумагам.

Детали по дефекту здесь: [https://rc.alfa-bank.net/channel/adir_uchetn_cenyi_2_2_14/thread/K4zy2vSdZ54qmCvFN
]

В настоящий момент УЦ по большинству позиций пересчитан, но остаётся 928 непересчитанных позиций:
!image-2024-01-12-18-47-52-823.png!

select rp.fRegPrice,curr = case rp.IdObjectUchPriceCurr when 174366 then 'USD' when 174367 then 'EUR' when 174368 then 'RUR' else '???' end,trf.acc_code,trf.place_code,trf.p_code,a.ISIN,a.p_name,* select rp.fRegPrice,curr = case rp.IdObjectUchPriceCurr when 174366 then 'USD' when 174367 then 'EUR' when 174368 then 'RUR' else '???' end,trf.acc_code,trf.place_code,trf.p_code,a.ISIN,a.p_name,* from ADFront.cf.RegPrices rp with(nolock)    join ADFront.dbo.objects obj with(nolock) on obj.IdObject = rp.IdObject       join hell.dbo.actives a with(nolock) on a.ISIN = isnull(obj.ISIN,obj.NameObject) join ADFront.dbo.Razdels r with(nolock) on r.IdRazdel = rp.IdRazdel join ADFront.dbo.RazdelTypes rt with(nolock) on rt.IdRazdelType = r.IdRazdelType   join ADFront.dbo.SubAccounts sa with(nolock) on sa.IdSubAccount = rp.IdSubAccount   cross apply (      select top 1 *   from a_hell_opers.dbo.a_all_transfers trf   where 1=1   and trf.comments = 'Перевод ЦБ в рамках массовой миграции в НРД СЗ 231208-001009'   and trf.a_date >= '2023-12-18'   and trf.acc_code = sa.acc_code   and trf.p_code = a.p_code   and trf.place_code = rt.place_code   ) trfwhere 1=1and rp.fRegPrice in (22.85,19.751069,16.875928,1615.38075)order by trf.acc_code,trf.place_code,trf.p_code",,,Марс
ADIRINC-1448,4131584,U_M0V2E,NEW,12.01.2024 16:21,ОТЭИСФЛ,,,,Дефект промсреды,,2024-02-26 00:00:00.0," 

В течении января каждый день работает джоб [09:00 Создание блокировочных налоговых платежей] который удаляет налоговые платежи

за прошедший год созданные вчера и создает новые налоговые платежи.

Для этого в джобе запускается ХП EXEC tax.BlokedPaymentsForTaxes, она все и делает.

 При этом на табличке с платежами hell.dbo.payments отрабатывает триггер:

 *ALTER TRIGGER [dbo].[payments_d_repl]   (DELETE)* выполняет трансляцию  в AdBack, в post_trade   и

трансляцию для кафки:

*EXEC pipe.notify @message_type = '//alfa-direct.ru/SQL/hell_ADBack_payments_d'*

*EXEC pipe.notify @message_type = '//alfa-direct.ru/SQL/hell_payments_pt'*

*EXEC pipe.notify_kafka @message_type = '//alfa-direct.ru/SQL/hell_kafka_payments'*

 

Этот триггер [dbo].[payments_d_repl] отправляет данные в AdFront.  Обработка очереди SB по нему часто сваливается

в deadlock (1205) и выбирается в качестве жертвы, т.е. откатывается. Посмотреть deadlock-и можно так :

 

*SELECT ** 

*FROM adback.Pipe.Errors*

*where 1=1*

*and ErrorMsg like 'BalancePositions.Notify, line 109, state 2, BalancePositions.Notify.err_num = 1205%'*

*and dtUpdate >= '2024-01-01'*

 

В результате  в таблице ADFront.cf.Operations не переходили в статус IdOperationStatus=5  операции по НДФЛ созданные вчера.

А сегодня они суммировались с новыми и платеж по НДФЛ удваивался.

 

Проверить наличие операциий в ADFront.cf.Operations по которым нет  платежа в Hell.dbo.Payments и будет задвоение

НДФЛ можно так:

 

*select **

*from ADFront.cf.operations*

*where IdOperationStatus = 1*

                               *and codemarketboard = 'MONY'*

                               *and comment like '%НДФЛ%2023%'*

                               *and TimeOperation >= '2024-01-03'*

                               *and SettleDate = '2024-02-05'*

*and ExtOperNo not in (select pay_no from hell.dbo.payments)*

 

Необходимо исправить эту ситуацию, т.е. сделать повторы накатов в случае ошибки 1205

 

 ",,,Сириус
ADIRINC-1446,4129905,U_M18JH,Принят к исправлению,12.01.2024 14:19,,,,,Дефект промсреды,,2024-03-18 00:00:00.0,"При указании диапазона более 2 недель при формировании брокерского отчета, возникает ошибка.
Формирование - онлайн

В логах ошибок нет, но
При проведении анализа, в таблице запись появляется, т.е. ошибка возникает в самом приложении МТ, не подгружает сам отчет в телефоне.
select top 1000 *
from reportserver.dbo.ExecutionLogStorage
--where username = 'MOSCOW\U_M1TP0'
where TimeStart > '2024-01-11 11:45:44.930' and Parameters like '%2544842%'
order by TimeStart desc

(см. скриншот)

!image-2024-01-12-13-42-16-119.png!
!image-2024-01-12-13-42-31-221.png!",,36.0,K2
ADIRINC-1445,4118958,U_M177U,Закрыт,10.01.2024 14:05,,,,,Дефект промсреды,07.02.2024 15:24,2024-03-14 00:00:00.0,"В списке счетов при пополнении со счета в банке для выбора недоступен новый ИИС

Проблема на проработке. Обсуждается тут https://rc.alfa-bank.net/channel/ai-otkrytie-iis-3?msg=uAeYchpALSM2HZt68",,5.0,Montblanc
ADIRINC-1444,4118365,U_M0A0R,На исправление,10.01.2024 13:38,,,,,Дефект промсреды,,2024-02-21 00:00:00.0,"При подключении срочного рынка клиентом AEKNZ0 4923629 был произведен некорректный расчет лимита +(dbo.__newlimit)
+

09.01.2024 Клиентом была совершена сделка на сумму 113,79
!image-2024-01-10-13-05-14-586.png!

остаток на счете у клиента, после совершения сделки, составляет 882,46 руб.

на клиента накладывается Административный лимит суммой 1000, которого быть не должно.
[http://backupsrv01.alfadirect.ru:8081/ReportServer/Pages/ReportViewer.aspx?/PreTrade%20Control/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D0%BB%D0%BE%D0%B3%D0%B0%20%D1%80%D0%B0%D1%81%D1%87%D0%B5%D1%82%D0%B0%20%D0%BB%D0%B8%D0%BC%D0%B8%D1%82%D0%BE%D0%B2&rs:Command=Render&ID=82884750]

!image-2024-01-10-13-09-46-301.png!

На скриншоте ниже, отображается результат проведения Анализа данного лимитного сервиса, который подтверждает некорректные расчеты лимитов.
т.е. лимитный сервис показывает 0 доступных средств, когда у клиента на остатке 882.46. Данное поведение лимитного сервиса некорректное.
!image-2024-01-10-13-28-55-159.png!

DECLARE
@limit DECIMAL(14, 2)

EXEC dbo.__newlimit
@oper_type = 'EXTRA_MONEY'
, @acc_code = '4931754-000'
, @p_code = 'money'
, @place_code = 'MICEX_SHR'
, @limit_ad = @limit OUTPUT;

print @limit




+_*Необходимо устранить ошибку навешивания административного лимита суммой 1000р на клиентов.*_+
 ",,3.0,НТФ (ЛК)
ADIRINC-1443,4114559,U_M177U,Закрыт,09.01.2024 18:02,,,,,Дефект промсреды,06.06.2024 14:37,2024-02-21 00:00:00.0,"Клиент заходит в МВТ, выбирает портфель ИИС

У клиента в ВТ не загружается портфель, только черный экран",,,Montblanc
ADIRINC-1442,4112802,RUM1CYC,На исправление,09.01.2024 15:31,,,,,Дефект промсреды,,2024-02-20 00:00:00.0,"Сервис сandles-api утилизирует все CPU cервера, проблема началась с 1 декабря, у сервиса явно есть проблемы с производительностью


!image-2024-01-09-15-29-25-251.png!
!image-2024-01-09-15-25-25-350.png|width=879,height=579!",,,Ядро
ADIRINC-1441,4107003,U_M0DRY,Закрыт,08.01.2024 16:58,,,,,Дефект промсреды,19.02.2024 16:59,2024-02-20 00:00:00.0,"Клиент пытается отменить заявку 51764408484, она помечается для удаления в 2024-01-05 18:32:41, но не переходит в конечный статус в БД, тк ЛС агент не может её снять

Jan 5 18:32:50.202802 adwls01 ls[2721213:2723801]/debug(tf): [sock:0x7f04c8469df0 FD:56 ASMICEX-22 172.21.110.142] - (out-tcp) [L=51]CnlOrd=\{[IdFI=149202][IdMktBrd=92][NED=51764408484][EOrdN=42252223376][IdRzd=17351689][OrdStRev=375][BuySell=Sell][IdOrdT=LMT][IdQntT=QTY][IdLfTm=D30][ClOrdId=][IdDocT=TRD][IdAcc=4328994]}
Jan 5 18:32:50.206372 adwls01 ls[2721213:2723798]/debug(tf): [sock:0x7f04c8469df0 FD:56 ASMICEX-22 172.21.110.142] - (in-tcp) [L=240]RspCnlOrd=\{RspOrd={[Err=OrdRejAlrdGone][Err=ОШИБКА: (916) Заявка не может быть отменена. Указанная заявка уже не активна. Текущий статус заявки 'W'][EOrdN=42252223376][NED=51764408484][PenlRmn=0][Rest=0][IdSubAcc=2485275][OrdStRev=375][IdAcc=4328994][ClOrdId=][ESesId=12422]}}

В итоге заявка в БД поменяла статус 2024-01-08 05:57:16

На момент 2024-01-05 18:32:41 торги по инструменту RU000A0JKQU8 еще велись, заявка блокировала лимиты",,,Ядро
ADIRINC-1439,4105863,U_M177U,Закрыт,02.01.2024 16:13,ОТЭИСФЛ,,,,Дефект промсреды,05.02.2024 16:10,2024-02-20 00:00:00.0,"В рамках задачи https://jira.moscow.alfaintra.net/browse/ITINVEST-3384 добавлялся новый тип счета Z0. В последствии обнаружилось, что из-за него у клиентов не получается пополнить брокерский счет со счета в альфа-банке, выдавая ошибку ""Нужен второй заход""

Как временное исправление убрали данный тип счета из списка ФТ deposit_available_accounts

Логи мидла: [http://adlog1/kibana/goto/1a87a940-aec6-11ee-9fe4-77fadf634ec0]
Логи core: [http://adirelkprod.alfadirect.ru/goto/345a609f6f1effa77b33c5d89c0d5234]",,,Montblanc
ADIRINC-1437,4099719,U_M1AYY,На исправление,28.12.2023 21:12,,,,,Дефект промсреды,,2024-03-12 00:00:00.0,"Коллеги, обратился клиент ГС 795552 по поводу отображения в МТ закладки ""За сегодня"" на примере инструмента US98387E2054.
По котировкам видна положительная динамика (котировка за вчера меньше текущей котировки), а в доходе справа видит убыток в рублях и процентах.
Очевидный дефект: даже при асинхронном изменении котировок для инструментов надо каждый раз пересчитывать доход по ним.
!image-2023-12-28-21-09-39-371.png!",,14.0,Core
ADIRINC-1434,4095695,U_M0YQB,Отклонен,27.12.2023 17:37,,,,,Дефект промсреды,27.12.2023 18:05,2024-02-15 00:00:00.0,"*Проблема заключается в следующем:*

Есть сервис *adir-moex-account-opening-service,* у него есть конфиги [https://git.moscow.alfaintra.net/projects/ADIR_CORE/repos/adir-moex-account-opening-service/browse/MoexAccountOpeningService/appsettings.json]

В них прописано расписание работы биржи хардкодом.

Накануне праздников приходится вручную править конфиг в соответствии с графиком работы биржи, иногда по несколько раз в нерабочее время и делать рестарт сервиса.

Необходим переход на получение данного графика в автоматическом режиме, на сколько нам известно уже есть в бою такой.",,,
ADIRINC-1431,4090149,U_M173X,Закрыт,26.12.2023 12:17,,,,,Дефект промсреды,20.02.2024 09:53,2024-02-14 00:00:00.0,"Авария 26.12.2023 c 10:00 и до 10:27 не работали выводы ДС 
 Причина с 9:50 завис сервис facadeLS на adir-p-core-02  и никак не реагировал
 При этом на adir-p-core-01 сервис работал, помог рестарт сервиса
На сервере в 9:50 был резкий скачок по ЦПУ и памяти
 !image-2023-12-26-12-17-02-046.png|width=1044,height=481!
!image-2023-12-26-12-24-51-853.png|width=1114,height=611!",,,Ядро
ADIRINC-1430,4088511,RUM1BPH,Закрыт,25.12.2023 21:40,,,,,Дефект промсреды,09.10.2024 10:22,2024-02-14 00:00:00.0,"Клиенты обращаются с тем, что у них неправильно рассчитана УЦ.
 Предоставляют либо верно составленный калькулятор, либо скрин или сам брокерский отчёт с подтверждением цены зачисления.

Запуск pereschet_cen.sql по клиенту и активу не пересчитывает УЦ.

Клиент ГС RU000A0BLWD7, цб NKHP (ISIN RU000A0BLWD7).

Отображается УЦ = 1054
 !image-2023-12-25-21-44-20-631.png!

 Пересчёт даёт УЦ = 1002
 !image-2023-12-25-21-46-21-078.png!

!image-2023-12-25-21-50-32-391.png!
 Клиент предоставляет калькулятор:
 !image-2023-12-25-21-53-28-458.png!

Альтернативный расчёт показывает:
 !image-2023-12-25-21-52-04-451.png!

Таким образом видим, что *алгоритм пересчёта* ""останавливается"" на сделке помеченной оранжевым с УЦ = 1002 и *не учитывает неурегулированные* (дата урегулирования 2023-12-26) *сделки*. *Является ли это стандартным поведением?*",,3.0,Марс
ADIRINC-1429,4083215,U_M20XK,NEW,22.12.2023 16:27,,,,,Дефект промсреды,,2024-02-12 00:00:00.0,"Доработать алгоритм сохранения налоговой детализации, чтобы рублёвая сумма (SumR) соответствовала сумме в валюте, умноженной на курс валюты (CumCURR*COURSE).

Пример ГС 4339296, актив VTBY.

!image-2023-12-22-16-29-30-744.png!

Скрипт:

select top 100 iid.SumR,iid.SumCURR,iid.COURSE,Amount = iid.SumCURR*iid.COURSE,iid.curr_codeselect top 100 iid.SumR,iid.SumCURR,iid.COURSE,Amount = iid.SumCURR*iid.COURSE,iid.curr_code,a.curr_code,a.*from a_hell_opers.dbo.a_all_transfers trf    left join hell.tax.interface_income_detail iid with(nolock) on iid.trn_no = trf.trn_no and iid.IsCheck = 'y'    join hell.dbo.actives a on a.p_code = trf.p_codewhere 1=1and trf.treaty = 4339296and trf.a_date >= '20220321'and trf.trn_no in (17925108)

SumR вместо CumCURR*COURSE для валютных активов отображается в брокерском отчёте, в результате чего клиент необоснованно рассчитывает на иную учётую цену, нежели ему считает алгоритм расчёта учётных цен.

!image-2023-12-22-16-35-27-548.png!

 Также нужно исправить SumR в исторических данных.

 ",,,Сириус
ADIRINC-1427,4082026,U_M1QLD,NEW,22.12.2023 13:49,,,,,Дефект промсреды,,2024-03-27 00:00:00.0,"Лимитная заявка выставляется как стоп-маркетная.

Клиент выставлял лимитную заявку, при подтверждении она сработала как стоп-маркетная.
Заявка от 26.06. под номером 43570839484
Видео от клиента во вложении Video_klienta

Просьба обратить внимание на то, что в начале видео он двигает плашку на графике для выставления заявки и заявка отображается как лимитная (независимо от того, выше или ниже стоимость клиента, чем рыночная), а затем при выставлении заявки на цену ниже, чем рыночная, заявка резко меняется на стоп-маркетную.

Данная ошибка воспроизводится если двигать цену на графике медленно, если двигать полоску завки быстро - тип торгового приказа не изменяется. 

Также проверили на своих устройствах, ситуация аналогичная.[^Video_klienta.mp4][^Video_sotr.MP4]

 ",,,Appalachians
ADIRINC-1426,4081664,U_M1DKF,Закрыт,22.12.2023 12:48,Фронт,,,,Дефект промсреды,16.02.2024 17:09,2024-03-04 00:00:00.0,"В обезличке МТ fresh ideas после восстановления пароля не перекидывает в авторизацию в МТ, а открывает авторизацию в ЛК.
Действия:
Клиент заходит в приложение, жмет ""войти по-другому"" - > ""не знаю логин и пароль""
После клиент восстанавливает пароль, вводит фио, номер телефона, после вводит смс. Придумывает пароль - > Всплывает окно ""Отлично, мы запомнили ваши логин и пароль"" -> После открывается авторизация в ЛК, вместо авторизации в МТ, но это не понятно пока клиент не введет логин и пароль и не увидит что у него октрылось.",,,НТФ (ЛК)
ADIRINC-1425,4081582,U_M1AYY,Закрыт,22.12.2023 12:36,,,,,Дефект промсреды,07.02.2024 16:13,2024-02-12 00:00:00.0,"После корп.действий, таких как конвертация, если цб хранилась не на нулевом (-000) счёте, она перекладывается на нулевой (-000) счёт клиента.
 Алгоритм пересчёта учётных цен в настоящий момент не учитывает такую ситуацию, когда одновременно с заменой ценных бумаг происходит и изменение счёта.

Пример ГС 4522520. Конвертация цб MARGad (ISIN US5603172082) на VKCO (ISIN RU000A106YF0). MARGad были на счёте 4522520-001, VKCO после конвертации оказались на 4522520-000.

Прошу:
 1). исправить алгоритм корп.действий, чтобы во время конвертаций счёт не изменялся.

2). исправить алгоритм расчёта учётных цен, чтобы он предусматривал
 изменение счёта во время корп. действий для правильного расчёта УЦ по уже совершённым корп.действиям.

 ",,,Марс
ADIRINC-1424,4080689,RUM1BPH,Отклонен,22.12.2023 10:58,,,,,Дефект промсреды,16.05.2024 10:53,2024-03-22 00:00:00.0,"Коллеги, 06.11.2023 наблюдалось разное отображение текущих цен во вкладке портфель и ""при проваливании"" на конкретную цб
 Клиент ГС 4351640 в детализации по бумаге клиент видел текущую цену с проходиших торгов
 !image-2023-11-15-22-35-26-390.png!
 А на вкладке Портфель видел цену закрытия 03.11
 !image-2023-11-15-22-36-23-925.png!

Чем можно объяснить такое различие? Нет ли такого, что закладка Портфель ""думает"", что сегодня выходной день и ""не ищет"" текущие котировки с торгов?

 ",,3.0,
ADIRINC-1423,4079303,U_M1DQU,Отклонен,21.12.2023 19:29,,,,,Дефект промсреды,10.01.2024 15:22,2024-02-12 00:00:00.0,"У клиента при выставлении заявки отображается, что доступно 4 лота за собственные средства, но при попытке отправить поручение на 1 лот заявка отбивается из-за лимитов",,,Everest
ADIRINC-1420,4077733,U_M1AYY,Отклонен,21.12.2023 13:15,,,,,Дефект промсреды,19.01.2024 09:24,2024-01-09 00:00:00.0,"Пример по клиенту** +_*AKPNP3 4375253*_+ 
 +_*Анализ предоставлен по ISIN*_+  (ошибка воспроизводится по всем переведенным активам)
|+_*US00206R1023*_+|

У клиента отображается некорректная цена покупки по заблокированным активам 
 !image-2023-12-21-13-09-20-758.png!

Вместо цены покупки отображается цена актива ($23.98) на момент перевода бумаг с ИИС на брокерский счёт (01.06.2023), т.е не учитываются из налоговой детализации (
|iid.Price = $18,22000000000000000; iid.SumCurr = $18,22|

)
 !image-2023-12-21-13-10-08-508.png!

Должна быть цена 18.22, а у нас 23.98, что является ошибкой. (_+точечное исправление в данном случае не подходит, необходимо устранять ошибку в логике расчетов+_)

+_*Необходимо устранить*_ *_ошибку_* _*в алгоритме,*_+ расчета УЦ по инструментам, +_*в момент*_+ +_*перевода активов*_+",,6.0,Марс
ADIRINC-1419,4074588,U_M1SK9,Закрыт,20.12.2023 16:23,,,,,Дефект промсреды,25.01.2024 15:51,2024-02-08 00:00:00.0,"Возник расинхрон данных по инструментам параметра ""квал"".
На примере инструмента BMG9349W1038
В БД у имеется поле с признаком ""квал"" по инструменту, по полю QInvestor
но при этом поле qualinvestback имеет значение 0
!image-2023-12-20-16-19-09-460.png!
 
В Альфа-Админ и Костыле у нас отсутствует данная информация по инструменту:
!image-2023-12-20-16-20-18-761.png!
!image-2023-12-20-16-20-31-728.png!

На МосБирже, данный инструмент ""квал""
!image-2023-12-20-16-21-23-391.png!

!image-2023-12-20-16-22-07-512.png!
+_*Необходимо отображать корректные данные*_+ 



 

 ",,2.0,
ADIRINC-1418,4074568,U_M177U,Закрыт,20.12.2023 16:11,,,,,Дефект промсреды,23.01.2024 15:53,2024-02-29 00:00:00.0,"Возникает ошибка при попытке провалиться в раздел ""Маржинальное кредитование"" из Портфель. (см. скриншот 1)
!1.png!

ошибка связана со значениями, который возвращает сервис 
portfolio-analytics-api
(см. скриншот 2)
!2.png!
!3.png!

+_*Требуется исправить ошибку и обеспечить возможность входа в раздел ""Маржинальное кредитование""*_+",,2.0,Montblanc
ADIRINC-1416,4066540,U_M1DKL,На исправление,19.12.2023 14:13,,,,,Дефект промсреды,,2024-02-28 00:00:00.0,"У клиента отображается некорректный тариф счета. 
 Отображается ""Персональный"" (см. сркиншот 1) должен отображаться ""Трейдер"".
 !1.png!

[http://adlog1/kibana/goto/cffde9f0-9e5f-11ee-9fe4-77fadf634ec0]



При этом в БД и других наших данных отображается Трейдер. (см. скриншоты ниже)
 !2.png!
 !3.png!
 !4.png!

Изменений тарифа не было:
 !image-2023-12-19-14-10-18-404.png!
 !image-2023-12-19-14-11-39-291.png!
 !image-2023-12-19-14-11-57-112.png!
 --Изменения по счету
 SELECT
 TOP 1000 *
 FROM
 [hell].[dbo].[account_change_log]
 WHERE
 treaty = 854468 
 ORDER BY
 db_time DESC

SELECT t.*, a.*
 FROM [hell_cache].[hell].[accounts] a WITH (SNAPSHOT)
 JOIN [hell_cache].[hell].[tarifs] t on t.tp_id=a.tp_id
 WHERE treaty=854468

_*Необходимо устранить ошибку и отображать корректный тариф клиенту.*_",,4.0,Matterhorn
ADIRINC-1415,4065065,U_M0VYR,На исправление,19.12.2023 11:23,,,,,Дефект промсреды,,2024-02-07 00:00:00.0,"Клиент пытается открыть ИИС.
Ожидаемый результат: ИИС открывается
Фактический результат: Ошибка ""Нужен второй заход""
В логах у клиента возникает ошибка Sequence contains more than one matching element при попытке сформировать запрос на биржу. В запросе на биржу должен быть только серия номер паспорта, но у клиента в системе банка стоят два актуальных ДУЛа - паспорт и (вроде) СНИЛС, с кодом вида ДУЛ 001 - Паспорт гражданина РФ и 091 - Иные документы соответственно. По клиенту выходят два номера ДУЛ, от того и ошибка. В последствии чего возникает 404 ошибка и как итог ""Не найден номер паспорта по параметру pin: Q44565.""
Вероятно необходимо делать выбор по ""ucd"":""001"" и грузить только этот вид документа в приоритете по клиенту, если такого нет, то смотреть иные ucd - код вида документа",,5.0,
ADIRINC-1413,4063448,U_M1W4D,Отклонен,18.12.2023 17:27,,,,,Дефект промсреды,17.01.2024 15:19,2024-02-06 00:00:00.0,"156369 ABR8HT
В интерфейсе DT в Позиции отображается некорректная сумма после запятой.
Должно быть 2 знака вместо 6 (см. скриншоты ниже)
!image-2023-12-18-17-03-21-114.png!
!image-2023-12-18-17-03-46-077.png!



_+*Необходимо устранить ошибку и отображать данные корректно*+_",,1.0,
ADIRINC-1412,4063446,U_M1AYE,Закрыт,18.12.2023 17:27,,,,,Дефект промсреды,26.01.2024 14:32,2024-04-10 00:00:00.0,"У клиента в маржинальном кредитовании отображаются данные, не совпадающие с расчетами ЛС + при кейсе с требованиями внутри баннера нет информации о сумме требований

Примеры на скринах

Сам запрос ПК возвращает 

""marginParams"": [
 {
 ""nameBalanceGroup"": ""РЦБ"",
 ""liquidActivesCost"": 1369944.58300000,
 ""startMargin"": 1352606.123000000000,
 ""minMargin"": 676303.0615000000000,
 ""adjustedMargin"": 1352606.11875,
 ""adjustedLiquidActivesCost"": 1340898.27225395,
 ""fundingCost"": 28873.2623960548,
 ""requirements"": 0,
 ""immediateRequirements"": 0
 }
 ]

И эти данные не попадают ни под один описанный кейс в документации

https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=1329243850",,3.0,Montblanc
ADIRINC-1411,4062895,U_M25TF,На исправление,18.12.2023 16:55,Фронт,,,,Дефект промсреды,,2024-02-06 00:00:00.0,"AVTLG3 4327768
В приложении АИ обнаружено некорректное заполнение полей ""номинал"" и ""нкд""  во вкладке ""Сводка"" в связи с чем клиенты не могут приобрести облигации.
на примере ISIN RU000A105658

На  18.12.2023 МосБирже данный инструмент обладает данными:
Номинал: 499,96 
НКД: 2.58
(См скриншот1)
!1.png!

При это в приложении АИ отображаются некорректные данные:
Номинал: 944,44
НКД: 2,58
(см. скриншот 1)
!2.png!

При этом в БД у нас хранятся данные соответствующие данным МосБиржы (сбонс)
(см. скриншот 3 и 4)

!3.png!

!4.png!

 

+_*Необходимо устранить ошибку, исправить некорректное отображение в приложении АИ и сообщить, откуда и по какой причине тянутся некорректные данные*_+

 ",,93.0,Appalachians
ADIRINC-1409,4061017,RSRamazanov@investlab.tech,Закрыт,18.12.2023 12:19,,,,,Дефект промсреды,31.01.2024 11:57,2024-02-06 00:00:00.0,"В МТ не проставляется рынок по инструментам, у которых единственный рынок\лик. рынок SPBEX_USD. 

Пример бумаги: ""isin"": ""LU2607735342"",
 ""symbolObject"": ""ARVLA""

В логах ЛИБЫ позиция присутствует 

AD.Core.Source.TradePositionsSource2 onClientSubAccPositionEntity id:96603155 ARVLA(828018) | idAccount:114823 backPos:39 nalPos:39 idfiUchPriceTOM:149262

Но рынок не проставлен

AD.Core.Source.TradePositionsSource2.Data pos ARVLA 96603155 setMarketBoard marketBoard=not_found
AD.Core.Source.TradePositionsSource2.Data for pos ARVLA 96603155 not found instrument=

При этом multi-markets возвращает

[
 {
 ""isin"": ""LU2607735342"",
 ""symbolObject"": ""ARVLA"",
 ""exchanges"": [
 {
 ""id"": ""SPBEX"",
 ""markets"": [
 {
 ""id"": ""SPBEX_USD"",
 ""name"": ""СПБ""
 }
 ],
 ""liquidMarketId"": ""SPBEX_USD"",
 ""liquidMarketName"": ""СПБ""
 }
 ],
 ""defaultExchangeId"": ""SPBEX""
 }
]

 ",,1.0,
ADIRINC-1407,4058238,U_M1DQU,Закрыт,15.12.2023 16:55,,,,,Дефект промсреды,26.01.2024 10:56,2024-04-09 00:00:00.0,"На МТ Андроид 2.27.1 при попытке входа на раздел ""Заявка"" по фьчерсному контракту HANG-12.23 - ошибка ""Потрясите устройство, чтобы написать в поддержку""
 НЕ ВОСПРОИЗВОДИТСЯ на лайт версии и на более старых версиях приложений.
Проблема наблюдается  в день экспирации фьюча.",,6.0,Everest
ADIRINC-1406,4057617,U_M1CUE,Закрыт,15.12.2023 16:29,,,,,Дефект промсреды,12.07.2024 07:46,2024-04-09 00:00:00.0,"В результате уязвимости происходит раскрытие данных об операциях других клиентов.

Используемый при этом URL:

[https://alfainvest.alfabank.ru/invest/api/v1/history/operations?subAccount=*3067001*-000&dateFrom=2021-08-25T21%3A00%3A00.000Z&dateTo=2023-09-25T20%3A59%3A59.999Z&assetIdType=ID_OBJECT&maxElements=100&operationTypes=E%2CD%2CS],

где *[3067001|https://alfainvest.alfabank.ru/invest/api/v1/history/operations?subAccount=3067001-000&dateFrom=2021-08-25T21%3A00%3A00.000Z&dateTo=2023-09-25T20%3A59%3A59.999Z&assetIdType=ID_OBJECT&maxElements=100&operationTypes=E%2CD%2CS] -* значение ** параметра [subAccount|https://alfainvest.alfabank.ru/invest/api/v1/history/operations?subAccount=3067001-000&dateFrom=2021-08-25T21%3A00%3A00.000Z&dateTo=2023-09-25T20%3A59%3A59.999Z&assetIdType=ID_OBJECT&maxElements=100&operationTypes=E%2CD%2CS], подверженного перебору.

пример запроса

GET /invest/api/v1/history/operations?subAccount=3067001-000&dateFrom=2021-08-25T21%3A00%3A00.000Z&dateTo=2023-09-25T20%3A59%3A59.999Z&assetIdType=ID_OBJECT&maxElements=100&operationTypes=E%2CD%2CS HTTP/1.1Host: alfainvest.alfabank.ruUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/116.0Accept: */*Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflate, brReferer: [https://trade.alfadirect.ru/]Origin: [https://trade.alfadirect.ru|https://trade.alfadirect.ru/]Sec-Fetch-Dest: emptySec-Fetch-Mode: corsSec-Fetch-Site: cross-siteAuthorization: Bearer redactedTe: trailersConnection: keep-alive
 
 Ссылка на видео: [https://alfabox.alfabank.ru/a/HLO6hDWzupkOs7qL/4e83bbcd-0625-4d1c-90de-50e19e383228?l]Пароль: a5u.u3VY",,,Montblanc
ADIRINC-1405,4057616,U_M1CUE,Закрыт,15.12.2023 16:26,,,,,Дефект промсреды,12.07.2024 07:47,2024-04-09 00:00:00.0,"Нарушитель имеет возможность получить данные о портфелях других пользователей

Используемый при этом URL:

[https://alfainvest.alfabank.ru/invest/api/v1/portfolio-analytics/report?accountId=*773638*&dateFrom=2023-08-26&dateTo=2023-09-26],

 

где [*773638*|https://alfainvest.alfabank.ru/invest/api/v1/portfolio-analytics/report?accountId=773638&dateFrom=2023-08-26&dateTo=2023-09-26] *-* значение ** параметра [accountId|https://alfainvest.alfabank.ru/invest/api/v1/portfolio-analytics/report?accountId=773638&dateFrom=2023-08-26&dateTo=2023-09-26], подверженного перебору.

 

Шаги для воспроизведения:
 # Авторизоваться в web.alfabank.ru
 # Перейти в [https://trade.alfadirect.ru/portfolio/analytics]
 # Посмотреть запросы в логах прокси-сервера
 # Увидеть, что есть запросы к alfainvest.alfabank.ru
 # Запрос с исходныи идентификатором - [https://alfainvest.alfabank.ru/invest/api/v1/portfolio-analytics/report?accountId=*773638*&dateFrom=2023-08-26&dateTo=2023-09-26]

 ",,,Уран
ADIRINC-1404,4052506,U_M1FE1,Закрыт,14.12.2023 14:26,,,,,Дефект промсреды,16.04.2024 12:30,2024-02-02 00:00:00.0,"по инструментам, например RU000A102HU3 наблюдаются отличия даты оферты по отношению с МосБиржей
!image-2023-12-14-14-25-23-741.png!

!image-2023-12-14-14-25-43-787.png!

Требуется устранить ошибку отображения данных.",,5.0,Сатурн
ADIRINC-1403,4051681,U_M1W4D,Закрыт,14.12.2023 12:54,,,,,Дефект промсреды,07.02.2024 11:10,2024-02-02 00:00:00.0,"Клиент 4950579
1. Клиент пополнил инвесткопилку 10 числа, почему по нему не было сформировано поручение на БПИФ 11 числа утром?
2. Поручение было сформировано только в 22:52, В соответствии с документацией [https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=660778449] , запускается 5 раз в день, но по логам сервис работает по непонятным интервалам, подскажите, какой интервал и нормальное ли поведение сервиса ?
скриншоты ниже
[http://adirelkprod.alfadirect.ru/goto/23d1912ad96640b87b65aea6c73ad2bb]
[https://alfaadmin/reporting/orders/4950579-000/50941036484/1]
!image-2023-12-14-12-50-11-019.png!

!image-2023-12-14-12-50-31-441.png!
!image-2023-12-14-12-50-50-091.png!

!image-2023-12-14-12-51-08-451.png!
!image-2023-12-14-12-51-23-894.png!",,202.0,
ADIRINC-1402,4051669,U_M1VL7,Закрыт,14.12.2023 12:39,Фронт,,,,Дефект промсреды,18.04.2024 09:57,2024-02-02 00:00:00.0,"У клиента 224755 AAO0LH отображается некорректная дата прибыли (прошедшая) с отрицательной прибылью в Калькуляторе доходности
 !image-2023-12-14-12-36-12-815.png!
 !image-2023-12-14-12-37-30-065.png!

Необходимо отображать клиенту корректную дату прибыли с корректной суммой прибыли.
 ссылки:
 [http://adirelkprod.alfadirect.ru/goto/b06486785298e9a1a39b4cd057b65115]",,14.0,Elbrus
ADIRINC-1398,4048379,U_M1F32,Закрыт,13.12.2023 13:26,,,,,Дефект промсреды,25.01.2024 11:14,2024-02-21 00:00:00.0,"При прохождения тестирования/оценки риск-профиля, возникает ошибка.
!1.png!

логи и текст ошибки:
[http://adirelkprod.alfadirect.ru/goto/9af93c64e93fd93901eabe614eab10ab]

[https://rc.alfa-bank.net/channel/adir_admins_public?msg=tgbLqQEbeQzd7rEsw]

{""errors"":[{""status"":400,""code"":""validationError"",""detail"":""Invalid form answers: В ответах содержатся недопустимые поля: agreement."",""title"":""Ошибка обработки данных"",""meta"":{""jexceptionMsg"":""class org.springframework.validation.beanvalidation.SpringValidatorAdapter$ViolationObjectError: [org.springframework.context.support.DefaultMessageSourceResolvable: codes [calculateProfileRequest.,]; arguments []; default message [], true]""}}]}

 

!image-2023-12-13-13-30-36-958.png!

Необходимо устранить ошибку расчет риск-профиля после прохождения опросника.",,5.0,Meribel
ADIRINC-1397,4045274,U_M1STA,Закрыт,12.12.2023 16:30,,,,,Дефект промсреды,24.01.2024 08:33,2024-02-20 00:00:00.0,"+_*Описание:*_+

Клиент ALDHIM 1158530 
 Отображается некорректный порядок операций в истории (см. скриншот 1)
 !1.png!

+_*Выявление ошибки:*_

+По Сервису +history-api+ приходит список истории в некорректной сортировке
 Запрос: adappn2
 _{color:#505f79}[curl -X GET --location ""http://172.21.1.97:80/api/operations-history?accCode=1158530-000&assetIdType=SYMBOL_OBJECT&operationDateEnd=2023-12-12T05%3A10%3A32.918982108&codeOperationType=E&codeOperationType=D&codeOperationType=S&codeOperationType=CT&codeOperationType=CS&codeOperationType=CP&codeOperationType=CE&codeOperationType=BE&codeOperationType=DE&codeOperationType=DP&codeOperationType=TP&codeOperationType=IE&codeOperationType=OE&maxElements=100"" -H ""application/json"" -H ""Content-Type: application/json;v=2""|http://example.com/]{color}_

Поступил ответ от сервиса - (см. файл ""ответ"") 
                                           [^ответ.txt]

В котором видим воспроизведение ошибки ""некорректная сортировка"" (см. скриншот 2)
 [http://adlog1/kibana/goto/017acf30-98f1-11ee-9fe4-77fadf634ec0]

!2.png!

В соответствии описания сервиса, данные получаем из core-сервиса (см. пункт 4 на скриншоте 3)
 [https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=676763511]

!3.png!

 

При просмотре логов сервиса [http://adirelkprod.alfadirect.ru/goto/8033e03dc910df948c5b929190e45208]
 _(adir-production-dotnet-clientoperationhistory)_ [http://adirelkprod.alfadirect.ru/goto/8033e03dc910df948c5b929190e45208] выявили , что, в таблице {color:#505f79}_+[operations_cache].[hell].[payments]+_{color} имеется различие даты. (см. скриншот 4) 

 

_SELECT TOP (100) *_
 _FROM [operations_cache].[hell].[payments] WITH(nolock)_
 _Where treaty = '1158530'_

 

_SELECT TOP (100) *_
 _FROM [operations_cache].[hell].[extra_transfers] WITH(nolock)_
 _Where treaty = '1158530'_

_!4.png!_

Сервис сортирует по номеру поля +_Pay_no_+ и дате из поля +_db_date_,+ а отображает у клиента дату из поля {color:#505f79}+_setllement_date_+{color} из-за чего данные отображаются некорректно.

+_*Требуется исправить ошибку и выводить клиенту дату истории в корректном порядке*_+

 ",,1.0,
ADIRINC-1396,4043661,U_M169D,Закрыт,12.12.2023 12:33,,,,,Дефект промсреды,15.03.2024 10:38,2024-03-15 00:00:00.0,"У клиента при переводе со срочного рынка (мб и в обратную сторону) возникает ошибка ""При расчёте лимитов произошла ошибка. Обратитесь в Службу клиентского сервиса."" Ошибка возникла после обновления ЛС 30.11 ",,4.0,Ядро
ADIRINC-1393,4021850,U_M1AYY,Закрыт,06.12.2023 18:14,ОТЭИСФЛ,,,,Дефект промсреды,20.12.2023 14:25,2024-01-26 00:00:00.0,"Наблюдается проблема с тем, что в брокерском отчете наблюдаются в сотни раз завышенные значения стоимости позиции, как минимум по инструменту USP32457AA44.

Проблема находится в таблице quotes_data.PriceInfo.Prices. С 24.10.2023 начал подтягиваться номинал 200.000 вместо 1.000 из-за чего в брокерском отчете отображается стоимость позиции ~500млн руб

Запрос:
{code:java}
select top 100 p.nominal,*
from quotes_data.PriceInfo.Prices p
join hell.dbo.actives a on a.act_id = p.act_id
where 1=1
and a.p_code = 'CRSFd200723'
and p.DatePrice <= getdate()
and p.AlgorithmId = 1
order by p.DatePrice desc{code}",,0.0,
ADIRINC-1392,4020679,U_M1AYY,Закрыт,06.12.2023 16:14,,,,,Дефект промсреды,11.03.2024 09:20,2024-01-25 00:00:00.0,"1754135 AQ5POL

В портфеле и в БД имеются некорректные данные по НКД по инструментам.

Отображается сумма Т+1 в текущем дне, где Т-текущий день.
На примере ISIN RU000A1074F4
от МосБиржы пришла информация по НКД: (см. скриншот общ)
2023-12-05 - пришла информация о цене НКД на сумму НКД <nkd>7.48000000</nkd> (см. скриншот 1)
2023-12-06 -  пришла информация о цене НКД на сумму НКД <nkd>8.05000000</nkd>
(см. скриншот 2)
У Клиента 2023-12-06 в Портфеле отображается НКД на сумму 8.05, которая равна сумме НКД расчетного дня по сделке за 2023-12-07 (инф. см. на скриншоте 3 и 4 (МосБиржа))
Т.Е. у система пропустила шаг НКД на сумму 7.48 и сразу проставился НКД 8.05 сразу за два дня, за 2023-12-06 и за 2023-12-07 (см. скриншот 5)

Необходимо устранить ошибку так, что система не пропускала шаги сумм НКД",,7.0,Марс
ADIRINC-1390,4012699,U_M1BFA,Закрыт,05.12.2023 11:36,,,,,Дефект промсреды,29.02.2024 13:25,2024-01-24 00:00:00.0,"ТТ АИ 4.0 для ПК при попытке загрузить сохраненную конфигурацию - выходят пустые графики без индикаторов и прочего, даже без инструментов.

Скриншот клиента и запрошенный ранее файл конфигурации клиента прилагаю.
 Конфиг клиента во вложениях.
 !image-2023-12-05-11-40-36-068.png!",,2.0,Pro terminal
ADIRINC-1386,3986759,U_M1QX4,Закрыт,28.11.2023 16:57,,,,,Дефект промсреды,24.05.2024 14:13,2024-01-17 00:00:00.0,"Добрый день!

Проблема в отображении чистого остатка в ВТ не совпадает с остатком в Админе. Клиент направил скриншот, где отображается остаток в 999 рублей, хотя суммы такой нет на счете.

Обратился клиент AKVCZW 1443259-000 Червенков Виталий Николаевич
Но проблема воспроизводится и у меня 1416416 AR7ISH 
Некорректное отображение баланса только у первого гс (1416416), также как и у клиента
У второго гс 7506890 позиция отображается корректная ",,2.0,НТФ (ЛК)
ADIRINC-1385,3984939,U_M1FE1,Закрыт,28.11.2023 13:14,ОТЭИСФЛ,,,,Дефект промсреды,16.02.2024 14:55,2024-02-29 00:00:00.0,"По некоторым инструментам (пример: RU000A0JXNU8, RU0009046452) отображается некорректная/устаревшая информация в разделе ""Показатели""

Статья сервиса: [https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=676758805]

На примере вышеуказанных инструментов при вызове эндпоинта /api/emitent возвращаются следующие из обнаруженных некорректные значения:

RU000A0JXNU8:
{quote}""debtVsEbidta"": 561.86909,
{quote}
RU0009046452:
{quote}""mktcap"": 1182104.65,
{quote}
 

Соответствующая информация находится в news_cache:

select mktcap, debt_vs_ebidta,* from [news_cache].[direct].[emitents] where emitent_id in ( select emitent_id from [news_cache].[direct].[instruments] where isin in ('RU0009046452','RU000A0JXNU8'))",,11.0,Сатурн
ADIRINC-1384,3982858,U_M0A0R,Закрыт,28.11.2023 10:23,,,,,Дефект промсреды,28.11.2023 10:29,2023-11-30 00:00:00.0,"В процедуре [kafka.import_actives_trade_marketboards_u|https://rc.alfa-bank.net/file-upload/toDudHCFf9LXrJGMH/kafka.import_actives_trade_marketboards_u.sql?download] некорректно определяется idfi инструмента, что привело к аварии IM15558072
https://rc.alfa-bank.net/channel/adir-avarii?msg=5eq7n5LqvDA4smYqc
Из-за этого у клиентов возникли некорректные срочные требования",,,
ADIRINC-1381,3969326,U_M1BFA,Закрыт,24.11.2023 12:28,,,,,Дефект промсреды,27.02.2024 10:38,2024-01-15 00:00:00.0,"Клиент: Рыжова Елена Петровна AP7VK4 793503
Платформа: АД 4.0
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||
|eprizhova|4.0.3927.1623|9.104|10.0|1 - Windows|Micro-Star International Co., Ltd. MS-7C13|BE8FF1F77619|

У клиента после обновления терминала АД 4.0 перестал отображаться график с инструментами.
Клиент пробовал заново создать график, всё равно не отображается, так же сбрасывал конфигурации

 ",,1.0,Pro terminal
ADIRINC-1380,3965100,U_M214D,NEW,23.11.2023 15:33,,,,,Дефект промсреды,,2024-02-26 00:00:00.0,"iOS 3.5.0, 3.6.0 
 Клиент заходит в приложение -> рынки -> инструмент Сбербанк (ошибка по многим инструментам)
 ОР: в trending-instruments-api передается isin инструмента
 ФР: в trending-instruments-api  не передается isin инструмента 

У меня ошибка воспроизводится

http://adlog1/kibana/goto/9dd41480-b535-11ee-b963-8f2ab4e67d2d

!image-2023-11-23-15-32-18-773.png!",,,Fuji
ADIRINC-1378,3960570,U_M1QX4,Закрыт,22.11.2023 17:08,,,,,Дефект промсреды,27.11.2023 16:05,2024-01-31 00:00:00.0,"Наблюдаются проблемы с 14.11 с сервисом:
|*queue*|*service*|
|adir-core.client-notifications.fact.status.1|com-client-margin-call-complete|

[https://git.moscow.alfaintra.net/projects/COMMON_CORE_DOTNET/repos/com-client-margin-call-complete/browse]

[https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=1168385614]

Пример ошибки:
|id|queue_name|error_code|error_text|request_uid|msg|error_date|service_name|
|30457929|adir-core.client-notifications.fact.status.1|The JSON value could not be converted to App.Models.Channel. Path: $.ContentType \| LineNumber: 0 \| BytePositionInLine: 216.|UNHANDLED_ERROR|5DB3F42B-ABE1-49F3-8747-61121BFBB101|{""DtInsert"":""2023-11-22T15:23:04.5004114+03:00"",""MsGuid"":""ff9da817-611c-46cd-ad96-6e68ab6a3292"",""System"":""CorpActMoneyEnricher"",""Event"":""CouponPayment"",""ClientIdType"":""PIN"",""ClientId"":""AIT2F4"",""ContentType"":""IM_PUSH"",""Message"":""\u002B 11.10 RUR. \u041F\u043E\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0435 \u043A\u0443\u043F\u043E\u043D\u043E\u0432 \u043F\u043E \u043E\u0431\u043B\u0438\u0433\u0430\u0446\u0438\u044F\u043C \u0415\u0432\u0440\u043E\u0422\u0440\u0430\u043D\u0441 \u043E.\u043A.\u0431. \u0441\u0435\u0440\u0438\u0438 001P-01"",""Status"":200,""cDataId"":""456516310879007019"",""cDataException"":null,""cDataMessage"":null,""stateCode"":null}|22.11.2023 15:23|com-client-margin-call-complete|

Тред:

[https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=zkTSNxEucy6TwTKHj]

 ",,,
ADIRINC-1375,3954257,U_M177U,Отложен,21.11.2023 14:45,,,,,Дефект промсреды,,2024-01-10 00:00:00.0,"Клиент заходит в ВТ, переходит в Аналитику портфеля - Состав портфеля - Отрасли.
Клиент видит что сумма активов меньше и обнаружил отсутствие бумаги Софтлайн, до этого так же не отображалась бумага ВК.
На скрине где обвел Софтлайн это в разделе Аналитика портфеля - Активы
ALDGH3 1025503",,2.0,Montblanc
ADIRINC-1373,3948762,U_M1DKL,Отложен,20.11.2023 14:52,,,,,Дефект промсреды,,2024-01-29 00:00:00.0,"AJT8Q2 215218
При выставлении уведомлений о цене, при вводе разделителя для ввода копеек, осуществляется два некорректных алгоритма:
1) при нажатии на точку, каретка остается перед точкой
2) при нажатии на запятую, разделитель не проставляется, а каретка перемещается на один символ влево
(см. запись экрана)",,4.0,Matterhorn
ADIRINC-1371,3948209,U_M214D,На исправление,20.11.2023 14:15,,,,,Дефект промсреды,,2024-03-13 00:00:00.0,"AVTG69 4320623
Во вкладке ""Избранные"" возникает ошибка ""Ошибка загрузки. Не удалось получить котировки. Попробуйте позже."" (во вложении скриншоты и логи)
APP_ID: sync-user-settings-api

http://adlog1/kibana/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:'2023-11-13T15:23:47.606Z',to:'2023-11-13T15:25:40.814Z'))&_a=(columns:!(message,level,app_id,request_uri),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!t,index:c86b4360-0ca6-11ec-93ad-93845fce08b0,key:level,negate:!f,params:(query:ERROR),type:phrase),query:(match_phrase:(level:ERROR))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:c86b4360-0ca6-11ec-93ad-93845fce08b0,key:traceId,negate:!f,params:(query:'6fe84ad416b5263d'),type:phrase),query:(match_phrase:(traceId:'6fe84ad416b5263d'))),('$state':(store:appState),meta:(alias:!n,disabled:!f,index:c86b4360-0ca6-11ec-93ad-93845fce08b0,key:spanId,negate:!f,params:(query:'6fe84ad416b5263d'),type:phrase),query:(match_phrase:(spanId:'6fe84ad416b5263d')))),index:c86b4360-0ca6-11ec-93ad-93845fce08b0,interval:auto,query:(language:kuery,query:''),sort:!(!(syslog_timestamp,desc)))",,22.0,Kilimanjaro
ADIRINC-1369,3943526,,Отклонен,17.11.2023 16:59,,,,,Дефект промсреды,10.01.2024 10:04,2024-02-19 00:00:00.0,"Добрый день, задача по АИ

У сервисов adir-k2db-forts-positions-post-trade , при работе возникают ошибки типа - Ошибка при сохранении в БД Недопустимый идентификатор счета с биржи

Ссылка на сервис - https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=1036196961

Ссылка на графану- https://grafana.alfadirect.ru/d/OJGbvT8nk/metriki-dlia-etl-servisov-net?orgId=1&var-datasource=gLBdput7z&var-env=prod&var-service=adir-k2db-forts-positions-post-trade&var-instances=All&var-status=All&var-actions=All&var-perc=50&from=now-15m&to=now

Ссылка на ЕЛК - http://adirelkprod.alfadirect.ru/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:now-15m,to:now))&_a=(columns:!(level,message),filters:!((&#39;$state&#39;:(store:appState),meta:(alias:!n,disabled:!f,index:a898b3c0-20d7-11ec-81d9-f956519bb053,key:level,negate:!f,params:(query:Error),type:phrase),query:(match_phrase:(level:Error)))),index:a898b3c0-20d7-11ec-81d9-f956519bb053,interval:auto,query:(language:kuery,query:&#39;_index:%20adir-production-dotnet-k2db-post-trade-hell-forts-positions&#39;),sort:!(!(&#39;@timestamp&#39;,desc)))",,,
ADIRINC-1364,3925756,U_M25TF,На исправление,14.11.2023 12:48,,,,,Дефект промсреды,,2024-02-14 00:00:00.0,"В некоторых вызовах сервиса adir-metrics-api передается пустой operType, что некорректно.
!image-2023-11-14-12-47-38-829.png!",,,CoreMT
ADIRINC-1363,3921318,U_M214D,Закрыт,13.11.2023 16:21,,,,,Дефект промсреды,06.03.2024 15:47,2024-01-22 00:00:00.0,"В приложении отображаются неактивные инструменты в разделе ""Рынки"" - ""Акции""
Пример MAIL@GS. (см. сркиншот 1)

При проваливании в инструмент, возникает ошибка (см. скриншот 2)",,9.0,Fuji
ADIRINC-1361,3912239,U_M0SLM,NEW,10.11.2023 13:26,,,,,Дефект промсреды,,2023-11-21 00:00:00.0,"У клиента А-клуб в отчете тянется неправильная процентная ставка по свопам

Расчет происходит правильный, неправильно тянутся данные в брокерский отчет: вместо 13 тянется 15

Проблема в [https://git.moscow.alfaintra.net/projects/ADIR_SQLDB/repos/ssrs_reports/browse/ssrs_reports/Stored%20Procedures/RB.trades_basic_get.sql#474]

Не происходит корректного матчинга с hell.repo_personal_yield из-за фильтра по curr_code",,,Core
ADIRINC-1360,3903013,U_M1P1L,NEW,08.11.2023 18:20,,,,,Дефект промсреды,,2023-11-20 00:00:00.0,"У клиента при открытии счета из всех терминалов возникает ошибка функциональности.

Проблема возникает при вызове сервиса CMS /rest/account/4201214/confirmation
 * Error: \{""apiVersion"":""2"",""requestId"":""1b3124a3-838d-4ddf-97db-42967013957d"",""requestSource"":""ADIRLK"",""userCode"":""LKUSER01"",""errorDateTime"":""2023-11-07T15:08:52.5102027+03:00"",""serviceName"":""AlfaInvestment.Nontrading.Service"",""errorCode"":""50011"",""errorMessage"":""Для @treaty=4201214 не найден зарезервированный счет"",""severity"":0}
  
 [https://git.moscow.alfaintra.net/projects/ADIR_CORE/repos/adir-client-management-restapi-service/browse]
 [http://adirelkprod.alfadirect.ru/goto/16e1bb538ad4cda79b4de33b49b82a8b]
  

Причина ошибки - матчинг с dbo.managers по ank_no, а у клиента две записи, из-за чего вызов процедуры падает

[https://git.moscow.alfaintra.net/projects/ADIR_SQLDB/repos/hell/browse/Hell/Stored Procedures/client.SetClient.sql|https://git.moscow.alfaintra.net/projects/ADIR_SQLDB/repos/hell/browse/Hell/Stored%20Procedures/client.SetClient.sql]",,,Меркурий 7
ADIRINC-1358,3898931,U_M177U,Закрыт,07.11.2023 18:30,,,,,Дефект промсреды,15.05.2024 15:51,2024-01-17 00:00:00.0,"Клиент 26362 ABKFUJ
 Платформа: МТ 2.26.1 андроид
deviceModel: samsung SM-X700
При попытке перехода в раздел перевод между счетами приложение  *предположительно* крашится и начинает мигать экран.
 Предполагалось что проблема в ЛК, но разработчикам ЛК воспроизвести подобное поведение на доступных устройствах не удалось и по видео проблема явно возникает не в ЛК",,,Montblanc
ADIRINC-1357,3897794,U_M18H1,Закрыт,07.11.2023 16:08,,,,,Дефект промсреды,07.02.2024 15:36,2024-01-16 00:00:00.0,"Платформа: МТ IOS

Версия: 3.5.0

У клиент в разделе Безопасность появляется красная точка на электронной подписи ( 1-2 скрин)

При этом, когда переходишь в разделе ""Электронная подпись"", то написано, что она активна ( 3 скрин)

В ПО Админ сертификат также действителен ( 4 скрин)

После пересоздания сертификата красная точка пропадает, но через некоторе время снова появляется, при этом электронная подпись активная.
После просмотра сертификата, красная точка тоже пропадает.",,6.0,Everest
ADIRINC-1356,3897327,U_M1UN1,Закрыт,07.11.2023 15:36,,,,,Дефект промсреды,15.11.2023 16:22,2023-11-10 00:00:00.0,"При входе в мобильный терминал альфа-инвестиций у клиентов участились случаи, когда у них просто висит белый экран и ничего не происходит. Базовые рекомендации в виде перезахода, переустановки, переподключения с другой сети не помогают

Примеры клиентов:
ANSJ6K
AXMLL4
K62699
AVW0X9
AA5WTG",,54.0,
ADIRINC-1354,3893502,U_M1QX4,Отклонен,06.11.2023 17:05,,,,,Дефект промсреды,21.11.2023 11:42,2024-01-16 00:00:00.0,"Клиент: Дакунин Виктор Владимирович AMOKVL 2333044

Платформа: МТ Андроид
Версия: 2.26.1

Описание Клиент через АМ (версия 12.05.06) выставил заявку на покупку акций ВТБ

В АМ цена за 1 лот = 200,6 руб. 
На бирже цена за 1 лот акций ВТБ на тот момент была 255.5 руб., что отличается от цены указанной в АМ.

Клиент выставил заявку, но она исполнилась по рыночной цене, а не по той, которая указана в АМ 
При этом в приложении АМ на своём устройстве цена указывается корректно

 ",,,Мобильный терминал
ADIRINC-1353,3893733,U_M18JH,Отклонен,06.11.2023 11:38,,,,,Дефект промсреды,06.03.2024 15:20,2023-12-19 00:00:00.0,"Клиент из раздела ещё пытается подключить срочный рынок, но фронт не собирает экран",,2.0,Мобильный терминал
ADIRINC-1352,3891366,U_M1BFA,Закрыт,03.11.2023 14:52,,,,,Дефект промсреды,27.02.2024 10:39,2024-03-05 00:00:00.0,"Некорректное отображение графика в АИ 4.0 Серый Валерий Константинович 138310 AO4D9T
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||FE1DisconnectTime||FE2DisconnectTime||FE3DisconnectTime||FE4DisconnectTime||
|vseriy|4.0.3927.1623|9.104|10.0|1 - Windows|LENOVO 81N8|1063C867B6A5|03.11.2023 12:57:00|5.16.37.149| | | | |


У клиента в торговом терминале Альфа-Инвестиции 4.0 некорректно отображаются графики, на которых не отображаются позиции.
Также в графике (новая версия) при виде свечей Heiken Ashi, то цена инструмента отображается неправильно.",,,Pro terminal
ADIRINC-1351,3888896,U_M1QX4,Закрыт,03.11.2023 13:00,,,,,Дефект промсреды,24.10.2024 10:27,2024-02-06 00:00:00.0,"Отсутствие возможности просматривать котировки драг. металлов в Веб-терминале, при выборе чёрный экран",,3.0,Web
ADIRINC-1350,3877210,U_M1QLD,Принят к исправлению,03.11.2023 11:08,График,Инвестиции,,,Дефект промсреды,,2024-02-06 00:00:00.0,"При наведении на детализацю на точке покупки на графике в режиме Lite - цена для облигаций отображается в рублях, а должна в % 

!image-2023-11-03-11-00-56-766.png|width=264,height=595!",,3.0,Мобильный терминал
ADIRINC-1349,3862487,U_M1AYE,Закрыт,02.11.2023 16:23,,,,,Дефект промсреды,29.01.2024 11:43,2023-12-15 00:00:00.0,"У клиента не отображается CH0103326762, бумага добавлена в hell и adfront, но не считается ликвидный рынок, из-за чего в терминале она позиция не отображается

 

declare @idobject int = 829785

SELECT * FROM ADFront.ts.Objects
WHERE IdObject = @idobject
SELECT * FROM ADFront.Liquidity.TradeMarketBoards AS tmb
WHERE 1=1
AND IdObject = @idobject

SELECT * FROM ADFront.[Liquidity].[ExchangesManualPriority]
WHERE 1=1
AND IdObject = @idobject

SELECT * FROM ADFront.[Liquidity].[BoardsManualPriority]
WHERE 1=1
AND IdObject = @idobject",,,Core
ADIRINC-1348,3858530,U_M1DKL,На исправление,01.11.2023 18:49,,,,,Дефект промсреды,,2024-01-12 00:00:00.0,"Клиенту гс 3228090 AXT0R6 начислены подарочные акции

В БД есть по портфелю

На фронте отсутствуют

!image-2023-11-01-18-46-24-227.png!

MongoDB Enterprise invest_set:PRIMARY> db.giftsPortfolio.find(\{ userId: ""AXT0R6""  }).pretty()MongoDB Enterprise invest_set:PRIMARY> db.giftsPortfolio.find(\{ userId: ""AXT0R6""  }).pretty()\{ ""_id"" : ObjectId(""6527af3ba46fa85e42dbc389""), ""userId"" : ""AXT0R6"", ""assetId"" : ""RU000A0DQZE3"", ""ticker"" : ""AFKS"", ""market"" : ""МБ ЦК"", ""logotype"" : ""https://lk.alfadirect.ru/api/logotypes/emitents/download/idobject/283663.png"", ""quantity"" : NumberLong(3), ""costFinInstrument"" : ""17.352000"", ""giftValue"" : ""52.056000"", ""campaignId"" : ""636a5519c9ea2f00fddd2f88"", ""status"" : ""gift"", ""gettingDate"" : ISODate(""2023-10-12T08:32:58.664Z""), ""dateForSale"" : ISODate(""2024-01-20T20:59:59.999Z""), ""genAgreement"" : NumberLong(3228090), ""subAccount"" : ""3228090-000"", ""showGift"" : false, ""buyPeriodEndDate"" : ISODate(""0000-12-31T21:29:43Z""), ""entryDate"" : ISODate(""2023-10-12T08:32:59.136Z""), ""changeDate"" : ISODate(""2023-10-12T08:32:59.136Z""), ""_class"" : ""ru.alfabank.mobile.invest.gifts.repository.entity.GiftsPortfolio""}{ ""_id"" : ObjectId(""6527ae91f7ece4236f54bd37""), ""idObject"" : 385612, ""userId"" : ""AXT0R6"", ""assetId"" : ""RU000A0JR4A1"", ""ticker"" : ""MOEX"", ""market"" : ""МБ ЦК"", ""logotype"" : ""https://lk.alfadirect.ru/api/logotypes/emitents/download/idobject/385610.png"", ""quantity"" : NumberLong(1), ""costFinInstrument"" : ""182.310000"", ""giftValue"" : ""182.310000"", ""campaignId"" : ""6526fd2ff7ece4236f53d9f0"", ""status"" : ""gift"", ""gettingDate"" : ISODate(""2023-10-12T08:30:09.438Z""), ""dateForSale"" : ISODate(""2024-01-20T20:59:59.999Z""), ""genAgreement"" : NumberLong(3228090), ""subAccount"" : ""3228090-000"", ""showGift"" : false, ""buyPeriodEndDate"" : ISODate(""0000-12-31T21:29:43Z""), ""entryDate"" : ISODate(""2023-10-12T08:30:09.929Z""), ""changeDate"" : ISODate(""2023-10-12T08:30:09.929Z""), ""_class"" : ""ru.alfabank.mobile.invest.gifts.repository.entity.GiftsPortfolio""}\{ ""_id"" : ObjectId(""6527aedba46fa85e42db8122""), ""idObject"" : 827155, ""userId"" : ""AXT0R6"", ""assetId"" : ""RU000A105EX7"", ""ticker"" : ""WUSH"", ""market"" : ""МБ ЦК"", ""logotype"" : "" https://lk.alfadirect.ru/api/logotypes/emitents/download/idobject/824243.png"", ""quantity"" : NumberLong(1), ""costFinInstrument"" : ""215.350000"", ""giftValue"" : ""215.350000"", ""campaignId"" : ""6526ff6fa46fa85e42da7f25"", ""status"" : ""gift"", ""gettingDate"" : ISODate(""2023-10-12T08:31:22.704Z""), ""dateForSale"" : ISODate(""2024-01-20T20:59:59.999Z""), ""genAgreement"" : NumberLong(3228090), ""subAccount"" : ""3228090-000"", ""showGift"" : false, ""buyPeriodEndDate"" : ISODate(""0000-12-31T21:29:43Z""), ""entryDate"" : ISODate(""2023-10-12T08:31:23.221Z""), ""changeDate"" : ISODate(""2023-10-12T08:31:23.221Z""), ""_class"" : ""ru.alfabank.mobile.invest.gifts.repository.entity.GiftsPortfolio""}{ ""_id"" : ObjectId(""6527af88a46fa85e42dc0223""), ""idObject"" : 174440, ""userId"" : ""AXT0R6"", ""assetId"" : ""RU0008926258"", ""ticker"" : ""SNGS"", ""market"" : ""МБ ЦК"", ""logotype"" : ""https://lk.alfadirect.ru/api/logotypes/emitents/download/idobject/174439.png"", ""quantity"" : NumberLong(1), ""costFinInstrument"" : ""32.175000"", ""giftValue"" : ""32.175000"", ""campaignId"" : ""6527adaaf7ece4236f54340e"", ""status"" : ""gift"", ""gettingDate"" : ISODate(""2023-10-12T08:34:15.707Z""), ""dateForSale"" : ISODate(""2024-01-20T20:59:59.999Z""), ""genAgreement"" : NumberLong(3228090), ""subAccount"" : ""3228090-000"", ""showGift"" : false, ""buyPeriodEndDate"" : ISODate(""0000-12-31T21:29:43Z""), ""entryDate"" : ISODate(""2023-10-12T08:34:16.241Z""), ""changeDate"" : ISODate(""2023-10-12T08:34:16.241Z""), ""_class"" : ""ru.alfabank.mobile.invest.gifts.repository.entity.GiftsPortfolio""}\{ ""_id"" : ObjectId(""6527ae37c69f14535013f06b""), ""idObject"" : 300087, ""userId"" : ""AXT0R6"", ""assetId"" : ""RU0007252813"", ""ticker"" : ""ALRS"", ""market"" : ""МБ ЦК"", ""logotype"" : ""https://lk.alfadirect.ru/api/logotypes/emitents/download/idobject/283639.png"", ""quantity"" : NumberLong(4), ""costFinInstrument"" : ""76.370000"", ""giftValue"" : ""305.480000"", ""campaignId"" : ""6527ae1bf7ece4236f544f2b"", ""status"" : ""gift"", ""gettingDate"" : ISODate(""2023-10-12T08:28:39.404Z""), ""dateForSale"" : ISODate(""2024-01-20T20:59:59.999Z""), ""genAgreement"" : NumberLong(3228090), ""subAccount"" : ""3228090-000"", ""showGift"" : false, ""buyPeriodEndDate"" : ISODate(""0000-12-31T21:29:43Z""), ""entryDate"" : ISODate(""2023-10-12T08:28:39.837Z""), ""changeDate"" : ISODate(""2023-10-12T08:28:39.837Z""), ""_class"" : ""ru.alfabank.mobile.invest.gifts.repository.entity.GiftsPortfolio""}",,84.0,Matterhorn
ADIRINC-1347,3857655,U_M1CWM,Отклонен,01.11.2023 16:45,,,,,Дефект промсреды,22.02.2024 13:13,2023-12-14 00:00:00.0,"В поиске ВТ отсутствует фьюс BR-11.23

Хотя информация по ним приходит

https://rc.alfa-bank.net/channel/team-invest-web-terminal?msg=wodz4JqhYux3GwrJt",,2.0,Web
ADIRINC-1344,3846189,U_M177U,Отклонен,30.10.2023 17:52,,,,,Дефект промсреды,28.02.2024 14:59,2024-02-20 00:00:00.0,У клиента в избранном добавлены 4 инструмента (на скриншоте) с разной доходностью. Информация в лидерах изменений избранных указана не по тем бумагам,,6.0,Montblanc
ADIRINC-1341,3838024,U_M1CUE,Закрыт,27.10.2023 16:32,,,,,Дефект промсреды,27.05.2024 11:28,2023-12-29 00:00:00.0,"Из-за падения сервиса[  {color:#ff0000}go-client-notifications-sender{color}++{color:#ff0000}++{color}|https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=950601668]

 сервис не имел возможность выгрузить сообщения из кафки и на шлюз смс не доставлялись.

 
{code:java}
// code placeholder
2023-10-26 15:37:46.6626|TRACE|NotificationsSender.Services.InvestAlfa.AlfaInvestTransferService|Обработка полученного из Kafka сообщения..|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6626|DEBUG|NotificationsSender.Services.InvestAlfa.AlfaInvestTransferService|Десериализация сообщения из топика (см. поле «message» в logContex'е).|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6627|TRACE|NotificationsSender.Database.Repositories.HellCacheRepository|Получаем данные в справочнике.|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6628|TRACE|NotificationsSender.Database.DbContexts.HellCacheDbContext|Открывается подключение к hell_cache на LTRhell_cache.alfadirect.ru|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6629|TRACE|NotificationsSender.Database.DbContexts.HellCacheDbContext|Создается команда БД|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6630|TRACE|NotificationsSender.Database.DbContexts.HellCacheDbContext|Тип команды: 'StoredProcedure' Текст команды: '[push_ntf].[service_sender_tags_for_mfm_get]' Входные параметры: '[\{""name"":""ntf_event"",""value"":""DividendPayment""}]' |8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6636|DEBUG|NotificationsSender.Database.DbContexts.HellCacheDbContext|Команда выполнена за 00:00:00.0006551|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6638|TRACE|NotificationsSender.Database.Repositories.HellCacheRepository|Количество полученных из БД записей: 1 шт.|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6638|TRACE|NotificationsSender.Database.Repositories.HellCacheRepository|Получение одиночной записи..|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6639|DEBUG|NotificationsSender.Services.InvestAlfa.AlfaInvestTransferService|Отправка уведомления в UWS (msGuid=40497474-89d8-480b-a9a5-4bf5149dfdc2)..|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6639|DEBUG|NotificationsSender.Services.InvestAlfa.UwsMfmProvider|Начало запроса в UWS.|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6639|DEBUG|NotificationsSender.Services.InvestAlfa.UwsMfmProvider|Вызов HTTP запроса (см. текст запроса в поле «requestText» логов).|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6640|INFO|System.Net.Http.HttpClient.IUwsMfmProvider.LogicalHandler|Start processing HTTP request POST 
{code}
[http://esbws.moscow.alfaintra.net/sms/distribute/send/push/sms/v13/rest]
{code:java}
|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6641|INFO|System.Net.Http.HttpClient.IUwsMfmProvider.ClientHandler|Sending HTTP request POST 
{code}
[http://esbws.moscow.alfaintra.net/sms/distribute/send/push/sms/v13/rest]
{code:java}
|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6785|INFO|System.Net.Http.HttpClient.IUwsMfmProvider.ClientHandler|Received HTTP response headers after 14.2948ms - 200|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6787|INFO|System.Net.Http.HttpClient.IUwsMfmProvider.LogicalHandler|End processing HTTP request after 14.6692ms - 200|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6788|DEBUG|NotificationsSender.Services.InvestAlfa.UwsMfmProvider|Статус HTTP запроса (см. текст ответа в поле «responseText» логов): OK.|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.6789|TRACE|NotificationsSender.Services.InvestAlfa.AlfaInvestTransferService|Отправка ответа UWS в топик adir-core.client-notifications.fact.status.1..|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.7364|TRACE|NotificationsSender.Services.InvestAlfa.AlfaInvestTransferService|Ответ UWS отправлен в Kafka.|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:46.7376|ERROR|NotificationsSender.Services.InvestAlfa.AlfaInvestTransferService|Непредвиденная ошибка в общем цикле.|Confluent.Kafka.KafkaException Local: No offset stored at Confluent.Kafka.Impl.SafeKafkaHandle.Commit(IEnumerable`1 offsets) at AlfaDirect.KafkaUtils.Adapters.KafkaTransactionAdapter.CommitConsumer(String topicName) at NotificationsSender.Services.InvestAlfa.AlfaInvestTransferService.RequestUwsMfmAsync(UwsPushSmsRequest request, ComposedNotification composedNotification, CancellationToken token) in C:\temp\src\NotificationsSender.Services\InvestAlfa\AlfaInvestTransferService.cs:line 273 at NotificationsSender.Services.InvestAlfa.AlfaInvestTransferService.HandleNotificationAsync(CancellationToken cancellationToken) in C:\temp\src\NotificationsSender.Services\InvestAlfa\AlfaInvestTransferService.cs:line 126|8bd9ced7-4dc7-468b-9dc4-7bbd1cb1fd20 2023-10-26 15:37:49.2600|TRACE|AlfaDirect.Logging.AspNet.NLogLoggingContext|Сброшен requestId|902dccec-c00c-4010-8c3a-6d9d23efd135 2023-10-26 15:37:49.8285|TRACE|AlfaDirect.Logging.AspNet.NLogLoggingContext|Сброшен requestId|e3b2f012-c3b2-47f1-8a9c-b84b062eb5a7 2023-10-26 15:38:04.2602|TRACE|AlfaDirect.Logging.AspNet.NLogLoggingContext|Сброшен requestId|025866b4-44d2-4389-b6c6-108648442321 2023-10-26 15:38:04.8291|TRACE|AlfaDirect.Logging.AspNet.NLogLoggingContext|Сброшен requestId|9b86a1f0-a959-4a42-9225-52516146dc43 2023-10-26 15:38:19.2596|TRACE|AlfaDirect.Logging.AspNet.NLogLoggingContext|Сброшен requestId|f7fa8eb1-2f75-42ff-b604-fea3d3a989e8 2023-10-26 15:38:19.8289|TRACE|AlfaDirect.Logging.AspNet.NLogLoggingContext|Сброшен requestId|84d2578d-66d6-4d13-a755-64249e9976ba 2023-10-26 15:38:34.2598|TRACE|AlfaDirect.Logging.AspNet.NLogLoggingContext|Сброшен requestId|083be3ae-ab16-4d51-8d36-d868e1d0a5f6 2023-10-26 15:38:34.8283|TRACE|AlfaDirect.Logging.AspNet.NLogLoggingContext|Сброшен requestId|f9ce90c7-b6d3-4e18-aa07-cd5dd8ae044b 2023-10-26 15:38:49.2594|TRACE|AlfaDirect.Logging.AspNet.NLogLoggingContext|Сброшен requestId|6f5ce5cc-f96e-47e1-bc6e-23bea1488d55{code}",,,
ADIRINC-1337,3835039,U_M1RH8,Закрыт,27.10.2023 11:07,,,,,Дефект промсреды,05.04.2024 15:04,2023-12-11 00:00:00.0,"У клиентов не отменяется заявка (не присваивается 21 статус) , хотя она была помечена для удаления (присвоен 15 статус) и поручение отправлено. 

Пример
МТ 2.23.1 андроид
Заявка 49150734784 (VIP клиент AVTWIO ГС 4348256)

Клиент отправил поручение на отмену (приложил файл). В бд, по логам,  видно, что заявка помечена на удаление, тем не менее, она не отменилась.

{code:java}
DECLARE @id as BIGINT = 49150734784     

select NumEDocumentBase,OrderChannel, dtupdate,dtinsert,ExtOrderNum,Quantity,idOrderStatus, NumEDocument,ficode,limitprice,stopprice,brokercomment, price, FromFrontEndNumber,IdDocumentType, *
from [ADFrontOrders].[Logs].[Orders] o where SignTime > '2019-03-10 17:34:00.000'
and NumEDocument in (@id)     	 
order by o.DtUpdate desc
{code}

 !image-2023-10-27-11-05-22-197.png|thumbnail! 

 !image-2023-10-27-11-00-55-331.png|thumbnail! 
",,,Core
ADIRINC-1333,3825473,U_M1AYE,Закрыт,25.10.2023 13:03,,,,,Дефект промсреды,29.01.2024 12:54,2023-12-27 00:00:00.0,"У клиентов с бумагой МЕТА не грузится портфель. 
Как бы все загрузилось но есть кривая позиция
onClientSubAccPositionEntity id:98466884 (441253) | idAccount:7271941 backPos:1 nalPos:1

Выглядит так что нет инфы по idobject = 441253
ну потом уже не смогли указать ликвидный рынок для нее
[TradePositionsSource2.Data|http://tradepositionssource2.data/] pos n/a 98466884 setMarketBoard marketBoard=not_found",,17.0,Montblanc
ADIRINC-1330,3809808,U_M1FDV,Закрыт,20.10.2023 13:52,,,,,Дефект промсреды,12.02.2024 12:01,2023-12-22 00:00:00.0,У клиентов в новой версии 2.26.1 при переходе в раздел рынки крашится приложение с ошибкой,,52.0,Мобильный терминал
ADIRINC-1329,3809420,U_M13J8,Закрыт,20.10.2023 13:20,,,,,Дефект промсреды,12.12.2023 09:59,2023-12-22 00:00:00.0,"Неправильный срок продажи подарочных акций Антипов Алексей Владимирович D50250 3320189

Клиенту начислили подарочные акции 12.10.2023, значит согласно правилам он их должен продать в течение 100 дней после начисление (т.е. в его случае до 20.01.2024), а у него отображается продать их до 31 июля 2023, что некорректно.",,1.0,АИ ПРО
ADIRINC-1328,3799363,U_M1QX4,Закрыт,18.10.2023 12:14,,,,,Дефект промсреды,26.10.2023 10:11,2023-11-30 00:00:00.0,"При сегодняшнем релизе [https://jira.moscow.alfaintra.net/projects/ADIRLK/versions/94689] , одна задача зааффектила на выводы дс https://jira.moscow.alfaintra.net/browse/ADIRLK-4174 .

После релиза начались массовые обращения клиентов. Клиенты , не могли вывести дс не выпустив сертификат или не перевыпустив старый. Выглядело примерно так , как на скрине у всех клиентов, которые хотели вывести в МТ и на IOS и на Android . В настоящее время релиз откатили. 

https://rc.alfa-bank.net/channel/adir-lk-pub?msg=LMJARQ9jpXCMnpgsd",,,
ADIRINC-1322,3767797,U_M1QVP,NEW,11.10.2023 16:53,,,,,Дефект промсреды,,2023-11-23 00:00:00.0,"Обращаются клиенты, у которых не получается отправить отчет в формате XML (для импорта). Удалось воспроизвести, в логах мидла ошибок нет. Логи с устройства прикрепил.

 !image-2023-10-11-16-51-32-113.png|thumbnail! 

",,5.0,
ADIRINC-1314,3753416,U_M0SLM,NEW,09.10.2023 11:05,,,,,Дефект промсреды,,2023-10-18 00:00:00.0,"По совершенным сделкам есть оредра на отмену. В итоге клиент думает, что заявка отменена, но она на самом деле исполнена

Пример 

select ts_time, DtUpdate, DtInsert ,* from a_hell_opers.dbo.a_trades atr join [ADFrontOrders].[Logs].[Orders] o 
on num_edocument = NumEDocument where atr.a_date = '2023-08-08 00:00:00.000' and num_edocument in (45230438584,
45230516684,
45230710784)
and treaty = 4759827 and IdOrderStatus = 21",,3.0,Core
ADIRINC-1313,3750296,U_M1FE1,Принят к исправлению,06.10.2023 16:29,,,,,Дефект промсреды,,2023-11-20 00:00:00.0,"# Клиент совершил сделку. 
 # Смотрит Историю операций
 # Не видит комиссий с конца сентября

 

Допинфо:

AGFHF7 7028469 Нет комиссии за сентябрь. 2.25.0, android

!image-2023-10-06-16-31-55-854.png!

 Запрос history-api 

[^aiordanskiy - Wed Oct 04 2023 18_37_55 GMT+0300 (Москва, стандартное время) (1).txt]

 ",,439.0,
ADIRINC-1312,3748215,U_M1RH8,Закрыт,06.10.2023 11:58,,,,,Дефект промсреды,17.04.2024 08:56,2023-11-20 00:00:00.0,"Сервис Issuers API делает запрос к кору 

{code:java}
[IssuersClient#getIssuerInfo(String,String)]--->GET http://172.21.1.97:80/api/fin-instrument-info/RU000A105BN4 HTTP/1.1
REQUEST HEADERS
PIN: AVWXK1
X-Request-Id: 6291d833-b2ff-450d-98c8-d8506c645e6a
X-External-System-Code: ADMT
X-External-User-Code: ISSUERS-API-I1
Content-type: application/json;v=1
{code}
После чего не может распарсить ответ. Ошибка:

{code:java}
 ""j.n.MalformedURLException: no protocol: genetico.ru\n\tat java.net.URL.<init>(URL.java:674)\n\tat java.net.URL.<init>(URL.java:569)\n\tat java.net.URL.<init>(URL.java:516)\n\tat c.f.j.d.d.s.FromStringDeserializer$Std._deserialize(FromStringDeserializer.java:318)\n\tat c.f.j.d.d.s.FromStringDeserializer.deserialize(FromStringDeserializer.java:175)\n\t... 64 common frames omitted\nWrapped by: c.f.j.d.e.InvalidFormatException: Cannot deserialize value of type `java.net.URL` from String \""genetico.ru\"": not a valid textual representation, problem: no protocol: genetico.ru\n at [Source: (io.netty.buffer.ByteBufInputStream); line: 1, column: 1427] (through reference chain: ru.alfabank.mobile.invest.issuers.client.dto.StockIssuerInfoResponse[\""webLink\""])\n\tat c.f.j.d.e.InvalidFormatException.from(InvalidFormatException.java:67)\n\tat c.f.j.d.DeserializationContext.weirdStringException(DeserializationContext.java:1991)\n\tat c.f.j.d.d.s.FromStringDeserializer.deserialize(FromStringDeserializer.java:186)\n\tat c.f.j.d.d.i.MethodProperty.deserializeAndSet(MethodProperty.java:129)\n\tat c.f.j.d.d.BeanDeserializer.deserializeFromObject(BeanDeserializer.java:392)\n\tat c.f.j.d.d.BeanDeserializer._deserializeOther(BeanDeserializer.java:220)\n\tat c.f.j.d.d.BeanDeserializer.deserialize(BeanDeserializer.java:187)\n\tat c.f.j.d.j.i.AsPropertyTypeDeserializer._deserializeTypedUsingDefaultImpl(AsPropertyTypeDeserializer.java:199)\n\tat c.f.j.d.j.i.AsPropertyTypeDeserializer.deserializeTypedFromObject(AsPropertyTypeDeserializer.java:119)\n\tat c.f.j.d.d.AbstractDeserializer.deserializeWithType(AbstractDeserializer.java:263)\n\tat c.f.j.d.d.i.TypeWrappedDeserializer.deserialize(TypeWrappedDeserializer.java:74)\n\tat c.f.j.d.d.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:323)\n\tat c.f.j.d.ObjectReader._bindAndClose(ObjectReader.java:2051)\n\tat c.f.j.d.ObjectReader.readValue(ObjectReader.java:1427)\n\t... 2 frames excluded\n\tat r.c.p.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:125)\n\tat r.c.p.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxO...""
{code}

Отсюда видим, что приходит URL genetico.ru без протокола.

Мы можем подтвердить это руками, дернув такой же запрос, что и сервис.

{code:java}
curl http://172.21.1.97:80/api/fin-instrument-info/RU000A105BN4 -H 'PIN: AVWXK1' -H 'Content-type: application/json;v=1' -H 'X-External-User-Code: ISSUERS-API-I1' -H 'X-External-System-Code: ADMT'
{code}

Получаем ответ:

{code:java}
{
   ""name"":""Генетико"",
   ""description"":"" Центр «ГЕНЕТИКО» проводит комплексную генетическую диагностику наследственных заболеваний и нарушений репродуктивной функции. Является одним из крупнейших лабораторно-производственных комплексов международного уровня в России, построенный по стандартам GLP."",
   ""countryCode"":""RUS"",
   ""webLink"":""genetico.ru"",
   ""employees"":80,
   ""city"":""Москва"",
   ""industrySectors"":[
      {
         ""industryId"":39,
         ""sectorId"":56,
         ""regionId"":6,
         ""regionName"":""Россия"",
         ""peIndAvgGlobal"":66.21455,
         ""epsIndLastFyAvgGlobal"":2.12498,
         ""psIndAvgGlobal"":1.43456,
         ""evEbitdaIndAvgGlobal"":-14.46002,
         ""revtrendgrIndAvgGlobal"":12.29547,
         ""roeIndAvgGlobal"":-228.67682,
         ""roaIndAvgGlobal"":4.79332,
         ""roiIndAvgGlobal"":8.65412,
         ""netProfitMarginIndAvgGlobal"":-0.94,
         ""debtVsEquityIndAvgGlobal"":366.8976,
         ""debtVsEbidtaIndAvgGlobal"":2.3602,
         ""pbIndAvgGlobal"":4.23805,
         ""peIndAvgRegion"":118.25192,
         ""epsIndLastFyAvgRegion"":0.58955,
         ""psIndAvgRegion"":3.01254,
         ""evEbitdaIndAvgRegion"":19.42622,
         ""revtrendgrIndAvgRegion"":15.01434,
         ""roeIndAvgRegion"":13.53534,
         ""roaIndAvgRegion"":9.3545,
         ""roiIndAvgRegion"":17.27561,
         ""netProfitMarginIndAvgRegion"":14.00564,
         ""debtVsEquityIndAvgRegion"":86.25155,
         ""debtVsEbidtaIndAvgRegion"":2.37867,
         ""pbIndAvgRegion"":1.95025
      }
   ]
}
{code}

Видим, что параметр +*""webLink"":""genetico.ru""*+ возвращается без указания протокола.",,,
ADIRINC-1311,3746637,U_M1AYE,Отклонен,05.10.2023 19:45,,,,,Дефект промсреды,12.01.2024 12:17,2023-10-10 00:00:00.0,"В ЛС сумма лик.активов считается правильно
В посттрейде сумма сильно завышена ",,3.0,
ADIRINC-1310,3744305,U_M19LL,Отклонен,05.10.2023 14:10,,,,,Дефект промсреды,08.11.2023 13:16,2023-11-03 00:00:00.0,"МТ на IOS не даёт ввести сумму10 000 000, например клиент разом не сможет купить 11 000 000 штук, макс. 10 000 000 шт. 

На Android данной проблемы не наблюдается.

!image-2023-10-05-14-08-52-706.png!",,3.0,Мобильный терминал
ADIRINC-1309,3740942,U_M1UN1,Закрыт,04.10.2023 18:16,,,,,Дефект промсреды,14.05.2024 16:35,2023-11-17 00:00:00.0,"В разделе ""Рынки"" во вкладке ""Индексы"" отображается изменение цены только у индекса РТС, хотя информация в логах по instruments-search-api возвращается корректно(скрин во вложении)",,86.0,Марс
ADIRINC-1308,3734935,U_M1BU7,Закрыт,03.10.2023 16:08,Фронт,,,,Дефект промсреды,18.04.2024 18:04,2023-12-05 00:00:00.0,"# Клиент на android 2.25 заходит на главный экран 6399914 AAKQUK
 # Видит виджет с ребалансировкой
 # Нажимает кнопку на нем

Фактически видит ошибку:

!image-2023-10-03-16-05-25-189.png!

!image-2023-10-03-16-04-59-078.png!

 

Допинфо:

 

curl 'http://adapp1:26747/rebalance/instructions?agreementId=6399914' -i -X GET -H 'AUTH-USER-ID: AAKQUK'


{""sales"":[],""purchases"":[\{""isin"":""RU000A0J2Q06"",""name"":""Роснефть"",""ticker"":""ROSN"",""placeCode"":""МБ ЦК"",""assetType"":null,""quantity"":3,""price"":{""value"":533.9500000000,""currency"":""RUB""},""imageId"":174378,""amount"":\{""value"":1601.85,""currency"":""RUB""}},\{""isin"":""US98387E2054"",""name"":""X5 RetailGroup GDR"",""ticker"":""FIVE@GS"",""placeCode"":""МБ ЦК"",""assetType"":null,""quantity"":1,""price"":{""value"":2274.0000000000,""currency"":""RUB""},""imageId"":452152,""amount"":\{""value"":2274,""currency"":""RUB""}},\{""isin"":""RU0009029540"",""name"":""СберБанк"",""ticker"":""SBER"",""placeCode"":""МБ ЦК"",""assetType"":null,""quantity"":10,""price"":{""value"":260.4800000000,""currency"":""RUB""},""imageId"":284396,""amount"":\{""value"":2604.8,""currency"":""RUB""}},\{""isin"":""NL0009805522"",""name"":""Яндекс"",""ticker"":""YNDX"",""placeCode"":""МБ ЦК"",""assetType"":null,""quantity"":1,""price"":{""value"":2404.8000000000,""currency"":""RUB""},""imageId"":662502,""amount"":\{""value"":2404.8,""currency"":""RUB""}},\{""isin"":""RU0009084396"",""name"":""ММК"",""ticker"":""MAGN"",""placeCode"":""МБ ЦК"",""assetType"":null,""quantity"":20,""price"":{""value"":52.7900000000,""currency"":""RUB""},""imageId"":174374,""amount"":\{""value"":1055.8,""currency"":""RUB""}},\{""isin"":""RU0009033591"",""name"":""Татнефть"",""ticker"":""TATN"",""placeCode"":""МБ ЦК"",""assetType"":null,""quantity"":3,""price"":{""value"":640.2000000000,""currency"":""RUB""},""imageId"":174380,""amount"":\{""value"":1920.6,""currency"":""RUB""}}],""total"":\{""sales"":0,""purchases"":11861.85,""currency"":""RUB""}}


*""assetType"":null как вариант либо какие то еще причины*

 ",,8.0,Meribel
ADIRINC-1305,3713979,U_M1QX4,Закрыт,28.09.2023 13:04,,,,,Дефект промсреды,22.01.2024 10:45,2023-11-10 00:00:00.0,"Маслова Надежда Михайловна APACDD / 166083 
||Login||ClientVersion||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||LoginTime||ClientIP||
|nmmaslova|4.0.3915.2056|9.104|6.1|1 - Windows|System manufacturer System Product Name|F46D04551667|28.09.2023 11:13:53|109.173.42.94|

в терминале на графиках отсутствуют данные с 2018 до 2020 или 2021 года
 идёт перескок сразу на 2-3 года

 ",,,Pro terminal
ADIRINC-1303,3711285,U_M0WVN,Отклонен,27.09.2023 18:28,,,,,Дефект промсреды,03.09.2024 10:08,2023-11-10 00:00:00.0,"# Клиент общается с поддержкой банка в чате ДТ
 # Сообщения приходят в последовательности на скрине
 # !image-2023-09-27-18-28-09-301.png!!image-2023-09-27-18-32-10-412.png!

AVW8ES Исакевич Евгений Геннадьевич 4597061
 АД 4.0.3843.1725",,2.0,
ADIRINC-1302,3710968,U_M1DCS,Принят к исправлению,27.09.2023 17:12,,,,,Дефект промсреды,,2024-07-30 00:00:00.0,"На примере клиента 2282233/AB8FLY в разделе ""Мои выплаты"" отсутствует информация по части выплат. По бумаге RU000A104Z71(ООО Биннофарм Групп, 001P-02) не отображается выплата купонов, которая должна быть *19.10*.23, однако выплата за 18.01.24 отображается.
При вызове сервиса [adir-coupon-info|http://adir-coupon-info.k8s-master.alfadirect.ru/api/coupon?endDate=2024-03-18&assetId=RU000A1052T1&assetId=RU000A104ZC9&assetId=RU000A106UW3&assetId=RU000A104ZK2&assetId=RU000A106MW0&assetId=RU000A104Z71&assetId=RU000A106888&assetId=RU000A105SP3&startDate=2023-10-19] информация об инструменте возвращается корректно
Во вложении добавлен лог по traceId f8830656f3e3f236 в котором видно, что в вызове с фронта запрашивался период с *24.09*.2023 по 31.12.2100, но на бэк передалось значение периода с *25.10*.23 по 31.12.2100 из-за чего, вероятно и не вернулось значение выплаты 19.10.23 !image-2023-09-27-12-28-44-792.png!",,665.0,Kailash
ADIRINC-1300,3705968,U_M0W2X,Закрыт,26.09.2023 17:43,,,,,Дефект промсреды,17.10.2023 12:10,2023-10-25 00:00:00.0,"Клиент заходит в приложение версия 2.25 на главном экране переходит в раздел размещения SPO ТМК - ""участвовать"" - заявка
Клиент выбирает какое количество хочет купить и у него сбрасывается число до 1 или 9 или 10 (зарегистрировали такие кейсы)",,31.0,Мобильный терминал
ADIRINC-1298,3701131,U_M1BFA,Закрыт,25.09.2023 18:10,,,,,Дефект промсреды,26.09.2023 09:58,2023-10-05 00:00:00.0,"В АИ 4.0 не отображаются данные в окнах.

При подключении ДТ 4.0 делает запрос на сервер, и по ответу должен сформировать файл для работы.

При получении ответа - Д.Т. не формировал необходимый файл.

Обновление и переавторизация не поможет. Помогает замена файла сonnectioninfo.cfg.",,,
ADIRINC-1297,3700360,U_M19LL,Отклонен,25.09.2023 16:54,,,,,Дефект промсреды,17.01.2024 13:35,2023-11-07 00:00:00.0,"Процедура импорта из 3-ки в 4-ку с ручным указанием ликвидного рынка размещение и последующим пересчетом ликвидного рынка для торгуемого актива ломает выставление/перевыставление заявок, так как цена на рынке размещения отсутствует. Необходимо доработать процесс заведения рынка размещения в рамках дополнительных размещений уже торгуемого инструмента.",,,
ADIRINC-1296,3698239,U_M1D2F,Закрыт,25.09.2023 11:48,,,,,Дефект промсреды,31.01.2024 14:36,2024-01-16 00:00:00.0,"В терминале QUIK перестала отображаться данная бумага RU000A0B6NK6 ТМК. из-за того что ts_p_code = 'RU000A0B6NK6' ,а не код инструмента в МБ =TRMK

select top 100 * from hell.dbo.papers where ts_p_code = 'RU000A0B6NK6'

!image-2023-09-25-12-31-08-178.png!

Выяснилось, что в рамках процесса размещения необходим ts_p_code = ISIN, что воздействует на отображение в QUIK.",,,Core
ADIRINC-1293,3690939,U_M1AYE,Отклонен,21.09.2023 19:24,,,,,Дефект промсреды,19.08.2024 10:48,2023-10-03 00:00:00.0,"У клиентов при загрузке Вэб-версии бесконечно грузится черный экран.

Проблема массовая

https://rc.alfa-bank.net/channel/team-invest-web-terminal?msg=hvrhupntbtZ9gambr",,100.0,Web
ADIRINC-1291,3688484,U_M17SM,NEW,21.09.2023 13:01,,,,,Дефект промсреды,,2023-11-02 00:00:00.0,"При подключении ДТ делает запрос для формирования файла

Ответ был получен, но ДТ не формировал файлы по полученному ответу

Пример ответа:
{code:java}
Sep 21 09:56:19.827543 adw1fe108 fe1[1877627:1877778]/debug(tf):+[acharkin:244181:1C99571EEEC0:0x7feacb4ce568] - (out-tcp) [CompL=202261][L=1048468]Obj={[IdObj=174366][IdObjT=CC][IdObjFcUnit=0][IdObjBs=541563][IdIndu=0][SbObj=USD][NmObj=USD][DescObj=USD, Рег№ 840][RegCodO bj=840][Nom=1][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=205925768969][Op=Ins]}
[Isin=USD]}Obj={[IdObj=174367][IdObjT=CC][IdObjFcUnit=0][IdObjBs=541565][IdIndu=0][SbObj=EUR][NmObj=EUR][DescObj=EUR, Рег№ 978][RegCodObj=978][Nom=1][Mult=1][MatDtObj=2100-0 1-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=37190665933][Op=Ins]}
[Isin=EUR]}Obj={[IdObj=174368][IdObjT=CC][IdObjFcUnit=174366][IdObjBs=541567][IdIndu=0][SbObj=RUB][NmObj=Рубль РФ][DescObj=Рубль РФ, Рег№ 643][RegCodObj=643][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=f alse]Ver=
{[Ver=173814291056][Op=Ins]}
[Isin=RUB]}Obj={[IdObj=174371][IdObjT=EZ][IdObjFcUnit=0][IdObjBs=0][IdIndu=10][SbObj=CHMF][NmObj=Severstal][DescObj=Severstal, Рег№ 00143A][RegCodObj=00143A][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=88990904 152][Op=Ins]}
[Isin=]}Obj={[IdObj=174373][IdObjT=EZ][IdObjFcUnit=0][IdObjBs=0][IdIndu=14][SbObj=LKOH][NmObj=LUKOIL][DescObj=LUKOIL, Рег№ 00077A][RegCodObj=00077A][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=88990904153][Op=Ins]}
[Isin=]}Obj={[IdObj= 174374][IdObjT=EZ][IdObjFcUnit=0][IdObjBs=0][IdIndu=19][SbObj=MAGN][NmObj=MMK][DescObj=MMK, Рег№ 00078A][RegCodObj=00078A][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=88990904154][Op=Ins]}
[Isin=]}Obj={[IdObj=174377][IdObjT=EA][IdObjFcUnit=0][IdObj Bs=0][IdIndu=29][SbObj=MTSI][NmObj=ПАО ""МТС""][DescObj=ПАО ""МТС"", Рег№ 04715A][RegCodObj=04715A][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=67968718019][Op=Ins]}
[Isin=]}Obj={[IdObj=174378][IdObjT=EA][IdObjFcUnit=0][IdObjBs=0][IdIndu=21][SbObj=ROSN ][NmObj=ПАО ""НК ""Роснефть""][DescObj=ПАО ""НК ""Роснефть"", Рег№ 00122A][RegCodObj=00122A][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=67968718020][Op=Ins]}
[Isin=]}Obj={[IdObj=174380][IdObjT=EZ][IdObjFcUnit=0][IdObjBs=0][IdIndu=14][SbObj=TATN][NmObj=T atneft][DescObj=Tatneft, Рег№ 00161A][RegCodObj=00161A][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=88990904155][Op=Ins]}
[Isin=]}Obj={[IdObj=174381][IdObjT=EA][IdObjFcUnit=0][IdObjBs=0][IdIndu=14][SbObj=TRNF][NmObj=ПАО ""Транснефть""][DescObj=ПАО ""Т ранснефть"", Рег№ 00206A][RegCodObj=00206A][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=67968718022][Op=Ins]}
[Isin=]}Obj={[IdObj=174382][IdObjT=EA][IdObjFcUnit=0][IdObjBs=0][IdIndu=11][SbObj=URKA][NmObj=Uralkaliy][DescObj=Uralkaliy, Рег№ 00296A][Re gCodObj=00296A][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=88990904156][Op=Ins]}
[Isin=]}Obj={[IdObj=174383][IdObjT=EA][IdObjFcUnit=0][IdObjBs=0][IdIndu=29][SbObj=URSI][NmObj=ОАО ""Уралсвязьинформ""][DescObj=ОАО ""Уралсвязьинформ"", Рег№ 00175A][RegCo dObj=00175A][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=67968718024][Op=Ins]}
[Isin=]}Obj={[IdObj=174388][IdObjT=FC][IdObjFcUnit=174366][IdObjBs=0][IdIndu=0][SbObj=GOLD][NmObj=Золото в слитках][DescObj=Золото в слитках][RegCodObj=][Nom=0][Mult=1][ MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=69261829257][Op=Ins]}
[Isin=]}Obj={[IdObj=174389][IdObjT=FC][IdObjFcUnit=174366][IdObjBs=0][IdIndu=0][SbObj=PLD][NmObj=Палладий][DescObj=Палладий][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]V er=
{[Ver=69254820092][Op=Ins]}
[Isin=]}Obj={[IdObj=174390][IdObjT=FC][IdObjFcUnit=174366][IdObjBs=0][IdIndu=0][SbObj=PLT][NmObj=Платина][DescObj=Платина][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=69254820616][Op=Ins]}
[Isin=]}Obj={[IdO bj=174391][IdObjT=IF][IdObjFcUnit=282886][IdObjBs=0][IdIndu=0][SbObj=RTSc][NmObj=Индекс РТС (Потребтовары и розница)][DescObj=Индекс РТС (Потребтовары и розница)][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=12401274594][Op=Ins]}
[Isin=] }Obj={[IdObj=174392][IdObjT=IF][IdObjFcUnit=282886][IdObjBs=0][IdIndu=0][SbObj=RTSo][NmObj=Индекс РТС (Нефть и Газ)][DescObj=Индекс РТС (Нефть и Газ)][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=12401274595][Op=Ins]}
[Isin=]}Obj={[IdObj =174393][IdObjT=IF][IdObjFcUnit=282886][IdObjBs=0][IdIndu=0][SbObj=RTSS][NmObj=Индекс РТС Стандарт][DescObj=Индекс РТС Стандарт][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=12401274596][Op=Ins]}
[Isin=]}Obj={[IdObj=174394][IdObjT=IF][Id ObjFcUnit=282886][IdObjBs=0][IdIndu=0][SbObj=RTSt][NmObj=Индекс РТС (Телекоммуникации)][DescObj=Индекс РТС (Телекоммуникации)][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=12401274597][Op=Ins]}
[Isin=]}Obj={[IdObj=174407][IdObjT=FC][IdOb jFcUnit=174366][IdObjBs=0][IdIndu=0][SbObj=SILV][NmObj=Серебро в слитках][DescObj=Серебро в слитках][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=69254820617][Op=Ins]}
[Isin=]}Obj={[IdObj=174410][IdObjT=FC][IdObjFcUnit=174366][IdObjBs=0] [IdIndu=0][SbObj=UR][NmObj=Нефть URALS][DescObj=Нефть URALS][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=69261829258][Op=Ins]}
[Isin=]}Obj={[IdObj=174411][IdObjT=FC][IdObjFcUnit=174368][IdObjBs=0][IdIndu=0][SbObj=SUGA][NmObj=Сахар (ГОСТ 21-94)][DescObj=Сахар (ГОСТ 21-94)][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=69261829259][Op=Ins]}
[Isin=]}Obj={[IdObj=174412][IdObjT=FC][IdObjFcUnit=174366][IdObjBs=0][IdIndu=0][SbObj=BR][NmObj=Нефть BRENT][DescObj=Нефть BRENT][R egCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=69254820618][Op=Ins]}
[Isin=]}Obj={[IdObj=174413][IdObjT=AO][IdObjFcUnit=174368][IdObjBs=174371][IdIndu=0][SbObj=CHMF][NmObj=Северсталь][DescObj=Акции обыкновенные Severstal, Рег№ 1-02-00143-A] [RegCodObj=1-02-00143-A][Nom=0.01][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=169542921260][Op=Ins]}
[Isin=RU0009046510]}Obj={[IdObj=174414][IdObjT=FC][IdObjFcUnit=174368][IdObjBs=0][IdIndu=0][SbObj=DS][NmObj=Дизельное топливо (летнее)][DescObj=Дизельное топливо (летнее)][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=69261829260][Op=Ins]}
[Isin=]}Obj={[IdObj=174415][IdObjT=IT][IdObjFcUnit=174368][IdObjBs=0][IdIndu=0][SbObj=ECBM][NmObj=Индекс Э/Э ЦЕНТР (базовый)][DescObj=Индекс Э/Э ЦЕНТ Р (базовый)][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=12401274605][Op=Ins]}
[Isin=]}Obj={[IdObj=174416][IdObjT=IT][IdObjFcUnit=174368][IdObjBs=0][IdIndu=0][SbObj=ECPM][NmObj=Индекс Э/Э ЦЕНТР (пиковый)][DescObj=Индекс Э/Э ЦЕНТР (пик овый)][RegCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=12401274606][Op=Ins]}
[Isin=]}Obj={[IdObj=174417][IdObjT=IT][IdObjFcUnit=174366][IdObjBs=0][IdIndu=0][SbObj=ED][NmObj=Курс EURO/USD (евро доллар)][DescObj=Курс EURO/USD (евро доллар)][R egCodObj=][Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=12401274607][Op=Ins]}
[Isin=]}Obj={[IdObj=174418][IdObjT=IT][IdObjFcUnit=174368][IdObjBs=0][IdIndu=0][SbObj=Eu][NmObj=Курс EURO/RUR (евро рубль)][DescObj=Курс EURO/RUR (евро рубль)][RegCodObj=] [Nom=0][Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=12401274608][Op=Ins]}
[Isin=]}Obj={[IdObj=174419][IdObjT=IT][IdObjFcUnit=174368][IdObjBs=0][IdIndu=0][SbObj=EUBM][NmObj=Индекс Э/Э УРАЛ (базовый)][DescObj=Индекс Э/Э УРАЛ (базовый)][RegCodObj=][Nom=0][ Mult=1][MatDtObj=2100-01-01][Exp=0][IsEnadObj=false]Ver=
{[Ver=12401274609][Op=Ins]}
[Isin=]}
{code}
 ",,,
ADIRINC-1287,3680390,U_M0WVN,Закрыт,19.09.2023 16:20,,,,,Дефект промсреды,10.01.2024 18:03,2023-09-28 00:00:00.0,"# Клиент подключил услугу автоматического пополнения Инвесткопилки (копилка для сдачи)
 # У части клиентов после автоматического пополнения Инвесткопилки, данная проводка в EQ - удаляется по неизвестным причинам техническим пользователем OP1..

Пример по клиенту BAK3O9 ГС 3182477 поступили ДС по транзакции карточной нс суммы 2053,51р в размере 200р !image-2023-09-19-16-08-31-090.png!

!image-2023-09-19-16-10-58-303.png!

В настоящее время такие проводки (удаленные) растут c 14/09/2023

На текущий момент список транзакций [^KDSD_DELETE.csv]

По информации от коллег из ФС EQ 14/09/2023 авария в МДУ после утсановки патча MDU#830 не проходили оплаты. 
 значительный инцидент - *IM15283988* 

 

Патч был откатан, но последствия остались.

Проблема пока решается в рамках дефекта на стороне  https://jira.moscow.alfaintra.net/browse/TM1RB-96
 
 ",,,Core
ADIRINC-1286,3680255,U_M169D,Закрыт,19.09.2023 15:39,,,,,Дефект промсреды,26.12.2023 12:04,2023-10-31 00:00:00.0,"На бою зависает сервис [com-k2db-balances-positions-cache-poc|http://adir-p-tc-01.alfadirect.ru:8080/admin/editBuild.html?id=buildType:AdirCore_ComK2dbBalancesPositionsCachePoc] и перестает транслировать балансы, при этом в этот момент начинает создавать нагрузку на БД, после рестарта сервиса трансляция продолжается 
тред с обсуждением https://rc.alfa-bank.net/channel/adir_admins_public?msg=5eNcoenMoeb74xMJe",,,Core
ADIRINC-1283,3676910,U_M1TP0,Закрыт,19.09.2023 10:23,,,,,Дефект промсреды,10.04.2024 16:36,2023-10-31 00:00:00.0,"1.Клиент проводил сделки

2.По проведенным сделкам клиент ожидал получение оповещения по почте

3. Оповещение по почте не получено.

Дополнительная информация.

Оповещение уходят от имени [broker@alfadirect.ru|mailto:broker@alfadirect.ru]    и они не приходят некоторым клиентам, например,  [bb@kernelpanic.ru|mailto:bb@kernelpanic.ru].  Причина -  некорректная настройка почтовых серверов [alfadirect.ru|mailto:broker@alfadirect.ru]  по части ptr-записей.

Подробнее это обсуждалось здесь: [https://rc.alfa-bank.net/direct/CY2EGdjHHr6ckMx3hu64xQpAH5zdrRPzKB?jump=Nkkw4njWiYDoyHYMX]

 По этому вопросу есть задача по которой эта проблема должна исправиться: https://jira.moscow.alfaintra.net/browse/ADIRLK-4152 

 ",,2.0,Личный кабинет
ADIRINC-1282,3672374,U_M0WVN,Отклонен,18.09.2023 12:42,,,,,Дефект промсреды,17.10.2023 11:31,2023-10-30 00:00:00.0,"# Клиент AODY8M 
Версия МП 2.25.0
OS устройства ANDROID добавляет в Избранное инструменты

!image-2023-09-18-12-40-02-296.png!
 # Через пару дней заметил, что раздел пуст.  

То есть инструменты самопроизвольно очищаются через некоторое время

Самим воспроизвести не удалось",,1.0,Мобильный терминал
ADIRINC-1281,3667851,U_M19LL,Закрыт,15.09.2023 17:49,ОТЭИСФЛ,,,,Дефект промсреды,08.11.2023 13:18,2023-11-17 00:00:00.0,"В чат обратился клиент 5395991 Коробов Антон Сергеевич AN75WA
Клиент обнаружил в МТ баг
МТ ANDROID 2.25.0

В ЦБ АКБ Приморье в разделе Заявка отображается цена с буквенным значением (скрин во вложении)

как можно воспроизвести данный баг:
1. Заходим в стакан купли/продажи данной акции
2. Выбираем любую позицию (нажать на позицию), откроется экран ""Заявки""
3. Вернуться на экран ""Стакан""
4. Снова выбрать любую позицию

Результат: Можно заметить, как цифры меняются на значение с буквой Е (преобразуется в степенное значение)

Воспроизводится только на Android версии. На iOS отображается корректно

Если первый раз зайти на экран ""Заявка"", то отображается корректно.
Воспроизводится, если выбирать позицию на экране ""Стакан"" повторный, третий и последующие разы.

Также данная ситуация с инструментом транснефть",,2.0,Мобильный терминал
ADIRINC-1280,3666420,U_M177U,Отложен,15.09.2023 15:39,,,,,Дефект промсреды,,2023-10-27 00:00:00.0,"Клиенты путаются в том, по какой цене была выставлена стоп-маркетная заявка, после её исполнения. В поле цена подставляется цена верхней или нижней границы ценового коридора биржи.
Таким образом у клиента:
- *до активации* заявки отображается - *указанная им стоп-цена торгового поручения*
- *после активации* заявки - отображается в заявке уже цена *верхней\нижней границы коридора* (как у обычной рыночной) 
- а *в сделках\операциях* - *цена реального исполнения* 

Возможно стоит использовать и оставлять цену , которую изначально указывает клиент в торговых поручениях такого типа, чтобы после наступления условия и активации стоп-маркетной и др. подобных заявок, *не изменять* изначально заданную пользователем цену и не отображать верхнюю или нижнюю границу ценового коридора (как это представлено у обычной маркетной\рыночной). 
(Клиенты думают, что ему кто то изменил параметры его торгового поручения и обращаются с вопросами и негативом, что они такого не делали)
После исполнения такой заявки, клиенту необходимо понимать именно по какой цене он выставлял.

Пример приведу ниже. 

Цена в приложение
 !image-2023-09-15-15-36-43-804.png|thumbnail! 

Цена в поручение
 !image-2023-09-15-15-37-08-772.png|thumbnail! 

Цена сделки
 !image-2023-09-15-15-38-23-561.png|thumbnail! ",,8.0,Мобильный терминал
ADIRINC-1279,3664728,U_M1CYD,Закрыт,15.09.2023 12:16,ОТЭИСФЛ,,,,Дефект промсреды,16.01.2024 13:28,2023-10-27 00:00:00.0,"Поступило 4 однотипных обращения 

Клиенты:

Кваш Михаил Иванович AK4NCO 4632627 Версия МП: 2.25.0
Покровский Григорий Иванович AVXBNT 6152000 Версия МП: 2.25.0
Ибрагимов Ринат Олегович AVWIQA 4639918 Версия МП: 2.25.0
Горшков Евгений Владимирович AVVAU2 4427255 Версия МП: 2.25.0

Описание:
У клиентов не отображаются цены по бумагам в портфеле. 
До этого возникала такая же ошибка, помогли базовые рекомендации, но спустя время после этого опять перестало отображаться. 

Помимо версии всех клиентов связывает наличие инструмента:
Noventiq Holdings plc, адр. US83407L2079 4632627-000 GDSFTL

И отображение ошибки:
Возникла ошибка при отображении стоимости некоторых активов. Уже чиним, извините

Присутствует похожий дефект:
https://jira.moscow.alfaintra.net/browse/ADIRINC-892",,22.0,Core
ADIRINC-1278,3661746,U_M1QX4,Отклонен,14.09.2023 15:18,ОТЭИСФЛ,,,,Дефект промсреды,03.09.2024 10:08,2023-10-26 00:00:00.0,"Химич Евгений Юрьевич C93317 / 4745 
Версия ДТ - 4.0.3843.1725.

У клиента не определяется величина проскока в процентах, если торги закрыты.
1. Перегружал, перелогинивался, устанавливал все с нуля на новый компьютер - работает одинаково.
2. Такое отображение по всем инструментам вне торгового времени.

Подскажите, пожалуйста, является ли данное поведение корректным? ",,1.0,Pro terminal
ADIRINC-1276,3659288,U_M1DKF,NEW,14.09.2023 10:36,,,,,Дефект промсреды,,2023-10-26 00:00:00.0,"В логах ЛК ошибки при обновлении токена паспорта 

Запрос на который получаем ошибку - 
curl --location --request POST 'https://private.auth.alfabank.ru/passport/openid-blue/token' \ --header 'Authorization: Basic blabla \ --header 'Content-Type: application/x-www-form-urlencoded' \ --data-urlencode 'grant_type=refresh_token' \ --data-urlencode 'response_type=access_token' \ --data-urlencode 'refresh_token=8a3fc452-43f2-3bbf-b1dd-5f8c6b1cb9ac'

!image-2023-09-14-10-35-04-221.png!",,,
ADIRINC-1272,3653610,U_M0NT4,Закрыт,12.09.2023 19:09,ОТЭИСФЛ,,,,Дефект промсреды,26.01.2024 14:58,2023-09-22 00:00:00.0,"Не отображаются свечи в аукцион закрытия дневных торгов(основная сессия) с 18:40 до 18:49. Сделки присутствуют, пример: trd_no = '659598949' или '659598869'

https://rc.alfa-bank.net/channel/adir_duty?msg=z9dXiXzpHjQKAYBTS",,15.0,
ADIRINC-1271,3653541,U_M1QX4,Отклонен,12.09.2023 17:25,ОТЭИСФЛ,,,,Дефект промсреды,03.09.2024 10:09,2023-12-06 00:00:00.0,"В чат обратился клиент: Гребенщиков Константин Евгеньевич I91826 19001
Платформа: АД 4.0 4.0.3843.1725
У клиента не отображается на графике значение показателя индикатора АТР. Чек-бокс активирован.

 ",,2.0,АИ ПРО
ADIRINC-1270,3648817,U_M1AYY,NEW,11.09.2023 23:06,,,,,Дефект промсреды,,2023-09-21 00:00:00.0,"К нам обратился клиент ГС 166255 цб BVTB (RU000A0JP5V6).

08.09.2023 открыл короткую позицию по активу.
 УЦ весь день вплоть до вечера отображалась правильно 0,02734 руб.
 Но после ночного пересчёта УЦ стала отображаться 0,02724 руб., что по мнению клиента неверно (в подтверждение клиент предоставил скриншот на 6:29).

Возможно ли, что УЦ в течение дня и перерасчёт ночью происходит в разных процедурах по разным алгоритмам?

Не смотря на то, что различие в 3-м знаке после запятой, вопрос для клиента значимый, поскольку клиент имел позицию -600 млн. шт.",,4.0,Марс
ADIRINC-1266,3644853,U_M25TF,На исправление,11.09.2023 09:48,,,,,Дефект промсреды,,2023-10-23 00:00:00.0,"Добрый день, cервис multi-markets возвращает ошибки. Причем процедура ([actives].[get_isin_trade_boards]) отрабатывает если запустить руками с такими же входными данными. Просьба помочь разобраться в ситуации.

Логи мидла http://adlog1/kibana/goto/ec7b1ce0-506e-11ee-a783-9f336750c633
 !image-2023-09-11-09-44-56-009.png|thumbnail! 

Логи кора http://adirelkprod.alfadirect.ru/goto/2be1cfde6ac7b2b64deef36a2364d708
 !image-2023-09-11-09-44-26-877.png|thumbnail! 

Результат работы процедуры [actives].[get_isin_trade_boards] (запуск руками с параметрами из лога).
 !image-2023-09-11-09-42-30-715.png|thumbnail! 

Ошибка
 !image-2023-09-11-09-42-52-373.png|thumbnail! ",,,Core
ADIRINC-1265,3638420,U_M1AYY,NEW,07.09.2023 22:03,,,,,Дефект промсреды,,,"Коллеги, к нам обратился клиент ГС 6531290 по активу RIRT (RU000A0JP922)

31.08.2023 клиент четырежды покупал и обнулял позицию по этому активу.
 Задаёт вопрос почему УЦ не пересчитывалась в течении дня, а всё время показывалась одна и та же – 239,8.

Судя по Конфлюенс [https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=1275974972]
 *УЦ должна пересчитываться после каждой операции покупки и продажи актива, или при перемещении актива между счетами*.

Этого не происходит ни в 14:11, ни в 19:01 - см. скриншоты
 !image-2023-09-07-22-15-14-814.png!!image-2023-09-07-22-15-51-292.png!",,17.0,
ADIRINC-1262,3630777,U_M1QLD,Отклонен,06.09.2023 12:11,,,,,Дефект промсреды,11.10.2023 14:07,2023-09-15 00:00:00.0,"В Android Версии 2.24.1 приложения в рынках нет валюты Дихрам ОАЭ (AED) 

На IOS проблемы не наблюдается

 

 ",,2.0,Мобильный терминал
ADIRINC-1260,3620791,U_M17SM,NEW,04.09.2023 13:08,,,,,Дефект промсреды,,2023-10-16 00:00:00.0,"В ДТ в окне поиска не ищется фьючерс, хотя он заведен корректно, в ВТ и МТ в поиске есть.",,11.0,Pro terminal
ADIRINC-1259,3620139,U_M1FE1,На исправление,04.09.2023 11:47,Дефекты_АИ,,,,Дефект промсреды,,2024-05-13 00:00:00.0,"Клиент заходит в приложение МТ. Проваливается в бумагу, переходит в раздел Купоны и наблюдает отсутствие информации, на IOS ""Нет информации по купонам. Мы уже работаем над их добавлением"". 
В Hell_cache календаря нет
SELECT * FROM [hell_cache].[coupon].[redemption] WITH (SNAPSHOT)
where act_id=126818",,63.0,Сатурн
ADIRINC-1256,3616309,U_M1CUE,Закрыт,01.09.2023 17:23,,,,,Дефект промсреды,24.04.2024 13:45,2024-07-02 00:00:00.0,"У клиента за 24.08.2023 было пополнение БС на 2000 рублей, операция не записана [operations_cache].[hell].[extra_transfers]",,15.0,Core
ADIRINC-1255,3616537,U_M0YQB,Принят к исправлению,01.09.2023 16:45,,,,,Дефект промсреды,,2023-11-27 00:00:00.0,"Validata-api хранит токен определенное время, после истечения срока его жизни перезапрашивает данные с МБ, но если токен станет невалидным раньше положенного времени сервис не запросит новый токен, из-за чего перестает работать интеграция с МБ

 

https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=3FwBEec7tGkjKHtCS",,,Уран
ADIRINC-1250,3607474,U_M17VN,Закрыт,30.08.2023 18:01,,,,,Дефект промсреды,17.06.2024 08:23,2023-11-01 00:00:00.0,"Клиент выставляет заявку айсберг. Ему разрешается минимум 1000 лотов и при этом нельзя изменить видимый объем лотов. Протестив узнали что видимый объем лотов меняется только кратно 10 когда выбираешь заявки не по 1к лотов, а по 100к лотов, но так же до сих пор нельзя поставить самому например вместо 100 поставить 200 или 250 и поле не редактируется никак.
В ДТ данный функционал работает и ставить айсберг можно, пример на скрине 120 штук скрыли.
Воспроизводится на всех версиях МТ",,,Мобильный терминал
ADIRINC-1248,3606059,U_M1DKL,NEW,30.08.2023 14:17,,,,,Дефект промсреды,,2023-10-31 00:00:00.0,"При попытке добавить уведомление об изменении цены и указать % изменения, равный текущей рыночной цене, возникает ошибка.
Клиент указывает не конкретную цену, а изменение цены в процентах. А если получилось, что число процентов совпало с текущей ценой, то пишет - нельзя выставить уведомление. !image-2023-08-30-14-16-41-668.png!",,1.0,Matterhorn
ADIRINC-1245,3599684,U_M17SM,На исправление,29.08.2023 11:02,,,,,Дефект промсреды,,2023-10-10 00:00:00.0,"Обратился клиент 4596826 Шаров Александр Сергеевич AFNWF1
У клиента в Т4.0 постоянно путаются значки эмитентов 
Версия 4.0.3843.1725

Со слов клиента: От версии не зависит вообще. Всегда значки путались.

 

у Алросы отображается иконка камаза",,1.0,НТФ (ЛК)
ADIRINC-1243,3598481,U_M1LYY,Закрыт,28.08.2023 18:32,,,,,Дефект промсреды,05.09.2023 13:00,2023-10-10 00:00:00.0,"При проставлении цены в форму детализации, указываем 6 цифр после запятой. Далее при сохранении, цена становится с 3мя цифрами после запятой.

Округление ведет к некорректному учету расходов.",,,
ADIRINC-1242,3598458,U_M18JH,Отклонен,28.08.2023 18:01,,,,,Дефект промсреды,30.08.2023 15:13,2023-10-30 00:00:00.0,"Клиент AR90H2 ГС 2987207  Ким СУК ЧА.
СУК ЧА - Имя клиента, отчества нет.
В МТ в профиле отображается просто СУК. Хотя в hell.dbo.anket_person в поле name стоит ""СУК ЧА""",,1.0,Мобильный терминал
ADIRINC-1238,3595736,U_M1QX4,Отклонен,28.08.2023 11:40,,,,,Дефект промсреды,03.09.2024 10:09,2023-10-09 00:00:00.0,"Клиент AVUDQM 4374901

Утверждает, что индикатор не корректно отображает дельту на кластерах. 
Версия актуальная 4.0.3843.1725, базовые рекомендации не исправили ситуацию, переустановка терминала, также не помогла.

Последние кластеры отсутствуют, манипуляции не помогли. Почему индикатор Дельта показывает разные данные на одних и тех же свечах?

папку DB (В ней содержится кэш) клиент чистила.",,3.0,АИ ПРО
ADIRINC-1237,3592852,U_M17SM,На исправление,25.08.2023 17:29,ОТЭИСФЛ,,,,Дефект промсреды,,2024-10-15 00:00:00.0,"У клиента в АД4 на двух графиках с разным таймфреймом одного и того же инструмента отображается разная цена. Во вложении - логи и видео клиента. Данная проблема происходит с разными бумагами. На скрине пример c OZON. ISIN: US69269L1044

[^logs.7z]",,,АИ ПРО
ADIRINC-1235,3592533,U_M1AYY,Закрыт,25.08.2023 16:02,,,,,Дефект промсреды,30.01.2024 12:37,2023-10-06 00:00:00.0,"Шаги воспроизведения:
 # Клиент т android 2.24.1 заходит в раздел Аналитика–Отчет
 # Смотрит на цифры
 # Видит , пополнения в валюте на большую сумму
 # !image-2023-08-25-15-58-27-765.png!!image-2023-08-25-15-58-43-457.png!

Фактически:

Пополнений в валюте у него либо не было совсем за выбранный период , либо на значительно меньшую сумму.

Если дернуть сервис аналитики , то таких цифр не видим

[http://adir-portfolio-analytics.k8s-master.alfadirect.ru/swagger/index.html]

Пример вызова:
  
 {{curl -X 'GET' \
 'http://adir-portfolio-analytics.k8s-master.alfadirect.ru/api/portfolioanalytics?accountId=205037&dateFrom=2023-07-25&dateTo=2023-08-25' \
 -H 'accept: application/json' \
 -H 'X-Request-Id: 00000000-0000-0000-0000-000000000001' \
 -H 'X-External-System-Code: ADMT' \
 -H 'X-External-User-Code: iordanskiy_support' \
 -H 'Content-Type: application/json;v=1'}}

{{Ответ в приложенном файле ..OUTswagger.txt}}

Не понятно откуда берутся данные в отчете по валюте.

{{}}",,104.0,Марс
ADIRINC-1234,3589827,U_M18JH,На исправление,25.08.2023 09:41,,,,,Дефект промсреды,,2023-12-08 00:00:00.0,"Клиент авторизируется в приложение Альфа-Инвестиции по карте банка:
ОР: Вызовы в пайпе логируются с каналом I1
ФР: Вызовы в пайпе логируются с каналом M2

Дефект перенесли из пространства паспорта, так как это дефект АИ",,,K2
ADIRINC-1229,3579002,U_M0WVN,Закрыт,22.08.2023 16:26,,,,,Дефект промсреды,22.08.2023 16:27,2023-10-03 00:00:00.0,"Кривченко Татьяна Витальевна AVWM4N

Версия приложения: 2.22.1
Логин: krivchenko_t
Устройство: HUAWEI PAR-LX1
 # Клиент совершает сделку по бумаге РУСАЛ покупку на 160 000. у клиента в заявке указано ,что будет списана комиссия на сумму не более 78,40 руб., но при этом по тарифу трейдер присутствует дополнительное вознаграждение в размере 0,02% и суммарно комиссия за эту сделку составляет - 104,4 руб. 
 # Пожелание клиентов ,чтобы в приложении поменяли расчет комиссии и при выставлении заявки стали отображать суммарно комиссию с учетом всех удерживаемых сумм. Так как приложение отображает сумму и указывает ""не более (определенной суммы"", но при этом сумма списывается БОЛЕЕ,чем та, которая указана.

Либо нужно писать какая именно комиссия ИЗ удерживается.

 

 

!image-2023-05-18-12-49-53-843.png!",,2.0,Core
ADIRINC-1228,3578151,U_M177U,Отклонен,22.08.2023 13:53,,,,,Дефект промсреды,30.08.2023 14:44,2023-12-05 00:00:00.0,"Шаги воспроизведения:

1. Клиент заходит на андроид 2.24.1 в раздел Аналитика.

2. При выборе *СВАЙПОМ* (при выборе пальцем ок) между Отчет и Состав портфеля, съезжает подсветка раздела)

Проверяли на ос андроид 13 версии

!image-2023-08-22-13-51-20-096.png!

!image-2023-08-22-13-50-57-021.png!

!image-2023-08-22-13-50-44-213.png!",,1.0,Мобильный терминал
ADIRINC-1225,3573781,U_M1QX4,Отклонен,21.08.2023 15:45,,,,,Дефект промсреды,12.01.2024 09:50,2023-10-02 00:00:00.0,"Не может войти в веб - терминал по логину паролю

Клиент - Зикриоллохи Холзода 6453948.
||Id клиента||ank_no||*Логин*||EQ ПИН||ФИО||Номер||mail||ГС||Суб.счет||БС||Тип||Закрыт?||Тариф||id логин||Торговля||FATCA||Актуализация||EQ||Тип БС||
|6029735|6534648|*z*|AT8RML|- Зикриоллохи Холзода|79657038720|zikriollo007@gmail.com|6453948|6453948-000|30601810200036453948|GK|N| |106333480|0 - везде|1 - без ограничений|1231130|Y|0 - БС|


Клиенту в смс был направлен логин и пароль. фамилии у клиента нет! в паспорте РФ где ""фамилия"" у клиента пусто! Его зовут Зикриоллохи , Холзода - отчество. система присвоила клиенту логин 1 букву - ""z"". клиент в поле логин указывает ""z"", пароль присвоенный системой и он не может войти в АИ, потому что логин должен быть из 6-ти символов. 
как авторизоваться под логином / паролем клиенту? восстановить данные не может, потому что если ставит прочерк, система не пропускает и пустое поле оставить тоже нельзя.

оркад изменять логины не может, как клиенту в таком случае авторизовываться в веб терминале?",,,АИ ПРО
ADIRINC-1224,3572602,RSRamazanov@investlab.tech,Закрыт,21.08.2023 13:24,,,,,Дефект промсреды,21.03.2024 10:40,2023-10-02 00:00:00.0,"У клиента показывает баланс на фортс 0, но при этом он смог выставить заявку, которая исполнилась

https://rc.alfa-bank.net/channel/team-invest-web-terminal?msg=MfpGNoknKcHWwsSPT",,10.0,АИ ПРО
ADIRINC-1219,3561354,RUM1BPH,Отклонен,17.08.2023 13:13,,,,,Дефект промсреды,11.01.2024 10:26,2023-09-28 00:00:00.0,"Коллеги, к нам обратился клиент ГС 4330920 по поводу неправильного отображения итогов в разделе ""Движение денежных средств за период"" 
 !image-2023-08-17-13-15-26-615.png|width=1145,height=491!
 По итогу разбора причин неправильного подсчёта итогов обнаружено, что тип операции зависим от переменной окружения ELR_SYS_NAME_TRANS%.
 В брокерском отчёте используется вью hell.dbo.all_EXTRA_transfers_report_2017, в которой поле oper_type определяется так:
 !image-2023-08-17-13-20-31-327.png!
 .где 
 !image-2023-08-17-13-23-24-753.png!

При этом значение =1 зависит от того, находится ли sys_name, указанный в трансфере, в списке окружения или нет.

Сейчас мы видим, что в переменные окружения добавлены новые sys_name
 !image-2023-08-17-13-25-19-337.png!
 Ситуация с итогами в брокерском отчёте +этого клиента+ таким образом была исправлена.

Сутью дефекта считаем, что определение типа операции не должно зависеть от переменной окружения, которая не логируется, не имеет аудита, не является времезависимой, не является темпоральной.
 В переменную окружения, как видим, можно легко что-то добавить, и, наверное, не сложнее что-то убрать. 
 А от этого зависит то, как клиентам выводится +юридически значимый+ брокерский отчёт.",,,Core
ADIRINC-1218,3560545,U_M1QX4,Отклонен,17.08.2023 11:44,,,,,Дефект промсреды,03.09.2024 10:09,2023-09-28 00:00:00.0,"4336753 Косарев Сергей Владимирович AVTQGY

после обновления у клиента не прогружаются графики по инструментам
базовые рекомендации не помогли

версия терминала 4.0.3843.1725

 ",,10.0,АИ ПРО
ADIRINC-1214,3560129,U_M1QX4,Отклонен,17.08.2023 11:31,ОТЭИСФЛ,,,,Дефект промсреды,03.09.2024 10:10,2023-11-10 00:00:00.0,"Клиент 12843 Веселов Павел Владимирович AAEM89
У клиента в Т4.0 Версия Терминала 4.0.3843.1725 не работает фильтр в окне сделок.

Если отмечает только тип ""Trade"" и количество >=0 (не имеет значения), то сделки вообще не появляются.
Если убрать все фильтры - бегут строки Bid, Ask, Bid Size, Ask Size.",,,АИ ПРО
ADIRINC-1212,3554332,U_M1DKF,NEW,15.08.2023 18:45,,,,,Дефект промсреды,,2023-09-27 00:00:00.0,"У клиента в ЛК в истории по  521586-001 не отображается пополнение на 3 500 000,00 руб.

Проблема в ХП [cabinet].[GetTreatyMoneyTransfers]

Подробности в  https://rc.alfa-bank.net/channel/adir-lk-pub?msg=hr6TSHp4qugPmWfux",,11.0,НТФ (ЛК)
ADIRINC-1211,3553709,U_M0WVN,Отклонен,15.08.2023 17:46,,,,,Дефект промсреды,22.08.2023 17:54,2023-08-24 00:00:00.0,"15.08.2023 занчительный инцидент - массовые проблемы с выводом с Инвесткопилки.

В процессе разбора проблем выяснили, что данная авария повторение проблемы от 10.08.2023

Инструментам массово, втч AKMB (БПИФ Упр.облигации для, торгуется в инвесткопилке) был проставлен IdTradePeriodStatus = 1 из-за некорректной даты в поле prevdate. Должен стоять предыдущий день в *_adfront.micex.securities_*

*_select prevdate, * from [micex_raw_data].[micex].[Securities] where isin = 'RU000A101PN3' and secboard = 'tqtf'_*

*_select prevdate, * from adfront.micex.securities where isin = 'RU000A101PN3' and secboard = 'tqtf'_*

!image-2023-08-15-17-33-34-873.png!

*Сделали бекап БД Adfront на 6 утра 15.08.2023*

Если смотреть изменения по таблице и бэкап видим, что шлюз обновлял поле PrevDate с 5:54 до 5:58. Как раз в это время наблюдались ошибки в адаптере

!image-2023-08-15-17-39-25-271.png!

А еще дальше ошибка  в триггере возникает, из-за чего  откатывается обновление даты:

*{{*
 **Ошибка № 2627 в строке 679 модуля: Securities_iu_repl. Текст ошибки: Violation of PRIMARY KEY constraint 'PK__#AC5840E__B7738869EF4AD82C'. Cannot insert duplicate key in object 'dbo.@MicexFinInfoExtTable'. The duplicate key value is (768054).*
 *}}{{*
 *SELECT * from [ADFrontArchive].[Logs].[ErrorInfoLog]*
 *WHERE ErrorProcedure = 'dbo.MicexSecuritiesSave'AND Date BETWEEN '20230815 05:50' AND '20230815 05:59'AND ErrorMessage IS NOT* null}}*

---------------------------------------------------------------------

Пример по IdFI = 244363

IdFI = 244363 - сам является дублем в ADFront.micex.Securities

*_{{SELECT top 100 date ,}}_* _{{from ADFront.[dc].[MicexSecurities]WHERE IdFI = 244363AND date > '20230814'ORDER BY 1 DESC}}_*

{{_*SELECT top 100 * from ADfront_20230815_0600.micex.SecuritiesWHERE IdFI = 244363SELECT top 100 * from ADFront.micex.SecuritiesWHERE IdFI =*_ _*244363*_}}

К чему пришли в процессе разбора и проверки нескольких версий:
 # Шлюз обновляет записи в micex.Securities с помощью ХП dbo.MicexSecuritiesSave
 # Триггер micex.Securities_iu_repl собирает пакет 'Micex_FIE_Make' (тут попадают дубли по idfi)
 # Пакет разбирает адаптер Objects.Micex_FIE_Make_Adapter_SaveData, в котором возникает ошибка заполнения временной таблицы из-за дублей @MicexFinInfoExtTable. Как выяснили выше ошибка в триггере возникает.
 # Все записи попавшие в пачку с дублем не обновляются в итоге.

{{}}",,,
ADIRINC-1210,3553245,U_M1BFA,Закрыт,15.08.2023 15:07,,,,,Дефект промсреды,30.01.2024 13:23,2023-09-26 00:00:00.0,"*Шаги воспроизведения:*

1. Клиент вводит логин и пароль

2. Идет подключение, терминал подключается

3. Далее начинают грузится окна и графики

4. Далее выкидывает на рабочий стол.

Подключение к сети нормальное, сторонних программ не использует, с логином и паролем ок

Видео и так же логи из папки Config во вложении[^ConnectionInfo (2).cfg.txt]",,,АИ ПРО
ADIRINC-1207,3548163,U_M1QLD,Отклонен,14.08.2023 13:08,,,,,Дефект промсреды,27.12.2023 14:39,2023-09-25 00:00:00.0,"Клиент AC3AWU 4250708  совершил сделку на 139,92-140,58 рублей, но на графике бумага отображается в районе 144 рублей.  Выше текущей цены, которая 140,06, у клиента не было сделок выше этой цены за последний месяц.



 ",,9.0,Мобильный терминал
ADIRINC-1206,3548015,U_M1QLD,Закрыт,14.08.2023 12:49,,,,,Дефект промсреды,08.11.2023 14:55,2023-09-25 00:00:00.0,"Клиент 4924307 Седых Михаил Юрьевич ARYDUB Проваливается в бумагу, заходит в график, выбирает lite режим. Ставя любой таймфрейм, график не соответствует. ",,10.0,Мобильный терминал
ADIRINC-1205,3547637,,Отклонен,14.08.2023 11:56,,,,,Дефект промсреды,11.01.2024 17:58,2023-09-25 00:00:00.0,"При попытке открытия брокерского счета, у клиента возникает ошибка ""Нужен второй заход""

 

[https://ibank/mon2/s/adir-space/goto/273e8e20-3a80-11ee-a21c-bb93df2df018]

В логах ""Ошибка при проверке операции. ActionID=ERRCUR7780""
По логам данная ошибки тянется с 14.05 ",,,Core
ADIRINC-1203,3529833,U_M00ZM,Закрыт,10.08.2023 13:17,,,,,Дефект промсреды,07.02.2024 11:49,2023-11-02 00:00:00.0,"10.08 по инструментам проставился запрет на торговлю инструментом, 

подробнее в [https://rc.alfa-bank.net/channel/adir-avarii?msg=AvtnNSMQZRMhGMtdX]",,67.0,Core
ADIRINC-1201,3524253,U_M0RCG,Отклонен,09.08.2023 10:17,,,,,Дефект промсреды,29.05.2024 06:40,2023-11-01 00:00:00.0,"Клиент заходит в приложение. Проваливается в бумагу в раздел график и видит, что в сводке- дневной диапазон отображается некорректная информация (Например минимальную цену за день больше чем текущая цена.)",,6.0,Мобильный терминал
ADIRINC-1200,3523366,U_M1CE2,Закрыт,08.08.2023 18:23,platform,,,,Дефект промсреды,22.08.2023 10:33,2023-09-20 00:00:00.0,"Обращается клиент 1852617 вопрос по заявке 45246203984 можем проверить, почему статус поменялся? Сам клиент в это время не заходил.
 !image-2023-08-08-18-26-39-671.png!
 Поручения от клиента только на выставление заявок по инструменту, на удаление нет
 !image-2023-08-08-18-27-20-696.png!
В логах Лс такая информация
 *  {{Aug 8 08:59:26.068987 adwls01 ls[4091382:4093065]/debug(tf): [sock:0x7f88e784a100 FD:53 ASFORTS-41 172.21.110.161] - (out-tcp) [L=51]CnlOrd=
{[IdFI=1988253][IdMktBrd=56][NED=45246203984][EOrdN=1963035938170942334][IdRzd=29143889][OrdStRev=9][BuySell=Buy][IdOrdT=LMT][IdQntT=QTY][IdLfTm=D30][ClOrdId=][IdDocT=TRD][IdAcc=1852617]}
}}",,2.0,
ADIRINC-1199,3521027,U_M19LL,Закрыт,08.08.2023 12:35,,,,,Дефект промсреды,23.04.2024 09:51,2023-10-09 00:00:00.0,"При ""свайпе"" между подразделами состав портфеля и отчёт возникает зависание вкладки (Скрин от клиента как это выглядит на устройстве). При этом невозможно просмотреть страницу, пока не нажмёшь на ту вкладку которую хотел посмотреть. !планка.png|width=372,height=386!",,2.0,Мобильный терминал
ADIRINC-1198,3520628,U_M19LL,Закрыт,08.08.2023 12:01,,,,,Дефект промсреды,24.05.2024 15:49,2023-08-17 00:00:00.0,"Рыночная заявка поданная из  Альфа мобайла  не исполняется, а после 00:00 она превращается в лимитную. 

Для  примера : 

клиент:Антонов Алексей Егорович ASTRAP 322274 выставил рыночную заявку 44842448484 в Альфа-Мобайле
 28.07 на покупку RU000A1065S5
Она не исполнилась и в статусе ""активная""



!image-2023-08-08-11-56-39-950.png!",,17.0,Core
ADIRINC-1195,3506820,U_M0WVN,Отклонен,03.08.2023 16:17,,,,,Дефект промсреды,22.08.2023 16:21,2023-09-14 00:00:00.0,"*Описание:*

1.08.2023 в 10.00.07 сек упал ЛС , в дампе системы в момент падения присутствуют только ошибки обращения к нулевому адресу.

При этом как такового нулевого адреса нет. Других деталей в логах сервиса установить на данный момент не удалось.

*Со стороны сервера, что видно в заббиксе:*

1. adwls01: Used disk space on /var/coredumps данный диск заполняется. Как только перестает расти память авария завершилась.

!image-2023-08-03-16-15-37-168.png!

Причина это или следствие неясно.

Однако заметил , что за 6 месяцев в момент роста данного раздела у нас были аварии с падением ЛС:

IM14735726 Деградация Лимитного сервиса из за реборна заявок выставленных повторно. 18.04.2023 11.35-11.59
 IM14516154 Воспроизведение бага [https://jira.moscow.alfaintra.net/projects/ADIRSVC-3802 (таски этой сейчас не существует почему то)|https://jira.moscow.alfaintra.net/projects/ADIRSVC-3802] из-за которого упал Лимитный сервис и не мог подняться 17.02.2023 12.01-12.24
 IM14925377 Полностью устранен, выполнен рестарт 9.06.2023 6.36-7.05

+ последняя 1.08.2023

 

!image-2023-08-03-16-14-39-035.png!

 Дополнительно задал вопрос коллегам в канал на счет этих и других метрик [https://rc.alfa-bank.net/channel/adir_admins_public?msg=zqfu9WvJyBT6D4Lhr]

Может быть в момент заполнения данного раздела места свободного всего мало остается (нижний график)?

 ",,,
ADIRINC-1194,3505523,U_M1QLD,Закрыт,03.08.2023 14:10,,,,,Дефект промсреды,11.10.2023 14:09,2023-10-26 00:00:00.0,"Клиент обновил версию приложения до 2.24.1. 
В данной версии переходя в раздел рынки и попытавшись найти облигацию ru000a105qx1 у него она не находится, в то время как в предыдущих версиях поиск работает корректно.",,9.0,Мобильный терминал
ADIRINC-1192,3505294,,Закрыт,03.08.2023 13:09,,,,,Дефект промсреды,22.01.2024 10:48,2023-09-14 00:00:00.0,"Клиент 260081 Плечко Игорь Владимирович G57919
У клиента в Т4.0 не загружается график по Сегеже SGZH и Детский мир DSKY, по другим инструментам все хорошо

Версия терминала 4.0.3843.1725",,3.0,АИ ПРО
ADIRINC-1191,3505444,U_M1BFA,Отклонен,03.08.2023 13:05,,,,,Дефект промсреды,04.08.2023 10:26,2023-10-04 00:00:00.0,"Во вкладке Новости не появляются новые сообщения с 31 июля.
Сервис adir-etl-news-interfax перестал принимать входящие запроса начиная с 1 августа
При вызове метода /api/Publishing/PostPieceOfNews
Вызывающей стороне возвращается ошибка ""ssl.SSLError: [SSL: SSLV3_ALERT_HANDSHAKE_FAILURE] sslv3 alert handshake failure"".",,15.0,
ADIRINC-1189,3505128,U_M1CUE,Отклонен,03.08.2023 12:55,,,,,Дефект промсреды,21.11.2023 09:39,2023-10-26 00:00:00.0,"Клиент выгружает брокерский отчет. Отсутствует информация по цене по облигации  RU000A1019T0
В quotes.priceinfo.prices отсутствует информация о цене.

select * from openquery([prod1.alfadirect.ru],'
select a.isin, p.* from quotes.priceinfo.prices p
join HELL.DBO.ACTIVES a on a.act_id = p.act_id
where a.isin = ''RU000A1019T0''
and algorithmid = 1
and dateprice > ''20230529''
order by dateprice
')

До 20.08.23 должна интеграция с CBonds заработать, где, вероятно, будет инфа по ценам",,1.0,Core
ADIRINC-1185,3486058,U_M1BFA,Отклонен,28.07.2023 15:07,,,,,Дефект промсреды,19.02.2024 16:45,2023-09-28 00:00:00.0,"При попытке авторизоваться в terminal.alfadirect.ru при нажатии на кнопку войти клиента перекидывает на private.auth.alfabank.ru с ошибкой ""Похоже, что-то пошло не так"" 

 

Временное решение - очистка куки файлов и кэша. 

!image-2023-07-28-15-05-42-896.png!!image-2023-07-28-15-05-42-810.png!",,0.0,АИ ПРО
ADIRINC-1178,3478110,RUM1BPH,Отклонен,26.07.2023 20:50,,,,,Дефект промсреды,23.05.2024 12:11,2023-09-07 00:00:00.0,"К нам обратился клиент ГС 3746772 по поводу расхождения портфеля в брокерском отчёте и в МТ.
 При проверке выяснилось, что актив FOODTECHN (RU000A106DH0) отображается в МТ, но *не отображается в брокерском отчёте в текущем дне (Т0)*:

!image-2023-07-26-20-48-50-544.png!

 снимки делались 26.07.23

!image-2023-07-26-20-56-58-850.png!

В незавершённых сделках операция видна:

!image-2023-07-26-21-00-30-326.png!  ",,3.0,Core
ADIRINC-1177,3473077,U_M1DKF,NEW,25.07.2023 17:19,,,,,Дефект промсреды,,2023-09-05 00:00:00.0,"Клиент 4307751_Шиляев Андрей Александрович AVS7ZW shiliaev_a2 при переходе в раздел переводов ДС появляется пустой экран. 
1. переводы - на банковский счет - белый лист
2. нажать на валюту в портфеле - перевести - белый лист
3. переводы - между счетами - выбор счета - работает
воспроизведение проблемы происходит на новых версиях приложения 2.24.1 Андройд",,29.0,Личный кабинет
ADIRINC-1175,3470323,U_M1HCS,Отклонен,25.07.2023 13:12,,,,,Дефект промсреды,22.08.2023 16:22,2023-09-25 00:00:00.0,"# Клиент сменил тариф неделю назад примерно 14.07
 # Смотрит у себя в АИ на андроиде в разделе Тариф

Фактически:

Видит расхождение в названии текущего тарифа на фронте приложения и бэке

!image-2023-07-25-13-08-30-923.png!

В бэке :

!image-2023-07-25-13-09-25-663.png!

 

 

!image-2023-07-25-13-09-00-756.png!

Сейчас вызывается tariffs-api:

В ответе видим /current
 * 
response body={
""name"" : ""Инвестор"",
""code"" : ""FIRST_STEP"",
""changeDate"" : ""2023-07-07T11:30:03"",
""specialTariffId"" : 0
}
Ссылка:  * 
[http://adlog1/kibana/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:now-4h,to:now))&_a=(columns:!(message),filters:!((]'$state':(store:appState),meta:(alias:!n,disabled:!t,index:c86b4360-0ca6-11ec-93ad-93845fce08b0,key:app_id,negate:!f,params:(query:gifts-api),type:phrase),query:(match_phrase:(app_id:(query:gifts-api)))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:c86b4360-0ca6-11ec-93ad-93845fce08b0,key:level,negate:!f,params:(query:ERROR),type:phrase),query:(match_phrase:(level:(query:ERROR)))),('$state':(store:appState),meta:(alias:!n,disabled:!f,index:c86b4360-0ca6-11ec-93ad-93845fce08b0,key:user_id,negate:!f,params:(query:BA1NK2),type:phrase),query:(match_phrase:(user_id:BA1NK2))),('$state':(store:appState),meta:(alias:!n,disabled:!f,index:c86b4360-0ca6-11ec-93ad-93845fce08b0,key:app_id,negate:!f,params:(query:tariffs-api),type:phrase),query:(match_phrase:(app_id:tariffs-api)))),index:c86b4360-0ca6-11ec-93ad-93845fce08b0,interval:auto,query:(language:kuery,query:'*'),sort:!('@timestamp',desc))
Логи директовского сервиса https://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=661757183: http://adirelkprod.alfadirect.ru/goto/7f17400020bdba67bcef7f10ee60d7a1",,,
ADIRINC-1174,3470341,U_M1QX4,Отклонен,25.07.2023 12:12,ОТЭИСФЛ,,,,Дефект промсреды,03.09.2024 10:10,2023-10-17 00:00:00.0,"1027512 Рачин Виталий Александрович AIE2C8В 
Платформа: ADВерсия 4.0.3843.1725
На графике по всем инструментам некорректно отображается текущая дата свечи/бара, на графике она - 16.07.2023(воскресенье).
Причем график корректный и должна стоять дата 17.07.2023 на свечи",,,АИ ПРО
ADIRINC-1173,3469686,U_M1EJ8,Закрыт,25.07.2023 11:31,,,,,Дефект промсреды,01.08.2023 11:54,2023-09-05 00:00:00.0,"Из-за недоступности связи с БД запросы Position keeping  падали с ошибками 
{code:java}
Microsoft.Data.SqlClient.SqlError: Error: 41341, Severity: 16, State: 1. (Params:). The error is printed in terse mode because there was error during formatting. Tracing, ETW, notifications etc are skipped.
Microsoft.Data.SqlClient.SqlError: Execution Timeout Expired. The timeout period elapsed prior to completion of the operation or the server is not responding.
Microsoft.Data.SqlClient.SqlError: Could not find stored procedure 'mrgn.get_params'.
{code}
После перезапуска Position Keeping  начал выдавать ошибки: 
{code:java}
Input array is longer than the number of columns in this table.
{code}
Данная ошибка возникает когда сервис не смог получить метаданные TVP параметров из базы. Эти метаданные кэшируются сервисом и в данном случае возникла ситуация при которой за кэшировался пустой массив с метаданными для TVP параметров, в результате сервис не мог вызвать некоторые хранимые процедуры и продолжил выбрасывать данную ошибку уже после восстановления доступности бд.

Решение:

На стороне сервиса необходимо сделать доработку: не выполнять кэширование пустого массива метаданных TVP параметров, в случае, когда их не удалось получить из базы.  Это позволит сервису при восстановлении доступности бд восстановить работоспособность без перезапуска.",,,
ADIRINC-1172,3467445,U_M0WVN,Закрыт,24.07.2023 17:08,Appalachians,,,,Дефект промсреды,24.04.2024 12:01,2023-09-04 00:00:00.0,"# Клиент смотрит график за 6 мес и год
 # Картинка не изменяется, и остается будто бы за 3 недели

OS устройства: ANDROID
Версия МП: 2.24.1
Платформа: MT

Замечено у нескольких клиентов на 2.24.1 , например гс 4407913 ниже скрины

У коллег на этой версии андроид воспроизводится так же.

!image-2023-07-24-17-06-37-038.png!!image-2023-07-24-17-06-48-710.png!",,2.0,Мобильный терминал
ADIRINC-1165,3453376,U_M1RH8,Закрыт,20.07.2023 10:31,,,,,Дефект промсреды,12.01.2024 15:59,2024-02-29 00:00:00.0,"C 19.07.2023 начали поступать обращения клиентов, торгующих на срочном рынке ФОРТС, по вопросам некорректности работы револьверных заявок. В результате разбора одной из проблем выяснилось, что поломан функционал по револьверным заявкам. Создана соответствующая задача на исправление.",,1.0,
ADIRINC-1164,3451837,U_M1BFA,Отклонен,19.07.2023 18:08,,,,,Дефект промсреды,12.01.2024 15:12,2024-04-12 00:00:00.0,"Клиент Исаенко Андрей Николаевич, 
 Платформа веб-терминал. trade.alfadirect.ru
 В разделе ""портфель"" при выводе отображается налог к доплате 47311, хотя у клиента он уже был удержан 28.06.2023

 

{{SELECT fTOPAY, fSUMPAYED, fRFTORETURN, fPROMTAX,  * FROM tax_data.tax.Register WHERE AccountID = 928093 AND TaxYear = 2023 }}

{{!https://rc.alfa-bank.net/file-upload/ktBBeBkPrqePDX24i/Clipboard%20-%2019%20%D0%B8%D1%8E%D0%BB%D1%8F%202023%20%D0%B3.,%2011:18.png!}}

{{SELECT * FROM a_hell_opers.dbo.a_payments WHERE treaty IN ( 928093, 4624831) AND a_date >= '2023-01-01' AND month_period = '2023-12-31' AND payment_type = 'TAXES'
!https://rc.alfa-bank.net/file-upload/WhAnB9fRq9ndrburX/Clipboard%20-%2019%20%D0%B8%D1%8E%D0%BB%D1%8F%202023%20%D0%B3.,%2011:24.png!}}",,1.0,АИ ПРО
ADIRINC-1159,3449659,U_M1CUE,Закрыт,19.07.2023 13:16,,,,,Дефект промсреды,12.01.2024 11:29,2024-03-21 00:00:00.0,"19.07.2023 в 9:50 упал сервис Trade Services REST API из-за чего не было доступно выставление заявок через Альфа-мобайл. Клиенты на фронте наблюдали ошибку ""кое-что сломалось"". 
На RUM наблюдалось что /adir/tradelimits получал ошибку запрашивая лимиты с  Trade Services REST API, соответственно лимиты не проверялись, из-за чего заявки не выставлялись. 
Необходимо так же уточнить из-за чего упал сервис и как мы можем его отслеживать что он в порядке(настройка мониторингов в том числе)",,,
ADIRINC-1158,3449643,U_M1AYY,Отклонен,19.07.2023 12:59,,,,,Дефект промсреды,22.02.2024 17:41,2023-08-30 00:00:00.0,"Коллеги, к нам обратился клиент ГС 242911 по поводу неправильного отображения УЦ для облигации SELGOLD01 (RU000A1062M5)
 Бумага имеет переменный номинал, зависящий от цены золота.
 При этом видим, что УЦ составляет на сегодня 19.07.2023 – 97,58143%.
 !image-2023-07-19-13-42-34-602.png!
 !image-2023-07-19-13-02-10-228.png|width=1397,height=379!

Эта величина получается усреднением от цен покупки, которые учтены в процентах.
 УЦ1 = (100*4+95,05+94,02+94) / 7 = 97,58143

Считаем, что УЦ должна считаться в рублях в соответствии с калькулятором
 !image-2023-07-19-12-53-48-084.png!

а затем приводить эту полученную УЦ к номиналу.

УЦ2 = (4961,49*4+5102,11+5046,82+5045,75) / 7 / 5673,24(*номинал на 19.07)* * 100 = 88,2354",,,Марс
ADIRINC-1150,3436820,U_M00ZM,Отклонен,14.07.2023 15:09,,,,,Дефект промсреды,20.12.2023 09:48,2024-03-21 00:00:00.0,"С версии МТ 2,24 в рынке разделе Индексов отображается только 3 индекса",,47.0,Core
ADIRINC-1148,3434805,U_M1BFA,NEW,14.07.2023 10:58,,,,,Дефект промсреды,,2023-08-25 00:00:00.0,"ОР: Клиент видит корректный баланс

ФР: Клиент видит баланс = 0 если у него в активах есть GBP, AED

 

На фронте неверно подтягивается цена по GBP = Nan, из-за чего неверно считается баланс. 

!image-2023-09-20-14-10-57-060.png!

!image-2023-09-20-14-14-23-908.png!",,6.0,Web
ADIRINC-1143,3423817,U_M19LL,Закрыт,11.07.2023 19:03,,,,,Дефект промсреды,17.01.2024 16:01,2023-08-23 00:00:00.0,"Веб-терминал.

Установленные по инструментам индикаторы пропадают с графика, если перезайти в терминал.
!image-2023-07-11-19-00-46-211.png!

!image-2023-07-11-19-01-01-336.png!",,3.0,АИ ПРО
ADIRINC-1139,3419245,U_M19LL,Закрыт,10.07.2023 19:24,,,,,Дефект промсреды,18.01.2024 10:23,2023-08-22 00:00:00.0,"Клиент заходит в ДТ в вкладку ""Позиция"":

ФР: По инструменту RU000A0NR6E2 НПУ отображается -100%
ОР: По инструменту RU000A0NR6E2 НПУ отображается -0.04%

В АД 4.0 НПУ считается на основе поля  LastPrice, вместо FairPrice 

В AdFront.fi.FinInfoExt  поле LastPrice = NULL, FairPrice = 99.96 
В МТ отображение корректно, так как для расчета берется FairPrice

!image-2023-07-10-19-22-50-901.png!

!image-2023-07-10-19-23-27-312.png!

 ",,,
ADIRINC-1138,3418335,U_M00ZM,Закрыт,10.07.2023 16:44,,,,,Дефект промсреды,24.10.2023 09:34,2024-03-21 00:00:00.0,"Клиент: Дерюжко Марина Ивановна AVW5XK 4482802
OS устройства: ANDROID Версия МП: 2.23.1
Клиенту не поступило 26.06. пуш-уведомление о зачислении частичного погашения номинала облигации.
В ibank только уведомления о поступлении купона (скрин).

26.06.2023 г. в 17:35:16 клиенту на бс поступило зачисление: Частичное погашение номинала 4B02-01-01671-D-001P (Облигации ОАО ""АБЗ-1"") д.ф.23.06.23. Уведомление не сформировано, просьба уточнить причины.",,2.0,Core
ADIRINC-1133,3416742,U_M177U,Закрыт,10.07.2023 13:40,Фронт,,,,Дефект промсреды,21.09.2023 06:52,2024-03-21 00:00:00.0,"Коллеги, к нам обратился клиент 4381272 с проблемой отображения УЦ по активу TRNFP (RU0009091573).
 Он видит округлённую УЦ = 140130,00, хотя в БД УЦ = 140133,3333.

В результате запрошенной консультации ADIRINC-1097 выяснилось, что отображение в МТ реагирует на значение поля PriceStep и округляет до соответствующей точности, чего не должно быть, поскольку в результате усреднения (не важно, по средневзвесу или по FIFO) могут возникать любые значения.

Можно разобрать на примере этого же клиента.
 Куплено 2 акции по цене 140000 р. (при покупке условие PriceStep=50 для борда не нарушено) и куплена 1 акция по цене 140400 р. (при покупке условие PriceStep=50 для борда не нарушено).
 В результате расчёта УЦ получаем: (2*140000+1*140400)/3 = 140133,3333. Условие PriceStep=50, прописанное для борда, при усреднении нарушено, поэтому происходит округление до 140130.00. 
 Что не корректно.

!image-2023-07-04-10-13-33-743.png!",,1.0,Мобильный терминал
ADIRINC-1131,3415238,U_M1Q88,Закрыт,10.07.2023 11:33,,,,,Дефект промсреды,13.02.2024 15:26,2023-08-21 00:00:00.0,"Клиент 7667338 Звягин Максим Игоревич BAK90Q выводил ДС с копилки 03.07, пифы успешно продались, но ДС не поступили на банковский счет из-за ошибки ЛС-а при запросе лимитов. 
 ОР: Пифы вновь покупаются, затем снова можно вывести ДС

ФР: Пифы не купились, на счете только рублевая позиция, а текущая реализация не подразумевает такого исхода, и при попытке вывода происходит попытка продать пифы, которых нет.

Сервис [http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=660778449]

Делает выборку по ГС, которым нужно выставить заявку на покупку, используя ХП 

[https://git.moscow.alfaintra.net/projects/ADIR_SQLDB/repos/hell/browse/Hell/Stored%20Procedures/dbo.accounts_check_withdrawal.sql#1]

в выборку попадают те, кто заводил ДС и не совершал выводы в течение 5 дней.

 

https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=oaSCpKPKhtg5cxyiq",,29.0,Core
ADIRINC-1130,3411956,U_M1CUE,Закрыт,07.07.2023 17:09,,,,,Дефект промсреды,21.05.2024 18:17,2023-09-29 00:00:00.0,"Клиент 7605784 Микаелян Ян Андраникович AUUV8X
2023-07-06 16:08:21 пытается вывести ДС с инвесткопилки 216,74 референс - OB40607230005264
У клиента списывается только 34.28 рублей. После клиент пытается еще раз другую сумму или эту же, думая что ничего не начилилсоь и получает лимит 0.
Проблема в том, что остальная часть денег(216,74 - 34.28) залочены заявкой на покупку бумаг. НО почему же заявки зависли и вообще лочат лимит:
есть две заявки:
1) по инструкции
2) головная
Первая заявка уже была отменена, но при этом головная почему-то не отклонилась, из-за чего и лочила деньги.
Так же дефект заключается в том, что клиент хочет вывести одну сумму, и вместо того чтобы сказать что столько денег нет, он выводит то что есть зачем-то.

BrokerComment=Заявка #44001435384 отклонена. Ожидание регистрации на бирже.[BrokerErrorCode=OrderRejected_AwaitingStockExchangeRegistration][ConfirmedQuantity=136][SentTime=638243238389766999][SendCompletedTime=638243238389766075][TerminatedTime=638243238389797193][ClientNumStrategy=0][IdOrderType=LMT][IdQuantityType=QTY][IdPriceType=QUO][IdLifeTime=GTD][IdExecutionType=ASL][IdPriceControlType=None][IdSettleCode=64][IdObject=571196][IdMarketBoard=92][IdOrderStatus=Rejected][IdRazdel=36765045][LimitPrice=1.3344][StopPrice=0][LimitLevelAlternative=0][SignTime=2023-07-07T10:50:36.811327][BuySell=Buy][Contragent=][ContragentRef=][Quantity=136][OpenQuantity=136][ActivationTime=][WithdrawTime=2023-07-07T23:59:59][IdFIActivate=0][ActivationPriceDirection=Undefined][Value=0][Comment=][IdCommandType=Enter][IdDocumentType=Subordinate][Login=mi_login][ClientOrderNum=1658422887][ClientNumEDocument=LJZWO1-b5e2cba9-9e07-4fc7-b170-be1f62e1c25d-1658422887][NumEDocument=44001435384][AcceptTime=2023-07-07T10:50:36.857601][NumEDocumentBase=44001432384][Flags=MTRA|SFA]}

Jul 7 10:50:38.979846 adwabmcx02 asmicex[456376:456697]/debug(tf): [sock:0x7f9c13c5bf68 FD:40 #0:LS84@172.21.110.144:8004] - (out-tcp) [Length=129]RspEnterOrderEntity={ResponseOrderEntity={[ErrorCode=OrderRejected_AwaitingStockExchangeRegistration][ErrorText=ОШИБКА: (533) Неверно указан код клиента][ExtOrderNum=0][NumEDocument=44001435384][PenaltyRemain=0][Rest=0][IdSubAccount=4371717][OrderStatusRevision=4][IdAccount=7605784][ClOrdId=][ExtSessId=12240]}}

ответ биржи

Jul 7 10:50:38.979846 adwabmcx02 asmicex[456376:456697]/debug(tf): [sock:0x7f9c13c5bf68 FD:40 #0:LS84@172.21.110.144:8004] - (out-tcp) [Length=129]RspEnterOrderEntity={ResponseOrderEntity=

{[ErrorCode=OrderRejected_AwaitingStockExchangeRegistration][ErrorText=ОШИБКА: (533) Неверно указан код клиента][ExtOrderNum=0][NumEDocument=44001435384][PenaltyRemain=0][Rest=0][IdSubAccount=4371717][OrderStatusRevision=4][IdAccount=7605784][ClOrdId=][ExtSessId=12240]}

}",,474.0,Риски
ADIRINC-1127,3411090,U_M1QX4,Отклонен,07.07.2023 15:25,,,,,Дефект промсреды,11.09.2024 10:52,2023-09-29 00:00:00.0,"Не сохраняются горизонтальные уровни в терминале 4.0 после перезахода.

Версия 4.0.3765.1407

 ",,3.0,Pro terminal
ADIRINC-1126,3410936,U_M1CE2,Отклонен,07.07.2023 14:25,Инвестиции,,,,Дефект промсреды,13.07.2023 14:48,2024-02-29 00:00:00.0,"Некорректно отображается доходность за месяц
 !image-2023-07-07-14-27-18-097.png!
 Судя по всему некорректно посчитана Olap-аналитика за 7 июля, что транслировалось на клиентов

!image-2023-07-07-14-26-39-200.png!

Необходимо установить причину некорректного расчета за 7ое июля и его исправление

 ",,,АИ ПРО
ADIRINC-1123,3406677,U_M1CUE,Закрыт,06.07.2023 18:19,,,,,Дефект промсреды,12.07.2024 07:46,2024-06-28 00:00:00.0,"У клиента (AAZV3C,148597) была выставлена заявка, при этом при вхождении цены в коридор заявка не исполнилась (30 июня в 14:15) по цене 12.252. В итоге не сработал стоплосс и клиенту пришлось удалять ее руками 04.07.2023. 

Заявка 43133686584.

[https://rc.alfa-bank.net/channel/adir_duty/thread/S2qnNeAhzWJXJtPwk]",,17.0,
ADIRINC-1121,3406307,U_M214D,NEW,06.07.2023 17:21,,,,,Дефект промсреды,,2023-08-17 00:00:00.0,"Добрый день, на протяжение всего наблюдаем резкие скачки sync-user-settings-api.  !image-2023-07-06-17-17-53-924.png!
 По логам видим, что сервис пытается вызвать /fevorite-assests . 
 !image-2023-07-06-17-19-52-389.png!
 На запрос сервис ru.alfabank.mobile.exceptions.RequestValidationException: validation.error , что говорит нам о ошибки валидации входных параметров запроса. В итоге получаем следующую ошибку ""Извините, что-то пошло не так, попробуйте позднее."".

!image-2023-07-06-17-20-23-171.png!

В входящем запросе в (sync-user-settings-api -> /fevorite-assests) удалось найти некорректные данные, из-за которых предположительно происходит ошибка
 !Пример запроса (поле).png!

Тут важно заметить, что это не единственное такое поле, их много и они разные, но в целом, имеют схожесть в отсутствие полей. 

 ",,,Fuji
ADIRINC-1118,3404066,RUM1BPH,Закрыт,06.07.2023 11:49,,,,,Дефект промсреды,18.01.2024 16:04,2023-08-17 00:00:00.0,"Коллеги, к нам обратился клиент ГС 1542592 с вопросом, почему по цб RU000A102EM7 в МТ есть отличная от нуля дневная доходность?
 !image-2023-07-05-14-02-51-717.png|width=215,height=474!
 Цб не торгуется с 2022-02-25 ([https://www.moex.com/ru/issue.aspx?board=TQTD&code=TIPO&utm_source=www.moex.com&utm_term=RU000A102EM7])

В этой связи вопрос: можно ли при закачке котировок по данной бумаге установить приоритет для SourceID = 10 выше, чем SourceID = 21 в табл. [quotes].[PriceInfo].[AlgorithmDetails]? 
 На что это может влиять и в чьей компетенции это находится?

!image-2023-07-05-14-12-36-386.png!",,11.0,
ADIRINC-1115,3403700,U_M1AYE,Отклонен,06.07.2023 11:05,,,,,Дефект промсреды,25.06.2024 14:20,2023-08-17 00:00:00.0,"После переключения MQ  менеджеров на резерв 403311-23, сервисы трансляции adir-mq-it-mass-automatic-payments и adir-mq-it-own-client-payments не переподключились к очередям и ничего не вычитывали. 

[https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=oB3LFrKM86zeDHj4B]

[https://rc.alfa-bank.net/channel/adir-avarii?msg=FdWIvs86MoMCBsV5w]

 

upd:

14.03.2023 В рамках задачи ""переключение кластера IBM MQ ВЦ/НВЦ заявка №178596/24"" после переключения, сервисы:

 adir-mq-assign-manager
 adir-mq2db-imt-mass-automatic-payments
 adir-mq2db-imt-own-client-payments

не переподключились к очередям и ничего не вычитывали, с 23:30 до момента рестарта вручную, файловые логи по сервису adir-mq-assign-manager прикладываю в заархивированной папке   !image-2024-03-15-10-47-18-355.png!",,,Core
ADIRINC-1114,3403667,U_M00ZM,Отклонен,06.07.2023 10:55,,,,,Дефект промсреды,06.07.2023 11:54,2023-08-17 00:00:00.0,"После переключения MQ  менеджеров на резерв 403311-23, сервисы трансляции adir-mq-it-mass-automatic-payments и adir-mq-it-own-client-payments не переподключились к очередям и ничего не вычитывали. 

[https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=oB3LFrKM86zeDHj4B]

https://rc.alfa-bank.net/channel/adir-avarii?msg=FdWIvs86MoMCBsV5w",,,Core
ADIRINC-1113,3403665,U_M00ZM,Отклонен,06.07.2023 10:54,,,,,Дефект промсреды,06.07.2023 11:54,2023-08-17 00:00:00.0,"После переключения MQ  менеджеров на резерв 403311-23, сервисы трансляции adir-mq-it-mass-automatic-payments и adir-mq-it-own-client-payments не переподключились к очередям и ничего не вычитывали. 

[https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=oB3LFrKM86zeDHj4B]

https://rc.alfa-bank.net/channel/adir-avarii?msg=FdWIvs86MoMCBsV5w",,,Core
ADIRINC-1112,3403177,U_M07DK,Отклонен,06.07.2023 10:22,,,,,Дефект промсреды,10.07.2023 20:36,2023-08-22 00:00:00.0,"Акции СПБ Биржи (RU000A0JQ9P9) у клиента отображаются в валюте - доллар, хотя с 22 сентября СПБ биржа указала, что торги акциями будут проходить только в рублях. Клиент AVW42O 4596036 

Был установлен стандартный ликвидный рынок - MICEX_SHR_T 
!image-2023-07-06-10-19-17-487.png!
Использованные процедуры.
{code:java}
----Шаг 1. Просьба установить ликвидный рынок инструменту (ИЗМЕНИТЬ УЖЕ СУЩЕСТВУЮЩИЕ ЗНАЧЕНИЯ)
DECLARE @Objects Liquidity.ObjectsTableType
update ADFront.[Liquidity].[ExchangesManualPriority] set IdUniversalExchange = 1 where IdObject = 452346
update ADFront.[Liquidity].[BoardsManualPriority] set IdLiquidBoard = 92 where IdObject = 452346
----Шаг 2. Просьба пересчитать ликвидные рынки
declare @Objects Liquidity.ObjectsTableType
INSERT INTO @Objects (IdObject) VALUES (452346);
EXEC adfront.Liquidity.LiquidMarketsSet @Objects = @Objects;
{code}

Далее пересчитали, но ситуация для клиента осталась актуальной. График и стакан отображаются в рублях.",,2.0,
ADIRINC-1110,3402179,U_M18JH,Отклонен,05.07.2023 18:26,,,,,Дефект промсреды,06.03.2024 13:22,2023-08-17 00:00:00.0,"Массово поступают обращения от клиентов с проблемой авторизации

Для примера: APO3NB 7622478 проблема при входе в веб-версию АИ
Клиент не может войти в веб-терминал. Возникает ошибка (снимок экрана).
Базовые рекомендации(кеш,куки, смена WiFi на мобильную связь, VPN, перезагрузка) не помогли.
Переходит по ссылке trade.alfadirect.ru в браузере Safari.

!image-2023-07-05-18-23-20-234.png!",,1.0,K2
ADIRINC-1109,3402336,U_M1QX4,Закрыт,05.07.2023 17:47,,,,,Дефект промсреды,26.07.2023 13:03,2023-10-17 00:00:00.0,"В терминале, при каждом новом создании окна ""График(новая версия)"" строчка с выбором курсора, таймфрема и тд съезжает вниз перекрывая клавиши - закрыть, развернуть, свернуть",,1.0,АИ ПРО
ADIRINC-1105,3400091,U_M1AYE,Отклонен,05.07.2023 13:20,,,,,Дефект промсреды,05.07.2023 16:54,2023-08-16 00:00:00.0,"При попытке вывести ДС с копилки клиента отправляет на активацию в ДК, но фасад ДК возвращает ошибку активации. Рост таких ошибок начался после последнего релиза торговых сервисов 03.07

От данной проблемы страдает вывод с инвесткопилки в мобайле

https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=pEtyhvhjss5WcK2PE",,31.0,Core
ADIRINC-1100,3396865,U_M1CVV,Отклонен,04.07.2023 16:21,ОТЭИСФЛ,,,,Дефект промсреды,10.01.2024 10:50,2023-08-15 00:00:00.0,"Дима, конвертни эту задачу, плиз, в реквест.
хочу протестировать отчетность.

Спасибо!",,,АИ ПРО
ADIRINC-1099,3396534,U_M1CUE,Закрыт,04.07.2023 15:06,,,,,Дефект промсреды,12.01.2024 13:29,2023-08-15 00:00:00.0,"Из-за проблем на МТРА у части клиентов не отображаются инвестиционные счета в разделе ""все мои продукты""",,3.0,
ADIRINC-1094,3386686,U_M1BFA,Закрыт,30.06.2023 17:07,,,,,Дефект промсреды,13.07.2023 17:14,2023-08-11 00:00:00.0,"У клиента иногда ""плывут""  графики в вебтерминале.

Скрины и допинфо по нему прилагаю:

!2FB184D4-D684-41FE-B41C-54FE5588A7C1.PNG!

1. iPhone 12

2. браузер сафари

3. Использует мобильная связь и Wi-fi

4. За границей

5. Иногда ! Planet vpn, vpn master и платный и бесплатный , и с российским и с белорусским и европейским.",,2.0,АИ ПРО
ADIRINC-1093,3386761,RUM1BPH,Закрыт,30.06.2023 16:57,,,,,Дефект промсреды,26.01.2024 19:46,2023-08-11 00:00:00.0,"Клиенты обращаются с тем, что у них неправильно рассчитана УЦ.
 Предоставляют либо верно составленный калькулятор, либо скрин или сам брокерский отчёт с подтверждением цены зачисления.

Запуск pereschet_cen.sql по клиенту и активу не пересчитывает УЦ.",,36.0,Марс
ADIRINC-1092,3381441,U_M0WVN,Закрыт,29.06.2023 16:50,,,,,Дефект промсреды,22.08.2023 16:15,2023-08-10 00:00:00.0,"# Клиент имеет на счету более 6млн (проходит по условиям , с которыми можно получить статус квала)
 # Фактически в Настройки–>Статус квалинвестора нет кнопки ""Стать квалом"", а только лонгрид с сайта по квалу.
 # !image-2023-06-29-16-49-58-589.png!

Что удалось проанализировать.

Источник по кандидатам тут: [hell].[cabinet].[QualInvestorCandidates]

Наш клиент там отсутствует

!image-2023-06-29-16-45-44-776.png!

В эту таблицу данные прокидывают два джоба из таблицы eqAccountData (наполняется сервисом шины ночью подходящими по условиям клиентами):

05:00 (2.30) Создание списка кандидатов в квал. инвесторы
12:00 Создание списка кандидатов в квал. инвесторы

 

Второй джоб падает с ошибкой :

не проходит проверка DATABASEPROPERTYEX('hell', 'Updateability') = N'READ_WRITE'",,5.0,Личный кабинет
ADIRINC-1091,3378557,U_M13MK,На исправление,29.06.2023 11:06,,,,,Дефект промсреды,,2024-09-30 00:00:00.0,"У клиента с тарифом профессионал комиссия должна быть 0,05% от сделки, но у клиента считается в 10 раз меньше",,7.0,Core
ADIRINC-1088,3374116,U_M1DKF,NEW,28.06.2023 13:57,,,,,Дефект промсреды,,2023-08-14 00:00:00.0,При создании ЭЦП после ввода кода из смс в ВТ у клиента возникает ошибка «Ошибка запроса кроссавторизации в ЛК»,,127.0,НТФ (ЛК)
ADIRINC-1087,3370422,U_M1CWM,Закрыт,27.06.2023 15:26,,,,,Дефект промсреды,13.07.2023 17:10,2023-08-08 00:00:00.0,"# Клиент сохранил свой список в ВТ
 # Вышел из приложения
 # Зашел снова

Фактически - список , который он настраивал под себя не сохраняется в данном случае. Пустой он или с инструментами - разницы нет

Также не добавляются активы в уже имеющиеся список ""Мой список"".

Видео от клиента [https://disk.yandex.ru/i/2KibLyJr2kkZ5w]

 

Телефон: Xiaomi Mi 11. ГС 4013060",,5.0,АИ ПРО
ADIRINC-1086,3369335,U_M1FE1,Закрыт,27.06.2023 12:22,,,,,Дефект промсреды,15.02.2024 11:00,2024-03-22 00:00:00.0,"Клиент заходит в приложение МТ. Проваливается в бумагу, переходит в раздел Купоны и наблюдает отсутствие информации, на IOS ""Нет информации по купонам. Мы уже работаем над их добавлением"". Хотя в Hell_cache каллендарь есть 
SELECT *
FROM [hell_cache].[coupon].[redemption] WITH (SNAPSHOT)
where act_id=117764",,11.0,Core
ADIRINC-1085,3360972,U_M0R67,Отклонен,26.06.2023 09:59,,,,,Дефект промсреды,03.07.2023 13:01,2023-08-07 00:00:00.0,"Клиент заходит в МТ или ВТ и пытается отменить заявку 
ОР: Заявка переходит в статус 15 ""Удалить. Помечен для удаления ""
ФР: Заявка остается в статусе 14 ""Активный""

Пример клиент 243405, заявка 43558167384 перешла в 15 статус только после реборна

Авария IM14982598 
Тред с обсуждением: 
[https://rc.alfa-bank.net/channel/adir_duty?msg=Yz6cZkBPGLJJxiK2R]

Проблема в ЛС, по какой-то причине он не переводил заявки в 15 статус
Как ВА был применен реборн заявок
Так же после ночного рестарта ЛС проблем с отменой заявок не наблюдалось ",,,Core
ADIRINC-1084,3359116,U_M1DQU,Закрыт,23.06.2023 16:28,Фронт,,,,Дефект промсреды,06.03.2024 12:24,2023-09-15 00:00:00.0,"В ВТ в истории дивидендов отображается дата последнего дня покупки, в МТ дата закрытия реестра.",,2.0,Everest
ADIRINC-1083,3357987,U_M1FE1,Отклонен,23.06.2023 14:22,,,,,Дефект промсреды,22.02.2024 13:31,2023-08-04 00:00:00.0,"Коллеги, добрый день. Обращаются клиенты, у которых неправильно отображается график выплат по купону.  В БД все записи есть, они соответствуют данным с Мосбиржи. Где-то данные не транслируются. 

Пример:

Клиент (AJTYCT 5365608) обращается с проблемой отображения купонного календаря по ""КАМАЗ"", облигация корпоративная (RU000A0ZZ877). Облигация погашается 10.05.2033, в графике купонов нет других дат кроме ближайшей даты 21.11.2023

 
{code:java}
select * from hell.actives.couponredemptionschedule where p_code = 'KMAZBO10'{code}
 

!image-2023-06-23-14-19-50-059.png!

 
{code:java}
SELECT *
FROM [hell_cache].[coupon].[redemption] WITH (SNAPSHOT)
where act_id='112623'{code}
!image-2023-06-23-14-18-50-308.png!

 ",,39.0,Core
ADIRINC-1082,3357130,U_M1QX4,Закрыт,23.06.2023 11:31,,,,,Дефект промсреды,04.07.2023 18:06,2023-08-04 00:00:00.0,"При выставлении заявки с валютой, сервис отдавал не тот ibmarketboard вместо 114 был 102 (ADFront.cf.Operations)
 Предположительно из-за релиза сервиса https://jira.moscow.alfaintra.net/browse/ITINVEST-1598

После отката днем 22.06 в бою версии сервиса, было расхождение версий с препродом. Препрод каким то образом аффектит на бой

 

SELECT * FROM ADFront.cf.Operations WHERE IdAccount = 2423019 AND TimeOperation >= '2023-06-23' AND ExtOperNo IN (600946905, 600950583)
 SELECT * FROM hell.dbo.trades WHERE acc_code = '2423019-000' AND p_code = 'CNY' AND db_date = '2023-06-23'

SELECT * FROM hell.dbo.trades tr
 INNER JOIN ADFront.cf.Operations op ON tr.ts_no = op.ExtOperNo
 WHERE tr.trd_type_code = 'D' AND op.CodeMarketBoard = 'CNGD'
 ORDER BY tr.ts_time DESC

Некорректные заявки в таблице
 SELECT * FROM Recycle.dbo.Operations_102_2023_06_23
  
  ",,,Core
ADIRINC-1081,3354492,U_M1AYE,Закрыт,22.06.2023 18:10,,,,,Дефект промсреды,23.06.2023 10:20,2023-10-05 00:00:00.0,"Клиент пытается пополнить свой БС по сбп запросом в райфайзен банк. Возникает ошибка. 
При вызове сервиса  [http://esbwsreco.moscow.alfaintra.net/CS/EQ/WSCodeMobileProviderInfo/WSCodeMobileProviderInfo10]
 
 когда мы вызываем сервис с кредами мобайла
 <externalSystemCode>RECO</externalSystemCode>
 <externalUserCode>PHONE-TRANSFER-API-M1</externalUserCode>
, ошибки нет, 
 но с кредами инвеста
 <externalSystemCode>ADMT</externalSystemCode>
 <externalUserCode>PHONE-TRANSFER-API-I1</externalUserCode>
 появляется ошибка",,1.0,
ADIRINC-1080,3354208,U_M1RH8,Отклонен,22.06.2023 17:37,,,,,Дефект промсреды,22.04.2024 09:10,2023-08-03 00:00:00.0,"Клиент заходит в Приложение Альфа-Инвестиции/Портфель/История/выбирает сделку/нажимает на значок графика и возникает ошибка ""Что-то пошло не так"".



{code:java}
13:09:14.454 AD.Core.Source.SymbolSource.LKOH=ВР TOM idFi:0 status:Pending -> status:Failed error:ErrorInfo:[
   typde: MarketData(12)
   code: InvalidInputArguments(9)
   title: Market data
   msg: #M9I1L183: symbol LKOH=ВР TOM not found in dictionary
   hashCode: I1L183
   args: [ ]
]

13:09:14.454 AD.Core.Source.QuoteSource.LKOH=ВР TOM status:Created -> status:Failed error:ErrorInfo:[
   typde: MarketData(12)
   code: InvalidInputArguments(9)
   title: Market data
   msg: #M9I1L183: symbol LKOH=ВР TOM not found in dictionary
   hashCode: I1L183
   args: [ ]
]
{code}",,4.0,Core
ADIRINC-1079,3351019,U_M1QX4,Отклонен,22.06.2023 10:45,,,,,Дефект промсреды,11.09.2024 10:52,2023-08-03 00:00:00.0,"При максимизирования окна появляются новые свечи, при восстановления прежнего размера они пропадают.
А-Инвестиции 4.0 (последняя версия 4.0.3765.1407), новый график, свечи типа ""Renko"".
""При изменении размеров окна, преимущественно по вертикали — меняется последовательность кубиков.
Изменение последовательности кубиков происходит на любом интервале и на любом инструменте.
Достаточно лишь изменить размеры окна. Например, максимизировать окно на весь экран.""",,1.0,Pro terminal
ADIRINC-1078,3351012,U_M1AYY,NEW,22.06.2023 10:42,,,,,Дефект промсреды,,2023-09-14 00:00:00.0,"Клиент AKCS44 обращается по отображению по портфелю 146673
в приложении отображается доход 452918,09 руб и доходность 9,56% от суммы портфеля 5 278 231 руб
от этой суммы портфеля в 5 278 231 руб 9,56% составляет 504598.88 руб

Доходность 9,56% считается от стоимость портфеля, которая была до момента открытия позиций.

Если прибыль составляет как указано на скрине 452918,09 руб., то до момента открытия позиций у клиента стоимость портфеля должна была быть 4 825 312,91 руб.,
Доход 9,56% от 4 825 312,91 руб. составляет 461 299,91 руб., то есть средств клиент должен был заработать на 8381,82 руб. больше, чтобы отобразилась доходность 9,56%


5 278 231 - 452 918,09 = 4 825 312,91 (руб) стоимость портфеля на момент начала открытия позиций
4 825 312,91*9,56%=461299,91 (руб) доход, который должен был быть у клиента

461 299,91-452 918,09 = 8381,82 (руб) на данную сумму клиент должен разаботать больше, чтобы доход был 9,56%",,18.0,Core
ADIRINC-1077,3350813,U_M00ZM,Закрыт,22.06.2023 10:21,,,,,Дефект промсреды,12.02.2024 17:53,2023-08-03 00:00:00.0,"Обращается клиент, у него не получается зайти в приложение - постоянно вылетает. ""В работе приложения А-Инвестиции произошла ошибка. Обновите приложение, как только разработчик предоставит исправление этой ошибки"".  Были найдены многочисленные краши в firebase. По данной проблеме завели баг https://jira.moscow.alfaintra.net/browse/ADMT-3750",,2.0,
ADIRINC-1076,3347563,U_M1DKF,Отклонен,21.06.2023 12:48,,,,,Дефект промсреды,03.07.2023 15:20,2023-08-02 00:00:00.0,"Клиенты пытаются участвовать в Pre-IPO с ИИС-а, но заявки не принимаются с ошибкой  

В логах лимитов при попытке выставить заявку есть проверка лимитов на вывод ДС, которые завершены с ошибкой вывода с ИИС 

Обсуждение тут [https://rc.alfa-bank.net/channel/adir_ipo_mt?msg=sE6BSN4RW7XaHDsHE]

[https://alfaadmin/reporting/orderlimitlog/2291277894]

[https://alfaadmin/reporting/orderlimitlog/2291277893]

https://alfaadmin/reporting/orderlimitlog/2291277892",,2.0,
ADIRINC-1074,3343219,RUM1BPH,Закрыт,20.06.2023 12:31,,,,,Дефект промсреды,24.04.2024 13:45,2024-06-11 00:00:00.0,"Клиент ГС 4322748 не видит в истории частичные погашения номинала по облигациям PKKO1P02 (RU000A1016Z3) и по OKEYBO1P03 (RU000A1014B9) и выплаты купонов
 В брокерском отчёте операции отражены.
 !image-2023-06-20-12-29-42-118.png!
 !image-2023-06-20-12-30-25-250.png!",,72.0,Core
ADIRINC-1073,3342710,U_M1AYY,На исправление,20.06.2023 11:05,,,,,Дефект промсреды,,2023-08-01 00:00:00.0,"ГС 4253999. инструмент MIX-9.23.

Клиент открывает шорт -2 контракта 2023-06-14 13:06:27 оба по цене 275 400 pt.
 !image-2023-06-20-11-02-26-912.png!
 Далее в течение дня отмечает, как меняется УЦ.
 В 17;43
 !image-2023-06-20-11-02-55-177.png!
 В 19:04
 !image-2023-06-20-11-03-28-984.png!
 Сейчас УЦ рассчитана верно. 
 !image-2023-06-20-11-08-17-559.png!
Основной вопрос, в чём причина ""болтания"" цен выше-ниже цены контракта и можно ли этого избегать?",,15.0,
ADIRINC-1072,3341114,U_M1AYY,Отклонен,19.06.2023 17:22,,,,,Дефект промсреды,15.12.2023 23:48,2023-07-31 00:00:00.0,"Коллеги, ГС 4302961, инструмент SILV-6.23.
 Клиент сбросил позицию 13.06 с датой исполнения 14.06. А 14.06 снова купил этот же фьючерс с этой же датой поставки. Поскольку он прежде обнулил позицию, он вправе рассчитывать на УЦ, равную цене второй сделки (=23,86).
 Механизм расчёта УЦ поступает по-другому: он операцию продажи ставит позже операции покупки с одним и тем же днём поставки, в результате чего цены усредняются (24.41+23,86)/2=24.14, после чего делается продажа 1 бумаги. Эту среднюю клиент видел в качестве УЦ.
 Для решения необходимо в сортировку после даты поставки добавить дату-время заключения сделки.
 !image-2023-06-19-17-21-53-397.png!",,2.0,
ADIRINC-1071,3340604,U_M0WVN,Закрыт,19.06.2023 15:58,Matterhorn,,,,Дефект промсреды,22.08.2023 16:11,2023-08-18 00:00:00.0,"Клиент хочет продать свою подарочную акцию, но кнопка у него будто неактивна постоянно на экране.

*ANDROID Версия МП: 2.23.1*

*AO4W3E*

Обращение не единичное

!image-2023-06-19-15-47-23-473.png!

 ",,14.0,
ADIRINC-1070,3334488,U_M1CUE,Закрыт,16.06.2023 12:28,,,,,Дефект промсреды,25.09.2023 17:44,2023-09-28 00:00:00.0,"Я, как клиент AS912J 1138532 обнаружил возможность попасть в приложение МТ без ввода пароля. 
Предисловие: Клиентам для подключении стратегии направляется ссылка в чате [https://adirect.onelink.me/8NPE/5e297195?type=place&value=advisorLite] по инструкции с базы знаний [http://infobrb/Finance/AlphaDirect/Pages/AllDocs/Strategii.aspx]
НО переходя по сслыке из чата клиента перебрасывает в app store(что некорректно), потому я планировал добавить рекомендацию, чтобы клиент сохранял ссылку к себе (в заметки или в тг/вк) и переходил не через чат.
Переходя по этой ссылке не через чат, у клиента не запрашивает пароль авторизации, даже если закрыть приложение. 
Если полнстью выйти из аккаунта, то перейдя по ссылке он как-то понимает что это я и заходит подомной предлагая сначала ЗАДАТЬ пароль, после чего впускает.",,,
ADIRINC-1069,3332534,U_M1AYY,Закрыт,15.06.2023 18:00,,,,,Дефект промсреды,30.01.2024 10:18,2023-07-28 00:00:00.0,"Коллеги, к нам обратился клисент ГС 949946.
У него по инструменту POLY (ISIN JE00B6T5S470) показывается УЦ 80515,19414.
Видим, что инструмент у него появился в результате перевода ценных бумаг в связи с расторжением ГС 4492471.
На ГС  4492471 инструмент появился при переводе из ВТБ.
Больше никаких операций не производилось.
В экстра-трансфере (trn=19575818) видим balance_price = 0, в следствие чего в качестве УЦ должна была встать рыночная котировка по инструменту (на 25.03.2022), 
а bps_rub указан 80515,19414.",,5.0,
ADIRINC-1068,3332366,U_M13MK,NEW,15.06.2023 17:26,,,,,Дефект промсреды,,2023-09-07 00:00:00.0,"Из-за наличия Meta в портфеле появляется всплывашка с ошибкой отображения некоторых активов.
 Актуально на всех версиях приложения
Клиенты активно жалуются на эту ошибку",,40.0,Уран
ADIRINC-1067,3330342,U_M1AYE,Отклонен,15.06.2023 11:50,,,,,Дефект промсреды,20.09.2023 13:36,2023-07-27 00:00:00.0,"Клиент заходит в МТ в вкладку Внебирживые активы
ОР: Видит доходность по инструменты
ФР: Доходность отображается 0 при этом invest-portfolio-api и invest-partners-api информацию о доходность возвращают 
!image-2023-06-15-11-49-27-004.png!
!image-2023-06-15-11-48-53-116.png!",,1.0,Мобильный терминал
ADIRINC-1066,3329773,U_M1DUZ,Закрыт,15.06.2023 10:52,,,,,Дефект промсреды,23.01.2024 16:02,2023-08-16 00:00:00.0,"Клиент открывает экран Маржинальная торговля, после чего пытается выставить заявку 
ОР: Параметр Нач.маржа совпадают на экране и при выставлении заявки 
ФР: Параметр Нач.маржа не совпадают на экране и при выставлении заявки 
Параметр Нач маржи на экране Маржинальная торговля тянется из таблицы adfront.ts.MarginRequirements 
!image-2023-06-15-10-49-59-209.png!
!image-2023-06-15-10-49-35-545.png!",,2.0,Core
ADIRINC-1065,3328778,U_M1BFA,Закрыт,14.06.2023 19:15,,,,,Дефект промсреды,18.01.2024 10:25,2023-07-27 00:00:00.0,"Клиент при входе в ВТ получает  ошибку fe0-10012

 

!image-2023-06-14-19-18-44-401.png!",,10.0,АИ ПРО
ADIRINC-1064,3328204,RUM1BPH,NEW,14.06.2023 17:17,,,,,Дефект промсреды,,2023-07-26 00:00:00.0,"Коллеги, к нам обратился клиент ГС 228679.
 По его мнению при изменении котировок сумма портфеля и доходность за всё время в абсолютных величинах должны во времени меняться на одинаковую величину.
 !image-2023-06-14-17-12-14-942.png!!image-2023-06-14-17-12-34-173.png!
 Два скриншота сняты в одну и ту же минуту. 
 Если посчитать разницу, то видно, что портфель изменился на 227 рублей, а доходность на 284,12 рубля.

Судя по предварительному анализу, указанные показатели портфеля действительно должны меняться во времени на одинаковые величины:
 !image-2023-06-14-17-21-19-072.png!",,7.0,Core
ADIRINC-1063,3317401,U_M173X,Отклонен,09.06.2023 16:32,,,,,Дефект промсреды,30.06.2023 17:36,2023-07-24 00:00:00.0,"Клиент пытается выставить заявку
 ОР: Заявка успешно выставляет
 ФР: Заявка падает в ошибку ""ОШИБКА 448 Указан недопустимый код расчетов""

Пример бумаги RU000A1062M5 RU000A105CS1

На фронте ошибка ""Что-то пошло не так"" !image-2023-06-09-16-31-29-051.png!

Ошибка в логах МТ


{code:java}
08:00:49.339 AD.Core.Source.TradeOrdersSource update rejected order OrderEntity: mask=ef5a89ffff0fbdf02f, idAccount=4189126, idSubAccount=3492606, orderStatusRevision=104, rest=1, price=99.86, orderUpdateTime=09 июня 2023 11:00, brokerComment=ОШИБКА: (448) Указан недопустимый код расчетов, brokerErrorCode=OrderRejected, confirmedQuantity=1, sentTime=09 июня 2023 11:00, terminatedTime=09 июня 2023 11:00, idOrderType=LMT, idQuantityType=QTY, idPriceType=QUO, idLifeTime=D30, idExecutionType=ASL, idSettleCode=65, idObject=827839, idMarketBoard=150, idOrderStatus=Rejected, idRazdel=26381195, limitPrice=99.86, signTime=09 июня 2023 11:00, buySell=Sell, quantity=1, openQuantity=1, withdrawTime=08 июля 2023 23:59, idFiActivate=2001476, idCommandType=NEW, idDocumentType=TRD, login=saefimov9, clientOrderNum=1028368004, clientNumEDocument=6GV2Q1-31b64a3e-520f-3562-9199-5d4d2caa1a26-1028368004, id=43107515984, acceptTime=09 июня 2023 11:00, SELGOLD01=МБ ЦК T+1 error ErrorInfo:[ typde: PlaceOrder(9) code: Unexpected(7) title: Place order msg: #PO7S40001: ОШИБКА: (448) Указан недопустимый код расчетов hashCode: S40001 args: [ Place:/Users/jenkins/AD_Api_Lib_Master/53/core/src/TradeOrderItem.cpp:161 ServerErrorCode:OrderRejected ClientOrderNum:6GV2Q1-31b64a3e-520f-3562-9199-5d4d2caa1a26-1028368004 ] ]
{code}",,,
ADIRINC-1062,3316971,U_M17VN,Отклонен,09.06.2023 15:03,,,,,Дефект промсреды,04.07.2023 14:56,2023-07-24 00:00:00.0,"Приходит пустой ответ http://adir-dividend-info.k8s-master.gointra.net/api/dvdcalendar/1000092/000?startDate=2023-06-09&endDate=2023-07-09
хотя в портфеле на субсчетет 1000092-000 есть акции с дивидендами в этом периоде (открыты позиции по  RU0007775219, RU000A0JPPT1 и RU0009062467

http://adir-dividend-info.k8s-master.gointra.net/api/dvdcalendar/1000092/000?startDate=2023-06-09&endDate=2023-07-09
 
curl -X 'GET' \
  'http://adir-dividend-info.k8s-master.gointra.net/api/dvdcalendar/1000092/000?startDate=2023-06-09&endDate=2023-07-09' \
  -H 'accept: application/json' \
  -H 'X-Request-Id: 00000000-0000-0000-0000-000000000001' \
  -H 'X-External-System-Code: 00000000-0000-0000-0000-000000000001' \
  -H 'X-External-User-Code: 00000000-0000-0000-0000-000000000001' \
  -H 'Content-Type: application/json;v=1'
 

Response body
Download
[]
Response headers",,,Core
ADIRINC-1061,3316952,U_M1FE1,Отклонен,09.06.2023 14:50,,,,,Дефект промсреды,04.07.2023 14:56,2023-07-24 00:00:00.0,"http://adir-dividend-info.k8s-master.gointra.net/api/dvdcalendar/all/RU0009033591
В массиве отсутствуют данные по будущим выплатам

В аттаче ответ сервиса дивидендов",,,
ADIRINC-1060,3314468,U_M1AYY,Закрыт,09.06.2023 09:18,,,,,Дефект промсреды,30.01.2024 17:09,2023-07-24 00:00:00.0,"Клиент ГС 4476625 обратился в связи с *неотображением в МТ* цб ADTH (ISIN US00653A1079). Эта бумага у клиента появилась в результате корп. действий 06.06.2023. 
 На 08.06.2023 УЦ не рассчитана. 
 !image-2023-06-09-09-21-37-783.png!

Клиент ГС 4321257 обратился в связи с *неотображением в МТ* цб ADTH (ISIN US00653A1079) – та же бумага

!image-2023-06-09-09-42-49-272.png!",,4.0,
ADIRINC-1059,3313221,U_M1CUE,Закрыт,08.06.2023 17:16,,,,,Дефект промсреды,28.07.2023 12:55,2023-07-21 00:00:00.0,"Периодически залипает сервис adir-tariff-service из-за чего могут наблюдаться проблемы со стороны клиента: 
- при смене тарифа возникает ошибка \\\\\\\\\\\\\\\""не удалось сменить тариф\\\\\\\\\\\\\\\""
- вкладка https://lk.alfadirect.ru/accounts/info не работает. 
Помогает рестарт.",,4.0,Core
ADIRINC-1058,3297525,U_M177U,Отклонен,05.06.2023 11:34,,,,,Дефект промсреды,23.01.2024 16:05,2023-08-07 00:00:00.0,"Коллеги, к нам обратился клиент ГС 280020 по поводу неправильного отображения доли фунтов стерлингов в своём портфеле в разделе Аналитика Валюта.
 В МТ видно, что доля инструментов в GBP составляет 0,1%. 
 !image-2023-06-05-11-33-40-195.png!
 В портфеле у клиента есть только один инструмент, номинированный в GBP – GAZCf060424 (ISIN RU000A1059A6). 
 Его рыночная стоимость на сегодняшний день составляет примерно: 1 шт. * 1000 GBP * 95,6 % / 100 * 100 руб./GBP = 95600 руб., что является 1/10 от всего портфеля (~917 тыс. руб.) или 10% от портфеля.",,,Мобильный терминал
ADIRINC-1057,3295142,U_M13MK,Отклонен,02.06.2023 16:16,,,,,Дефект промсреды,26.06.2023 11:07,2023-07-17 00:00:00.0,"Некорректное отображение в разделе \\\\\\\\\\\\\\\""Аналитика\\\\\\\\\\\\\\\"">\\\\\\\\\\\\\\\""Отчет\\\\\\\\\\\\\\\"">\\\\\\\\\\\\\\\""Операции\\\\\\\\\\\\\\\""
 В отчете отображается вывод денежных средств, которых не было
outputsPapers=[AnalyticsReportResponse.Report|http://analyticsreportresponse.report/](value=7331.4, currency=RUB)",,16.0,Core
ADIRINC-1056,3294182,U_M1CUE,Закрыт,02.06.2023 14:08,,,,,Дефект промсреды,09.08.2023 13:37,2023-08-28 00:00:00.0,"У клиента на графике по инструменту не отображается текущая позиция.
Перезагрузка терминала не помогла.
После совершении сделки по инструменту, отображение появляется, но на следующий день если сделок нет, то позиция не отображается.
У клиента в настройках включены настройки сделки и режим реального времени.",,17.0,
ADIRINC-1055,3288425,U_M25TF,На исправление,01.06.2023 10:03,,,,,Дефект промсреды,,2023-07-14 00:00:00.0,"Коллеги, участились случаи поступления жалоб от клиентов, в расхождение баланса в МТ с данными в 3ке. При этом ночные пересчеты и сверки не помогают. Мы определили, что проблема возникает из-за расхождения данных между hell и ADfront.

Для проверки испульзуем: SSRS отчет Сверка денежных позиций между АД 3.5 и АД 4.

Для устраниения расхождения запускаем процедуру починки (см ниже).
{code:java}
EXEC ADFront.repair.SubAccPosition
@OnlyShow = 0
, @IdAccount = 'ГС Клиента'{code}
 

Просим проверить процедуру ночного пересчета и/или процедуру сверки для системного решения.

Пример клиента:
 541549, P02742
 4811246, AVI4EY",,188.0,
ADIRINC-1054,3282945,U_M1AYY,Отклонен,30.05.2023 17:58,,,,,Дефект промсреды,06.03.2024 23:54,2023-08-04 00:00:00.0,"У клиента 4499586 были зачисления валюты из ВТБ. При методе расчёта по FIFO (как он утверждает) брались курсы ЦБ (AlgorithmID=2) на день зачисления, а при методе расчёта УЦ по средневзвесу стали браться курсы по AlgorithmID = 1.

!image-2023-05-30-17-57-14-636.png!
!image-2023-05-31-09-30-44-958.png!

 ",,12.0,
ADIRINC-1053,3282654,U_M1QLD,Ретест дефекта,30.05.2023 16:58,,,,,Дефект промсреды,,2023-07-12 00:00:00.0,"Клиент заходит в сводку по фьючу
ОР: ГО совпадает с тем что в МТ и на бирже 
 ФР: ГО отличается от МТ и биржи
!image-2023-05-30-17-01-52-606.png!!image-2023-05-30-17-02-12-698.png!
!image-2023-05-30-16-59-51-862.png!",,3.0,Web
ADIRINC-1052,3280240,U_M1AYY,Закрыт,30.05.2023 11:31,,,,,Дефект промсреды,11.07.2023 12:11,2023-07-12 00:00:00.0,"Коллеги, клиенты стали обращаться в связи с неправильным отображением УЦ.

Сейчас обратился клиент ГС 938580. Клиент закрыла ИИС с переводом активов на БС. ИИС закрыт и бумаги переведены 23.05.2023.
 На 30.05 у клиента всё ещё нескорректированные УЦ (=1) по большинству бумаг.

!image-2023-05-30-11-19-52-294.png!

Причиной по всей видимости является указание в экстра-трансферах балансовой цены =1
!image-2023-05-30-11-33-27-460.png!",,50.0,
ADIRINC-1051,3277589,U_M19LL,Закрыт,29.05.2023 17:00,ОТЭИСФЛ,,,,Дефект промсреды,05.07.2023 12:11,2023-05-31 00:00:00.0,"При сохранении информации о транзакции в БД, приводит к экстренному завершению процесса quik.exe на сабсервере.",,,
ADIRINC-1050,3276617,U_M0SLM,Принят к исправлению,29.05.2023 15:13,ОТЭИСФЛ,,,,Дефект промсреды,,2023-07-11 00:00:00.0,"|Клиенты обращаются с проблемой отображения инструмента в портфеле. Оба инструменты торгуются на SPBEX_FSHR в 3ке, а также были переведены из неторогового раздела. Судя по всему, ошибка плавающая, вероятнее всего происходит из-за процессов происходящих в неторговое время.
  
 Версия приложения МТ 2.23.0. Воспроизводилась на 2.21.0
 Приложены логи клиента ARLXWR проблема с инструментом US5603172082  ориентировочно 06/07/2023 с 11 до 12 часов воспроизводилась ошибка|",,104.0,Core
ADIRINC-1049,3272828,U_M177U,Закрыт,29.05.2023 10:24,ОТЭИСФЛ,,,,Дефект промсреды,13.09.2023 13:48,2023-09-15 00:00:00.0,"У клиентов возникает ошибка ""Ошибка. Не удалось получить котировки. Попробуйте еще раз."" при загрузки вкладки ""Избранное"". ",,46.0,Мобильный терминал
ADIRINC-1048,3269087,U_M173X,Закрыт,26.05.2023 12:11,,,,,Дефект промсреды,24.04.2024 13:46,2024-06-11 00:00:00.0,"25.05.2023 было зачисление дивидендов по сберу.  Клиент на следующий день заходит в МТ, в историю операций
 ОР: В истории это зачисление отображается
 ФР: В истории это зачисление не отображается 

В ответе сервиса adir-client-operation-history этой операции нет, но при этом в [operations_cache].[hell].[extra_transfers] данное зачисление присутствует. 
 Вероятно в сервисе или в бд некорректно формируется paging_key  и из-за этого операция не попадает в выборку процедуры [operations].[get_extra_transfers]
 !image-2023-05-26-12-09-03-383.png!
 !image-2023-05-26-12-10-48-157.png!
 !image-2023-05-26-12-08-32-549.png!
  ",,106.0,Core
ADIRINC-1047,3268541,U_M1DKL,На исправление,26.05.2023 10:48,,,,,Дефект промсреды,,2023-09-08 00:00:00.0,"Ситуация 1:
У меня включены уведомления в настройках смартфона и для Альфа-Мобайла, и для Альфа-Инвестиций. В IBank статус «доставлено» и для пуша для входа в Альфа-Онлайн, и для пуша для входа в ЛК - все как и должно быть.
Ситуация 2:
У меня выключены уведомления в настройках смартфона и для Альфа-Мобайла, и для Альфа-Инвестиций. В IBank для пуша для входа в Альфа-Онлайн статус «Не доставлено» и идет досыл смс. Для АИ статус остается «Доставлено», хотя пуш я не получил, смс не отправляется.
Корректная работа во второй ситуации: Пуш для ЛК статус не доставлено, идет досыл смс.
А по факту Пуш не отображается, тк он отключен, но из-за статуса \\\\\\\\\\\\\\\""Досталвено\\\\\\\\\\\\\\\"" не идет досыл смс
Проблема воспроизводится на Андройде",,14.0,Matterhorn
ADIRINC-1046,3266659,U_M25TF,NEW,25.05.2023 18:10,,,,,Дефект промсреды,,2023-07-10 00:00:00.0,"Клиент пытается купить RU000A105PQ7, в МТ она торгуется только в CNY 
ФР: Заявка выставляется в рублях
ОР: Заявка выставляется в CNY
select IdFi, IdMarketBoard, * from [ADFrontOrders].[Logs].[Orders] where NumEDocument = '42233759584'
select * from ADFront.intrfc.LinkedFI where IdFi = 1993389 and idMarketBoard = 150
select * from adfront.dbo.objects where idObject = 174368
!image-2023-05-25-18-09-58-369.png!
!image-2023-05-25-18-04-04-272.png!",,2.0,Core
ADIRINC-1045,3262434,U_M1CUE,Закрыт,24.05.2023 18:51,,,,,Дефект промсреды,21.05.2024 18:53,2023-08-18 00:00:00.0,"Пример: НРД отдает информацию по дивидендам Газпромнефти 81 рубль, но часть суммы - 69 рублей было выплачено ранее и останется выплатить 12 рублей, но от нрд идет инфа 81 и мы выводим что будет ближайшая выплата 81 рубль, не вычитая то что было выплачено. Корректное отображение - 12 рублей",,16.0,
ADIRINC-1044,3262199,U_M1DQU,Закрыт,24.05.2023 18:47,,,,,Дефект промсреды,06.03.2024 15:45,2023-07-07 00:00:00.0,"Клиент пытается выставить заявку по инструменту RU000A1059A6
ОР: В поле итого сумма должна быть равна номинал *  курс валюты  * кол-во лотов * цена в % + NKD
 ФР: В поле итого сумма равна номинал  * кол-во лотов * цена в % + NKD
Проблема в том что RU000A1059A6 торгуется в режиме TQCB и с биржи по этому инструменту на TQCB CurrencyID = SUR (советский рубль) 
Вопрос аналитики, насколько корректно опираться на CurrencyID в данном случае
{code:java}
select * from adfront.dbo.objects where ISIN = 'RU000A1059A6' select * from ADFront.dbo.FinInstruments where IdObject = 826729 and isEnabledFinInstrument = 1 select * from ADFront.intrfc.LinkedFI where IdFi = 1990430 select * from AdFront.fi.FinInfoExt where IdFi = 1990430 select CurrencyID , * from AdFront.[micex].[Securities] where IdFi = 1990430
{code}
!image-2023-05-24-18-38-43-907.png!
 !image-2023-05-24-18-46-07-009.png!",,23.0,Мобильный терминал
ADIRINC-1043,3259131,U_M13J8,Закрыт,24.05.2023 10:09,,,,,Дефект промсреды,07.06.2023 12:12,2023-07-26 00:00:00.0,"На версии 2.23 не работает загрузка вложений в чат
Проблема у клиентов с Android 13 ",,6.0,Мобильный терминал
ADIRINC-1042,3258767,U_M18JH,Закрыт,24.05.2023 09:29,,,,,Дефект промсреды,30.08.2023 14:31,2023-07-26 00:00:00.0,"В новой версии у некоторых клиентов в разделе Ещё перестали отображаться доступные виджеты.
Скорее всего это связано с тем, что с 2.23 полностью перешли на получение инфы из ФБ и убрали из кода приложения, а у некоторых клиентов Фичи из ФБ не доходят",,2.0,Мобильный терминал
ADIRINC-1041,3257909,U_M1DQU,Отклонен,23.05.2023 18:43,,,,,Дефект промсреды,23.05.2023 18:47,2023-07-06 00:00:00.0,"Клиент пытается выставить заявку

ОР:  Заявка успешно выставляется
ФР:  У клиента появляется ошибка P023S40009

!image-2023-05-23-18-43-02-483.png!",,,Мобильный терминал
ADIRINC-1040,3257906,U_M1DQU,Отклонен,23.05.2023 18:34,,,,,Дефект промсреды,06.03.2024 16:14,2023-07-26 00:00:00.0,"Клиент пытается выставить заявку 

ОР: Заявка успешно выставляется
 ФР: У клиента появляется ошибка P07S40003

Ошибка означает - Сформированный текст заявки на стороне сервера не совпадает с заявкой сформированной на клиенте
При анализе текста заявок было обнаружено что отличается ""Исходящий номер""

!image-2023-05-23-18-35-48-907.png!

!image-2023-05-23-18-32-48-100.png!",,,Мобильный терминал
ADIRINC-1039,3257787,U_M1P1L,NEW,23.05.2023 18:06,,,,,Дефект промсреды,,2023-07-06 00:00:00.0,"Клиент пытается открыть счет, но возникает ошибка при проверке комплаенса К17 FATCA/CRS 
|adir-production-dotnet-alfabankapi-000451|
|
 _score|-|
 _type|application-nlog|
 @timestamp|May 22, 2023 @ 11:52:53.130|
 level|Info|
 logContext.host|webadmin1|
 logContext.machine|WEBADMIN1|
 logContext.requestId|839533f0-b6f6-4142-a87c-c637cbeff2ce|
 message|[POST: /api/onboarding/preregesia] (request=\\\\\\\\\\\\\\\\{\\\\\\\\\\\\\\\""pin\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""ANP8TS\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""isMobile\\\\\\\\\\\\\\\"":null,\\\\\\\\\\\\\\\""isIpo\\\\\\\\\\\\\\\"":null,\\\\\\\\\\\\\\\""isIia\\\\\\\\\\\\\\\"":false,\\\\\\\\\\\\\\\""isAClub\\\\\\\\\\\\\\\"":false,\\\\\\\\\\\\\\\""method\\\\\\\\\\\\\\\"":null,\\\\\\\\\\\\\\\""channel\\\\\\\\\\\\\\\"":null,\\\\\\\\\\\\\\\""accountType\\\\\\\\\\\\\\\"":null,\\\\\\\\\\\\\\\""manager\\\\\\\\\\\\\\\"":null,\\\\\\\\\\\\\\\""saleplaceCc+ode\\\\\\\\\\\\\\\"":null}): завершен с ошибкой 400: \\\\\\\\\\\\\\\\{\\\\\\\\\\\\\\\""Value\\\\\\\\\\\\\\\"": {\\\\\\\\\\\\\\\""ErrorCode\\\\\\\\\\\\\\\"":310,\\\\\\\\\\\\\\\""ErrorMessage\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""Не пройдена Compliance проверка К17 FATCA/CRS\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""EqService\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""WSCustomerChannelsInfo12PortTypeClient\\\\\\\\\\\\\\\""}
,\\\\\\\\\\\\\\\""Formatters\\\\\\\\\\\\\\\"":[],\\\\\\\\\\\\\\\""ContentTypes\\\\\\\\\\\\\\\"":[\\\\\\\\\\\\\\\""application/json\\\\\\\\\\\\\\\""],\\\\\\\\\\\\\\\""DeclaredType\\\\\\\\\\\\\\\"":null,\\\\\\\\\\\\\\\""StatusCode\\\\\\\\\\\\\\\"":400}|
Но при запросе информации в подразделения комплаенса они не подтвердили наличие запретов:
!image-2023-05-23-18-08-01-636.png!",,3.0,Core
ADIRINC-1038,3253898,U_M13J8,Закрыт,22.05.2023 19:23,,,,,Дефект промсреды,28.07.2023 13:00,2023-07-25 00:00:00.0,"Клиент через главный экран переходит в уведомления и наблюдает сделку с текстом \\\\\\\\\\\\\\\""Продажа VK GDR 10 шт. по цене G RUB\\\\\\\\\\\\\\\""",,3.0,
ADIRINC-1037,3251989,U_M1AYY,Отклонен,22.05.2023 13:57,,,,,Дефект промсреды,15.12.2023 22:44,2023-07-04 00:00:00.0,"Коллеги, к нам обратился клиент, у которого были только одни приходы по цб SBER3.
 Bp_rub и bps_rub высчитаны верно. Поскольку были только приходы, то средневзвес можно посчитать простым суммированием суммы и делением на общее кол-во.
 Получаемая при этом УЦ = 236,08
 Однако в cf.RegPrices учётная цена выставлена неверно - 139,55
 !image-2023-05-22-13-53-03-066.png!
 При этом запуск процедуры починки не отрабатывает, и УЦ в cf.RegPrices не исправляется:

EXEC cf.RepairRegPrices
  @IdSubAccount = 7183466
 ,@IdObject = 285270",,10.0,Core
ADIRINC-1036,3247904,U_M1QLD,На исправление,19.05.2023 17:18,,,,,Дефект промсреды,,2023-07-03 00:00:00.0,"Клиент сообщает, что индикатор Экспоненциальная скользящая средняя отображается не верно. Для сравнения скрин с источника Tradingview.
Так же, когда рисуешь отличные линии они иногда смещаются !image-2023-05-19-17-18-30-305.png!",,4.0,Мобильный терминал
ADIRINC-1035,3247517,U_M1QLD,На исправление,19.05.2023 15:52,,,,,Дефект промсреды,,2023-07-03 00:00:00.0,"платформа: МТ(iOS)
 версия: 2.17
 описание: некорректно отображены сделки на графике.
 зеленым подсвечены сделки на покупку от 05.05.2023.
покупка 5 контрактов по цене 2,145.
продажа 8 контрактов должна быть по цене 2,179",,9.0,Мобильный терминал
ADIRINC-1034,3247246,U_M0R67,Отклонен,19.05.2023 14:19,,,,,Дефект промсреды,16.04.2024 10:50,2023-07-03 00:00:00.0,"При попытке снять заявку с биржи в период большой активности шлюз отбивает заявки с ошибкой 
May 19 09:57:18.362227 adwls01 ls[1586036:1587914]/debug(01): [requestsProcessor:12] - Ignore cancel request for order that is already in cancelling status ServerOrderEntity={OrderEntity={[IdAccount=4253008][IdSubAccount=2416859][OrderStatusRevision=123][Rest=1000][EntryRest=1000][Price=194.63][ExtSessId=12191][ExtOrderNum=36094511207][SessionFilled=0][OrderUpdateTime=638200866168277972][BrokerComment=Заявка #42533835084 ожидает подтверждения отмены от биржевого агента][BrokerErrorCode=NoErrors][BATime=638200866127848105][ConfirmedQuantity=1000][SentTime=638200866076112737][SendCompletedTime=638200866167653341][KillTime=638200866168277779][ExchangeTime=638200866120369338][ExchangeTerminatedTime=0][ClientNumStrategy=0][IdOrderType=LMT][IdQuantityType=QTY][IdPriceType=QUO][IdLifeTime=D30][IdExecutionType=ASL][IdPriceControlType=None][IdSettleCode=64][IdObject=285209][IdMarketBoard=92][IdOrderStatus=PendingCancel][IdRazdel=16872757][LimitPrice=194.63][StopPrice=0][LimitLevelAlternative=0][SignTime=2023-05-18T22:45:56][BuySell=Sell][Contragent=][ContragentRef=][Quantity=1000][OpenQuantity=1000][ActivationTime=][WithdrawTime=2023-06-16T23:59:59][IdFIActivate=0][ActivationPriceDirection=Undefined][Value=0][Comment=][IdCommandType=Enter][IdDocumentType=TRD][Login=tishmukova][ClientOrderNum=95820][ClientNumEDocument=EZ04Q1-2016B9966BCB-95820][NumEDocument=42533835084]
 
на шлюзе ответ 
{ResponseOrderEntity=\\\\\\\\\\\\\\\\{[ErrorCode=OrderRejected_FloodDetected][ErrorText=Слишком много необработанных заявок. Попробуйте позже][ExtOrderNum=0][NumEDocument=42436049284][PenaltyRemain=1000][Rest=0][IdSubAccount=1143286][OrderStatusRevision=370][IdAccount=1574856][ClOrdId=][ExtSessId=0]}}RspCancelOrderEntity={ResponseOrderEntity={[ErrorCode=OrderRejected_FloodDetected][ErrorText=Слишком много необработанных заявок. Попробуйте позже][ExtOrderNum=0][NumEDocument=42533835084]
После чего отмена больше не отправлялась на биржу",,44.0,Core
ADIRINC-1033,3244121,U_M1B1C,Закрыт,18.05.2023 17:33,,,,,Дефект промсреды,13.10.2023 11:03,2023-07-20 00:00:00.0,"Клиент продает подарочную акцию.

ОР: Акция в портфеле больше не отображается
 ФР: Акция в портфеле отображается еще в районе 10 минут

При вызове /portfolios/sell в коллекцию gifts.giftsSales должна добавиться запись с статусом sold, а в коллекции gifts.giftsPortfolio статус тоже на sold должен поменяться, но при этом у некоторых клиентов в gifts.giftsPortfolio статус selling остается еще в районе 10 минут и похоже что это вызвано кэшом на стороне gifts-api

И похоже при таком раскладе, акция продолжает показываться у клиента в мт



!image-2023-05-18-18-07-20-678.png!!image-2023-05-18-18-07-47-142.png!",,4.0,Мобильный терминал
ADIRINC-1032,3244115,U_M1QX4,Отклонен,18.05.2023 17:30,,,,,Дефект промсреды,03.09.2024 10:10,2023-08-11 00:00:00.0,Один и тот же индикатор - ADX при одинаковых настройках показывает разные данные во вкладке торговля и графики,,1.0,АИ ПРО
ADIRINC-1031,3243794,U_M1FE1,Принят к исправлению,18.05.2023 15:39,,,,,Дефект промсреды,,2023-06-30 00:00:00.0,"Ситуация:
 # Клиент держал 700 шт. бумаг до закрытия реестра для получения дивидендов
 # На следующий день , после дня закрытия реестра продал 200шт.

Фактически в разделе дивиденды отображается следующая информация в момент, когда дивиденды еще не выплатили:

!image-2023-05-18-15-38-32-706.png!

 

То есть 200шт бумаг, которые были проданы, но по ним дывы должны быть в этой строчке не учитываются",,240.0,Core
ADIRINC-1030,3242323,U_M0WVN,Закрыт,18.05.2023 12:53,,,,,Дефект промсреды,26.09.2023 10:45,2023-07-20 00:00:00.0,"Кривченко Татьяна Витальевна AVWM4N

Версия приложения: 2.22.1
Логин: krivchenko_t
Устройство: HUAWEI PAR-LX1
 # Клиент совершает сделку по бумаге РУСАЛ покупку на 160 000. у клиента в заявке указано ,что будет списана комиссия на сумму не более 78,40 руб., но при этом по тарифу трейдер присутствует дополнительное вознаграждение в размере 0,02% и суммарно комиссия за эту сделку составляет - 104,4 руб. 
 # Пожелание клиентов ,чтобы в приложении поменяли расчет комиссии и при выставлении заявки стали отображать суммарно комиссию с учетом всех удерживаемых сумм. Так как приложение отображает сумму и указывает ""не более (определенной суммы"", но при этом сумма списывается БОЛЕЕ,чем та, которая указана.

Либо нужно писать какая именно комиссия ИЗ удерживается.

 

 

!image-2023-05-18-12-49-53-843.png!",,2.0,Core
ADIRINC-1029,3240790,U_M17SM,Закрыт,18.05.2023 09:45,,,,,Дефект промсреды,30.01.2024 12:21,2023-06-30 00:00:00.0,"Клиент пытается подключиться к ДТ 
 ОР: клиент успешно подключается
 ФР: у клиента появляется ошибка , в логах \\\\\\\\\\\\\\\""Дескриптор SafeHandle был закрыт\\\\\\\\\\\\\\\""
A90007 2926 Тишков Константин Юрьевич
!image-2023-05-18-09-44-45-895.png!",,1.0,АИ ПРО
ADIRINC-1028,3240230,U_M1QX4,Закрыт,17.05.2023 17:14,,,,,Дефект промсреды,10.01.2024 17:43,2024-02-21 00:00:00.0,"Клиент не может зайти в личный кабинет АИ, приходит код, вводит и возникает ошибка \\\\\\\\\\\\\\\""Неправильный код из SMS\\\\\\\\\\\\\\\""
Коды отправляются с промежутком в 5-10 минут
 ",,2.0,Личный кабинет
ADIRINC-1027,3239543,U_M0WVN,Отклонен,17.05.2023 15:50,,,,,Дефект промсреды,22.08.2023 16:29,2023-07-19 00:00:00.0,"ФР:
 # Клиент заходил в ЛК Альфа-Директ и ждал пуш 16.05.2023
 # Пуш не доставился и досылка смс была

Входит 
|2.22.1|9.104|12|4 - Android|motorola XT2201-2|

Пуш отправка 16.05 факт

!image-2023-05-17-15-43-50-109.png!

Смс досылка после недоставки:

!image-2023-05-17-15-44-18-757.png!

Попал на аварию клиент  со входом в ЛК как раз , там поставку откатывали

3. В итоге 17.05 у него в разделе уведомления насыпало таких строк (ниже скрин)

Фактически отправлена со шлюза 1 пуш (недоставлен) и досылка смс (доставлена)

!image-2023-05-17-15-46-40-570.png!

Почему в разделе уведомления на следующий день 17.05 они всплыли не понятно",,2.0,
ADIRINC-1026,3238139,U_M1D7N,На исправление,17.05.2023 12:15,,,,,Дефект промсреды,,2023-06-29 00:00:00.0,"Заявки на размещение в adfront висят в активном idorderstatus, хотя в hell.[dbo].[instruction_registry] заявки уже помечены как исполненные
Было уже два подобных кейса
Обсуждалось тут 
https://rc.alfa-bank.net/channel/adir_duty?msg=6yzz3vuGf6FhfCDSX",,49.0,Core
ADIRINC-1025,3237671,U_M1AYE,Закрыт,17.05.2023 11:34,,,,,Дефект промсреды,15.04.2024 10:09,2023-06-29 00:00:00.0,"При попытке пополнить БС с карты дергается сервис [http://esbws:80/CS/EQ/WSCardListMask10/SOAP|http://esbws/CS/EQ/WSCardListMask10/SOAP]
который возвращает все карты клиента, но при выборе карты не проходит проверка на статус закрытой
В итоге для перевода выбирается закрытая карта и операция отклоняется ПЦ",,10.0,Личный кабинет
ADIRINC-1024,3235903,U_M25TF,На исправление,16.05.2023 18:49,ОТЭИСФЛ,,,,Дефект промсреды,,2023-05-26 00:00:00.0,"Коллеги, добрый день. 
 К нам обратился клиент Индина Мария Андреевна (ГС 1488502)
 У неё по инструменту FSKE в МТ после конвертации Россетей показывает доходность 2000%.
 По существу разбора ситуации видим, что bps_rub для экстра-трансфер 40077877 рассчитан как 0,00614500. В то же время bp_rub рассчитан как 0,10169200. Вроде по предыдущим сообщениям [~U_M1AYY] эти значения не должны сильно расходиться между собой.
 !image-2023-05-16-18-40-42-221.png!",,23.0,
ADIRINC-1023,3236038,U_M17SM,Закрыт,16.05.2023 18:49,,,,,Дефект промсреды,17.01.2024 16:50,2023-06-29 00:00:00.0,"Платформа ПК версия 4.0.3765.1407
У клиента при нажатии на ""Volum profile"" график сжимается и сбивается,
также при установке таймфейма 1 минута график сжимается растянуть его у клиента не получается",,3.0,АИ ПРО
ADIRINC-1022,3235268,U_M1AYY,Повторный,16.05.2023 16:29,ОТЭИСФЛ,,,,Дефект промсреды,,2024-02-15 00:00:00.0,"Коллеги, добрый день. Помогите разобраться в причинах расхождения между УЦ, показываемой в МТ и ценой, получаемой при помощи калькулятора.

К нам обратился клиент Баранова Наталья Федоровна (AVTQBA 4641321).
 У клиента по инструменту  NVTK (RU000A0DKVS5) в МТ отображается цена 955,8 руб.,
 по калькулятору получается 1136,64 руб.

При проверке видим, что bp_rub и bps_rub рассчитаны верно (за исключением двух инфра-трансферов для bps_rub), и средневзвес, посчитанный на их основе, даёт результат, совпадающий с калькулятором:

 !image-2023-05-16-16-18-30-897.png!
 Как видно, только 300 шт. бумаг из 821 были куплены по цене равной или немного меньше 955,8. ",,8.0,
ADIRINC-1021,3226782,U_M17SM,NEW,15.05.2023 19:13,,,,,Дефект промсреды,,2024-10-11 00:00:00.0,"На почту обратился клиент гс 90381 AKOPPQ Баласанян Арташес Вазгенович не работает в АД 4.0 опции меню: ""Переход на сайт"" и ""Перевод денежных средств"" Например, после первого перехода на сайт перестает подниматься окно с переводом денежных средств. То же и в обратную сторону, сайт выдает ошибку: \{""id"":""FIELD_MISSED"",""message"":{""en"":""Required field not found: token""},""base_id"":""16080bf6-dbe4-428e-b648-06739b59e920"",""type_id"":""REQUEST_READER"",""class"":""class ru.ratauth.exception.ReadRequestException""}
В принципе, любое использование одного из этих пунктов сразу ломает оба их и не работает до перезагрузки всего приложения.
Также выявилась такая ошибка - при открытии окна переводов сперва вообще завис, после перезапуска приложения в нем один раз отобразилась страница авторизации сайта (скрин).
Windows 11 64 бит
Скриншот и логи во вложении.
Просьба помочь в решении вопроса клиента.",,,
ADIRINC-1020,3226776,U_M1BFA,Отклонен,15.05.2023 18:56,,,,,Дефект промсреды,12.01.2024 09:55,2023-06-28 00:00:00.0,"невозможно сделать отображение графиков кластерами, как в предыдущих версиях. Иконка из окна выбора отображения графиков пропала. Остались свечи и еще 2 вида.
На скриншоте на 5-й значок по счету не реагирует. !image-2023-05-15-18-53-34-283.png!",,2.0,
ADIRINC-1019,3226704,U_M1QX4,Отклонен,15.05.2023 18:09,,,,,Дефект промсреды,03.09.2024 10:10,2023-06-28 00:00:00.0,"Не работает в АД 4.0 опции меню: ""Переход на сайт"" и ""Перевод денежных средств"" Например, после первого перехода на сайт перестает подниматься окно с переводом денежных средств. То же и в обратную сторону, сайт выдает ошибку: \{""id"":""FIELD_MISSED"",""message"":{""en"":""Required field not found: token""},""base_id"":""16080bf6-dbe4-428e-b648-06739b59e920"",""type_id"":""REQUEST_READER"",""class"":""class ru.ratauth.exception.ReadRequestException""}

Также при открытии окна переводов сперва вообще завис, после перезапуска приложения в нем один раз отобразилась страница авторизации сайта (скрин).",,1.0,АИ ПРО
ADIRINC-1018,3226703,U_M1DKF,Отклонен,15.05.2023 18:08,,,,,Дефект промсреды,25.01.2024 17:44,2023-06-28 00:00:00.0,"Клиент не может подать поручение на закрытие ИИС с типом 3 или 4 в ЛК
Те клиенты, у кого в hell.dbo.accounts проставлен тип ИИС 3 или 4, что соответствует закрытию с налоговыми вычетами, не могут подать поручение на закрытие через ЛК
При попытке воспользоваться функционалом ЛК ловят ошибку",,6.0,Личный кабинет
ADIRINC-1017,3225868,U_M1QX4,Отклонен,15.05.2023 16:03,,,,,Дефект промсреды,03.09.2024 10:10,2023-06-27 00:00:00.0,"*Версия:*
 ** 4.0.3681.1925
*Описание:*
Зависание котировок
На почту обратился клиент гс 4270116 и 5324912 APMUGL Рыбьяков Михаил Сергеевич Проблема с зависанием графиков.
Новое окно не зависает. Зависает только старое окно спустя некоторое время работы. При перезапуске приложения зависание проходит. Таймфрем 1-5 минут.
Открыто 14 окон графиков. зависает обычно одно окно
 ",,4.0,АИ ПРО
ADIRINC-1016,3225678,RUM1BPH,Закрыт,15.05.2023 16:01,ОТЭИСФЛ,,,,Дефект промсреды,09.10.2024 10:18,2023-05-24 00:00:00.0,"Коллеги, добрый день.
 К нам обратился клиент Миленький Андрей Иванович , ГС - 292911 по поводу неверного расчёта УЦ. 
 У клиента по инструменту RU000A0JPNN9 отображается цена 0,12016, что отличается от ожидаемой им 0,1591.

При проверке кейза клиента замечено, что была конвертация HMRK (RU000A0JPVJ0) в FSKE (RU000A0JPNN9). 
В экстра-трансфере 34906572 (Конвертация выпуска HMRK в HMRKA) указана цена 0,5588, а должна быть 1,19593178571428, если считать методом FIFO по HMRK (RU000A0JPVJ0). 

!image-2023-05-15-16-06-39-266.png!

  !image-2023-05-15-17-07-43-193.png!
 Прошу обосновать цену 0,5588 в данном трансфере. ",,31.0,Марс
ADIRINC-1015,3223994,U_M173X,Закрыт,15.05.2023 12:51,,,,,Дефект промсреды,23.04.2024 09:53,2023-07-17 00:00:00.0,"iOS 2.17.0
Клиент пытается выставить стоп-лимит заявку на продажу с проскоком 
ОР: Поле итого считается как (стоп-цена - проскок*шаг цены) * кол-во лотов
ФР: Поле итого считается как (стоп-цена + проскок*шаг цены) * кол-во лотов
!image-2023-05-15-12-51-31-856.png!",,1.0,Мобильный терминал
ADIRINC-1014,3223657,U_M0WVN,Отклонен,15.05.2023 11:49,,,,,Дефект промсреды,03.03.2024 23:34,2023-06-27 00:00:00.0,"Клиент выставляет заявку на IOS с графика и экран заявки выхоит за пределы экрана

!image-2023-05-15-11-47-15-166.png!",,1.0,Мобильный терминал
ADIRINC-1013,3219958,U_M214D,На исправление,12.05.2023 16:01,,,,,Дефект промсреды,,2023-06-26 00:00:00.0,"В левом верхнем окне невозможно изменить данные. 
Неактивен выпадающий список сортировки, поле некликабельное
Со слов клиента: ""У меня выставлено Лидеры оборота. Изменить невозможно, окно неактивно.""",,18.0,Fuji
ADIRINC-1012,3215984,U_M1AYE,Закрыт,11.05.2023 17:45,,,,,Дефект промсреды,15.05.2023 16:46,2023-06-23 00:00:00.0,"У клиентов из-за ошибки снимаются заявки при попытке их перевыставить ЛС-ом

42267511484",,3.0,Core
ADIRINC-1011,3215756,U_M1CE2,Закрыт,11.05.2023 17:03,,,,,Дефект промсреды,17.01.2024 18:16,2023-06-23 00:00:00.0,"При раскатке в кубер adir-position-keeping иногда зависает, поднятый на новой версии под и не обрабатывает запросы, 
Из-за чего не отрабатывает  CI/CD [Pipeline · Dotnet services / adir-position-keeping · GitLab (alfadirect.ru)|http://gitlab.alfadirect.ru/dotnet-services/adir-position-keeping/-/pipelines/17132]
!image-2023-05-11-17-16-57-647.png!
!image-2023-05-11-17-19-59-695.png!

requests.exceptions.ReadTimeout: HTTPConnectionPool(host='adir-position-keeping.k8s-master.alfadirect.ru', port=80): Read timed out. (read timeout=10) Cleaning up project directory and file based variables 00:00 ERROR: Job failed: exit code 1
Помогает рестарт подов",,,Core
ADIRINC-1010,3214123,U_M1CUE,Отклонен,11.05.2023 13:47,,,,,Дефект промсреды,21.06.2023 12:57,2023-07-13 00:00:00.0,Клиент 4419539 Волчанский Михаил Михайлович AVU59Q переходит в раздел Аналитика - отчет  и наблюдает выплаты купонов на сумму 686.56. В то время когда в брокерском отчете выплаты купонов составляют 639.54 рублей.,,2.0,
ADIRINC-1009,3209327,U_M16SR,Отклонен,10.05.2023 12:29,,,,,Дефект промсреды,17.01.2024 16:01,2023-07-12 00:00:00.0,"По бумаге ПАО Генетико Ru000a105bn4 не отображается информация во вкладках Обзор и Показатели/О компании. Насколько я знаю информация тянется с [news_cache].[direct].[emitents] , там эту бумагу я не нашел даже.
 На андройде ошибка \\\\\\\\\\\\\\\""Нужен второй заход\\\\\\\\\\\\\\\"", на IOS \\\\\\\\\\\\\\\""Ошибка загрузки\\\\\\\\\\\\\\\""
https://rc.alfa-bank.net/channel/bagi-info-po-emitentam/thread/3xk7Lcz74hfmNhLKq",,5.0,
ADIRINC-1008,3209284,U_M17SM,На исправление,10.05.2023 11:59,,,,,Дефект промсреды,,2023-06-22 00:00:00.0,"Согласно руководству по АД 4.0
ПУ (дн)- это прибыль/убыток дневной. Рассчитывается как совокупный финансовый результат текущего дня, включая переоценку позиций.
По клиентам 44522 AC27NI и 4336753 AVTQGY отображается по давно неторгуемым бумагам ПУ(дн) не ноль, а какое-то значение.

https://rc.alfa-bank.net/channel/adir-terminal-support/thread/NHHp8ffaC9YyacQSj",,11.0,АИ ПРО
ADIRINC-1007,3208918,U_M17SM,Закрыт,10.05.2023 11:29,,,,,Дефект промсреды,30.01.2024 12:31,2023-06-22 00:00:00.0,"У клиента 739502 ABSWRT перестают обновляться графики по разным таймфреймам. Похож на дефект годовой давности когда при переключении вкладок включается офлайн режим [http://jira.moscow.alfaintra.net/browse/ADIRTERM-868
[https://rc.alfa-bank.net/channel/adir-terminal-support/thread/wCTsG6RcfT7K7mq4m]",,11.0,Pro terminal
ADIRINC-1006,3198546,U_M19LL,Закрыт,03.05.2023 18:09,,,,,Дефект промсреды,12.05.2023 13:53,2023-06-20 00:00:00.0,"В ночном расчете количество бумага на конец дня не рассчиталась, что повлекло за собой неверный расчет учетной цены в следующем дне.

Пример клиента: 

Клиент ANPYVK 1358323 Тимошенко Андрей Николаевич  открыл позицию по NG-5.23 1шт. сегодня 03.05.2023 по цене 2,322 pt
 У клиента рассчитана средняя цена в позиции некорректно (указано на скриншоте)

Просьба разобраться и поправить отображение.

*SELECT 'ADFront.cf.RegPrices' as 'ADFront.cf.RegPrices',Price = fRegPrice, PriceCur = cur.SymbolObject, acc_code = sa.CodeSubAccount, ISIN = obj.ISIN,obj.NameObject,rt.place_code*
*--,rp.**
*,rp.**
*FROM ADFront.cf.RegPrices rp with(nolock)*
*join ADFront.dbo.SubAccounts sa on sa.IdSubAccount = rp.IdSubAccount*
*join ADFront.dbo.objects obj on obj.IdObject = rp.IdObject*
*join ADFront.dbo.objects cur on cur.IdObject = rp.IdObjectUchPriceCurr*
*join ADFront.dbo.Razdels r on r.IdRazdel = rp.IdRazdel*
*join ADFront.dbo.RazdelTypes rt on rt.IdRazdelType = r.IdRazdelType*
*WHERE 1 = 1*
*AND sa.CodeSubAccount like '1358323-000'*
*and isnull(obj.ISIN,obj.NameObject) in ('NG-5.23')*
*--AND rp.fClearPos <> 0*

 

!image-2023-05-03-18-05-14-828.png!

 ",,32.0,
ADIRINC-1005,3192602,U_M1DKF,Закрыт,02.05.2023 15:48,,,,,Дефект промсреды,08.06.2023 15:56,2023-06-16 00:00:00.0,"Коллеги, поступили требования от безопасности банка установить минимальные требования к длине пароля согласно 

Национальный стандарт Российской Федерации ГОСТ Р 57580.1-2017 ""Безопасность финансовых (банковских) операций. Защита информации финансовых организаций. Базовый состав организационных и технических мер"".

(утвержден приказом Федерального агентства по техническому регулированию и метрологии от 8 августа 2017 года N 822-ст ""Об утверждении национального стандарта"").

 *Необходимо сделать минимум 8 символов как минимум*

*У нас на фронте сейчас стоит 6*

*!image-2023-05-02-15-47-21-915.png!*",,,
ADIRINC-1004,3191199,U_M1QLD,Отклонен,02.05.2023 13:31,,,,,Дефект промсреды,07.02.2024 15:53,2023-07-06 00:00:00.0,"Клиент 4460813 AVVCOY владеет бумагами  OZON которая торгуется как на Московской Бирже(МБ), так и на  СПБ Бирже(СПББ). У клиента куплена бумага и на той, и на другой бирже. Он проваливается в бумагу - МосБирж - раздел График - наблюдает подпись \\\\\\\\\\\\\\\""на МосБирже RUB\\\\\\\\\\\\\\\"", но на графике отображается покупка сделанная на СПББ. 
Так же у клиента и в позиции на МБ, и в позиции на СПББ в разделе История отображается общая история по этой бумаге, не рассчитанная на то, что куплены на разных биржах",,8.0,Fuji
ADIRINC-1003,3187860,U_M1CWM,Закрыт,28.04.2023 17:53,,,,,Дефект промсреды,30.01.2024 15:43,2023-06-15 00:00:00.0,"Клиент 6482171 Платонов Андрей Андреевич AU7M4U 
Устройство на базе iOS 14.8, iPhone SE
Проваливается в бумагу, заходит в раздел График и у него перестают отображаться другие вкладки типа сводка, стакан и тд, из-за чего он не может перейти обратно, нет и кнопки «<«. Из любого другого пункт строка есть.
Вероятно проблема из-за нехватки места на экране.",,6.0,АИ ПРО
ADIRINC-1002,3185944,U_M17SM,Закрыт,28.04.2023 12:56,,,,,Дефект промсреды,30.01.2024 12:30,2023-06-15 00:00:00.0,"ОР: Клиент запускает и авторизовывается в ДТ 4.0 после корректно у него загружается конфигурация
ФР: Клиент запускает и авторизовывается в ДТ 4.0 после ни одна конфигурация не загружается",,3.0,АИ ПРО
ADIRINC-1001,3179951,U_M18JH,Закрыт,27.04.2023 10:13,,,,,Дефект промсреды,22.09.2023 13:27,2023-07-04 00:00:00.0,"Клиент заходит в МТ, переходит на главном экране по своему имени в личный кабинет - заказ документов - документы для вычета по ИИС - жмет сохранить -
ОР: файл сохраняется
ФР: ничего не происходит.
Примеры ГС: 2812508 4436540 4430122",,6.0,
ADIRINC-1000,3177795,U_M177U,Отклонен,26.04.2023 15:41,,,,,Дефект промсреды,23.01.2024 13:34,2023-07-03 00:00:00.0,"# Клиент на андроид заходит в Операции и выбирает выплату купонов , например по ОФЗ
 # Далее есть возможность кликнуть на нее тут

!image-2023-04-26-15-32-53-566.png!

Фактически:

Возникает ошибка на фронте 

!image-2023-04-26-15-33-27-030.png!

В логах микросервисов ошибок не нашел",,,
ADIRINC-999,3175720,U_M1CWM,Закрыт,26.04.2023 10:40,,,,,Дефект промсреды,14.02.2024 17:05,2023-06-13 00:00:00.0,"Клиент 1117815 Рыбакова Сталина Владимировна AS02SM
ОР: заходит в ВТ и видит по бумаге RU000A101YY2 корректно подтянутую текущую цену, стакан по ней корректно отображает заявки, график грузится.
ФР: заходит в ВТ и видит по бумаге RU000A101YY2 текущую цену 0, от чего доходность по бумаге -100%, в разделе стакан написано \\\\\\\\\\\\\\\""торги закрыты\\\\\\\\\\\\\\\"", в разделе график пусто.
В МТ все корректно подгружается
https://rc.alfa-bank.net/channel/team-invest-web-terminal/thread/4j6MZ29sT9D99gR97",,2.0,
ADIRINC-998,3172093,U_M00ZM,Закрыт,25.04.2023 11:33,,,,,Дефект промсреды,25.04.2023 11:41,2023-06-09 00:00:00.0,"Деградация Лимитного сервиса из за реборна заявок, с ручным подтверждением, выставленных повторно.",,,
ADIRINC-997,3165532,U_M1FE1,Закрыт,21.04.2023 16:44,,,,,Дефект промсреды,04.06.2024 10:30,2023-06-07 00:00:00.0,"Клиент заходит в бумагу, переходит в раздел дивиденды и видит окно \\\\\\\\\\\\\\\""купить до 30 декабря 2110\\\\\\\\\\\\\\\""
Дата отображается некорректно. Замечено по бумагам:
RU000A0JNJ11
RU000A0D8PC2
RU000A0JXNU8",,236.0,Сатурн
ADIRINC-996,3164715,U_M1CUE,Отклонен,21.04.2023 16:22,,,,,Дефект промсреды,31.05.2023 14:54,2023-06-07 00:00:00.0,"Клиент AKEPT4 93720 Букреев Александр Михайлович

Версия МТ 2.22.1 android
Устройство Blackview BV4900Pro

Клиент настраивает порядок в избранном. После перезахода в приложение этот порядок сбразывается.",,2.0,Мобильный терминал
ADIRINC-995,3162956,U_M00ZM,Закрыт,21.04.2023 10:45,,,,,Дефект промсреды,13.02.2024 13:29,2023-06-07 00:00:00.0,"Клиент не может вывести ДС с БС с типом «Инвесткопилка», если на счете отсутствуют бумаги, а есть только ДС.
Предположительно некорректная работа сервиса microinvest-sell-and-withdraw, который при отсутствии бумаг пытается для вывода Выставить заявку на продажу бумаг , ЛС выдает, что доступно 0 и сам сервис отдает 500 и ошибку нехватки лимитов. 
|Apr 7, 2023 @ 12:54:59.973|Конец запроса POST /rest/microinvest/sellandwithdraw/assets - 500 - 1418ms|
| |Apr 7, 2023 @ 12:54:59.972|Конец вызова Post запроса HttpClient. Метод: HttpPostAsync.|
| |Apr 7, 2023 @ 12:54:59.972|Получен результат \\\\\\\\\\\\\\\\{\\\\\\\\\\\\\\\""limits\\\\\\\\\\\\\\\"": {\\\\\\\\\\\\\\\""own\\\\\\\\\\\\\\\"":0,\\\\\\\\\\\\\\\""marginal\\\\\\\\\\\\\\\"":0},\\\\\\\\\\\\\\\""taxes\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\\{\\\\\\\\\\\\\\\""taxSum\\\\\\\\\\\\\\\"":15.00,\\\\\\\\\\\\\\\""taxTotal\\\\\\\\\\\\\\\"":15.00,\\\\\\\\\\\\\\\""taxRate\\\\\\\\\\\\\\\"":13.00,\\\\\\\\\\\\\\\""balancePrice\\\\\\\\\\\\\\\"":0.00,\\\\\\\\\\\\\\\""amountToRub\\\\\\\\\\\\\\\"":1.000000,\\\\\\\\\\\\\\\""isActual\\\\\\\\\\\\\\\"":true,\\\\\\\\\\\\\\\""extraTaxSum\\\\\\\\\\\\\\\"":0.00,\\\\\\\\\\\\\\\""extraTaxRate\\\\\\\\\\\\\\\"":0.00},\\\\\\\\\\\\\\\""factWithdraw\\\\\\\\\\\\\\\"":5817.60}. Метод: HttpPostAsync.|
| |Apr 7, 2023 @ 12:54:59.972|Конец вызова запроса лимита на вывод. Метод: GetWithdravalLimitAsync.|
| |Apr 7, 2023 @ 12:54:59.972|Вывод средств невозможен. Доступные лимиты : 0 , 0|
| h4. Expanded document
 [View surrounding documents|http://adirelkprod.alfadirect.ru/app/discover#/context/a898b3c0-20d7-11ec-81d9-f956519bb053/S5onW4cBrZ9mmZsVP6b8?_g=(filters:!())&_a=(columns:!(message),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!t,index:a898b3c0-20d7-11ec-81d9-f956519bb053,key:_index,negate:!f,params:!(adir-production-dotnet-limitservice,adir-production-dotnet-rucabinet),type:phrases),query:(bool:(minimum_should_match:1,should:!((match_phrase:(_index:adir-production-dotnet-limitservice)),(match_phrase:(_index:adir-production-dotnet-rucabinet)))))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:a898b3c0-20d7-11ec-81d9-f956519bb053,key:logContext.requestId,negate:!f,params:(query:cd4a6d59-6c22-4982-a9f5-0e7124b75df6),type:phrase),query:(match_phrase:(logContext.requestId:cd4a6d59-6c22-4982-a9f5-0e7124b75df6))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:a898b3c0-20d7-11ec-81d9-f956519bb053,key:logContext.requestId,negate:!f,params:(query:eaed28c6-6163-489d-b372-5bb1e72634d2),type:phrase),query:(match_phrase:(logContext.requestId:eaed28c6-6163-489d-b372-5bb1e72634d2))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:a898b3c0-20d7-11ec-81d9-f956519bb053,key:logContext.requestId,negate:!f,params:(query:a2e8b7d3-5e3d-46d6-8e93-00b0b2778b45),type:phrase),query:(match_phrase:(logContext.requestId:a2e8b7d3-5e3d-46d6-8e93-00b0b2778b45))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:a898b3c0-20d7-11ec-81d9-f956519bb053,key:_index,negate:!f,params:(query:adir-production-dotnet-limitservice),type:phrase),query:(match_phrase:(_index:adir-production-dotnet-limitservice))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:a898b3c0-20d7-11ec-81d9-f956519bb053,key:_index,negate:!f,params:(query:adir-production-dotnet-facade-limitservice),type:phrase),query:(match_phrase:(_index:adir-production-dotnet-facade-limitservice)))))]
 [View single document|http://adirelkprod.alfadirect.ru/app/discover#/doc/a898b3c0-20d7-11ec-81d9-f956519bb053/adir-production-dotnet-microinvest-sell-and-withdraw-000506?id=S5onW4cBrZ9mmZsVP6b8]
 TableJSON|
| | 
 _id|S5onW4cBrZ9mmZsVP6b8|
 _index|adir-production-dotnet-microinvest-sell-and-withdraw-000506|
 _score|-|
 _type|application-nlog|
 @timestamp|Apr 7, 2023 @ 12:54:59.972|
 category|Microinvest.Sell.Withdraw.Library.RequestProcessor|
 host|adir-p-core-14|
 level|Error|
 logContext.ActionId|19303c34-7645-4e4a-b518-da353ec83e76|
 logContext.ActionName|Microinvest.Sell.Withdraw.Service.Controllers.V1.SellAndWithdrawController.SaleAssetsAndWidthdrawMoney (Microinvest.Sale.Withdraw.Service)|
 logContext.apiVersion|1|
 logContext.requestId|2d253d11-dd21-492e-b6f4-73909a589c27|
 logContext.RequestId|80050276-0001-df00-b63f-84710c7967bb|
 logContext.RequestPath|/rest/microinvest/sellandwithdraw/assets|
 machine|ADIR-P-CORE-14|
 message|Вывод средств невозможен. Доступные лимиты : 0 , 0|",,34.0,Core
ADIRINC-994,3161939,U_M2AB7,На исправление,20.04.2023 18:17,,,,,Дефект промсреды,,2023-05-03 00:00:00.0,"При попытке выставить заявку у клиента всплывает ошибка рассинхронизации с сервером

Клиенты часто ловят ошибку из-за разных текстов заявок на сервере и на устройстве, тк текст поручения уже подписанной заявки подставляют для новой заявки

 

07:41:58.426 AD.Core.Source.TradeOrdersSource get ClientEnterOrderRsp: clientOrderNum=1697663403, idLogin=101424037, errorCode=OrderRejectedBadOrderSign, errorText=Сформированный текст заявки на стороне сервера не совпадает с заявкой сформированной на клиенте

 

 

 ",,134.0,Everest
ADIRINC-993,3157614,U_M0WVN,Закрыт,19.04.2023 18:39,ОТЭИСФЛ,,,,Дефект промсреды,20.06.2023 10:11,2023-05-02 00:00:00.0,"с 19.04 перешли на средневзвешенный расчет учетной цены 

[https://www.alfadirect.ru/news/540-menyaem-raschyot-uchyotnyx-cen-na-edinuyu-srednevzveshennuyu-metodiku-s-19-aprelya-2023-]

За 19.04 поступают массовые обращения клиентов.

На текущий момент около 15-16 , где клиенты не согласны с расчетом

Примеры:

[^учетка за 19.xlsx]

 

 

 ",,86.0,
ADIRINC-992,3156512,U_M18JH,Отклонен,19.04.2023 16:14,,,,,Дефект промсреды,21.06.2023 09:42,2023-06-05 00:00:00.0,"Клиенты при авторизации в приложение ловуят ошибку \\\\\\\\\\\\\\\""Сервис не доступен. Проверьте интернет соединение\\\\\\\\\\\\\\\"".
Примеры клиентов:
131998 AA2V9Z
4406545 AR6JWK",,5.0,Мобильный терминал
ADIRINC-991,3151782,U_M00ZM,На исправление,18.04.2023 15:05,,,,,Дефект промсреды,,2023-06-02 00:00:00.0,"Предположительно при старте датакэша в сущностях SubAccountAccessEntity, SubAccountRazdelEntity,ClientAccountEntity,TSAccount4LSEntity,TSSubAccount4LSEntity зачитались не все значения. Из-за этого часть клиентов не могла выставлять заявки, а часть у части клиентов не отображались позиции. 
Проблема возникла после релиза торговый сервисов по задаче  ITINVEST-1165
Тред с обсуждениями [https://rc.alfa-bank.net/channel/adir-avarii?msg=SMFXggoDfK5rJ5AJn] 
https://rc.alfa-bank.net/channel/adir-avarii?msg=qSqN2JPyHmMRmKr6c",,,
ADIRINC-990,3151748,U_M173X,Закрыт,18.04.2023 14:41,,,,,Дефект промсреды,14.11.2023 12:38,2023-06-23 00:00:00.0,"17.04  в 8.38  ЛК исчерпал пулл коннектов, что привело к деградации сервиса
 Ошибка в логах ЛК
 ""Timeout expired. The timeout period elapsed prior to obtaining a connection from the pool. This may have occurred because all pooled connections were in use and max pool size was reached.""

Судя по недельному графику коннектов, ночью они освобождаются и из-за этого до лимита не доходит, в этот раз такого не произошло. При этом повышенной нагрузки в это время не было

!image-2023-04-18-14-38-29-254.png!

!image-2023-04-18-14-39-22-452.png!

Тред с обсуждением https://rc.alfa-bank.net/channel/adir-lk-pub?msg=BPRFCmfoEextmSz38",,,
ADIRINC-989,3147910,U_M00ZM,Отклонен,17.04.2023 18:37,,,,,Дефект промсреды,15.05.2023 12:22,2023-06-02 00:00:00.0,Неверно посчитаны позиции при переходе на расчёт по средневзвесу. ,,,Core
ADIRINC-988,3141090,U_M0WVN,Закрыт,14.04.2023 17:13,,,,,Дефект промсреды,06.08.2024 18:11,2023-06-21 00:00:00.0,"Прикладываю видео некорректного поведения в поле ввода при редактировании заявки на ВТ. 

Описывать не буду, на видео в принципе хорошо видно

[^RPReplay_Final1680869095.MP4]",,,Web
ADIRINC-987,3122911,U_M1AYY,Закрыт,11.04.2023 12:24,,,,,Дефект промсреды,24.01.2024 10:46,2023-08-04 00:00:00.0,"Клиент 57910 Маринов Владимир Викторович AE3PAS заходит в МТ ->
 переходит в портфель -> смотрит на RU000A1057S2 облигация росснефть и видит НКД 0, хотя уже были выплаты 21 марта
пример 2 :
Клиент AC0NUC 4134141 переходит в раздел \\\\\\\\\\\\\\\""Портфель\\\\\\\\\\\\\\\"" и наблюдает по облигации НКД 0, проваливается в бумагу и видит в разделе \\\\\\\\\\\\\\\""Позиция\\\\\\\\\\\\\\\"" НКД = 0 ,в разделе \\\\\\\\\\\\\\\""Купоны\\\\\\\\\\\\\\\"" НКД так же 0",,14.0,Марс
ADIRINC-986,3120705,U_M1CWM,Отклонен,10.04.2023 19:25,,,,,Дефект промсреды,05.05.2023 17:14,2023-05-26 00:00:00.0,"У клиента отображается учетная стоимость как текущая стоимость актива, учетная стоимость должна быть 4961",,,АИ ПРО
ADIRINC-985,3115262,U_M0WVN,Закрыт,07.04.2023 18:01,,,,,Дефект промсреды,24.04.2024 12:06,2023-05-25 00:00:00.0,"Завожу пока по следам аварии в пт 07.04.2023, может еще что добавим позже

Начали тормозить сервисы мидла на mesos кластере Альфа-Директ (большая пачка).

Аффектит в частности на загрузку портфеля и на другие функциональности приложения.

Предположительно на участке балансировщика проблема (или за ним, например Checkpoint)

Если вручную генерить пакеты с F5, то видны задержки периодические пакетов , как будто ""залипают""

!image-2023-04-07-17-52-46-136.png!

!image-2023-04-07-17-36-23-897.png!

!image-2023-04-07-17-56-31-491.png!

Ошибки корелируют с ростом коннектов на Checkpoint Клика(напрямую он не связан с ситуацией в Директе, только предположение)

!image-2023-04-07-17-38-47-265.png!",,,Core
ADIRINC-984,3112539,U_M00ZM,Отклонен,07.04.2023 10:31,,,,,Дефект промсреды,07.04.2023 13:26,2023-05-24 00:00:00.0," У клиентов нет отображения позиций по бумагам обособленных в рамках указа 318.
Например: АФК система обособлена по указу, клиент её не вилит в МТ в неторговом разделе
!image-2023-04-07-12-48-42-477.png!
!image-2023-04-07-12-47-01-786.png!
В рамках проверки скриптом выявили у нас 300+ с обособленными бумагами. А видов бумаг около 240. Проблемы с отображением не во всеми из них. Необходимо довести необходимый борд неторгового раздела.",,6.0,Альфа-Админ
ADIRINC-983,3108341,U_M17VN,Закрыт,06.04.2023 12:19,,,,,Дефект промсреды,28.04.2023 11:03,2023-05-23 00:00:00.0,"Клиент заходит в приложение, хочет выставить заявку на покупку или продажу армянского драма
ОР: Сумма отображается корректно и равна цена * кол-во
ФР: Сумма отображается в 100 раз меньше
Воспроизводится на iOS 2.17.0
!image-2023-04-06-12-18-40-043.png!",,2.0,Мобильный терминал
ADIRINC-982,3107691,U_M1BFA,Закрыт,06.04.2023 11:00,,,,,Дефект промсреды,22.02.2024 13:23,2023-05-23 00:00:00.0,"При длительном простое график иногда мерцает.

Также при наведении перекрестия график мерцает.

*ОР:*

График не мерцает.

Подробности в Видео

*UPD* (23.03.2023): нативный график мерцает сразу после создания

Видео в https://jira.moscow.alfaintra.net/browse/ADIRTERM-1233",,9.0,АИ ПРО
ADIRINC-981,3107287,U_M1D7N,Отклонен,06.04.2023 10:15,,,,,Дефект промсреды,28.02.2024 13:57,2023-06-13 00:00:00.0,"Клиент 472981 AP517L переходит в портфель и смотрит на бумагу RU000A0JU6Q7 
Наблюдает странную доходность: У него 2000 бумаг и УЦ 192 рубля, если цена выростает  на 2 рубля, то доходность 3000 рублей вместо 4-ех, а если выростает на 4 рубля, то доходность 7000 рублей. Шаг цены бумаги 1 рубль.
Проблема заключается в том, что у него из-за разной цены сделок по этой бумаге УЦ дробная 192,5, в следствии чего доходность корректно отображается, но клиент это не понимает, тк УЦ у него меньше. Вероятно УЦ округляется до целых",,8.0,Core
ADIRINC-980,3102916,U_M1QLD,Закрыт,05.04.2023 12:00,,,,,Дефект промсреды,14.02.2024 17:23,2023-05-22 00:00:00.0,"Клиент заходит в любую бумагу с устройства Android в МТ, переходит в раздел График. Даты отображаются корректно. В дневном таймфрейме пишется день, месяц, год. Далее клиент нажимает на шестеренку и у него начинает отображаться некорректная дата 18 июл. 69.
Меняя таймфрейм на любой другой, дата так же некорректно оотображается но относительно таймфрейма, т.е. часовой покажет некорректно - 18 июл. 23:59 например.
Так же при нажатии на шестеренку перестают отображаться сделки",,6.0,Мобильный терминал
ADIRINC-979,3098839,U_M173X,Отклонен,04.04.2023 12:02,,,,,Дефект промсреды,28.04.2023 11:16,2023-05-19 00:00:00.0,"Клиент заходит в МТ

ОР: Плашки о срочных требованиях нет

ФР: Отображается плашка о необходимости пополнить счет на 0 рублей 

Проблема воспроизводиться на iOS 2.17.0 

в adfront.ts.MarginRequirements 



!image-2023-04-04-12-01-55-532.png!

!image-2023-04-04-12-00-25-624.png!",,3.0,Мобильный терминал
ADIRINC-978,3098131,U_M1CUE,Закрыт,04.04.2023 10:43,,,,,Дефект промсреды,21.06.2023 13:06,2023-05-19 00:00:00.0,"Клиент пытается пройти тест, но у него лагает, долго грузится, перекидывает с вопроса на вопрос, с первого вопроса на второй и обратно на первый вопрос, вопросы повторяются. По итогу тест не пройден.",,10.0,Личный кабинет
ADIRINC-977,3096317,U_M1CYD,Закрыт,03.04.2023 18:41,,,,,Дефект промсреды,12.04.2023 14:05,2023-05-19 00:00:00.0,"У облигаций Совкомфлота и Газпрома номинал в долларах, но цена в рублях не пересчитывается с учетом курса номинала",,,Альфа-Админ
ADIRINC-976,3096565,U_M1FLP,Отклонен,03.04.2023 18:17,,,,,Дефект промсреды,09.08.2023 17:01,2023-05-19 00:00:00.0,"31.03.2023 в 04:30 произошла деградация сервиса adir-portfolio-analytics.

Сервис перестал отвечать. В МТ во вкладки ""Отчёт"" в аналитике портфеля появлялась плашка ""Что-то пошло не так"".

Поднять сервис помогла перезагрузка на IIS примерно в 6:10. Сервис поднялся в 6:31.

Логи: [Discover - Elastic (alfadirect.ru)|http://adirelkprod.alfadirect.ru/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:'2023-03-31T01:10:37.983Z',to:'2023-03-31T03:50:28.921Z'))&_a=(columns:!(message),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:a898b3c0-20d7-11ec-81d9-f956519bb053,key:_index,negate:!f,params:(query:adir-production-dotnet-portfolioanalytics),type:phrase),query:(match_phrase:(_index:adir-production-dotnet-portfolioanalytics))),('$state':(store:appState),meta:(alias:!n,disabled:!f,index:a898b3c0-20d7-11ec-81d9-f956519bb053,key:logContext.statusCode,negate:!f,params:(query:'500'),type:phrase),query:(match_phrase:(logContext.statusCode:'500')))),index:a898b3c0-20d7-11ec-81d9-f956519bb053,interval:auto,query:(language:kuery,query:''),sort:!(!('@timestamp',desc)))]

!image-2023-04-03-18-14-09-274.png|width=820,height=490!

Метрики: [Метрики http-запросов в разрезе .NET-сервисов AlfaDirect - Dashboards - Grafana|https://grafana.alfadirect.ru/d/R4g6cCYnz/metriki-http-zaprosov-v-razreze-net-servisov-alfadirect?orgId=1&var-datasource=vic&var-env=prod&var-service=adir-portfolio-analytics&var-instances=adir-p-core-19.alfadirect.ru:8753&var-controllers=All&var-actions=All&var-actions_count=&var-percentile=95&from=1680225968194&to=1680233837517]

В данный момент также были работы в базе:

[RELEASE] event_log 20230331 - 4:00 Успех
 [RELEASE] hell 20230331 - 4:15 Успех
 [RELEASE] adback 20230331 - 4:45 Успех
 [RELEASE] adfront 20230331 - 4:55 Успех
 [RELEASE] compliance 20230331 - 5:05 Успех
 [RELEASE] quotes_calc 20230331 - 5:10 Успех
 [RELEASE] hell_data_cache 20230331 - 5:15 Успех

А также: 

Недоступен сервер [445P2.ALFADIRECT.RU|http://445p2.alfadirect.ru/] – упал MSSQL.  Где-то с 3 до 5 не работали Джобы.",,,Core
ADIRINC-975,3095074,U_M1N2N,Закрыт,03.04.2023 15:32,,,,,Дефект промсреды,21.06.2023 12:35,2023-06-07 00:00:00.0,"О.Р. При погашении облигаций в аналитике клиент видит сумму дохода с облигаций
Ф.Р. При погашении облигаций в аналитике отображается как убыток, а не прибыль. 
!snimok_ekrana.png!",,3.0,Мобильный терминал
ADIRINC-974,3089085,U_M1N2N,Закрыт,31.03.2023 15:59,,,,,Дефект промсреды,05.04.2023 13:36,2023-06-06 00:00:00.0,"О.Р. При переключении периода отчёта клиент видит правильные данные по активам
Ф.Р. При переключении периода и обратно и у клиента отображаются разные данные.
Переключая вкладки:
Всё -> С начала года -> Всё
Отображаются разные данные 
!snimok_ekrana.png!!snimok_ekrana2.png!",,5.0,Core
ADIRINC-973,3084726,U_M1CUE,Отклонен,30.03.2023 18:00,,,,,Дефект промсреды,21.06.2023 12:04,2023-06-06 00:00:00.0,"Клиент в приложении переходит в портфель, и видит что у его облигации в юанях текущая цена = 0
Почему-то не тянется ликвидный рынок исходя из логов устройста, хотя у бумаги ликвидный рынок корректен.
Информация из логов: 10:47:18.002 [AD.Core.Source.TradePositionsSource2.Data|http://ad.core.source.tradepositionssource2.data/] pos FLOTd300326 83125822 setMarketBoard marketBoard=not_found",,13.0,Мобильный терминал
ADIRINC-972,3084696,U_M001D,Отклонен,30.03.2023 17:49,,,,,Дефект промсреды,12.05.2023 16:39,2023-05-16 00:00:00.0,"Клиент на главном экране переходит в уведомления через колокольчик, после выбирает ""Счёт"" и видит один и тот же пуш пришедший дважды в разные последовательные дни. Пример: AVTAGB 4449583
|Доставлено PUSH|79613138301 (AVUV0K)|PUSH (через MFM)|27.03.2023 02:14:27|AI6|- 7 000.00 RUB Списание с брокерского счёта|По вопросам доставки обращаться на Helpdesk. По вопросам формирования и корректности текста на п/я ADirTechnology@alfabank.ru|Просмотреть|
|Доставлено PUSH|79613138301 (AVUV0K)|PUSH (через MFM)|26.03.2023 13:21:04|AI6|- 7 000.00 RUB Списание с брокерского счёта|По вопросам доставки обращаться на Helpdesk. По вопросам формирования и корректности текста на п/я ADirTechnology@alfabank.ru|Просмотреть|

Вероятнее всего проблема из-за ночного дублирования записей в БД.
По проблеме есть тред [https://rc.alfa-bank.net/channel/support-adir-trading-services/thread/aQtrkfxR4gAm5jua5]

Пример 2: AS912J так же был пуш 26-го числа и продублировался этот же пуш 27.03 в 02:14 (такое же время, как и в прошлом примере)",,1.0,Мобильный терминал
ADIRINC-971,3083853,U_M1N2N,К закрытию,30.03.2023 15:35,,,,,Дефект промсреды,,2023-05-16 00:00:00.0,"О.Р. При уменьшении графика объемы торгов тоже басштабируются.
Ф.Р. Нет масштабирования объема торгов.
Например: 
1. открываем график юаня
2. Ставим недели
3. Уменьшаем по максимум
4. Листаем в прошлое чуть чуть (что бы объемы торгов скрылись)
5. Получаем рябь вместо объемов торгов.
!screen.jpg|width=310,height=672!
 ",,2.0,Мобильный терминал
ADIRINC-970,3082497,U_M1CUE,Закрыт,30.03.2023 13:25,,,,,Дефект промсреды,07.08.2024 14:45,2023-06-05 00:00:00.0,"Клиент AXL0SH Гаврук К. В. пользуется браузерной версией Альфа-инвестиции.

После того, как клиент первый раз зарегистрировался и вошёл в онлайн версию. С тех пор у него ни разу не запрашивал пароль для входа, автоматически осуществляется вход.

Проблема с кросс-авторизацией в веб-терминале, процесс работает не совсем корректно, что аффектит на пользователей в новом клике

Воспроизводится это следующим образом
 Клиент из МТ кросс-авторизуется в ВТ c client_id  = adirect-app, после чего клиент с этим токеном спокойно заходит в Новый Клик. 

Данная тема уязвимости решается через целевую авторизацию для веб-терминала: для этого нужна инфраструктура с Cerberus, вторым фактором и новым client_id для веб терминала.",,4.0,Личный кабинет
ADIRINC-969,3082457,U_M2829,NEW,30.03.2023 12:36,,,,,Дефект промсреды,,2023-06-28 00:00:00.0,"Запрос в монгу возвращает null,  из-за этого сервис спамит ошибками
Streaming aggregation: [\{ ""$match"" : { ""markets.code"" : ""NRD_PLCM_RUB"", ""date"" : { ""$gte"" : { ""$date"" : ""2023-03-29T21:00:00Z""}}}}, \{ ""$unwind"" : ""$markets""}, \{ ""$match"" : { ""markets.code"" : ""NRD_PLCM_RUB"", ""date"" : { ""$gte"" : { ""$date"" : ""2023-03-29T21:00:00Z""}}}}, \{ ""$limit"" : 2}] in collection businessDayScheduleMarkets 


Корневая причина ошибки из-за бага на фронте в функциональности размещений.",,,Мобильный терминал
ADIRINC-968,3080746,U_M173X,Отклонен,30.03.2023 09:16,,,,,Дефект промсреды,08.07.2024 17:13,2024-08-19 00:00:00.0,"Пример:
Клиент выставляет стоп заявку c стоп ценой 2.64, заявка исполняется и цена исполнения заявки равна 2.99, при этом такой цены не было на бирже, а цена сделки равна 2.705 

select BrokerComment, price, StopPrice, * from [ADFrontOrders].[Logs].[Orders] where NumEDocument = 40751732684 select * from hell.dbo.a_trades where treaty = 76580 and a_date > '2023-03-05 21:22:45.000' and num_edocument = 40751732684

 

!image-2023-03-30-09-15-53-890.png!",,,Core
ADIRINC-967,3079465,U_M1DKL,Принят к исправлению,29.03.2023 17:59,,,,,Дефект промсреды,,2023-06-13 00:00:00.0,"Клиент AVTB7C 13.03.2023 4-е раза получил ошибку отправки Push о достижении цены (ошибка из-за удаленного приложения с устройства), после чего его устройство заблокировалось на получение Push уведомлений для альфа-инвестиций(корректные настройки работы Push).
После повторной установки приложения у клиента должен сбрасываться признак того что пуши заблокированы, но из-за того, что не происходит вызов сервиса при устаноки приложения на UWS на разблокировку связки устройства со шлюзом у клиента сохраняется блокировка и пуши не формируются.
ПС: скриншот 2 с параметром пушей отображается N тк было исправлено вручную ",,,Matterhorn
ADIRINC-966,3072359,U_M0WVN,Закрыт,28.03.2023 11:47,,,,,Дефект промсреды,02.09.2024 10:51,2023-05-12 00:00:00.0,"# Клиент выводит дс с брокерского счета по реквизитам в другой банк.
 # Подставляет счет 3-го лица для вывода в АБ

*Фактически:*

Успешно пытается вывести дс на счет 3-го лица в Альфа-Банк по реквизитам, из-за чего генерятся проблемы с возвратом излишне уплаченного налога/удаления проводок

!image-2023-03-28-11-43-05-544.png!

ГС 6823134

427,96 7728168971 30601810000036823134 АО ""Альфа-Банк"" //Россия, 107078, г.Москва, ул. Каланчевская, д. 27// 44525593 АО ""Альфа-Банк"" 40817810505611225737 АО ""АЛЬФА-БАНК"" 44525593 30101810200000000593 026616557610 Нагаева Алиса Илдаровна Возврат средств по дог. N 6823134 от 19.02.2023. Нагаева Алиса Илдаровна. Без НДС по дог. N 6823134 от 19.02.2023. Нагаева Алиса Илдаровна. OP1ED233E001WASE ЭПД отменен: ОТЗЫВ ДЕНЕЖНЫХ СРЕДСТВ НА СЧЕТА 3-Х ЛИЦ ЗАПРЕЩЕН

Возможно необходимо ограничить возможность вывода по реквизитам в МТ\ЛК\ВТ на счета Альфа-Банка, т.к проверки владельца счета в банке по такому флоу не происходит

Пример ручных манипуляций с удалением проводок по данному кейсу:

!image-2023-03-28-11-48-36-609.png!",,,Личный кабинет
ADIRINC-965,3072340,U_M1CUE,Закрыт,28.03.2023 11:31,,,,,Дефект промсреды,21.06.2023 11:54,2023-06-01 00:00:00.0,"Клиент 3108001 Куликов Александр Васильевич AKED34 в МТ нажимет Еще - Личный кабинет - Тарифы у него долгое время отображается Инвестор: Подключено; Трейдер: Скоро подключим. В то время когда тариф у него уже давно изменился и стоит Трейдер",,6.0,Мобильный терминал
ADIRINC-964,3071227,U_M0Z22,Закрыт,28.03.2023 10:18,,,,,Дефект промсреды,17.01.2024 12:13,2023-05-12 00:00:00.0,"После рестарта сервера логирования, могут наблюдаться зависания подов сервисов в кубере.
 # Необходимы доработки сервисов в плане возможности бесперебойной работы в момент, когда откинуть логи нет возможности. *(Часть сервисная)*
 # Необходимо уходить со старой железки под логирование. т.к ее рестарт аффектит на критичные функциональности, например ввод\вывод дс или другие. *(Часть админская)*

*!image-2023-03-28-10-17-05-590.png!*

+*Допинфо по кейчу от 26.03-27.03:*+

например не было логов с 23.58 26.03 по adir-fin-instrument-forecast примерно [http://adirelkprod.alfadirect.ru/goto/7caf25148dfcf65c3c54c8d0928b36f8] 

В кубер, там с этого времени много в терминейтинг подов повисло. При попытке логи посмотреть ошибка ""kubectl logs -n adir-fin-instrument-forecast-prod adir-fin-instrument-forecast-6bf9c659c8-9bhtr
Error from server: Get ""[https://172.21.74.21:10250/containerLogs/adir-fin-instrument-forecast-prod/adir-fin-instrument-forecast-6bf9c659c8-9bhtr/adir-fin-instrument-forecast]"": dial tcp 172.21.74.21:10250: connect: no route to host""

Попытки ребутнуть под тот, что в терминейтинг у этого сервиса , не приводят к результату, завис. Запросы с  мезос-кластера Директа уходят я так понимаю через балансировщик дёргая , например такие ручки получая 500-ю ошибку  [http://172.21.1.97:80/api/forecast/consolidated/RU0009029540|http://172.21.1.97/api/forecast/consolidated/RU0009029540]",,,Core
ADIRINC-963,3070391,U_M1AYE,Отклонен,27.03.2023 18:30,,,,,Дефект промсреды,13.04.2023 14:04,2023-05-12 00:00:00.0,"При запросе смс для подписания ЭП возникает ошибка {color:#FF0000}SmsRequetPhoneUnknown_RS1AS101017{color}

{color:#172b4d}Номер телефона везде есть и один и тот же:{color}

{color:#172b4d}ПФ1, ДИК, В альфа-Админе, в SIM имси действителен{color}",,8.0,Мобильный терминал
ADIRINC-962,3065148,U_M1DLC,NEW,24.03.2023 18:34,,,,,Дефект промсреды,,2024-08-27 00:00:00.0,"У позиций, которыз различается номинал в ADFront.bs.Objects и hell.dbo.actives при первой загрузке портфеля меняется баланс.
При первой загрузке инфу тянет мидловая апи portfolio-analitics, которая дергает adir-position-keeping, а после баланс транслирует либа Белова.
adir-position-keeping берет номинал и хелла, а либа Белова из adfront, где номинал актуален. 
Пример бумаги RU000A0JY023
 
все такие активы
select a.nominal, ob.nominal,* from hell.dbo.actives a
join adfront.dbo.objects ob
on ob.isin = a.isin
where a.nominal != ob.nominal and a.nominal >= 2 and ob.nominal >=2",,185.0,Ядро
ADIRINC-961,3065365,U_M1CUE,Закрыт,24.03.2023 18:24,,,,,Дефект промсреды,31.01.2024 12:35,2023-05-31 00:00:00.0,"Клиент заходит в АМ, переходит в раздел, все мои продукты и нажимает на инвесткопилку.
ОР: Видит корректный баланс
ФР: Отображаются копейки на счету без учета активов БПИФ
Допинфо:
Клиент - 6666128 Сергеева Илона Юрьевна AEPT1E
Логи АМ-эко и МТРА

Вероятно некорректно тянется информаия с датакэша МТРОЙ

В БД в тройке и четверке данные по портфелю корректны.
Последняя операция пополнения была 17-го февраля",,64.0,Core
ADIRINC-960,3056342,U_M1CUE,Отклонен,23.03.2023 17:20,,,,,Дефект промсреды,27.03.2023 18:34,2023-05-29 00:00:00.0,"1665452 AJQ1TM Клиент пытается создать ЭЦП, но прежде чем подписать по ПУШу, возникает ошибка ""Не удалось запросить СМС (RS1AS101017)""",,,Мобильный терминал
ADIRINC-959,3054880,U_M1B1C,Отклонен,23.03.2023 14:10,,,,,Дефект промсреды,28.02.2024 13:50,2023-05-29 00:00:00.0,"Описание: У клиента ARQGQE не отображаются идеи от гуру в разделе Поддержка, тариф инвестор. Клиент в чате
[https://rc.alfa-bank.net/channel/a-inv-mt/thread/F5YHd6rYKa8d2rcfr]",,22.0,Мобильный терминал
ADIRINC-958,3052023,U_M0WVN,Закрыт,22.03.2023 18:46,,,,,Дефект промсреды,03.07.2024 11:26,2023-05-05 00:00:00.0,"1. Клиент на главном экране видит ИИР
!image-2023-03-22-18-20-43-768.png!
2. Проваливается в него
Фактически:
 # Внутри пусто и отсутствуют инструменты
 # !image-2023-03-22-18-19-34-968.png!
Допинфо:
 * 
 статус {
\\\\\\\\\\\\\\\""status\\\\\\\\\\\\\\\"": *\\\\\\\\\\\\\\\""REBALANCE_ME*\\\\\\\\\\\\\\\"",
\\\\\\\\\\\\\\\""entryAmount\\\\\\\\\\\\\\\"": 200000,
\\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\""
}
 
recommendations
*\\\\\\\\\\\\\\\""buy\\\\\\\\\\\\\\\"": [],*
*\\\\\\\\\\\\\\\""sell\\\\\\\\\\\\\\\"": []*
*}*
2161237 ГС
По информации от коллег [https://rc.alfa-bank.net/channel/adir_autoadvisor?msg=TQfxTRfadmoPakb7e] пустой ответ recommendations сервиса portfolio-rebalance  . Система не может выдать подходящие рекомендации для приведения клиентского портфеля в соответствие с модельным из-за наличия счета в юанях.",,5.0,Мобильный терминал
ADIRINC-957,3049925,U_M1XSA,Повторный,22.03.2023 13:45,ОТЭИСФЛ,,,,Дефект промсреды,,2024-10-01 00:00:00.0,"* Клиент регистрируется на ФОРТС, но счет так и не регистрируется, в ЛК статус ФОРТС ""регистрация""
 задача в Адиртех https://jira.moscow.alfaintra.net/browse/ADIRTECH-4208
 Пример ГС 937759",,97.0,Уран
ADIRINC-956,3047231,U_M1AYE,Отклонен,21.03.2023 18:26,,,,,Дефект промсреды,05.05.2023 14:37,2023-05-04 00:00:00.0,"Из раздела «Ещё» -> «Отчётность» -> «Отчёты» не грузится брокерский отчет

Ошибку загрузки выдаёт вьюха, а не приложение МТ. В логах не отслеживается

воспроизводится на версиях 2.21 и 2.22 

 https://rc.alfa-bank.net/channel/adir-lk-pub?msg=6Le26g2EhREdeKoRa",,15.0,Личный кабинет
ADIRINC-955,3041889,U_M1MST,Закрыт,20.03.2023 17:33,,,,,Дефект промсреды,22.02.2024 14:23,2023-07-06 00:00:00.0,"На главном экране переходя в виджет \\\\\\\\\\\\\\\""прогнозы по иностранным акциям\\\\\\\\\\\\\\\"" отображаются русские акции.
Проблема из-за того что иностранные акции не торгуются в АИ, поэтому в том году заменили подборку на российские.
На Андроиде изменили название виджета, а на iOS нет, т.к. не имеем возможности обновить приложение",,2.0,Мобильный терминал
ADIRINC-954,3030506,U_M1CE2,К закрытию,16.03.2023 17:24,,,,,Дефект промсреды,,2023-04-27 00:00:00.0,"После сплита инструмента график до сплита, остаётся по старым данным цен.
 !image-2023-03-16-17-26-04-183.png!
На мосбирже корректный график с учетом сплита
!image-2023-03-16-17-33-31-439.png!
 Проблема есть и у других инструментов, у которого было корп. действие сплит",,17.0,Мобильный терминал
ADIRINC-953,3030692,U_M1AYE,Закрыт,16.03.2023 17:09,,,,,Дефект промсреды,13.04.2023 15:37,2023-04-27 00:00:00.0,"Например, в МТ в рынках невозможно найти фьючи, у которых дата экспирации стоит сегодняшняя, но на бирже торги ещё ведутся
Пример Si-3.23, дата экспирации 16.03, но в МТ его уже нет
https://rc.alfa-bank.net/channel/a-inv-mt?msg=HC56ASxXPAp98GJL6",,1.0,Core
ADIRINC-952,3029736,U_M00ZM,Закрыт,16.03.2023 14:06,,,,,Дефект промсреды,12.01.2024 12:36,2023-04-27 00:00:00.0,"# Клиент выставил заявку из Мобайл (помечается как ""с голоса"")
 # Зашел в АИ , чтобы отменить ее. 
 *Фактически:*
 1. Клиент нажал отменить в АИ.
 2. В логах сопровождение видит статус ""Помечен для удаления"" и не предпринимает никаких действий при обращении клиента. 
 3. Заявка исполняется на следующий день, если ее не отменил сотрудник как заявку выставленную ""с голоса""
  
 *Допинфо:*
 Клиент  5742613 выставил заявки на покупку через приложение Альфа-Банка:
 1) рыночная заявка на покупку 19 шт Управляемые Российские Акции Альфа-Капитал RU000A102E78
 2) рыночная заявка на покупку 1276 шт Управляемые Облигации Альфа-Капитал RU000A101PN3
 Логи:
 1) [https://alfaadmin/reporting/orders/5742613-000/40715413984/1]
 2) [https://alfaadmin/reporting/orders/5742613-000/40715409184/1]
 *06.03.2023 заявки исполнились на открытии рынка несмотря на то, что помечены для удаления.*
 Необходимо либо сделать так, чтобы при нажатии на Отмену заявки статус не менялся и выводилось сообщение на фронт о том, чтобы он обратился с голоса и попросил отмены.
 Либо дать ему возможность отменить ее в АИ самостоятельно.",,95.0,Core
ADIRINC-951,3023475,U_M1BFA,Закрыт,15.03.2023 10:45,,,,,Дефект промсреды,17.03.2023 17:20,2023-05-19 00:00:00.0,"Если открыть торговлю по товарному рынку, то итоговая сумма не будет рассчитываться правильно, вместо этого просто переносятся pt в итог.

Предусловие:

У пользователя выпущен сертификат

Шаги:

1) Перейти в виджет торговля

2) Открыть инструмент SILV -12.23

ФР:
 *!image-2023-03-15-10-58-53-962.png!*  

Итог переносится из цены. А т.к. цена в pt, то сумма 23,42.
 ОР:
!image-2023-03-15-10-59-12-167.png!

Сумма пересчитывается корректно. В итоге 17486",,,АИ ПРО
ADIRINC-950,3018872,U_M12WM,Закрыт,14.03.2023 09:43,,,,,Дефект промсреды,16.03.2023 15:28,2023-04-25 00:00:00.0,"После релиза сервиса торговых сервисов была регрессия в шлюзе, перестал посылаться статус торгов по инструменту на ЛС",,,Core
ADIRINC-949,3015044,U_M00ZM,Закрыт,13.03.2023 11:39,,,,,Дефект промсреды,16.03.2023 15:33,2023-04-24 00:00:00.0,"У клиента Кассовые агрегаты позиций вышли за пределы longint и равны 2 152 580 008,28, а для вывода у него считается -2 147 483 648,00

[https://rc.alfa-bank.net/channel/support-adir-trading-services?msg=toNBfPYh3fLu7LqZg]

https://alfaadmin/reporting/orderlimitlog/1709267162",,,Core
ADIRINC-948,3012756,U_M16SR,Закрыт,10.03.2023 17:16,,,,,Дефект промсреды,16.03.2023 15:39,2023-04-21 00:00:00.0,На версии 2.21.1 у некоторых клиентов нет вкладки «График». Предположительно причина в ФТ graph_tab_enabled,,,Мобильный терминал
ADIRINC-947,3012744,U_M1N2N,Закрыт,10.03.2023 16:55,,,,,Дефект промсреды,19.02.2024 14:32,2023-05-16 00:00:00.0,"О.Р: У клиента отображается вывод средств в истории

Ф.Р: У клиента не отображается вывод средст в истории

В приложении мобайла отображение есть.
 !snimok_ekrana.png!!snimok_ekrana2.png!",,9.0,Core
ADIRINC-946,3007806,U_M1AYE,Закрыт,09.03.2023 14:26,,,,,Дефект промсреды,16.06.2023 10:18,2023-06-06 00:00:00.0,"Из-за падения очереди не работает трансляция из БД hell в hell_cache
 Пример проблемы из-за отсутствия трансляции
Клиент открыл БС с типом «Инвесткопилка» 08.03 в 15:25 и ему был отправлен пуш об успешном открытии, но счёт не отображался в Альфа-мобайле. По логам альфа мобайла видно, что на запрос Ген.соглашений клиента ГС копилки не возвращается
В мобайл информация по копилке не приходила, тк информация по счетам в Директе тянется через универсальную шину сервисом adir/account/info/v10/rest/\\\\\\\\\\\\\\\\{pin}, дальше запрос идёт в
 Сервис adir-production-dotnet-client-account-info, он забирают информацию по ГС из hell_cache.hell.accounts
Со стороны клиента: 
Клиент заходит в приложение Альфа-Мобайл. Переходит в раздел все мои продукты и пытается открыть Инвесткопилку. Получает ошибку \\\\\\\\\\\\\\\""Обратитесь в службу поддержки Альфа-Инвестиции по телефону +7(495)786-48-86\\\\\\\\\\\\\\\""
В логах core ошибка, будто клиент пытается открыть еще одну инвесткопилку. Ошибка возникает примерно в 15:50, в то время, когда инвесткопилка была открыта уже в 11:11. 
Стандартный процесс, когда клиент пытается создать еще одну ИК: нажимает открыть ИК - возникает окно, мол, у вас уже есть ИК и предлагает перейти к ней.",,25.0,Core
ADIRINC-945,3004271,U_M1AYE,Закрыт,07.03.2023 14:53,,,,,Дефект промсреды,19.07.2023 13:19,2023-05-12 00:00:00.0,"При свайпах портфелей портфели не меняются, отображается первый загруженный портфель",,27.0,Мобильный терминал
ADIRINC-944,2998074,U_M1BW4,Закрыт,06.03.2023 11:52,,,,,Дефект промсреды,12.05.2023 12:42,2023-06-23 00:00:00.0,"Клиент покупает новую бумагу - бумага изменяется в цене - доходность за сегодня в рублях меняется, но доходность в процентах равна 0.
Замечал такой баг только  впервый день, когда бумага была куплена. В остальные дни бумага корректно рассчитывает и рубли, и процент доходности за сегодня",,2.0,Мобильный терминал
ADIRINC-943,2994937,U_M0WVN,Закрыт,03.03.2023 18:48,,,,,Дефект промсреды,28.04.2023 15:55,2023-06-15 00:00:00.0,После обновления клиентов  на новую версию приложения из стора на  2.2.21  отсутствует вкладка График,,6.0,Мобильный терминал
ADIRINC-942,2991824,U_M00ZM,Закрыт,03.03.2023 10:58,,,,,Дефект промсреды,28.04.2023 12:45,2023-05-31 00:00:00.0,"02.03 после рестарта кафки, BOAGENT перестал из нее вычитывать данные.

Это повлияло на трансляцию информации из posttrade в adfront, из-за чего у клиентов некорректно отображались срочные требования и данные по маржинальным позициям

Обсуждение 

https://rc.alfa-bank.net/channel/support-adir-trading-services?msg=HcwdRigkBqpAGzNtd",,,Core
ADIRINC-941,2980808,U_M1CUE,Закрыт,28.02.2023 13:59,,,,,Дефект промсреды,16.04.2024 10:31,2023-04-12 00:00:00.0,"Клиент 6746529 L30058 при попытке пройти тестировани получает ошибку ""при выполнении запроса произошла ошибка"", в логах ""Не удалось найти клиента с логином vsvilenko"".
У клиента не был прописан логин в hell.dbo.clients, но в hell.dbo.managers он был",,,Личный кабинет
ADIRINC-940,2980763,U_M18H1,Закрыт,28.02.2023 13:14,,,,,Дефект промсреды,27.02.2024 16:19,2023-06-19 00:00:00.0,"Клиент пытается открыть БС через Альфа-Инвестиции. Но у него отключены каналы УКД

Вместо корректной ошибки для понимания что необходимо клиенту, он получает ошибку «Нужен второй заход»

В логах директа ошибка «Отсутствует информация о каналах»

*+Согласно Брокерскому регламенту, пункт 20.8 ([https://alfabank.servicecdn.ru/site-upload/a6/bd/2014/broker_reglament_110822.pdf])+*
 # Клиент использует Пароль для входа в СЭД в качестве своего ключа ПЭП. Осуществляя первый вход в одну из СЭД с использованием Логина и Пароля, или принимая Логин к использованию путем указания соответствующего признака рядом с Логином, который однозначно подтверждает принятие Клиентом этого Логина, Клиент подтверждает свое согласие использовать данный Логин для указания на лицо, от имени которого был создан и (или) отправлен электронный документ, а Пароль в качестве ключа ПЭП. Правила применения ключей ПЭП определяются настоящим Регламентом.

*+Идентификатор (Логин)+* - присвоенный Клиентам участникам электронного взаимодействия набор символов, хранящийся в перечне присвоенных идентификаторов в соответствующей корпоративной информационной системе Банка. Распространяется также на Клиентов, которые для входа в СЭД используют (вводят) номер банковской карты или банковского счета в соответствии с ДКБО, и введенному номеру найден соответствующий Логин Клиента, содержащийся в базе данных Банка.",,,Мобильный терминал
ADIRINC-939,2978013,,NEW,27.02.2023 19:02,,,,,Дефект промсреды,,2023-05-03 00:00:00.0,"При подсчете общего баланса по портфелю показывает сумму меньше, чем если бы складывали все позиции по отдельности. 
Проблема возникает из-за пересчета в рубли активов в валютах, которых больше нет в Директе. Например, GBP
В итоговой сумме эта позиция считается нулевой, тк по валюте тянется курс 0
На примере у клиента портфель при первом запуске считается Position Keeping-ом, который тянет курс 84,88 по GBP, а потом баланс начинает транслироваться Либой, который транслирует курс 0, из-за чего баланс уменьшается",,13.0,Core
ADIRINC-938,2976412,U_M1CWM,Отклонен,27.02.2023 14:33,,,,,Дефект промсреды,05.05.2023 16:31,2023-04-11 00:00:00.0,"У клиента при подключение к вэб версии терминала выходит ошибка подключения.
Сервер прервал соединение",,,АИ ПРО
ADIRINC-937,2975881,U_M0C88,На исправление,27.02.2023 12:43,,,,,Дефект промсреды,,2023-04-11 00:00:00.0,"Пример: Клиент AVFCG0 6767913 пытается отменить заявку 40453263284. Заявка помечается для даления, но не удаляется.",,,Core
ADIRINC-936,2972324,U_M1AYE,Закрыт,22.02.2023 16:53,,,,,Дефект промсреды,16.10.2023 09:25,2023-04-10 00:00:00.0,"ЛС получает из бд некорректное значение Currate(курс) по валютным облигам торгующимся в рублях, из за этого в PriceRur цена не умноженная на курс валюты номинала. Соответственно уходящую позицию в рублях тоже нужно умножить на курс
 
Из-за этого клиентам, показывает, что они могут купить облиг на сумму, которой у них по факту нет
Обсуждение тут https://rc.alfa-bank.net/channel/support-adir-trading-services?msg=jFFvtKeXMcg8C27GB",,4.0,Core
ADIRINC-935,2972265,U_M00ZM,Отклонен,22.02.2023 15:06,,,,,Дефект промсреды,27.02.2023 18:27,2023-04-10 00:00:00.0,"После рестарта серверов шлюзы не запускаются в автоматическом режиме

Из-за того, что шлюзы не работали, не транслировалась информация по НКД

Обсуждение https://rc.alfa-bank.net/channel/adir-avarii?msg=NSTPGFivnccissXZQ",,,Core
ADIRINC-934,2971552,U_M1D7N,Отклонен,22.02.2023 12:37,,,,,Дефект промсреды,19.02.2024 16:41,2023-04-28 00:00:00.0,"ОР: При загрузке приложения клиент видит цены и изменения по своим позициям.
ФР: При загрузке приложения клиент видит цены и изменения по своим позиция, но через несколько секунд происходит подгрузка других данных и портфель меняется, а также меняются цены по инструментам. 
!16769903977663359544661344845644_(1).jpg|width=339,height=753!!16769904063195354040686093672463_(1).jpg|width=339,height=752!",,9.0,Core
ADIRINC-933,2970419,U_M1CUE,Закрыт,22.02.2023 10:19,,,,,Дефект промсреды,21.06.2023 11:59,2023-07-18 00:00:00.0,"Пример:
У клиента 4363423 Драгун Павел Викторович AVT4DS в разделе портфель появилось уведомление\\\\\\\\\\\\\\\""Изменить состав портфеля\\\\\\\\\\\\\\\""
При нажатии на кнопку Изменить возникает ошибка \\\\\\\\\\\\\\\""Кое-что сломалось\\\\\\\\\\\\\\\""
В логах ошибка \\\\\\\\\\\\\\\""Не удалось вычислить marketboardName. ISIN: US42207L1061\\\\\\\\\\\\\\\""
Вероятно ошибка возникает из-за того что в портфеле есть неторгуемые бумаги.
Подобная ошибка возникает у AVXAIH 5789275, у него так же присутствуют три актива  (YNDX,TCSHad,HHGPad), которые невозможно продать.
Такая же ошибка возникала и у других клиентов, но логи уже не сохранились, но у всех так же есть бумаги на неторговом разделе ",,7.0,Мобильный терминал
ADIRINC-932,2968567,U_M1FPP,Закрыт,21.02.2023 15:32,,,,,Дефект промсреды,19.02.2024 16:36,2023-04-07 00:00:00.0,"ОР: Заходя в портфель клиент видит НКД по облигациям в Юанях
ФР: НКД по облигациям в Юанях равен 0
!B262B66A_5719_460C_97EE_975B30625986.jpg|width=226,height=470!
Происходит по инструментам:
RU000A105NH1
RU000A105SA5
RU000A105U75
RU000A105M75
RU000A105NL3
RU000A1057S2",,6.0,Core
ADIRINC-931,2968012,U_M00ZM,Отклонен,21.02.2023 14:30,,,,,Дефект промсреды,03.07.2023 11:13,2023-04-07 00:00:00.0,"У некоторых пользователей наблюдаются проблемы отправления СМС при создании ЭЦП в МТ. Появляется ошибка ""Не удалось запросить СМС (RS1AS101017)"".",,,Core
ADIRINC-930,2967730,U_M1FPP,Отклонен,21.02.2023 12:48,,,,,Дефект промсреды,22.02.2024 14:26,2023-04-27 00:00:00.0,"У клиента в разделе позиция учетная цена в сто раз меньше действительной. Если смотреть в портфеле, то вероятно будет отображаться 0,00 уц, тк есть дефект фронта, когда отображаются только два знака после запятой, а уц = 0,0019.... из-за чего кажется что уц равна 0. Проблема чаще воспроизводится на таких валютах как Казахстанский тенге (KZT) и Армянский драм (AMD)",,3.0,Core
ADIRINC-929,2960824,U_M1DQU,Закрыт,20.02.2023 10:13,,,,,Дефект промсреды,14.03.2023 13:11,2023-06-13 00:00:00.0,"Пример: Клиент AQJ73N 212667 выставил заявку 50 акций на продажу и наблюдает за ней в стакане. Через время часть заявки исполнено и отображается что по данной цене продается в стакане всего 30 акций, в то время, когда чуть левее по этой цене указано что у клиента выставлено 50 шт.",,,Мобильный терминал
ADIRINC-928,2954134,U_M1AYE,Отклонен,16.02.2023 19:07,,,,,Дефект промсреды,13.06.2023 10:26,2023-04-05 00:00:00.0,"У клиента исполнилась заявка на продажу 50к бумаг, но по факту она исполнилась частично на 1000 бумаг

 

https://rc.alfa-bank.net/channel/support-adir-trading-services?msg=G5TJF9JYdp9FyzWzD",,,Core
ADIRINC-927,2952046,U_023HG,Отклонен,16.02.2023 14:26,,,,,Дефект промсреды,17.05.2023 11:39,2023-04-04 00:00:00.0,"16.02 с 12:15 до 13:53 не открывались брокерские счета.

Анализ показал, что сервис alfabankapi неожиданно остановился и не включался. Решилась проблема отключением процесса и затем перезапуском сервиса.

 ",,,Core
ADIRINC-926,2950808,U_M1AYE,Закрыт,16.02.2023 11:58,,,,,Дефект промсреды,17.05.2023 15:04,2023-04-24 00:00:00.0,"Авторизация в Альфа Инвестиции происходит только после 4-5 вводов пин-кода.

Клиент на протяжении 2 дней жалуется, что ""Открывается только после 4-5 вводов пин-кода"". Базовые рекомендации не помогли, находится в России. Перезагружал телефон, заходил по логину и паролю заново. VPN - нет.
 Устройство - самсунг. Логи и скриншот во вложении.

 

UPD. Таких клиентов уже несколько.

Есть информация от [~U_M16EL], что в версии 2.21 МТ эта проблема будет исправлена.",,,Мобильный терминал
ADIRINC-925,2948996,U_M1N2N,Закрыт,15.02.2023 18:20,,,,,Дефект промсреды,13.04.2023 13:42,2023-04-04 00:00:00.0,"ОР: При прогрузке портфеля - стоимость инструментов указывается в соответствии с ликвидным рынком.

ФР: При прогрузке портфеля клиент сначала видит стоимость позиции по облигациям сначала в рублях, а через несколько секунд в валюте. 

 

!snimok_ekrana.png!!snimok_ekrana2.png!

Проблема возникает с некоторыми облигациями, у которых валюта номинала - не рубль.

Первоначально данные облигации торговались в валюте, но позже стали торговаться в рублях. 

В основном по данным облигациям ликвидный рынок стоит MOEX_RUB и, соответственно отображение должно быть в рублях, а не в долларах. 

 ",,2.0,Core
ADIRINC-924,2948758,U_M1E0U,Закрыт,15.02.2023 17:36,,,,,Дефект промсреды,06.04.2023 15:53,2023-05-02 00:00:00.0,"Добрый день!

У клиента ADMF7T отсутствует информация о подарочной акции в коллекции gifts.giftsPortfolio. При этом в gifts.participantsBonusCampaigns данные присутствуют, что акция есть у пользователя и она не просрочена. В коллекции gifts.giftsSales также присутствуют записи о неудачных попытках продажи подарочной акции.",,4.0,Мобильный терминал
ADIRINC-923,2948269,U_M1CE2,Закрыт,15.02.2023 16:16,,,,,Дефект промсреды,28.09.2023 13:10,2023-04-21 00:00:00.0,"Воспроизводится и на iOS и на Андроид платформах в АИ и ГИ
При получении ИИР клиент переходит в поле Заявка, где автоматически должна заполняться цена и объем, но по юаню этого не происходит, клиенту транслируется только объем, который он может взять в плечо, а не конкретная рекомендация ПБ
Результат: При любом кол-ве лотов отображается 0% от портфеля
Ожидаемый результат: Стоимость рассчитывается корректно от ликвидной стоимости портфеля",,1.0,Мобильный терминал
ADIRINC-922,2946523,U_M197Z,NEW,15.02.2023 12:02,,,,,Дефект промсреды,,2024-09-16 00:00:00.0,"У некоторых клиентов не работает звуковое оповещение пушей, в основном о достижении цены и продажи активов. Ве базовые рекомендации были выполнены и в настройках все стоит корректно для работы звука.
Как происходит: клиенту приходит определенный пуш от альфа-инвестиций, клиент пуш не слышит, только визуально наблюдает на экране. 
По остальным приложениям такие же настройки и звуковое сопровождение пушей работает.
Пример клиента: 4313211 AVTCK4
Алексей Ломовский порекомендовал разработчикам АИ уточнить больше информации у http://alfa/profile/Pages/view.aspx#/info?accountname=REGIONS\\\\\\\\\\\\\\\\U_0246Q",,7.0,Мобильный терминал
ADIRINC-921,2944985,U_M16SR,Отклонен,14.02.2023 17:45,,,,,Дефект промсреды,22.02.2024 14:41,2023-05-17 00:00:00.0,"Пример:
Клиент 4460813 AVVCOY провалившись в бумагу заходит в раздел график и позиция и наблюдает сильное различие учетной цены ",,11.0,Мобильный терминал
ADIRINC-920,2944941,U_M1SK9,Отклонен,14.02.2023 17:14,,,,,Дефект промсреды,18.03.2024 10:47,2023-04-20 00:00:00.0,"Пример:
 Клиент 2399830 AQI2E3 обращается с проблемой, что не отображается погашение в истории.
 У клиента было погашение облигаций RU000A101DU4 Вита Лайн БО-01 3 февраля на сумму 22 тыс. рублей
 В истории погашение не отображается



Пример 2:
 Клиент AEL662 4405176 в истории не отображается погашение облигаций RU000A101D13 от 30.01

Проблема возникает из-за отсутствия income_type в hell.extra_transfers

[https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=7a5qgZX4bHxh2DMt7] [
https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=TYuRXPNTLE5J3e5pB
]http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=858114865",,49.0,Core
ADIRINC-919,2941820,U_M1EFY,Закрыт,14.02.2023 10:03,,,,,Дефект промсреды,18.05.2023 16:15,2023-03-31 00:00:00.0,"Иногда core сервисы начинают выедать много коннектов, что приводит к увеличению потребляемого CPU и деградации других сервисов. 

Пример: Candles-api. 11.02.23 с 2:45 сервис начал выедать коннекты и не закрывать их, что привело к увеличению CPU. После рестарта сервиса кол-во коннектов пришло в норму.
 !image-2023-02-14-10-04-31-367.png!

!image-2023-02-14-10-04-16-222.png!

Пример 2: Сервис Validata-api. 13.02.23 c 5:15 сервис так же начал выедать коннекты и после рестарта сервиса они пришли в норму.  
 !image-2023-02-14-10-07-09-068.png!

!image-2023-02-14-10-07-19-585.png!

 ",,,Core
ADIRINC-918,2939557,U_M214D,Закрыт,13.02.2023 15:06,,,,,Дефект промсреды,31.07.2024 12:13,2023-04-19 00:00:00.0,"ОР: клиент переходит в рынки - индексы - свайпает индекс влево чтобы добавить в избранное - появляется у значка индекса флажочек - переходит в избранное - там наблюдает индекс
ФР: клиент переходит в рынки - индексы - свайпает индекс влево чтобы добавить в избранное - появляется у значка индекса флажочек - переходит в избранное - там отсутствует индекс - переходит обратно в индексы - влажочка нет",,65.0,Core
ADIRINC-917,2938160,U_M0WVN,Закрыт,13.02.2023 12:03,,,,,Дефект промсреды,22.09.2023 13:30,2023-04-19 00:00:00.0,"Клиент заходит в МТ
ОР: Вход проходит успешно
ФР: При входе выскакивает ошибка A2AS90005 или A2AI1L467, со второй попытки вход клиент входит успешно

!image-2023-02-13-12-03-01-178.png!",,10.0,Core
ADIRINC-916,2932136,U_M1MST,Отклонен,09.02.2023 18:53,,,,,Дефект промсреды,14.02.2023 11:19,2023-04-18 00:00:00.0,"Поступают обращения от клиентов о том, что исчезают записи из избранного.

Пропадают активы, которых нет в портфеле у клиента",,,Мобильный терминал
ADIRINC-915,2931870,U_M0WVN,Отклонен,09.02.2023 18:50,,,,,Дефект промсреды,10.01.2024 18:23,2023-03-29 00:00:00.0,"Клиент APKM1T  ГС 1860970  выставил заявку, ждет пуш уведомления об исполнении

!image-2023-02-09-18-49-36-208.png!

*Фактически:*

Пуш не доставлен.

*Допинфо:*

Пуш не пришел на смс шлюз MFM:

!image-2023-02-09-18-44-26-649.png!

Тут видно , что  с++ сервис pushnf не смог отправить сообщение на шлюз, тк статус IdState = *2*


select top(200)
h.IdNotification, l.IdLogin, h.IdDevice, h.Token, m.MessageTitle, m.MessageText, m.DtInsert, m.Payload, h.IdState, h.IdLogin, h.IdDevice, m.ComputerName, h.NotificationDate
from
[AD2010Web].[dbo].[NotificationHistory] h with(nolock)
inner join [AD2010Web].[dbo].[NotificationMessages] m with(nolock)
on h.UUID = m.UUID
inner join ADFront.dbo.Logins l with(nolock)
on (l.IdLogin = h.IdLogin)
where 1=1
and h.IdLogin = *102176139*
and iddevice = '*02ab5473-519c-3e3e-9635-82490b08a5b5*'
order by NotificationDate desc, h.IdDevice

!image-2023-02-09-18-46-48-939.png!

 ",,,Core
ADIRINC-914,2928795,U_M177U,Закрыт,09.02.2023 10:23,,,,,Дефект промсреды,13.02.2023 14:42,2023-04-17 00:00:00.0,"Пример: Клиент 4264483 Вознесенский Антон Юрьевич APRXV9

ОР: При пополнении счета по СБП в МТ выбирает банк, успешно совершает перевод.

 ФР: При пополнении счета по СБП в МТ при выборе банка всплывает ""Кое-что сломалось На нашей стороне, но мы уже чиним""

В логах ошибка 
response body=\{ ""errorId"" : ""cbfa8a8cfaef43aa"", ""application"" : ""phone-transfer-api"", ""errorCode"" : ""DESTINATION_ACCOUNT_NOT_AVAILABLE"", ""messages"" : { ""ru"" : ""Счёт не доступен для зачисления"" } }",,,Мобильный терминал
ADIRINC-913,2926384,U_M1DKF,Отклонен,08.02.2023 14:44,,,,,Дефект промсреды,08.02.2023 14:44,2023-03-27 00:00:00.0,При стандартном ответе от шины «PL00046 У клиента отсутствует адрес» у клиента на фронте всплывает неформализованная ошибка,,,Личный кабинет
ADIRINC-912,2924902,U_M0WVN,Закрыт,08.02.2023 11:08,,,,,Дефект промсреды,13.04.2023 11:43,2023-04-14 00:00:00.0,"Суть проблемы:
 1. Было выставлено поручение 39962117284, оно перешло в статус воркинг;
 2. Была выставлена заявка 39971100584 по нему;
 3. Потом поручение решили снять, и оно перешло в статус 15, а затем в 16;
 4. Заявка отменилась автоматически и перешла в 21 статус;
 5. После этого и поручение должно было перейти в статус 21, но из-за ошибки оно перешло в статус 20 (исполнено);

Так как в статус 20 поручение перейти не должно было, то и трейда по нему не было.

На втором скрине видно что сделка только одна и она старая",,1.0,Core
ADIRINC-911,2924886,U_M16SR,Отклонен,08.02.2023 10:52,,,,,Дефект промсреды,15.03.2023 12:02,2023-05-31 00:00:00.0,"При попытке удалить из избранного позиции, по котором в БД нет информации, на фронте возникает ошибка.

ОР: удалить из избранного можно независимо от ответа от кор сервисов",,,Мобильный терминал
ADIRINC-910,2923308,U_M1FE1,На исправление,07.02.2023 17:09,,,,,Дефект промсреды,,2023-03-24 00:00:00.0,"# Клиент заходит Рынки–в фильтрах выбирает облигации–сортирует по доходности
ФР: Видит MAX доходность 15%, хотя есть облиги с 25-30% и они у нас доступны к торгам. Например RU000A102HB3
!image-2023-02-07-17-08-16-610.png!",,12.0,Core
ADIRINC-909,2923534,U_M1CUE,NEW,07.02.2023 16:45,,,,,Дефект промсреды,,2023-04-13 00:00:00.0,"ОР:
1) Клиент ранее заблокировав техническую карту привязанную к БС, например, через ЦПК, пополняет свой БС с карты. Сервис по созданию карт автоматически создает новую карту и платеж проходит.
ИЛИ
2) Клиент не знает о существовании виртуальной карты(она же техническая карта или fake card) и потому он не блокирует ее, проблем не возникает.

ФР:
Клиент, заблокировав ранее виртуальную карту через сотрудника ЦПК, пытается совершить перевод с карты на БС(карту БС) и получает ошибку ""Что-то пошло не так... Перевод отклонен банком-получателем""

В логах ошибки: 
ERRCUR1416 Перевод отклонён банком-получателем
APE0267 Операция отклонена банком, выпустившим карту получателя. Попробуйте использовать другую карту или обратитесь в банк, выпустивший карту получателя


Почему не прошло по 1-му ОР:
Судя по коду сервис создания карты не вызывался, т.к. уже была техническая карта в статусе 2 - done \{ ""CardId"": ""131037093"", ""Status"": 2, ""RqId"": ""MR83K1OH"" } - источник [[https://rc.alfa-bank.net/channel/adir-lk-pub/thread/6ngPT62rvRW6gH5pu]
]В то время когда сама карта имела статус в EQ - 12 - Уничтожена, статус в ПЦ - 3 - Карта заблокирована клиентом или сотрудником банка по просьбе клиента.
Карта может быть закрыта самостоятельно клиентом.

 Почему не прошло по 2-му ОР:
Карта - Заблокирована клиентом по звонку в ЦПК. 
Вероятно либо клиент увидел карту в переводах с карты на карту в приложении АМ и не понял что это за карта, тк он ее не заводил, а в переводе полностью не влезает название карты: ""Виртуальная карта для пополнени..."", а сотрудник ЦПК не смог объяснить и карту заблокировали по решению клиента.
Либо сотрудник ЦПК рассказал клиенту о существовании карты, клиент говорит что не заводил ее и снова принимает решение заблокировать. ",,1.0,Личный кабинет
ADIRINC-908,2919148,U_M0WVN,Закрыт,06.02.2023 16:53,,,,,Дефект промсреды,15.02.2023 09:51,2023-03-23 00:00:00.0,"Не стану сильно расписывать, на скрине хорошо видно.

Завели идею по Сберу с некорректным графиком.

На Андроиде увидел такую, на IOS не увидел такого по Сберу.

 

 

!image-2023-02-06-16-51-42-758.png!

 

 ",,,Мобильный терминал
ADIRINC-907,2916333,U_M1MST,Закрыт,06.02.2023 11:48,,,,,Дефект промсреды,15.03.2023 12:03,2023-05-29 00:00:00.0,"В МТ клиенту предлагается для покупки бумага с прогнозом на рост, которая на бирже уже не торгуется.
Пример:  !image-2023-02-06-11-40-37-906.png!",,,Мобильный терминал
ADIRINC-906,2915416,U_M1P1L,На исправление,06.02.2023 11:09,,,,,Дефект промсреды,,2023-03-23 00:00:00.0,"У клиентов счет в Директе открывается не дожидаясь проверок на стороне EQ:
от EQ пришла ошибка PBS0052 Запрет открытия счета по ограничениям идентификации. В итоге клиент не может пополнить БС
Пример:
SELECT iia_type_id, status_type, eqmessage, * FROM hell.dbo.accounts WHERE client_id in(6131098, 6131098)
Обсуждение: https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=L8qNRqraYBPdG4LNK",,1.0,Core
ADIRINC-905,2915379,U_M18JH,Закрыт,06.02.2023 10:56,Фронт,,,,Дефект промсреды,08.11.2023 14:02,2023-05-29 00:00:00.0,"У клиента при подписании поручения возникает ошибка. ""Повышенный уровень риска..."" Текст ошибки большой и не помещается на экран, попадает под кнопку ""хорошо"", а проскроллить экран вниз нет возможности. !image-2023-02-06-10-53-46-270.png!  ",,,Мобильный терминал
ADIRINC-904,2906079,U_M1CYD,Закрыт,02.02.2023 11:55,,,,,Дефект промсреды,18.05.2023 10:01,2023-05-03 00:00:00.0,"По RU000A0JP0U9 ПАО ""Банк Санкт-Петербург"" на сервере LTRnews_[cache.alfadirect.ru|http://cache.alfadirect.ru/]
select mktcap,* from [news_cache].[direct].[emitents] where emitent_id = ( select emitent_id from [news_cache].[direct].[instruments] where isin = 'RU000A0JP0U9 ')
стоит капитализация mktcap = 0.00 рублей, в то время как на мосбирже капитализация указана на данный момент(02.02.2023 11:40) = 574 860 000 ₽. 
Если вручную проставлять капитализацию, то каждую ночь цена апдейтится(пример из скрипта выше: dt_update 2023-02-02 01:37:05.926)  и снова становится 0 ",,,Core
ADIRINC-903,2905811,U_M12WM,Закрыт,02.02.2023 11:36,,,,,Дефект промсреды,12.10.2023 15:30,2023-03-21 00:00:00.0,"ОР: При выставлении револьверной заявки все заявки выполняются и есть возможность их отмены.
ФР: При отмене револьверной заявки может возникнуть ситуация, когда ответы от сервисов приходят в неправильном порядке. Заявка может быть выполнена, но отображаться в статусе \\\\\\\\\\\\\\\""В процессе\\\\\\\\\\\\\\\"", а в логах как \\\\\\\\\\\\\\\""помечена для удаления\\\\\\\\\\\\\\\""
!snimok_ekrana.png|width=754,height=41!
!snimok_ekrana2.png|width=554,height=232!
 ",,3.0,Core
ADIRINC-902,2904475,U_M177U,Закрыт,01.02.2023 20:24,,,,,Дефект промсреды,07.04.2023 22:00,2023-04-10 00:00:00.0,В МТ при пополнении не показываются в списке счета типа МИР,,1.0,Мобильный терминал
ADIRINC-901,2903507,U_M19LL,Закрыт,01.02.2023 15:52,,,,,Дефект промсреды,03.07.2024 11:26,2023-03-20 00:00:00.0,"Не верный алгоритм расчета вармаржи по вечному фьючерсу USBRUBF из за этого на данный момент он считается не верно и корректируется только после того как приходит файл. 
У Климова А.П. есть новый код который он написал, но пока не может его выкатить, т.к. требует ввода некоторых данных с сайта биржи.
https://www.moex.com/a8141",,3.0,Core
ADIRINC-900,2901466,U_M1CWM,Закрыт,01.02.2023 10:44,,,,,Дефект промсреды,05.05.2023 17:17,2023-05-29 00:00:00.0,"У клиентов различаются балансы в разных терминалах из-за разных текущих цен некоторых позиций: у тех, у которых в ADFront.ts.FinInfoExt различаются значения FairPrice и PrevLast, тк ВТ показывает цену из PrevLast, а МТ из FairPrice.
МТ показывает правильно",,30.0,АИ ПРО
ADIRINC-899,2898207,U_M19LL,Закрыт,31.01.2023 13:42,,,,,Дефект промсреды,15.05.2023 10:46,2023-04-06 00:00:00.0,Инструмент RU000A105BY1 ГазКЗ-28Е блокирует лимит и не дает выставить другие заявки ,,,Core
ADIRINC-898,2895948,U_M0NT4,NEW,30.01.2023 19:49,,,,,Дефект промсреды,,2023-03-17 00:00:00.0,"Инструмент из одного конвертируется в другой. В тот инструмент в который произошла конвертация еще не торгуется, поэтому текущая цена либо равна 0, либо инструмент вовсе не отражается в портфеле. Из за этого стоимость общего портфеля отображается не верно и клиенты негативят. 
Для примера клиент Носов Николай Николаевич H61109 128081 - некорректно отображается баланс в позициях в АИ 4.0 для ПК - после конвертации россетей в позициях не отображаются сведения по 106D, а по 105D некорректно НПУ рассчитано (-100%).  Баланс уменьшился портфеля на 450 т.р., клиент негативит.",,30.0,Core
ADIRINC-897,2890413,U_M1BFA,Закрыт,27.01.2023 16:14,,,,,Дефект промсреды,09.03.2023 18:34,2023-03-29 00:00:00.0,"Клиент заходит в ВТ, в портфель
 ОР: Баланс отображается корректно
 ФР: баланс портфеля не совпадает с суммой стоимости всех позиций.

!image-2023-01-27-16-13-51-292.png!",,,АИ ПРО
ADIRINC-896,2888507,U_M00ZM,Закрыт,27.01.2023 11:13,,,,,Дефект промсреды,09.01.2024 17:12,2023-05-19 00:00:00.0,"В истории операций в МТ отображается платежка датой выставления, а не датой исполнения.

Пример: 2500705 
Клиенту была выставлена комиссия за обслуживание 199 рублей 09.01, дата исполнения - 31.01
!image-2023-01-27-11-10-07-289.png!
В выписке данное списание не числится:
!image-2023-01-27-11-10-44-791.png!
А в истории указано что списание уже произошло:
!image-2023-01-27-11-11-10-763.png!",,24.0,Core
ADIRINC-895,2886049,U_M0VYR,Закрыт,26.01.2023 15:04,,,,,Дефект промсреды,30.03.2023 15:21,2023-03-14 00:00:00.0,"# Клиент выводит ДС с ИИС в другой банк
 # Возникает ошибка ""При формировании текста поручения произошла ошибка""

Фактически: Если посмотреть в логах по логину клиента , можно увидеть ошибку:

{""type"":""[https://tools.ietf.org/html/rfc7231#section-6.5.1]"",""title"":""One or more validation errors occurred."",""status"":400,""requestId"":""d6604167-8b45-40cf-a95c-a20916b7c927"",""errors"":\\{""TIN"":[""The TIN field is required.""]}

TIN - это ИНН его нужно указывать при выводе втч на 30601.. счета, в данном случае не указывается и запрос в ошибку падает.

Нужен фикс.

!image-2023-01-26-15-04-13-367.png!

 ",,3.0,Личный кабинет
ADIRINC-894,2884991,U_M1D2F,NEW,26.01.2023 12:44,,,,,Дефект промсреды,,2023-02-06 00:00:00.0,"лиент пробует подать заявку на участие в первичном размещении по инструменту RU000A105PP9 (ЕвроТранс о.к.б. серии 001P-01)
Номинал бумаги 1000 руб., размещение 100% от номинала
1 облигация - 1000 рублей.
В ПО Web-Admin в логах в колонке 140,06
Т.е. система рассчитывает цену больше 100%
Бумага торгуется уже на бирже и возможно, при выставлении заявки система рассчитывает цену не как по первичному размещению .
Ссылка на лог: https://alfaadmin/reporting/orderlimitlog/1347164068",,12.0,Core
ADIRINC-893,2884846,U_M1BFA,Закрыт,26.01.2023 12:15,,,,,Дефект промсреды,02.02.2023 17:14,2023-03-14 00:00:00.0,"В веб терминале при покупке акций Яндекса в поле ""Итог"" отображается сумма 144к, хотя лот стоит 1912 руб.

 

Проблема скорее всего связана с привязкой к Currency Region. 

ISIN у бумаг начинается на US и рассчитываются они скорее всего с привязкой к курсу, т.е. 1912*75 ~ 144к. Хотя валюта торговли обозначена как RUB",,,АИ ПРО
ADIRINC-892,2882018,U_M1CUE,Отклонен,25.01.2023 15:38,,,,,Дефект промсреды,16.07.2024 12:22,2023-05-23 00:00:00.0,"Тред на обсуждение https://rc.alfa-bank.net/channel/adir-vrmb-hkd-i-drugie?msg=qBypXLrBbyoF2eHSf
!image-2023-02-01-14-44-07-597.png!",,41.0,Montblanc
ADIRINC-891,2880736,U_M1BW1,Отклонен,25.01.2023 11:11,,,,,Дефект промсреды,14.03.2023 19:07,2023-03-13 00:00:00.0,"В 4:15 был сделан новый релиз БД (обновление Hell.dbo.v_adm_managers) асинхронно с обновлением АА. Старая версия АА не ожидает null значений в 3х полях: course_manager, schedule_date, reg_code.

В разделе ""Менеджеры"" происходит ошибка.",,,Альфа-Админ
ADIRINC-890,2874897,U_M1AYE,Закрыт,23.01.2023 20:10,,,,,Дефект промсреды,13.04.2023 15:01,2023-03-10 00:00:00.0,"У клиентов заблокировался лимит из-за активных записей по депо-поручениям в adfront.ts.transfersecurityorders, но эти заявки на перевод уже отменены",,34.0,Core
ADIRINC-889,2873831,U_M00ZM,Отклонен,23.01.2023 15:51,,,,,Дефект промсреды,21.02.2024 19:01,2023-03-29 00:00:00.0,"ОР: В налоговом отчёте показаны операции с бумагами с привязкой к бирже
ФР: Клиент купил бумаги на СПБ бирже, с которой позже прекратились торги. Бумаги числятся на балансе клиента и недоступны для торгов. Позже клиент начал торговать той же бумагой на МСК бирже. Продажа инструмента на МСК бирже в налоговом отчёте отображается как продажа первых купленных инструментов, т.е. числящихся на СПБ бирже и недоступных для торгов. Позже, инструмент из СПБ биржи перешел в НТР. В отчёте нет разбивки на биржи. 
 
Например: 2.09.2022 клиентом были куплены акции ФосАгро в размере 165 штук на СПБ бирже.
запрос на историю баланса по данной бумаге: 
select dateadd(second,i_last_update,'1/1/99') as time, * from a_hell_balance.dbo.a_balance
where treaty = 4369153 and p_code = 'PHOR2'
and a_date > '2022-08-26 00:00:00.0'
order by a_date desc
!image-2023-01-23-15-16-53-034.png!
После этого торги через СПБ биржу были прекращены, и бумаги остались на балансе.
С 17.10.2022 клиент начал торговать этим инструментом на Московской бирже:
!image-2023-01-23-15-23-47-637.png!
В налоговом отчёте сделки по продаже данного инструмента на Московской бирже относятся к заблокированным акциям на СПБ бирже ( 3 столбец \\\\\\\\\\\\\\\""Тип Операции\\\\\\\\\\\\\\\"" - Продажа), а не акциям, находящимся на Мск бирже, по которым шли торги.
Отображение в налоговом отчёте:
!image-2023-01-23-15-14-12-542.png!
!image-2023-01-23-15-14-57-887.png!",,3.0,Core
ADIRINC-888,2867055,U_M19LL,Закрыт,20.01.2023 16:28,,,,,Дефект промсреды,12.05.2023 16:20,2023-03-28 00:00:00.0,"в quik при формировании отчётов возникает ошибка ""неправильно указано значения язык данных отчёта 1049"".",,,Альфа-Админ
ADIRINC-887,2866111,U_M1N2N,Отклонен,20.01.2023 14:55,,,,,Дефект промсреды,22.01.2024 12:11,2023-03-07 00:00:00.0,"ОР: Клиент видит полные цены в сводке на графике
ФР:  У клиента отображаются три точки, вместо цифр после запятой.
Цена предложения и спроса 32.40 отображение нормальное. Но если будет 32,405 отображение переходит в 32,...
!image-2023-01-20-14-47-17-977.png|width=611,height=962!
!image-2023-01-20-14-49-36-109.png!
Редко отображается большое число без точек.
!image-2023-01-20-14-47-13-365.png!
 ",,2.0,Мобильный терминал
ADIRINC-886,2866052,U_M13MK,На исправление,20.01.2023 14:18,,,,,Дефект промсреды,,2023-03-07 00:00:00.0,"Клиент ГС 90514, isin RU000A102N77 
У клиента была 1 сделка  446514402 по инструменту: покупка 4 бумаги по 311020 р, 
Потом была реорганизация VTBMPIF3891 в VTBMPIF3891, в рамках реорганизации были навешаны депо переводы и налоговые деталицазии, но учетная цена все равно формируется на основе сделки. При этом если у клиента до реогранизации были только депо переводы, то учетная цена считается нормально 
!image-2023-01-20-14-16-41-509.png!
!image-2023-01-20-14-17-32-740.png!
 ",,27.0,Core
ADIRINC-885,2866151,U_M0WVN,Закрыт,20.01.2023 14:04,,,,,Дефект промсреды,10.01.2024 18:04,2023-03-07 00:00:00.0,"При отправке Детального отчета по счету на электронную почту приходит Справка-расчет
Проверил на iOS
Видос во вложении
[^video5357391760915965440.mp4]",,3.0,Личный кабинет
ADIRINC-884,2865506,U_M0WVN,Закрыт,20.01.2023 13:45,,,,,Дефект промсреды,10.01.2024 18:06,2023-03-07 00:00:00.0,"# Клиент хочет сделать Налоговый отчет 
 # Заходит в профиль--функц.личн.кабинета--Отчеты–выбирает иис
ФР:
Пропадает вкладка Налоговый, при переключении с БС на ИИС
!image-2023-01-20-13-44-46-284.png!
В ЛК при этом Налоговый вынесли в Справку-расчет и Детальный
*!image-2023-01-20-13-44-18-883.png!*",,4.0,Личный кабинет
ADIRINC-883,2864673,U_M1DKF,Принят к исправлению,20.01.2023 11:20,,,,,Дефект промсреды,,2023-03-07 00:00:00.0,"Перевод оставшихся активов с разорванного ИИС осуществляется без комиссии в рамках лояльности, хотя у клиентов она отображается и учитывается при расчетах лимитов, в результате чего переводы отбиваются по ошибке лимитов
[https://alfaadmin/reporting/orderlimitlog/1377097194]",,30.0,Личный кабинет
ADIRINC-882,2864490,U_M1FE1,Закрыт,20.01.2023 11:18,,,,,Дефект промсреды,07.02.2024 11:13,2023-04-19 00:00:00.0,"ОР: клиент заходит в историю сделок и видит выплату по дивидендам.
 ФР: клиент заходит в историю и не видит выплату по дивидендам, либо не подгружается лого компании, хотя в приложении у компании есть лого

Доп. Информация:
 Проблема возникает из-за неправильной трансляции или ручных правок в архивных записях транзакций в Production1 hell.dbo.a_all_transfers. После попадания в архив транзакций любые изменение не отражаются в operations_cache.hell.extra_transfers из-за чего поля income_type (тип транзакции) и as_p_code(код компании, отображение логотипа) в таблице operations_cache.hell.extra_transfers в Operation Cache могут иметь значения NULL, а соответственно не подгружаться в историю. 
 Примеры:
 запрос на сравнение income_type
 SELECT c.[trn_no], c.[income_type], t.[income_type], c.[comments], c.[db_time] FROM [operations_cache].[hell].[extra_transfers] c WITH (SNAPSHOT) LEFT JOIN prod1.[hell].[dbo].[a_all_transfers] t on c.trn_no = t.trn_no where c.income_type is null and t.income_type is not null and c.comments like 'Внешнее зачисление: Див%'
 !image-2023-01-20-10-55-09-749.png!
 запрос на сравнение as_p_code
 SELECT c.[trn_no], c.[as_p_code], t.[as_p_code], c.[comments], c.[db_time] FROM [operations_cache].[hell].[extra_transfers] c WITH (SNAPSHOT) LEFT JOIN prod1.[hell].[dbo].[a_all_transfers] t on c.trn_no = t.trn_no where c.as_p_code is null and t.as_p_code is not null and c.comments like 'Внешнее зачисление: Див%'
 До исправления не отображались дивиденды по ФосАгро. В основном ошибка возникает именно по этой бумаге.
 !image-2023-01-20-11-14-41-300.png!
 Версия МТ: 2.20.1
 Платформа: Android 10
  ",,53.0,Core
ADIRINC-881,2863118,U_M1FD7,Отклонен,19.01.2023 18:58,,,,,Дефект промсреды,23.01.2023 16:11,2023-03-07 00:00:00.0,"Клиенты пополнили ИИС 31.12.2022, но в брокерском отчете дата исполнения 02.01.2023. Клиентов данная информация не устраивает. Необходимо поправить отчет. Список клиентов можно выгрузить так:
*SELECT * FROM a_hell_opers.dbo.a_all_transfers a*
*left join hell.dbo.accounts AS ac*
*ON a.acc_code = ac.acc_code*
*WHERE a.a_date = '2023-01-02'*
*AND a.settlement_date = '2022-12-31 00:00:00.000' AND a.tran_type='EXTRA' and a.place_code='MICEX_SHR' and a.p_code='money'*
*AND ac.iia_type_id IN (2,3,4,5)*
!брокерский отчет.jpg!
!image-2023-01-19-18-57-42-278.png!
 ",,13.0,Core
ADIRINC-880,2862978,U_M1AYE,Отклонен,19.01.2023 17:17,,,,,Дефект промсреды,19.04.2024 10:03,2024-06-06 00:00:00.0,"В Мт В портфеле в разделе Заявки при просмотре подробной информации о стоп-маркетной заявке цена отображается не такая, по какой она исполнялась


  ",,2.0,Core
ADIRINC-879,2862264,U_M0WVN,Закрыт,19.01.2023 15:22,,,,,Дефект промсреды,13.04.2023 17:53,2023-03-06 00:00:00.0,"Ожидаемы результат:
 # Клиент заходит в историю операций и смотрит операции
 # Хочет увидеть сколько налогов у него списали

Фактический результат:

       1. Видит, что налог за предыдущий год списан дважды

!image-2023-01-19-14-59-40-832.png!

Свежий пример:

AA6QDR ГС 3414173

МТ 2.19.0 Андроид

При воспроизведении массово отбирались клиенты и исправлялось руками, отбирая так, например:

{{SELECT o.* into Recycle.dbo.tmp_20230106_oper5status FROM ADFront.cf.Operations o LEFT JOIN hell.dbo.payments p ON o.ExtOrderNo = p.pay_no AND p.payment_type = 'taxes' AND p.settlement_date = '2023-02-05' WHERE o.Comment LIKE '%НДФЛ%' AND o.SettleDate = '2023-02-05' AND p.pay_no IS NULL AND *o.IdOperationStatus <> 5*}}

и обновляя {{IdOperationStatus}}:

{{update o set *IdOperationStatus=5*FROM ADFront.cf.Operations oLEFT JOIN hell.dbo.payments p    ON o.ExtOrderNo = p.pay_no
        AND p.payment_type = 'taxes'        AND p.settlement_date = '2023-02-05'WHERE o.Comment LIKE '%НДФЛ%'    AND o.SettleDate = '2023-02-05'    AND p.pay_no IS NULL
    AND o.IdOperationStatus <> 5}}

{{Так же удаляли вручную из operations_cache эти операции, для того чтобы убрать отображение на фронте:}}

select * FROM *operations_cache.[hell].[payments]* where 1=1 and db_date = '2023-01-01 00:00:00.000' and pay_no in (select ExtOrderNo from prod1.Recycle.dbo.tmp_20230104_oper5status)

{{Проблема в джобе
09:00 Создание блокировочных налоговых платежей, который обращается в процедуру tax.BlokedPaymentsForTaxes }}

{{Подробнее https://rc.alfa-bank.net/channel/adir_duty?msg=7NTPgwzndnJ8WWkwv}}",,66.0,Core
ADIRINC-878,2857819,U_M07DK,Закрыт,18.01.2023 15:51,,,,,Дефект промсреды,09.01.2024 09:23,2023-03-03 00:00:00.0,"Клиенту перед закрытием ИИС переводят все активы на БС, в hell.[dbo].[a_all_transfers] переводы есть, но автоматически не создаются налоговые детализации по данным переводам в hell.tax.interface_income_detail, в следствии чего у клиентов учетная цена по переведенным активам отображается некорректно. Так же из-за этого некорректно рассчитывает налоговая база",,63.0,Core
ADIRINC-877,2851222,U_M12WM,Закрыт,17.01.2023 09:35,,,,,Дефект промсреды,20.01.2023 14:53,2023-03-02 00:00:00.0,"Два источника сообщений, лс и дк, каждый в своем потоке модифицирует хранилище, что приводит к гонке. поэтому сообщения от лс и дк должны обрабатываться в одном потоке дкм. но по умолчанию на уазе сконфигурировано что сообщения от дк обрабатываються в потоке его соединения и нет возможности сообщения от лс прокинуть в соединение от дк. поэтому в дкм на аузе должно быть обязательно поток обработки. ",,,Core
ADIRINC-876,2850449,U_M1E0U,Отклонен,16.01.2023 17:31,,,,,Дефект промсреды,16.02.2023 13:30,2023-03-01 00:00:00.0,"Коллеги, в ходе начисления подарочных акций 16.01, возникло 2 проблемы:

 

При начислении новых ПА, gifts-api выдавал ошибку «Failed», при этом акции этим клиентам начислились судя по запросу в MongoDB (giftsPortfolio, participantsBonusCampaigns)

 

А вот с акциями по тикеру ARLS возникла проблема – из 12118 клиентов, акции начислились не всем, Кибана ругается на то, что эти аккаунты не существуют, и в монге их тоже нет.

При этом была та же ошибка, что и в другой акции, а именно «Failed». Но опять же, эти акции с такой ошибкой начислились клиентам успешно, кроме 39 пользователей.

А вот, что это за пользователи я не знаю и найти в таком количестве не могу.

По факту успешно начислились всем акции по тикеру VEO, MTSS и частично ARLS.

 

Просьба разобраться, как попало в список 39 несуществующих пользователей и почему при начислении выводится на некоторых клиентах ошибка «Failed», при этом акции успешно начисляются.

 

Прикладываю json файл по пользователям (1455 клиентов), по которым была ошибка «Failed». Из них акции начислились 1416 клиентам. Скрины в подтверждение предоставлю во вложении.

 

*+Тикер+*: ARLS

*+campaignId+* *+новой ПА+*: 63c517abcaa69e5fa4c68789

 

 ",,,Мобильный терминал
ADIRINC-875,2848187,U_M12WM,Закрыт,16.01.2023 12:32,,,,,Дефект промсреды,13.04.2023 15:28,2023-03-01 00:00:00.0,"После рестарта сервиса DVFO зависает поток общения между торговыми сервисами и DVFO, в следствии чего все заявки по ЮАНЯМ попадали в этот поток и оставались там ждать 

 Заведена задача ADIRSVC-3142 на исправление",,,Core
ADIRINC-874,2845328,U_M1AYE,Отклонен,13.01.2023 18:47,,,,,Дефект промсреды,30.08.2024 18:46,2023-03-01 00:00:00.0,"У клиента в ДТ рублевая позиция отображается с точностью до 6 знаков после запятой. 

Ссылка на обсуждение [https://rc.alfa-bank.net/channel/adir-terminal-support?msg=nrabcXEAKco59mb2K]



!image-2023-01-19-17-11-40-017.png!",,,АИ ПРО
ADIRINC-873,2845318,U_M19LL,Закрыт,13.01.2023 18:05,,,,,Дефект промсреды,18.01.2024 10:25,2023-03-01 00:00:00.0,"Из за перевода акций с неторгового раздела на торговый у клиентов образуется Срочные Маржинальные требования. Данная информация отображается только в МТ. На маржин колл не влияет.
Для примера: Клиент 4424858
07.06.2023 произошла конвертация ценных бумаг TCR2 Therapeutics Inc., а.о. US87808K1060 в Adaptimmune Therapeutics plc ORD SHS, адр .US00653A1079.
Сейчас у клиента в портфеле отображается минус 40 по TCR2 Therapeutics Inc. и возникли срочные требования на 5569,98 рублей.
!1.png!
!image-2023-06-07-16-55-42-179.png!
 ",,108.0,Core
ADIRINC-872,2845288,U_M19LL,Закрыт,13.01.2023 16:54,,,,,Дефект промсреды,13.04.2023 16:39,2023-02-28 00:00:00.0,"Клиент пытается перевести ДС с одного своего счета на другой свой счет, но сумма которую он может перевести равен 0. В логах видна ошибка:  \\\\\\\\\\\\\\\""Ошибка при выполнении запроса в ЛС: Некорректные данные: не найдена информация по субсчету (IdRazdel=28887386)\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""errorCode\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""40010\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""requestId\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""1b837bca-e309-4bb7-a46f-1c4a33829806\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""apiVersion\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""1\\\\\\\\\\\\\\\""}\\\\\\\\\\\\\\\"";",,4.0,Core
ADIRINC-871,2845272,U_M1AYE,Закрыт,13.01.2023 16:36,Фронт,,,,Дефект промсреды,13.04.2023 15:02,2023-05-31 00:00:00.0,"У клиентов на главном экране и во вкладке «Позиция»  округляется до меньшего количества знаков, чем реально отображается в стакане или на графике ",,,Мобильный терминал
ADIRINC-870,2844875,U_M1B1C,Закрыт,13.01.2023 15:44,,,,,Дефект промсреды,12.10.2023 15:35,2023-03-21 00:00:00.0,"Пререквизит: 2 клиента заходят в МТ с одного устройства, после чего 1 из клиентов заходит в чат
ОР: Клиент определяется корректно 
 ФР: Клиент определяется некорректно, заходит один, а определяется другой
Пример: 
В МТ заходит клиент ADNHAT Зак Дмитрий Вадимович, а в чате отображается как E79303 Зак Вадим Яковлевич 
Версия приложения iOS 2.17
 !image-2023-01-13-15-44-46-570.png!
 !image-2023-01-13-15-44-32-347.png!
 !image-2023-01-13-15-44-26-573.png!",,5.0,Мобильный терминал
ADIRINC-869,2841432,U_M1AYE,Закрыт,12.01.2023 16:18,,,,,Дефект промсреды,03.11.2023 14:09,2023-05-02 00:00:00.0,"При отказе в открытии БС по комплаенсу на фронте отображается неформализованная ошибка вместо адекватного текста.
Пример 4358581 AVT0A3 получил «Нужен второй заход», хотя в логах СОС ошибка по комплаенсу «Проверка актуальности паспорта вернула ошибку: Паспорт РФ просрочен»",,14.0,Мобильный терминал
ADIRINC-868,2833814,U_M1BFA,Отклонен,10.01.2023 18:03,,,,,Дефект промсреды,19.01.2023 17:12,2023-04-10 00:00:00.0,"Клиент заходит в ДТ, открывает график 
ОР: На синем прямоугольнике должна отображаться информация о типе заявки, и должна быть черная линия
!image-2023-01-10-18-01-36-510.png!

ФР: Отображается только синий прямоугольник
!image-2023-01-10-18-01-25-140.png!

 

 ",,3.0,АИ ПРО
ADIRINC-867,2833807,U_M1CWM,Отклонен,10.01.2023 17:51,,,,,Дефект промсреды,22.03.2023 13:26,2023-04-07 00:00:00.0,"!image-2023-01-10-17-50-54-498.png!

Обсуждение [https://rc.alfa-bank.net/channel/adir-terminal-support?msg=ifMDziFBNFQaNjRw7
]

Инцидент IM14338004",,,АИ ПРО
ADIRINC-865,2831638,U_M12WM,Закрыт,10.01.2023 11:33,,,,,Дефект промсреды,31.03.2023 11:36,2023-01-12 00:00:00.0,"После утреннего релиза на версию 
|157645176|[22|http://jenkins.alfadirect.ru:8080/job/git-nightly/job/hotfix%2F2.28.1/22/]|2.28.1d|

10.01.23 с 9:50 не работали сервисы AUTH01 и AUTH02, падали из-за ошибки 

Jan 10 10:05:16.349748 ADWAUTH01 auth[1966390:1966452]/fatal: [config] - ConfigFile::Node::getString: Value [Path=Username] is not present in configuration

11.01.23 не стартовал сервис asotc и падал aimicex",,,Core
ADIRINC-864,2830241,U_M0S8K,Закрыт,09.01.2023 19:17,,,,,Дефект промсреды,20.01.2023 15:53,2023-01-12 00:00:00.0,"06.01.23 с 19:10 перестали доходить запросы с мидл кластера до кор сервисов директа через балансировщик 172.21.1.97

Проблема возникла из-за разных настроек балансировщиков на разных плечах

Обсуждение велось тут 

https://rc.alfa-bank.net/channel/adir_admins_public?msg=63sBKgmAfv6WCukuC",,,Core
ADIRINC-863,2829718,U_M19LL,Закрыт,09.01.2023 19:07,,,,,Дефект промсреды,15.05.2023 10:41,2023-02-21 00:00:00.0,"Удаление платежей из hell.dbo.payments не вызывает процесс аннулирования операций в ADfront и удаления платежей из operations_cache.hell.payments

Каждый день в январе в 9:00 пересоздаются блокировочные налоговые платежи: старые удаляются и новые создаются. Обнаружен дефект процедуры удаления платежей. В данном случае происходит задвоение удержанного налога.

 ",,,Core
ADIRINC-862,2827558,U_M1CWM,Отклонен,09.01.2023 14:00,,,,,Дефект промсреды,05.05.2023 16:18,2023-02-20 00:00:00.0,"При запросе списка карт на пополнение БС всплывает ошибка. 

Данные по картам в ответ от CS/EQ/WSCardListMask10/SOAP получены, скорее всего ошибка фронтовая",,,АИ ПРО
ADIRINC-861,2826193,U_M1AYE,Отклонен,09.01.2023 12:07,,,,,Дефект промсреды,21.06.2023 12:09,2023-03-15 00:00:00.0,"Не проходит продажа подарочной акции из-за отрицательного баланса текущего счета.

Надо бы сделать так, чтобы у таких клиентов при продаже акции МТ выводило сообщение, например, ""Невозможно продать подарочную акции, потому что на счёте отрицательный баланс""

 ",,,Мобильный терминал
ADIRINC-860,2825485,U_M0Z22,Отклонен,09.01.2023 10:48,,,,,Дефект промсреды,16.02.2023 15:07,2023-01-11 00:00:00.0,"Падала MTRA 31.12.22, 01.01.23, 04.01.23, 07.01.23 ",,,Core
ADIRINC-859,2822164,U_M00ZM,Закрыт,30.12.2022 10:56,,,,,Дефект промсреды,30.03.2023 15:29,2023-02-17 00:00:00.0,"Клиент заходит в МТ , в портфель

ОР: Позиции отображаются корректно
ФР: Позиции по валюте пропадают 

Происходит из-за того что у клиента в adfront.bs.SubAccPositions две позиции по долларам, одна из позиций на idRazdelType = 13 (ALFA_RUB/MOEX Рынок ценных бумаг)

select * from adfront.bs.SubAccPositions where idAccount = 97308 and IdObject = 174366
select * from adfront.[dbo].[Razdels] where IdRazdel in (693909,693907)
select * from adfront.[dbo].[RazdelTypes] where IdRazdelType = 13
!image-2022-12-30-10-56-08-024.png!

 ",,82.0,Core
ADIRINC-858,2820349,U_M1DKF,На исправление,29.12.2022 11:21,,,,,Дефект промсреды,,2023-04-04 00:00:00.0,При стандартном ответе от шины «PL00046 У клиента отсутствует адрес» у клиента на фронте всплывает неформализованная ошибка,,,Личный кабинет
ADIRINC-857,2819918,U_M1E0U,Отклонен,29.12.2022 10:37,,,,,Дефект промсреды,29.12.2022 11:39,2023-01-16 00:00:00.0,"Добрый день!

Каждый день приходит порядка 10-15 инцов от клиентов с просьбой перенести подарочные акции с ИИС на брокерский счёт, потому что при продаже клиентам выводится ошибка ""Необходимо открыть текущий счет"".

При этом у клиентов помимо ИИС присутствует и брокерский счёт, но автоматически подарочные акции начисляются именно на ИИС.

Соответственно, я вижу 2 варианта решения проблемы:
 # Обеспечить возможность клиентам самим самостоятельно переносить подарочные акции с ИИС на брокерский счёт (при условии, если начислилась подарочная акция, когда отсутствовал брокерский счёт и только после начисления был заведён);
 # Обеспечить при наличии брокерского счёта автоматическое начисление подарочных акций на него соответственно",,,Мобильный терминал
ADIRINC-856,2819836,U_M00ZM,Закрыт,28.12.2022 18:52,,,,,Дефект промсреды,06.04.2023 15:21,2023-02-16 00:00:00.0,"В портфелях клиентов не отображаются инструменты, которые находились на неторговом разделе. (Яндекс, все инструменты ISIN которых начинается на DE)",,19.0,Core
ADIRINC-855,2819539,U_M1AYE,Закрыт,28.12.2022 18:03,,,,,Дефект промсреды,17.02.2023 07:34,2023-02-16 00:00:00.0,"При подписании поручения на депо-перевод у клиента всплывает окошко с ошибкой без текста.

В логах error на ответ от [http://esbws//depo/orders/registration/v10/rest]

{ ""instr_status"": ""Ожидание"", ""result"": """", ""order_id"": 915993 }",,3.0,Личный кабинет
ADIRINC-854,2818886,U_M1BFA,Закрыт,28.12.2022 15:41,,,,,Дефект промсреды,02.02.2023 17:18,2023-02-15 00:00:00.0,"Клиент в вечернюю сессию заходит в ВТ:

ОР: Стоимость активов отображается корректно
ФР: В стоимости активов добавляется стоимость фьючерсов

Похоже что дефект привнесли в релизе https://jira.moscow.alfaintra.net/browse/ITINVEST-459


!image-2022-12-28-15-40-53-271.png!",,,АИ ПРО
ADIRINC-853,2817118,U_M16WU,Закрыт,27.12.2022 22:39,,,,,Дефект промсреды,09.03.2023 18:45,2023-02-15 00:00:00.0,"При закрытии рынка и формировании проводок не формируется переброска 47404810000000000018/30424810200000000012 (пример референ FX01_F0189996365 от 27.12.2022) при этом на сумму этой сделки образуется расхождение на ЕП АДИР 47404810700000000017 (т.е. она избыточно там учитывается в сумме переброски)
Необходимо  проверить корректность работы процедуры ats_EQ_export_new_selt
1. предположительно в сумму переброски по 47404810700000000017 включается сумма этой проводки (что не верно)
2. решить вопрос с переброской с 47404810000000000018, либо завести логику в эту процедуру либо создать новую для 47404810000000000018

нужно просить Климов Алексей Петрович посмотреть процедуру ats_EQ_export_new_selt на тему:
1. Проводки по банку не формируются, но включаются ли в суммы проводок по переброскам обороты по банку (treaty = 6) ",,,Core
ADIRINC-852,2816369,U_M1ME9,Отклонен,27.12.2022 13:03,,,,,Дефект промсреды,06.03.2024 16:07,2023-03-09 00:00:00.0,"ФР:
Клиент смотрит свой портфель в части внебиржи и видит нули по продуктам и доходность. Продуктов в настоящее время не имеет
!image-2022-12-27-13-04-01-853.png!
ОР: Не отображать ничего по всей видимости.
 ",,10.0,Мобильный терминал
ADIRINC-851,2815408,U_M1AYE,Отклонен,27.12.2022 10:21,,,,,Дефект промсреды,11.01.2024 17:41,2023-03-31 00:00:00.0,"При выборе фьючерса CNYRUBF на iOS вылетает из приложения.

На последней версии Android проблемы не наблюдается",,,Мобильный терминал
ADIRINC-850,2814694,U_M1AYE,Закрыт,26.12.2022 17:25,,,,,Дефект промсреды,12.01.2024 12:12,2023-02-13 00:00:00.0,"В Сводке по бумагам GDR отсутствует информация по ISIN

в news_cache данные есть. ",,,Core
ADIRINC-849,2814323,U_M173X,Закрыт,26.12.2022 17:17,,,,,Дефект промсреды,30.09.2024 09:21,2023-03-07 00:00:00.0,Не приходят пуши на устройства Huawei,,43.0,Мобильный терминал
ADIRINC-848,2814305,U_M19LL,Закрыт,26.12.2022 16:56,,,,,Дефект промсреды,24.04.2024 12:10,2023-02-13 00:00:00.0,"В МТ АИ не отображаются облигации номинал которых в CNY. Для примера инструмент RU000A105104
h1.  ",,31.0,Core
ADIRINC-847,2814651,U_M1AYE,Отклонен,26.12.2022 16:21,,,,,Дефект промсреды,09.02.2023 11:57,2023-04-19 00:00:00.0,В МТ в портфеле периодически отображается баннер с главной страницы,,,Мобильный терминал
ADIRINC-846,2814281,U_M0S8K,Закрыт,26.12.2022 16:18,,,,,Дефект промсреды,17.01.2024 11:43,2023-01-11 00:00:00.0,Краш одного сервиса влечет за собой падение всей ноды. Аффектит на расчет лимитов при выводе ДС с БС.,,,Core
ADIRINC-845,2814230,U_M0NT4,Закрыт,26.12.2022 15:01,,,,,Дефект промсреды,18.01.2024 17:56,2023-02-13 00:00:00.0,"Добрый день!  По RU0007661625 отличаются свечи на бирже и в терминалах.
{code:java}
SELECT * FROM [ADDataFeed].[dbo].[Candles] where idfi = 146986 and Low = '137.100000' and time > '2022-10-09 23:29:00.000' and time < '2022-10-11 00:29:00.000'{code}
 

При этом сделки в бд есть   !image-2022-12-26-14-59-27-535.png|width=603,height=122!
 !image-2022-12-26-15-00-36-999.png|width=857,height=494!
 !image-2022-12-26-15-01-19-842.png!
  ",,16.0,Core
ADIRINC-844,2813331,U_M1AYE,Закрыт,26.12.2022 11:38,,,,,Дефект промсреды,05.05.2023 14:43,2023-02-13 00:00:00.0,"При попытке совершить Депо-перевод клиента не принимается код подтверждения: после ввода кода окно ввода продолжает висеть и ничего не происходит.

В самом ЛК ошибка 2022-12-20 17:56:06.4533|ERROR|Error|LK Списание депо. [cabinet].[OpDepoExtraTran]: [70011][Недостаточно средств для обеспечения вывода: есть 975.34, надо не меньше 1000.00 руб.] Трейс 37d9720e-443b-48b8-9607-19c3a2b4672f",,,Личный кабинет
ADIRINC-843,2812541,U_M16WU,Закрыт,26.12.2022 09:27,,,,,Дефект промсреды,09.03.2023 18:45,2023-02-13 00:00:00.0,"При перебросках проводки с place_code = MICEX_SHR_T_OTC не учитываются, из-за этого надо руками редактировать проводки

Переброски формируются в процедуре [dbo].[_ats_EQ_export_new]
http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=884082528
{code:java}
SELECT dateadd(second,i_last_update,'1/1/99') as time, * FROM [a_hell_opers].[dbo].[a_fin_transactions] where market_code = 'MICEX_SHR_T_OTC' and p_code = 'money' and a_date >='2022-12-20 00:00:00.000' 
SELECT dateadd(second,i_last_update,'1/1/99') as time, * FROM [a_hell_export].dbo.[a_EQ_export] where place_code = 'MICEX_SHR_T_OTC' and db_date>='2022-12-20 00:00:00.000'
{code}",,,Core
ADIRINC-842,2811611,U_M13MK,На исправление,23.12.2022 17:25,,,,,Дефект промсреды,,2023-02-10 00:00:00.0,"Доходности за один и тот же период различаются.
В отчете по комиссии считался доход по «Прибыль/Убыток», и он отличается от доходности во втором отчете
Сравниваем суммы с первого скрина и результат сложения позиций из Myportfolio ",,16.0,Core
ADIRINC-841,2810336,RUM0KZK,Закрыт,23.12.2022 11:42,Фронт,,,,Дефект промсреды,09.02.2023 11:17,2023-03-06 00:00:00.0,"Коллеги, привет! 

23.12 была авария из-за проблемы с облигацией Алфьа-Банк в юанях. 
Бумаге не присвоился ликвидный рынок, из-за чего перестали отображаться размещения, а в МТ полностью перестал работать экран ""Главный' 

Выключение ФТ placements_new_widget_enabled не помогло. ",,,Мобильный терминал
ADIRINC-840,2809785,U_M197Z,Отклонен,23.12.2022 10:40,,,,,Дефект промсреды,15.05.2023 10:47,2023-02-10 00:00:00.0,"При формировании проводок для экспорта EQ поменялся местами счет debet и kredit

SELECT dateadd(second,i_last_update,'1/1/99') as time, * FROM [a_hell_export].dbo.[a_EQ_export] where tran_no in (236603498,236783431) and db_date>='2022-12-20 00:00:00.000'

Ошибочная проводка 236603498

Проводка мешала закрытию опер. дня


!image-2022-12-23-10-38-32-918.png!",,,Альфа-Админ
ADIRINC-839,2807404,U_023HG,Закрыт,22.12.2022 11:20,,,,,Дефект промсреды,28.03.2023 16:24,2023-03-03 00:00:00.0,"Клиент заходит в МТ -> Еще -> Таблица кодов 



ОР :  ""Сформировать новую"" -> ""Подписать"" -> ""Экран с таблицей""
ФР: ""Сформировать новую"" -> ""Подписать"" -> выкидывает в настройки



Проблема воспроизводится на версии андройд 2.20.1",,1.0,Мобильный терминал
ADIRINC-838,2807463,U_M17E4,Отклонен,22.12.2022 10:45,,,,,Дефект промсреды,09.02.2023 11:18,2023-03-03 00:00:00.0,"При кросс-авторизации в из мобайла в МТ происходит ошибка «Что-то пошло не так»

В либе ошибки:

06:30:39.408 AD.Core.Source.SymbolSource.n/a=n/a idFi:0 status:Pending -> status:Failed error:ErrorInfo:[
 typde: MarketData(12)
 code: InvalidInputArguments(9)
 title: Market data
 msg: #M9I1L181: symbol n/a=n/a not found in dictionary
 hashCode: I1L181
 args: [ ]
]

06:30:39.408 AD.Core.Source.QuoteSource.n/a=n/a status:Created -> status:Failed error:ErrorInfo:[
 typde: MarketData(12)
 code: InvalidInputArguments(9)
 title: Market data
 msg: #M9I1L181: symbol n/a=n/a not found in dictionary
 hashCode: I1L181
 args: [ ]
]

06:30:39.409 AD.Core.Source.SymbolSource.ISIN:RUR idFi:0 status:Pending -> status:Failed error:ErrorInfo:[
 typde: MarketData(12)
 code: InvalidInputArguments(9)
 title: Market data
 msg: #M9I1L108: object by ISIN [SymbolSpec: ISIN:RUR] not found in dictionary
 hashCode: I1L108
 args: [ ]
]

06:30:39.409 AD.Core.Source.QuoteSource.ISIN:RUR status:Created -> status:Failed error:ErrorInfo:[
 typde: MarketData(12)
 code: InvalidInputArguments(9)
 title: Market data
 msg: #M9I1L108: object by ISIN [SymbolSpec: ISIN:RUR] not found in dictionary
 hashCode: I1L108
 args: [ ]
]",,2.0,Мобильный терминал
ADIRINC-837,2806233,U_M1FPP,Отклонен,21.12.2022 16:15,,,,,Дефект промсреды,17.02.2023 10:32,2023-02-13 00:00:00.0,"Не транслируются позиции по бумагам в текущем дне после покупки актива.

В dbo.balance записи есть, а в bs.position - нет.

Примеры бумаг ниже

 ",,20.0,Core
ADIRINC-836,2803989,U_M1CWM,Закрыт,20.12.2022 19:34,,,,,Дефект промсреды,10.03.2023 12:29,2023-02-08 00:00:00.0,Не кликабельна кнопка «Купоны» в разделах по бумаге RU000A104A39,,,АИ ПРО
ADIRINC-835,2803977,U_M16SR,Закрыт,20.12.2022 19:07,,,,,Дефект промсреды,12.05.2023 15:53,2023-03-27 00:00:00.0,В разделе рынков облигаций при смене на темную тему криво отображается чипса «Корпоративные». При смене на светлую - вообще пропадает,,,Мобильный терминал
ADIRINC-834,2803960,U_M1AYE,Отклонен,20.12.2022 18:33,,,,,Дефект промсреды,16.07.2024 12:24,2023-02-08 00:00:00.0,"В ЛК в рублевой позиции отображается количество, отличное от МТ и Вэб-терминала, из-за чего возникает много вопросов о расхождениях от клиентов",,,НТФ (ЛК)
ADIRINC-833,2802854,U_M16SR,Отклонен,20.12.2022 14:06,,,,,Дефект промсреды,01.03.2023 12:35,2023-03-24 00:00:00.0,"Сейчас, чтобы удалить бумагу из избранного, надо в нее провалиться и убрать её оттуда через раздел «Рынки», но если бумаги нет в Рынках, то удалить ее оттуда не получится.

Версия терминала 2.20.1

Пример бумаги: STFL",,,Мобильный терминал
ADIRINC-832,2798618,U_M1DKF,На исправление,19.12.2022 12:04,,,,,Дефект промсреды,,2023-02-06 00:00:00.0,"Клиент делает вывод ДС на текущий счет в Альфа-Банк

ОР: Вывод проходит успешно
 ФР: На стороне EQ проводка падает в ошибку и ДС не зачисляются, на стороне Альфа-Директа при этом ошибки нет



Дефект заведен на то, что ошибочный статус не возвращается

Пример (в данном случае ошибка из-за неверного Наименования клиента) 
 !image-2022-12-19-12-05-09-854.png!
 !image-2022-12-19-12-05-36-433.png!
{code:java}
select text_result, eq_no, * FROM hell.equision.ADCP_PROD_CP_request where target_account = '40817810211690002029' and tran_no = 33777940 order by crt_date desc
{code}",,2.0,Core
ADIRINC-831,2797198,U_M1AYE,Закрыт,19.12.2022 09:42,,,,,Дефект промсреды,23.01.2023 14:49,2023-02-28 00:00:00.0,В истории портфеля у клиента отображается дата зачисления ДС 0001 год,,3.0,Core
ADIRINC-830,2796443,U_M0WVN,Отклонен,16.12.2022 17:26,,,,,Дефект промсреды,16.07.2024 14:37,2023-02-03 00:00:00.0,"ФР:
1. Клиент хочет выставить заявку но сумма свободных дс у него отображается неактуальная. 
Допинформация:
Причина в том, что по заявкам на размещения у клиента блокируется сумма. Средства заблокированы пока: 
а) идет временной прмежуток между датой закрытия реестра и \\\\\\\\\\\\\\\""техникой\\\\\\\\\\\\\\\""(датой сделки с контрагентом по выставленным заявкам прошедшим по условиям)  
б) какие -то заявки не прошли по условиям и по ним сделок не будет. НО процесс отмены таких производится вручную человеком в вебадмин, регламента четкого нет по времени, но как привило к дате сделок по заявкам с контрагентом их отменяют. То есть день-два они находятся в подвешенном состоянии  и тоже влияют на доступный остаток у клиента при выставлении заявки в МТ
Пока ответственный за мониторинг (в данном случае по размещениям Раков Евгений Владимирович не переведет их в конечный статус ), клиенты видят некорректно свои доступные дс в МТ
!image-2022-12-16-17-02-32-452.png!
!image-2022-12-16-17-25-23-004.png!
 ",,13.0,Core
ADIRINC-829,2795770,U_M0WVN,Закрыт,16.12.2022 15:54,,,,,Дефект промсреды,30.01.2024 12:27,2023-02-27 00:00:00.0,"ФР:
 # Клиент смоттрит дивиденды ближайшие , например Лукоил
 # Видит 1 выплату ближайшую за 2021 год.
 # При этом запланировано 2 выплаты за 2021 и 9 мес. 2022 года
ОР: 
Клиент видит все выплаты, которые запланированы и утверждены.
!image-2022-12-16-15-48-29-250.png!
!image-2022-12-16-15-49-42-380.png!
Для инфо: воспроизводится на IOS и Android
В логах на мидле приходят все выплаты:
[http://amlog/kibana/goto/85b209d0-7d40-11ed-8b86-41fecbdb41e3]
response body=\\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""name\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЛУКОЙЛ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""imageId\\\\\\\\\\\\\\\"" : 174373, \\\\\\\\\\\\\\\""dividendPlan\\\\\\\\\\\\\\\"" : [ { \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2022-12-19T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2022-12-21T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 11.67, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 537000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 0, \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2023-01-10T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2022-12-19T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2022-12-21T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 5.56, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 256000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2022, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 9 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2023-01-10T00:00:00.000+0000\\\\\\\\\\\\\\\"" } ], \\\\\\\\\\\\\\\""dividendHistory\\\\\\\\\\\\\\\"" : [ \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2021-12-17T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2021-12-21T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 5.01, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 340000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2021, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 9 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2022-01-11T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2021-07-01T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2021-07-05T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 3.03, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 213000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2020, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 12 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2021-07-14T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2020-12-16T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2020-12-18T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 0.88, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 46000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2020, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 9 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2020-12-31T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2020-07-08T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2020-07-10T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 6.45, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 350000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2019, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 12 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2020-07-22T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2019-12-18T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2019-12-20T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 3.07, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 192000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2019, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 9 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2020-01-10T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2019-07-05T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2019-07-09T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 2.84, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 155000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2018, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 12 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2019-07-19T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2018-12-19T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2018-12-21T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 1.93, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 95000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2018, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 9 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2019-01-11T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2018-07-09T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2018-07-11T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 2.92, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 130000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2017, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 12 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2018-07-23T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2017-12-20T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2017-12-22T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 2.5, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 85000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2017, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 9 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2018-01-12T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2017-07-06T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2017-07-10T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 4.02, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 120000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2016, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 12 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2017-07-21T00:00:00.000+0000\\\\\\\\\\\\\\\"" }, \\\\\\\\\\\\\\\\{ \\\\\\\\\\\\\\\""lastBuyDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2016-12-21T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""recordDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2016-12-23T00:00:00.000+0000\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""yield\\\\\\\\\\\\\\\"" : 2.18, \\\\\\\\\\\\\\\""amount\\\\\\\\\\\\\\\"" : { \\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"" : 75000000, \\\\\\\\\\\\\\\""currency\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""minorUnits\\\\\\\\\\\\\\\"" : 1000000 }, \\\\\\\\\\\\\\\""year\\\\\\\\\\\\\\\"" : 2016, \\\\\\\\\\\\\\\""period\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""ЗА 9 МЕСЯЦЕВ\\\\\\\\\\\\\\\"", \\\\\\\\\\\\\\\""payDate\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""2017-01-12T00:00:00.000+0000\\\\\\\\\\\\\\\"" } ], \\\\\\\\\\\\\\\""assetId\\\\\\\\\\\\\\\"" : \\\\\\\\\\\\\\\""RU0009024277\\\\\\\\\\\\\\\"" }",,12.0,Мобильный терминал
ADIRINC-828,2792181,U_M1CWM,Закрыт,15.12.2022 16:54,,,,,Дефект промсреды,11.08.2023 17:03,2023-03-21 00:00:00.0,"Коллеги, привет! 
Клиенты обращаются с проблемой, что при 15 мин неактивного состояния выбрасывает на экран авторизации.
Это связано с тем, что токен на аусах живет 15 минут. 
Однако надо обновлять его только когда клиента не находится на экране терминала.
Некоторые клиенты открывают терминал для просмотра графика в фоне",,2.0,АИ ПРО
ADIRINC-827,2792157,U_M0WVN,Отклонен,15.12.2022 16:23,,,,,Дефект промсреды,17.05.2023 11:39,2023-02-02 00:00:00.0,"ФР: Клинет хочет выпустить эцп. При попытке подтвердить по смс, возникает ошибка.

!image-2022-12-15-16-24-05-925.png!

ОР: Подтверить и выпустить сертификат.

Дополнительно :

В логах в эластика ошибок не вижу, вижу как смс формируется: [http://adirelkprod.alfadirect.ru/goto/618b07feb9ed37e63ed0564b41221838]

 

На айбанке вижу те самые сформированные смс: 

!image-2022-12-15-16-26-23-906.png! При этом клиент соощает , что не получал их. Но мне кажется он что то не договаривает, тк статус доставки шлюз получает от самого устройства. По любому дошло. Вопрос в том что за ошибка на фронте возникает? 

Так как сами серты как будто бы выпустились:

!image-2022-12-15-16-30-09-703.png!",,2.0,
ADIRINC-826,2791054,U_M1AYE,Отклонен,15.12.2022 13:17,,,,,Дефект промсреды,05.05.2023 14:38,2023-02-02 00:00:00.0,"Коллеги, привет!
Обратился клиент с проблемой, что в уведомлении висит 2 записи о списании ДС, при этом списание было одно. 
Действительно сервис МФМ возвращает 2 записи
[http://esbwsreco/sms/message/history/v13/rest?clientId=AMUUV8&applicationCode=ADM&messageTypes=AI6]
{code:java}
{
      \\\\\\\\\\\\\\\""internalId\\\\\\\\\\\\\\\"": 448447717134665841,
      \\\\\\\\\\\\\\\""sentAt\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""2022-12-09T17:58:50.000+0300\\\\\\\\\\\\\\\"",
      \\\\\\\\\\\\\\\""channel\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""push\\\\\\\\\\\\\\\"",
      \\\\\\\\\\\\\\\""deliveryChannel\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""push\\\\\\\\\\\\\\\"",
      \\\\\\\\\\\\\\\""status\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""sent\\\\\\\\\\\\\\\"",
      \\\\\\\\\\\\\\\""sourceCode\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""ALFAINVEST\\\\\\\\\\\\\\\"",
      \\\\\\\\\\\\\\\""typeCode\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""AI6\\\\\\\\\\\\\\\"",
      \\\\\\\\\\\\\\\""text\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""- 32 000.00 RUB Списание с брокерского счёта\\\\\\\\\\\\\\\"",
      \\\\\\\\\\\\\\\""pushShortText\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""- 32 000.00 RUB Списание с брокерского счёта\\\\\\\\\\\\\\\"",
      \\\\\\\\\\\\\\\""options\\\\\\\\\\\\\\\"":       {
         \\\\\\\\\\\\\\\""type\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""9\\\\\\\\\\\\\\\"",
         \\\\\\\\\\\\\\\""otp\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""notification_type\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":9,\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""id\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":404073141,\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""id_sub_account\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":2691598,\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""symbol_spec\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""\\\\\\\\\\\\\\\""
      }
   },
      \\\\\\\\\\\\\\\""internalId\\\\\\\\\\\\\\\"": 448455694230099373,
      \\\\\\\\\\\\\\\""sentAt\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""2022-12-10T02:14:07.000+0300\\\\\\\\\\\\\\\"",
         \\\\\\\\\\\\\\\""otp\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""notification_type\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":9,\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""id\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":404171721,\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""id_sub_account\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":2691598,\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""symbol_spec\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""\\\\\\\\\\\\\\\""
   }
{code}
При этом со стороны МФМ сообщили, что это мы дважды вызвали ручку отправки ПУШа
2022-12-09 17:58:50,274 INFO [jetty-msg-rest-1127] [c.m.a.r.PROTOCOL] <---- Content-Type: application/json;charset=UTF-8 Accept: [application/json] Payload:
{\\\\\\\\\\\\\\\""text\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""- 32 000.00 RUB Списание с брокерского счёта\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""type\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""AI6\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""clientId\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""AMUUV8\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""source\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""***\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""deliveryType\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""PUSH\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""pushSendingMode\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""all_devices\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""applicationCode\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""ADM\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""pushAttributes\\\\\\\\\\\\\\\"":{\\\\\\\\\\\\\\\""type\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""9\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""otp\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""notification_type\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":9,\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""id\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":***,\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""id_sub_account\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":***,\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""symbol_spec\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""RUB\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""gcm\\\\\\\\\\\\\\\"":{},\\\\\\\\\\\\\\\""aps\\\\\\\\\\\\\\\"":{\\\\\\\\\\\\\\\""alert\\\\\\\\\\\\\\\"":{}}},\\\\\\\\\\\\\\\""templateParameters\\\\\\\\\\\\\\\"":{},\\\\\\\\\\\\\\\""pushDeviceAddresses\\\\\\\\\\\\\\\"":[\\\\\\\\\\\\\\\""apnj4bugd63qu4tp8ef26oa1mm8oi4eojg\\\\\\\\\\\\\\\""]}
2022-12-10 02:14:07,459 INFO [jetty-msg-rest-2716] [c.m.a.r.PROTOCOL] <---- Content-Type: application/json;charset=UTF-8 Accept: [application/json] Payload:
И теперь в БД МФМ лежит 2 записи, поэтому и возвращается 2. 
Удалять нельзя (требование законодательства)
 ",,1.0,Core
ADIRINC-825,2790173,U_M16SR,Закрыт,15.12.2022 10:40,,,,,Дефект промсреды,06.04.2023 12:40,2023-05-23 00:00:00.0,"В день исполнения фьючерса клиент заходит в терминал и не видит его. 
 Пример фьюч SI-12.22 , он торгуется до 12:00 15.12.2022, а в приложении он пропал с  2022-12-15 00:00:00.000 

!image-2022-12-15-10-41-12-286.png!
!image-2022-12-15-10-40-51-963.png!",,1.0,Мобильный терминал
ADIRINC-824,2789374,U_M172H,Закрыт,14.12.2022 20:32,,,,,Дефект промсреды,06.04.2023 15:25,2023-02-02 00:00:00.0,"Клинеты жалуются на отсутствие сделок/выплат/поступлений в разделе История в АИ

В hell.trades записано сделок много больше, чем в oper_cache.hell.trades

Далее скрины из архива и из operations_cache:

 
||!image-2022-12-19-10-42-04-927.png!||Heading 2||

!image-2022-12-19-10-42-47-036.png!

 

Примеры:

1. 1392393 AS387U Крылов Алексей Александрович

Версия мт: 2.19.0

!image-2022-12-14-20-22-06-457.png!!image-2022-12-14-20-22-22-303.png!

!image-2022-12-14-20-22-40-188.png!

2.   4373188 Данилов Сергей Валерьевич AVUCGL.
 Пополнял счет 7.12 на 400 рублей, данная сумма не отображена в МТ в разделе ""История""

2.19.0

!image-2022-12-14-20-23-56-629.png!!image-2022-12-14-20-24-13-658.png!

3. 

4470177 Сычёв Игорь Владимирович AVUZZW

android 2.19.0.

У клиента в истории не отображается информация о погашение облигации 11.11, RU000A101178

!image-2022-12-14-20-25-52-088.png|width=215,height=450!!image-2022-12-14-20-26-14-248.png|width=231,height=397!!image-2022-12-14-20-26-42-293.png|width=277,height=506!

4.",,92.0,Core
ADIRINC-823,2789029,U_M1AYE,Закрыт,14.12.2022 17:27,Фронт,,,,Дефект промсреды,20.03.2023 15:49,2023-04-07 00:00:00.0,На главной в виджете неправильное название у «Лукойл»,,,Мобильный терминал
ADIRINC-822,2788101,U_M1CWM,Закрыт,14.12.2022 15:04,,,,,Дефект промсреды,12.01.2023 17:05,2022-12-16 00:00:00.0,"Добрый день! 

При выставлении заявки по US98387E2054 в стоимость заявки сумма умножается на курс USD.

В bs.Objects ликвидный рынок 92 (для которого валюта - рубли)
В ВТ приходит 116, для которого установлена валюта - USD
!image-2022-12-14-15-02-45-749.png!

!image-2022-12-14-15-03-18-490.png!

 ",,5.0,АИ ПРО
ADIRINC-821,2785247,U_M173X,Отклонен,13.12.2022 15:47,,,,,Дефект промсреды,12.03.2024 11:13,2023-04-06 00:00:00.0,"Добрый день! 

По активам эмитента VK не запрашивается изображение.
Из-за чего отображается заглушка
!image-2022-12-13-15-46-42-724.png!

В девтуле действительно нет запроса изображения для этого эмитента.

!image-2022-12-13-15-45-14-220.png!",,2.0,АИ ПРО
ADIRINC-820,2784573,U_M1BFA,Закрыт,13.12.2022 14:03,,,,,Дефект промсреды,12.01.2023 17:13,2023-01-31 00:00:00.0,"У клиента отображается 0 стоимость позиции по фьючерсу HOME-12.22
В БД и девтуле ничего необычного не увидел. ПО аналогии с другими инструментами, все совпадает.

!image-2022-12-13-14-01-42-638.png!",,1.0,АИ ПРО
ADIRINC-819,2781363,U_M1EP6,Отклонен,12.12.2022 14:54,,,,,Дефект промсреды,13.04.2023 14:11,2023-03-16 00:00:00.0,"На рынке в графиках активов не отображаются свечи за дату 09.12.2022.

В примерах отсутствуют по USD, гонгконгскому доллару и фьючерсу si-3.23

Скриншоты все 12.12.2022",,4.0,Core
ADIRINC-818,2781241,U_M17A7,Закрыт,12.12.2022 14:46,,,,,Дефект промсреды,17.05.2023 11:23,2023-01-30 00:00:00.0,"При открытии счета автоматически не открывается рынок ОТС НДЦ
пример ГС 2718467 
select * from adfront.[dbo].[Razdels] where IdAccount = 2718467 select * from adfront.[dbo].[RazdelTypes]",,,Core
ADIRINC-817,2778200,U_M0WVN,Закрыт,10.12.2022 21:33,,,,,Дефект промсреды,22.08.2023 16:19,2023-01-30 00:00:00.0,"У клиента задвоенные операции в Истории


 Пример скрин:
 AAMHWD 72886
 !image-2022-12-10-21-32-00-541.png!
 !image-2022-12-10-21-31-26-835.png!",,38.0,Личный кабинет
ADIRINC-816,2778195,U_M177U,Отклонен,10.12.2022 19:31,,,,,Дефект промсреды,22.02.2023 14:37,2023-01-30 00:00:00.0,"Из-за отключения отображения бумаг Meta у клиентов, у которых были эти бумаги в МТ при просмотре портфеля появляется всплывашка о том, что портфель отображается некорректно.",,,Мобильный терминал
ADIRINC-815,2778191,U_M1AYE,Закрыт,10.12.2022 14:08,,,,,Дефект промсреды,10.01.2024 15:26,2023-03-16 00:00:00.0,"Клиент формирует отчет за период, который по временным рамкам шире, чем дата открытия счёта клиента, предположительно из-за этого крашится формирование отчёта
На примере клиента 3872386  его счёт был открыт 21 марта 2022 года, отчет формируется с 01.01",,6.0,Личный кабинет
ADIRINC-814,2778190,U_M00ZM,На исправление,10.12.2022 13:14,,,,,Дефект промсреды,,2023-03-16 00:00:00.0,После покупки ЦБ при просмотре доходности за сегодня рассчитывается некорректная сумма,,22.0,Core
ADIRINC-813,2777523,U_M1DQU,Отклонен,09.12.2022 17:56,,,,,Дефект промсреды,22.12.2022 11:36,2023-01-27 00:00:00.0,"При попытке выставить заявку на продажу облигацию по рыночной цене, некорректно считается сумма заявки

Похожий кейс обсуждался тут https://rc.alfa-bank.net/channel/support-adir-trading-services?msg=BZCJzaq45t84THhuK",,,Мобильный терминал
ADIRINC-812,2776909,U_M0W2X,Отклонен,09.12.2022 14:45,,,,,Дефект промсреды,22.12.2022 12:41,2023-01-27 00:00:00.0,"При попопытке купить Казахстанский тенге на сумму от 1 млн рублей, не правильно отражается объем выставляемой заявки в МТ. Объем в 100 раз меньше чем заявка. Объем заявки на 1 млн руб, отображается что покупает на 10000 руб.",,1.0,Core
ADIRINC-811,2776445,U_M1AYE,Отклонен,09.12.2022 12:50,,,,,Дефект промсреды,11.09.2024 10:52,2023-01-27 00:00:00.0,"В ДТ при отрисовке свеч текущая цена моментами произвольно меняется, а затем возвращается на прежний уровень",,,Core
ADIRINC-810,2776328,U_M1FE1,Закрыт,09.12.2022 12:33,,,,,Дефект промсреды,15.04.2024 10:33,2023-03-15 00:00:00.0,"В календаре инвестора не отображается информация по выплате купонов, хотя информация в базе есть 


 Пример RU000A103C46, выплата 30.12, в календаре инвесторе информации нет, 
 в hell.actives.couponredemptionschedule информация по выплате есть",,80.0,Сатурн
ADIRINC-809,2774473,U_M1BFA,Отклонен,08.12.2022 17:17,,,,,Дефект промсреды,08.12.2022 18:04,2023-01-26 00:00:00.0,"ФР: Клинет хочет выпустить эцп. Ждет смс, вводит и его перекидывает на страницу авторизации, после ввода логопаса, возникает ошибка.

ОР: Подтверить и выпустить сертификат.

Дополнительно : прикладываю видео по себе с IOS в сафари:

[^video5229048354175983928.mp4]

Ошибок в логах в эластике не нашел. При этом с компа в гугл хром выпустил сертификат.

Так же пример клиента, которому не уходит смс совсем при попытке подтвердить сертификат ГС 5668229

 ",,3.0,АИ ПРО
ADIRINC-808,2773520,U_M1782,Закрыт,08.12.2022 15:22,,,,,Дефект промсреды,22.01.2023 18:00,2023-02-15 00:00:00.0,"Клиент заходит в раздел Аналитика: Состав портфеля 

ОР: Состав портфеля отображается корректно 

ФР: отображается ошибка ""Кое-что сломалось""

Пример ГС 1755523 Android 2.19.0, 

!image-2022-12-08-15-22-28-711.png!",,0.0,Мобильный терминал
ADIRINC-807,2771236,U_M1CWM,Закрыт,07.12.2022 22:40,,,,,Дефект промсреды,16.02.2023 17:07,2023-01-26 00:00:00.0,"ФР: У клиентов в портфеле отображается 0 при входе в веб-терминал

!image-2022-12-07-22-37-27-251.png!

ОР: Клиент должен видеть весь портфель

Дополнение:

В логах видим , что сломалась одна из бумаг, в частности по ней при запросе мультирынков перестал приходить IdObject , а точнее приходит пустое значение в списке - """"

!image-2022-12-07-22-36-51-244.png!

[http://adlog1/kibana/goto/aaa18fd0-7666-11ed-8175-533c5d667b1c] (logview/weigol)

В веб-терминале при такой ситуации у клиента ломается весь портфель целиком и он перестает видеть ВСЕ бумаги.

Необходимо обработать этот кейс так, чтобы не падал весь портфель, а к примеру только одна бумага (желательно, чтобы было видно какая)",,1.0,АИ ПРО
ADIRINC-806,2770208,U_M1DQU,Отклонен,07.12.2022 16:56,,,,,Дефект промсреды,21.12.2022 11:24,2023-01-25 00:00:00.0,"У клиента не отображается кнопка ""Портфель"" в разделе ""Календарь инвестора""

Отображение регулируется на фронте 
{code:java}
Проверить результат ITradePosition (библиотека Белова), если в портфеле клиента на текущем субсчёте есть облигации или акции, то вывести ChipElement ""Портфель"". Если нет, чипсу не отображать.
{code}
У клиента есть акции, при этом раздел не отображается.
!image-2022-12-07-16-50-27-563.png|width=339,height=498!
 |SessionID|Login|ClientVersion|DeveloperCode|ProtocolVersion|OSVersion|OSType|DeviceModel|MacAdress|IdDevice|
|13965072171|ksahipov|2.19.0|101394178_5DD58414-A519-43E5-B1F0-D32CEE0DC67E|9.93|10|4|MI 8| |5cebb1dc-89dc-3a5e-8a4d-4200a10a232a|

 ",,,Мобильный терминал
ADIRINC-805,2770250,U_M173X,Закрыт,07.12.2022 16:13,,,,,Дефект промсреды,28.04.2023 11:25,2023-02-14 00:00:00.0,"Клиент пытается зайти в приложение:

ОР: клиент успешно заходит
 ФР: у клиента ошибка ""Произошла ошибка. попробуйте еще раз.""

Проблема на версии 2.19.0 (21819029)

В метриках по клиенту ошибка ""A7I1L71"" 

!image-2022-12-07-16-13-20-785.png!!image-2022-12-07-16-13-54-789.png!
  ",,13.0,Мобильный терминал
ADIRINC-804,2769863,U_M18JH,Отклонен,07.12.2022 15:13,,,,,Дефект промсреды,16.02.2023 09:49,2023-01-25 00:00:00.0,"При авторизации клиент получает ошибку «Сервис недоступен»

По метрикам логируется ошибка A7I1L71

msg: #A7I1L71: !settings.deviceModel.empty():

Ошибка проявляется на версии 2.19, похоже, что только на 12 андроиде",,3.0,Мобильный терминал
ADIRINC-803,2765515,U_M1E0U,Отклонен,06.12.2022 16:25,,,,,Дефект промсреды,06.12.2022 16:32,2023-01-24 00:00:00.0,"Добрый день! 

Клиент не может продать подарочную акцию. Ошибка на микросервисе BROKER_ACCOUNTS_NOT_FOUND.

При этом в запросе с шины БС вернулись. 
{code:java}
---------------------------- Address: http://esbwsreco/eq/customer/accounts/v11/rest?cus=AR4GR2&ean=3060&act=GK&onlyactive=Y&tag=arrest&tag=oad Http-Method: GET Headers: [Accept:""application/json"", Content-Type:""application/json"", X-External-System-Code:""ADMT"", X-External-User-Code:""GIFTS-API-I1"", X-UserID:""WSMT"", X-BranchNumber:""0000"", X-B3-TraceId:""27108c306a5769f0"", X-B3-SpanId:""db80425d5db33f3f"", X-B3-ParentSpanId:""27108c306a5769f0"", X-B3-Sampled:""0""] 
----------------------------
{code}
{code:java}
---------------------------- Status: 200 OK Headers: [X-Powered-By:""Servlet/3.1"", X-HP-CAM-COLOR:""V=1;ServerAddr=6lAMMRmJ1jzASc8ORpj6+A==;GUID=1|yrBHeFjgYTqI6_a-fbU6IBuW5LV5E8VinPCwdezM4i0.|L2VxL2N1c3RvbWVyL2FjY291bnRzL3YxMS9yZXN0"", Cache-Control:""no-cache"", Content-Type:""application/json"", Date:""Mon, 05 Dec 2022 12:04:29 GMT"", Content-Language:""en-US"", Transfer-Encoding:""chunked""] Payload: [{""ean"":""30601810800036385665"",""act"":""GK"",""ccym"":""RUR"",""buh"":""100"",""ama"":0,""total"":0,""oad"":""2022-12-02""},{""ean"":""30601840100036385665"",""act"":""GK"",""ccym"":""USD"",""buh"":""100"",""ama"":0,""total"":0,""oad"":""2022-12-02""},{""ean"":""30601978700036385665"",""act"":""GK"",""ccym"":""EUR"",""buh"":""100"",""ama"":0,""total"":0,""oad"":""2022-12-02""}]{code}",,,Мобильный терминал
ADIRINC-802,2765450,U_M1E0U,Закрыт,06.12.2022 15:27,,,,,Дефект промсреды,09.02.2023 11:58,2023-02-13 00:00:00.0,"Добрый день! 

Обращается клиент с проблемой продажи подарочных акций.
Выходит сообщение: Нет счетов. 

При этому у клиента есть текущие счета, но начинаются они с 42301, а в ручке на шину мы фильтруем только 40817. 

Кажется, не все счета 42301 в нашей системе являются счетами-депозитами
!image-2022-12-06-15-24-47-674.png|width=1187,height=352!",,,Мобильный терминал
ADIRINC-801,2763990,U_M173X,Закрыт,06.12.2022 12:24,,,,,Дефект промсреды,13.04.2023 10:24,2023-03-10 00:00:00.0,"Клиент заходит в приложение 

ОР: отображаются только открытые счета

ФР: отображается закрытый счет

Ссылка на обсуждение [https://rc.alfa-bank.net/channel/a-inv-mt?msg=icBzbQMDckPevzFea]

Пример ГС 4340015

  !image-2022-12-06-12-25-18-602.png!!image-2022-12-06-12-25-38-662.png!

 ",,2.0,Core
ADIRINC-800,2753400,U_M19LL,Закрыт,01.12.2022 17:04,,,,,Дефект промсреды,13.04.2023 16:39,2023-01-19 00:00:00.0,"Клиенты жалуются на то что размер купона в 100 раз выше.
Для примера :
В чат обратился клиент 4345258 Антипова Анна Александровна AVTUX4В МТ android 2.18.2 некорректно отображаются купоны по облигации Газпром капитал 3034-1-д RU000A105А95 (скрин во вложении)На бирже Размер выплаты в валюте номинала - 43,13 USD, в МТ 4313 USD, доходность верно отображена.",,2.0,Core
ADIRINC-799,2750438,U_M1BFA,Закрыт,30.11.2022 19:28,,,,,Дефект промсреды,16.02.2023 17:12,2023-01-19 00:00:00.0,"Добрый день! 

В веб-терминале евровая позиция отображается как рубль, из-за чего у клиента баланс портфеля отличается от МТ.

RU000A105C51 (idObject:)
RU000A105146 (idObject:)

Веб-терминал (trade.alfadirect.ru)

!image-2022-11-30-19-20-33-227.png|width=343,height=282!

МТ
!image-2022-11-30-19-22-00-895.png|width=345,height=748!",,,АИ ПРО
ADIRINC-798,2750112,U_M1AYE,Отклонен,30.11.2022 18:50,,,,,Дефект промсреды,26.12.2022 11:32,2023-03-06 00:00:00.0,При расчете комиссии за заявку с одинаковым объемом считается разная комиссия,,4.0,Мобильный терминал
ADIRINC-797,2749697,U_M1E0U,Закрыт,30.11.2022 16:45,,,,,Дефект промсреды,02.03.2023 16:23,2023-02-07 00:00:00.0,"{color:#172b4d}Не фильтруются счета по параметру bah, из-за чего попадают зарезервированные счета{color}

 

!image-2022-11-30-16-41-48-201.png!",,,Мобильный терминал
ADIRINC-795,2746425,U_M0WVN,Закрыт,29.11.2022 21:32,,,,,Дефект промсреды,12.05.2023 14:39,2023-01-18 00:00:00.0,"Клиент смотрит аналитику портфеля в МТ андроид.

Хочет увидеть поступление 153000Р, которое он делал вчера 28.11

ОР: 29.11 увидеть поступление в разделе операции аналитики портфеля

ФР: этого поступления ДС на БС нет в аналитике портфеля

Допинфо:

!image-2022-11-29-21-26-34-009.png!

 

!image-2022-11-29-21-27-14-228.png!",,3.0,Core
ADIRINC-794,2746394,U_M1E0U,Отклонен,29.11.2022 20:10,,,,,Дефект промсреды,30.11.2022 09:51,2023-01-18 00:00:00.0,"ОР: выплата производится на текущий рублевый счет.

ФР: пытается выплатиться на текущий в Юанях

Пример; 6003401 ГС

Возникает ошибка при попытке продать android Версия МП: 2.17.1 :

!image-2022-11-29-20-10-11-141.png!

[http://adlog1/kibana/goto/3a1509e0-7008-11ed-8175-533c5d667b1c]

!image-2022-11-29-20-07-25-040.png!

!image-2022-11-29-20-08-39-744.png!",,,Мобильный терминал
ADIRINC-793,2744996,U_M1AYE,Закрыт,29.11.2022 15:14,,,,,Дефект промсреды,26.12.2022 14:49,2023-02-06 00:00:00.0,"При попытке продажи подарочной акции клиент получает сообщение, что заявка не исполнена и акции не проданы.

По логам найдена проблема в том, что сервис некорректно выбирает transferAccountNumber:

по клиенту от uws сервиса при запросе ""http://esbwsreco/eq/customer/accounts/v11/rest?cus=AUFLCI&ean=40817&act=EE&act=EH&act=GZ&act=MH&onlyactive=Y&tag=arrest&tag=oad""

вернулись два счёта EE 

{""ean"":""40817810705681240238"",""act"":""EE"",""ccym"":""RUR"",""buh"":""100"",""ama"":58,""total"":58,""oad"":""2021-10-05""},\{""ean"":""40817840805680006178"",""act"":""EE"",""ccym"":""USD"",""buh"":""100"",""ama"":0,""total"":0,""oad"":""2022-03-24""}

из которых выбрался долларовый счёт, на который мапл не смог начислить ДС

response body={
""transferAccountNumber"" : ""··6178""}

 
campaignId: ""62dff919c49d82ba1502af61""",,7.0,Мобильный терминал
ADIRINC-792,2735622,U_M00ZM,Отклонен,25.11.2022 12:41,,,,,Дефект промсреды,25.11.2022 12:46,2023-01-13 00:00:00.0,Из-за поставок EQ 23/11/2022 в рамках заявки 650665-22 в Директе не работали пополнения\выводы ДС. EQ робот не получал данные со стороны EQ,,,Core
ADIRINC-791,2733890,U_M1AYE,Закрыт,24.11.2022 18:30,,,,,Дефект промсреды,13.04.2023 15:41,2023-01-13 00:00:00.0,У клиента при загрузке портфельной аналитики в разное время в течение дня отображается сильно разнящаяся информация,,5.0,Core
ADIRINC-790,2733805,U_M00ZM,На исправление,24.11.2022 18:13,,,,,Дефект промсреды,,2023-02-28 00:00:00.0,"Добрый день! 

Откуда-то в ADDataFeed.dbo.Alltrades появилась сделка, которой нет в котировках на бирже. 

Из-за этого у клиентов, у которых есть данная позиция, изменилась текущая цена и инструмента, в следствии чего некорректно отображается стоимость портфеля и доходность, так как данная сделка транслируется ADDataFeed.AllTrades.LastTrades, а оттуда в ADfront.fi.FinInfoExt

Также данная сделка отображается на графиках в терминала

!Clipboard - 24 ноября 2022 г., 10_19.png!
{code:java}
select * from ADDataFeed.AllTrades.LastTrades where idfi = 218283 and tradetime < '2022-11-23 13:10:09.000' order by tradetime desc
select * from ADDataFeed.dbo.Alltrades where idfi = 218283 and tradetime < '2022-11-23 13:10:09.000' order by tradetime desc
{code}
 Проблема задевает 1662 клиента",,41.0,Core
ADIRINC-789,2731604,U_M1DKF,Закрыт,24.11.2022 11:19,,,,,Дефект промсреды,20.01.2023 14:52,2022-12-16 00:00:00.0,"# Клиент заходит в ЛК Директа
 # Видит ошибку internal server errror + пропала вся витрина размещений

ОР: Ошибок быть не должно

ФР: При заведении новых размещений в БД ошиблись и внесли одно из полей , которое не ожидается в ЛК.

Падает вся витрина целиком.

 

Необходимо подумать как при таких кейсах сохранить отображение других инструментов на витрине и исключить возникновение неформализованной ошибки типа :""internal server errror"" при входе. 

Предлагаю писать, что-то типо: ""В настоящее время на витрине размещений отображаются не все инструменты""

 ",,,Личный кабинет
ADIRINC-788,2727249,U_M1AYE,Отклонен,22.11.2022 18:27,,,,,Дефект промсреды,05.05.2023 14:31,2023-01-31 00:00:00.0,"В разделе ""Заявка"" по инструменту  некорректно отображаются кнопки ""Купить и Продать"".
Сверу указано ""Продажа"" снизу ""Купить"".",,,Мобильный терминал
ADIRINC-787,2727248,U_M1AYE,Отклонен,22.11.2022 18:25,,,,,Дефект промсреды,05.05.2023 14:31,2023-01-31 00:00:00.0,"В разделе ""Заявка"" по инструменту  некорректно отображаются кнопки ""Купить и Продать"".
Сверу указано ""Продажа"" снизу ""Купить"". !image-2022-11-22-18-18-49-638.png!",,,Мобильный терминал
ADIRINC-786,2727247,U_M1AYE,Закрыт,22.11.2022 18:21,,,,,Дефект промсреды,12.05.2023 15:04,2023-01-11 00:00:00.0,"В разделе ""Заявка"" по инструменту  некорректно отображаются кнопки ""Купить и Продать"".
Сверу указано ""Продажа"" снизу ""Купить"". !image-2022-11-22-18-18-49-638.png!",,,Мобильный терминал
ADIRINC-785,2723344,U_M0WVN,Закрыт,21.11.2022 18:13,,,,,Дефект промсреды,12.05.2023 14:44,2023-01-10 00:00:00.0,"Шаги воспроизведения:
 # Клиент выбирает таймфрейм, например, по инструменту RU000A0JSQ90 (месячный)

ОР: Предполагает увидеть соответствующий график цен

ФР: График за данный месяц с таким таймфреймом отсутствует.

Допинфо:

select * from addatafeed.dbo.candles where IdFI = 231277 and Time >= getdate() - 300 order by Time desc

Выясняется , что данных нет по инструментам за июнь+октябрь с месячным таймфреймам в бд.

[^IMG_6521.MP4]

^!IMG_6520.jpg!^",,13.0,Core
ADIRINC-784,2718761,U_M177U,Отклонен,18.11.2022 23:53,mobile_terminal,,,,Дефект промсреды,09.02.2023 13:14,2023-01-09 00:00:00.0,"Клиент заходит в Переводы
ОР: у клиента открывается форма для перевода
ФР:  у клиента появляется белый экран

Пример AQ4YMA , AQL03O. Версия приложения 2.18.0, 2.17.1

!image-2022-11-18-23-51-03-481.png!",,10.0,Мобильный терминал
ADIRINC-783,2718735,U_M1BF4,На исправление,18.11.2022 19:58,,,,,Дефект промсреды,,2023-01-09 00:00:00.0,"На графике не отображается цена покупки. 
Для примера: У клиента 769728-000 не отображается цена покупки по распискам Эталон ",,46.0,Мобильный терминал
ADIRINC-782,2712976,U_M1DKL,NEW,17.11.2022 11:13,,,,,Дефект промсреды,,2024-08-23 00:00:00.0,"Клиент заходит в чат Альфа-Инвестиций:
ОР: чат работает, подтягивается история сообщений
ФР: чат работает, но история сообщений не подтягивается, вместо этого ошибка \\\\\\\\\\\\\\\""Не получилось загрузить историю\\\\\\\\\\\\\\\""
Проблема только на iOS 2.17.0 из-за проблемы в токене кроссавторизации для чата
Исправить можно только новым релизом, что сейчас сделать нельзя. Как временное решение, клиенту необходимо перелогиниться для создания нового токена
!image-2022-11-17-11-07-12-131.png!",,26.0,Matterhorn
ADIRINC-780,2712192,U_M1CYD,Закрыт,17.11.2022 10:05,,,,,Дефект промсреды,06.04.2023 17:15,2022-12-29 00:00:00.0,"Клиент заходит в приложение -> портфель до 10 утра и видит отображение плашка с срочными маржинальными требованиями, при этом у клиента их нет и после наступления основной торговой сессии плашка пропадает. Требование тянется из таблицы adfront.ts.MarginRequirements

Пример клиент 4249144 
!image-2022-11-17-10-06-00-821.png!
!image-2022-11-17-10-05-51-330.png!

!image-2022-11-17-10-05-40-907.png!",,126.0,Core
ADIRINC-779,2711332,U_M0WVN,Закрыт,16.11.2022 15:31,,,,,Дефект промсреды,13.04.2023 17:49,2022-12-28 00:00:00.0,"Для CLS заявок выставляется WithdrawTime за пределами торгового времени.

И раньше их переводил в неактивный статус джоб, который по ночам проверяет время жизни заявок. Но сейчас этот джоб отключили, и всю работу должен был выполнить СУЗ. Но он игнорирует правила на WithdrawTime для такого IdLifeTime",,1.0,Core
ADIRINC-778,2708285,U_M1AYY,Закрыт,15.11.2022 17:58,,,,,Дефект промсреды,14.02.2024 18:04,2023-01-23 00:00:00.0,"Добрый день! 
Обращаются клиенты с проблемой отображения УЦ после кор. действий.
Выяснилось, что из-за доначислений дроби, УЦ стала аномально высокой.  
!image-2022-11-15-17-56-39-811.png!
 
{code:java}
select * from a_hell_opers.dbo.a_all_transfers where acc_code = '4532944-000' and p_code = 'SBIA'{code}
Для корректировки необходимо что-то сделать с доначислением. 
Либо удалить запись, а дробь добавить к основному, либо скорректировать УЦ перевода для дроби.
Обсуждали в https://rc.alfa-bank.net/channel/adir_duty?msg=d9cbNEat88zLWTBaQ",,2.0,Core
ADIRINC-777,2708114,U_M1AGU,Закрыт,15.11.2022 17:03,,,,,Дефект промсреды,17.11.2022 16:42,2023-01-23 00:00:00.0,"Клиент запрашивает аналитику по портфелю советнику и получает стандартную ошибку «Нужен второй заход». Ошибка возникает из-за проблем с определением marketboardName у бумаги RU000A102E78  в сервисе [adir-sovetnik-portfolio-rebalance|https://git.moscow.alfaintra.net/projects/ADIR_CORE/repos/adir-sovetnik-portfolio-rebalance/browse]

[https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=EsGPwRBgom6LWGsm6]

Логи:
 [http://adirelkprod.alfadirect.ru/goto/fc6ce1c2f6c0b6a2d637fa590fe1dacc]",,,Core
ADIRINC-776,2707414,U_M173X,Закрыт,15.11.2022 15:18,,,,,Дефект промсреды,03.07.2024 11:36,2022-12-27 00:00:00.0,"Клиент заходит в приложение, проваливается в инструмент в вкладку Сводка
ОР: текущая цена по инструменту должна меняться
ФР: цена не меняется, приходится перезаходить в приложение
iOS 2.17.0
Проблема возникает с инструментом RUO00A0JKQU8, у себя воспроизвести не удалось",,5.0,Appalachians
ADIRINC-775,2704724,U_M1DKF,Закрыт,14.11.2022 19:14,,,,,Дефект промсреды,20.03.2023 12:02,2023-02-14 00:00:00.0,"При попытке восстановить логин\пароль по ФИО и номеру телефона клиент получает заглушку, что информация по нему не найдена.

Проблема возникает из-за того, что сервис WSCustomerSearchClients11 вызывается с параметрами <ucd>001</ucd> , а у клиента нет российского паспорта: без указания этого параметра сервис данные по клиенту находит.",,,Core
ADIRINC-774,2703640,U_M1CWM,Закрыт,14.11.2022 14:24,,,,,Дефект промсреды,19.01.2023 17:17,2022-12-26 00:00:00.0,,,,АИ ПРО
ADIRINC-773,2698830,U_M1AYY,Отклонен,11.11.2022 12:48,,,,,Дефект промсреды,26.01.2023 16:53,2022-12-23 00:00:00.0,"Добрый день! 

У клиентов не учитывается налоговая детализация, если в переводе в 
 a_hell_opers.dbo.a_all_transfers поля bp_* не равны NULL.
 Из-за чего по каждому клиенту приходится руками просить апдейтить данные значения. 

Необходимо реализовать процесс, в котором при наличии данных в  hell.tax.interface_income_detail по данному переводу уц считается на основании детализации, в независимости от того, какие значения в bp_*

Очень большое кол-во клиентов (182589), у которых в переводе не равны NULL поля bp_*, и при этом есть детализация. Это все потенциальные обращения в поддержку
{code:java}
select distinct count(trn.acc_code)
from a_hell_opers.dbo.a_all_transfers trn
left join hell.tax.interface_income_detail tax
ON trn.trn_no = tax.trn_no
and trn.acc_code = tax.acc_code
where bp_percent is not null and bp_rub is not null and bp_usd is not null and bp_eur is not null   and id is not nulland tran_type = 'EXTRA'
and db_date > '2022-07-01'
{code}
 

 ",,,Core
ADIRINC-772,2694692,U_M1CYD,Закрыт,10.11.2022 12:02,,,,,Дефект промсреды,06.04.2023 16:55,2022-12-22 00:00:00.0,"У клиента на РЦБ доступен баланс 11:35, а на ФОРТС -11:28, он хочет погасить минус, сделав перевод с РЦБ на ФОРТС
ОР: клиент успешно переводит ДС
ФР: клиенту после нажатия кнопки по 'Перевести' сплывает ошибка ""Кое что сломалось""

В логах ЛК ошибка о нехватке средств

В логах расчета лимита во время вывода есть две записи, в одной лимит проходит, а в другой нет 
[https://alfaadmin/reporting/orderlimitlog/1040631538]
https://alfaadmin/reporting/orderlimitlog/1040631537

Пример ГС 183158 10.11.2022 08:52:22

!image-2022-11-10-12-00-24-634.png!",,2.0,Core
ADIRINC-771,2692348,U_M0NT4,Отклонен,09.11.2022 14:33,,,,,Дефект промсреды,11.08.2023 16:56,2022-12-21 00:00:00.0,"Добрый день! 
Обращаются клиенты с проблемой расчета УЦ для сплитованных инструментов. 
В момент корп-действия не создается запись в таблице hell.[dbo].[splits] из-за чего УЦ отображается на день перевода. 
Необходимо реализовать процесс создания записи в таблице в момент формирования корп. действия депозитарием и возможность редактирования записей в данной таблице через Альфа-Админ. ",,2.0,Core
ADIRINC-770,2686064,U_M1CUE,Отклонен,07.11.2022 17:33,desk_terminal,,,,Дефект промсреды,11.09.2024 10:53,2022-12-19 00:00:00.0,"Добрый день! 
В Т4.0 версия 4.0.3584.1946 при добавлении нового тикера в список котировок автоматически меняется рынок у большинства уже ранее добавленных инструментов. Автоматически по инструментам проставляется рынок СПб, клиент вручную меняет на МБ ЦК. Как только добавляет новый, некоторые инструменты встают опять в рынок СПб.
1-й скрин - как отображается до добавления нового тикера
2-й скрин -после добавления
 ",,1.0,АИ ПРО
ADIRINC-766,2676302,U_M1CE2,Отклонен,02.11.2022 18:13,mobile_terminal,,,,Дефект промсреды,02.05.2023 10:28,2022-12-16 00:00:00.0,"Добрый день! 
Наблюдаем проблему с инструментом RU000A1055M9
Не приходит рынок в multi-markets-api, из-за чего в портфеле на андройде он с 0 ценами (текущей, учетной, доходностью и пр.), а на ios в бесконечной загрузке. 
Клиент 139731
Инструмент RU000A1055M9
multi-markets-api:
{code:java}
Запрос
curl 'http://adappn2:27044/markets' -X POST -d '{\\\\\\\\\\\\\\\""symbolObjects\\\\\\\\\\\\\\\"" : [\\\\\\\\\\\\\\\""ALFBd050825\\\\\\\\\\\\\\\""]}' -H 'AUTH-USER-ID: AUONUA' -H 'Content-Type: application/json' | jq
Ответ:
[]{code}
adir-production-dotnet-multi-markets-asset-info
 
Запрос:
Тип команды: 'StoredProcedure'
Текст команды: '[actives].[get_symbol_trade_boards]'
Входные параметры: '[{\\\\\\\\\\\\\\\""name\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""symbol_list\\\\\\\\\\\\\\\"",\\\\\\\\\\\\\\\""value\\\\\\\\\\\\\\\"":[{\\\\\\\\\\\\\\\""symbol_object\\\\\\\\\\\\\\\"":\\\\\\\\\\\\\\\""ALFBd050825\\\\\\\\\\\\\\\""}]}]'
Ответ: Актив имеет более одного дефолтного рынка на бирже
{code}
У инструмента действительно несколько ликвидных рынков.
Это нормальная ситуация. Надо запрашивать рынки с учетом позиции клиента. 
!image-2022-11-02-18-12-21-848.png!",,3.0,Core
ADIRINC-765,2675112,U_M157D,NEW,02.11.2022 14:17,,,,,Дефект промсреды,,2022-12-15 00:00:00.0,"Добрый день! 

В Альфа-МоОбайле у клиентов отображается 0 цена по инструменту US29760G1031, так как сервис за шинным методом /adir/assetprices/v10/rest возвращает 0
{code:java}
{      
    ""assetId"": ""US29760G1031"",     
    ""assetCode"": ""US29760G1031"",      
    ""price"": 0,   
    ""delayedPrice"": 0,   
    ""priceCurrency"": ""USD""   
}{code}
При этом цена у инстурмента есть
!image-2022-11-02-14-16-40-444.png!
Есть ощущения, что сервис берет цену не из нужного поля.
Подозреваю, что таких инструментов не мало. ",,14.0,Core
ADIRINC-764,2672658,U_M173X,Закрыт,01.11.2022 17:14,,,,,Дефект промсреды,17.05.2023 17:00,2022-12-14 00:00:00.0,"* 
 {{При запросе нескольких таблиц ДК с помощью процедуры ADFront.dbo.DataCacheGetData ДК ожидает столько таблиц, сколько он запросил  и в том порядке, как они перечислены в параметре процедуры @TableListЕсли по какой-то причине при обработки очередной таблицы возникает ошибка, то она логируется в  процедуре ADFront.dbo.DataCacheGetData в таблице dbo.ErrorInfoLog, но выполнение процедуры не прерывается, и порядок возвращаемых таблиц смещается.

К примеру был такой вызов :

 EXEC dbo.DataCacheGetData @TableList = 'Objects,159624154484,ClientObjectBalanceIdFI,159685946167,FinInstruments,159623958771,ObjectGroups,109822387102,ObjectTypes,109822387103,ObjectExt,159685946167,TSObjects,159685948629,TSMarginPaperCoefs,158639649097,TSMarginPaperRiskRates,158639700680',@Delimeter = ',' Лог показал такую для всех трех ДК

SELECT * FROM dbo.ErrorInfoLog
WHERE ErrorProcedure = 'dbo.DataCacheGetData'AND DAte >= '2022-10-31 13:53:06' AND  DAte < '2022-10-31 13:53:07'  Строка 551 это обработка сущности Objects:После получения ошибки Lock request time out period exceeded в блоке CATCH процедура продолжила свою работу и успешно обработала следующую сущность ClientObjectBalanceIdFI, которую ДК интерпретировал как сущность Objects !

В Objects кол-во полей возвращается существенно больше, чем в ClientObjectBalanceIdFI. 
Недостающие поля были заполнены пустыми значениями на стороне ДК, в том числе и SymbolObject, что и привело к снижению скорости работы системы из-за поиска при каждом запросе

Что можно сделать:1 Возвращать всегда столько таблиц, сколько запросил ДК и в строго в запрошенном порядке. Если при обработке сущности возникла ошибка, то возвращать пустой набор данных для сущности. Как вариант добавить поле - статус обработки.2. Добавить к каждой сущности имя сущности, чтобы ДК мог понять какую сущность ему вернули успешно и обработать именно ее. В этом случаем кол-во возвращаемых таблиц и их порядок не так важен.3. При возникновении ошибки в любой сущности, вся процедура заканчивает работу с ошибкой

Возможно есть  и другие варианты решения данной проблемы.
```}}
 

Задача SQL https://jira.moscow.alfaintra.net/browse/ADIRSUPSQL-31 
Тред обсуждения https://rc.alfa-bank.net/channel/adir-avarii?msg=5DN8fyQfnNnw3R8Y7",,,Core
ADIRINC-763,2672087,U_M1F0T,Отклонен,01.11.2022 15:48,,,,,Дефект промсреды,15.11.2022 15:11,2022-12-14 00:00:00.0,"Клиент удаляет инструмент из раздела ""Избранное""
ОР: инструмент удаляется
ФР: инструмент пропадает и сразу возвращается обратно в конец списка
У клиент некорректно работает раздел ""Изюранное"" в МТ.

Тред обсуждения: https://rc.alfa-bank.net/channel/a-inv-mt?msg=jQPeh8M22mWMNByL6

Удаление приложения клиенту не актуально, так как большой список сохранения.

Чистка кэша и перезагрузка телефона не помогает.",,18.0,Мобильный терминал
ADIRINC-762,2671897,U_M19HZ,Отклонен,01.11.2022 15:46,,,,,Дефект промсреды,22.02.2023 16:31,2023-03-15 00:00:00.0,"По структурным нотам не отображается текущая цена. Для примера: RU000A1058A8, RU000A1055N7, RU000A1058E0, RU000A1053N2, RU000A1055M9, RU000A1058Z5, RU000A1054N0, RU000A1051W7.  !image-2022-11-01-15-45-43-016.png!",,,Мобильный терминал
ADIRINC-761,2666683,U_M00ZM,Закрыт,31.10.2022 11:41,,,,,Дефект промсреды,06.03.2024 11:59,2022-12-13 00:00:00.0,"Клиент пытается вывести ДС
 ОР: Клиент успешно выводит ДС
 ФР: Вывод не проходит с ошибкой \\\\\\\\\\\\\\\""Операция не прошла проверку на отмывание ДС.\\\\\\\\\\\\\\\""
Пример ГС 4251439, клиенту доступно только 116865.34, из-за того что в расчете не учитываются зачисления дивидендов старше 14 дней 
ГС 4354259 доступно 13207, дивы старше 14 дней уже недоступны
Процедура hell.dbo.[laundry_control] 
При этом процедура начинает срабатывать из-за технического перевода: 
 \\\\\\\\\\\\\\\""Внешнее зачисление: Перевод ИИС. Техническая конвертация.\\\\\\\\\\\\\\\"" Клиенты из-за этого не могут вывести ДС с ИИС, при закрытии ИИС
 Пример ГС 4262883
 !image-2022-12-13-14-14-52-099.png!",,23.0,Core
ADIRINC-760,2665645,U_M00ZM,Закрыт,31.10.2022 09:14,,,,,Дефект промсреды,22.11.2022 11:16,2023-01-09 00:00:00.0,"После релиза торговых сервисов  27.10.2022 сборкой 28 ветки release/2.26.0 версии 151851528, изменился файл ad.xml, что привело к нарушению работы МТРА и деградации на серверах с МТРА.

Тред аварии: https://rc.alfa-bank.net/channel/adir_admins_public?msg=5xngWntwE2bh3q4qm

Проблему решили откатом релиза.


Изменения: (из треда [https://rc.alfa-bank.net/channel/adir_dotnet_pub?msg=Mh8a4TJLGmnad3BL6] )
Отчет по ServerOrderEntity:
Перемещенные поля из OrderEntity: IdCertificate, IdLogin, SessionId, IdAllowedOrderParams, FromFrontEndNumber

Добавленные поля: PingPongInProcess

Удаленные поля: IdRazdelType, IdRazdelGroup, IdObjectCurrency, LinkedOrderNumEDocument

Сущность OrderEntity больше не подходит для подачи поручений через TSWrapper вместо нее вероятно нужно использовать ServerOrderEntity т.к. теперь только здесь есть нужные поля.

Отчет по OrderEntity:

Добавленные поля: EntryRest, ExtSessId, ExtOrderNum, SessionFilled, FilledPrice, BATime, KillNumEDocument, SentTime, KillTime, TerminatedTime, ExchangeTime, ExchangeTerminatedTime, RepoDate, ClientNumStrategy, BIC, Comment, AccountContragent, IdAccountTypeContragent, TradeNo, Reason

У поля Flags поменялся тип с ClientEnterOrderFlags на OrderFlags

Удаленные поля не проверял так же не проверял изменения во всех перечислениях, но что то мне подсказывает что они там есть.

Добавлен тип OrderFlags",,,Core
ADIRINC-759,2661201,U_M1CUE,Закрыт,27.10.2022 19:04,,,,,Дефект промсреды,18.04.2024 18:06,2022-12-12 00:00:00.0,"Добрый день! 

Обращается много клиентов с проблемой отображения купонов по облигациям.
Данные дублируются, не совпадают с биржей и т.д.

На примере бумаги RNANO2P2 видим в hell.actives.couponredemptionschedule лишние и некорректные данные
{code:java}
select * from hell.actives.couponredemptionschedule where p_code = 'RNANO2P2'
{code}
!image-2022-10-27-18-50-50-933.png!
вот данные на [бирже |https://www.moex.com/ru/issue.aspx?code=RU000A101EW8#/bond_4]

!image-2022-10-27-18-49-51-791.png!

Бумаг, в которых дублируются данные от 2 и более агентов 877
{code:java}
declare @tmp table (p_code nvarchar(30), cnt int);
insert into @tmp select distinct p_code, count(distinct UserName) from hell.actives.couponredemptionschedule 
group by p_code 
select * from @tmp where cnt > 1
{code}
Потенциально, это может быть равно кол-ве приходящих инцидентов",,168.0,Core
ADIRINC-758,2659441,U_M172H,Закрыт,27.10.2022 13:51,,,,,Дефект промсреды,02.12.2022 15:08,2022-12-29 00:00:00.0,"Добрый день! 

В [news_cache].[vendor].[news] появилась запись с пустыми headline и body, из-за чего стал спамить сервис news-api.

!image-2022-10-27-13-50-55-347.png!

SELECT * FROM [news_cache].[vendor].[news] where news_id in (45889)

!image-2022-10-27-13-49-41-790.png!

Необходимо добавить проверку в процедуру, которая наполняет данную таблицу, на наличие распаренных headline и body",,,Core
ADIRINC-757,2656723,U_M1EEY,Отклонен,26.10.2022 18:35,,,,,Дефект промсреды,09.02.2023 15:02,2023-01-18 00:00:00.0,"Пользователь находится в ""Календарь инвестора"", тап на смену периода отображения купонов/дивидендов (прим: фильтр по дате)

ФР: краш приложения, после выбора периода отображения купонов/дивидендов

ОР: купоны/дивиденды отображаются корректно при выборе фильтра",,,Мобильный терминал
ADIRINC-756,2656538,U_M1E0U,Отклонен,26.10.2022 16:31,mobile_terminal,,,,Дефект промсреды,09.02.2023 14:25,2022-12-08 00:00:00.0,"Добрый день! 

Обращается клиент с проблемой отображения подарочной акции
Авторизуется с устройства Honor 50 Lite 6+ (NTN-LX1)

 
||SessionID||Login||ClientVersion||DeveloperCode||ProtocolVersion||OSVersion||OSType||DeviceModel||IdDevice||
|12998668871|egurianovskiy|2.17.1|101394178_5DD58414-A519-43E5-B1F0-D32CEE0DC67E|9.93|11|4|NTN-LX1|b85e4890-42ec-3eec-ac56-79abfc277a99|

 

В монге данные заведены корректно
{code:java}
gifts.giftsPortfolio
{
    ""_id"": {
        ""$oid"": ""634d63b658c52a0d06a1ae3e""
    },
    ""userId"": ""AW05HV"",
    ""assetId"": ""RU0007252813"",
    ""ticker"": ""ALRS"",
    ""market"": ""МБ ЦК"",
    ""logotype"": ""https://lk.alfadirect.ru/api/logotypes/emitents/download/idobject/283639.png"",
    ""quantity"": {
        ""$numberLong"": ""5""
    },
    ""costFinInstrument"": ""68.82"",
    ""giftValue"": ""344.10"",
    ""campaignId"": ""62dff919c49d82ba1502af61"",
    ""status"": ""gift"",
    ""gettingDate"": {
        ""$date"": ""2022-10-17T14:16:22.376Z""
    },
    ""dateForSale"": {
        ""$date"": ""2023-01-25T14:16:22.376Z""
    },
    ""genAgreement"": {
        ""$numberLong"": ""5662256""
    },
    ""subAccount"": ""5662256-000"",
    ""showGift"": true,
    ""entryDate"": {
        ""$date"": ""2022-10-17T14:16:22.376Z""
    },
    ""changeDate"": {
        ""$date"": ""2022-10-19T04:46:40.589Z""
    },
    ""_class"": ""ru.alfabank.mobile.invest.gifts.repository.entity.GiftsPortfolio""
}
{code}
{code:java}
gifts.participantsBonusCampaigns
{
    ""_id"": {
        ""$oid"": ""634d63af58c52a0d06a1ac0a""
    },
    ""userId"": ""AW05HV"",
    ""subAccount"": ""5662256-000"",
    ""genAgreement"": {
        ""$numberLong"": ""5662256""
    },
    ""campaignId"": ""62dff919c49d82ba1502af61"",
    ""status"": ""gift"",
    ""entryDate"": {
        ""$date"": ""2022-10-17T14:16:15.646Z""
    },
    ""changeDate"": {
        ""$date"": ""2022-10-17T14:16:15.646Z""
    },
    ""_class"": ""ru.alfabank.mobile.invest.gifts.repository.entity.Participant""
}
{code}
 

 ",,,Мобильный терминал
ADIRINC-755,2655267,U_M1QLD,На исправление,26.10.2022 13:27,,,,,Дефект промсреды,,2023-06-06 00:00:00.0,"Клиент заходит в график по инструменту и в настройках ставит галочку на отображение позиции
ОР: На графике отображается позиция
ФР: Позиция не отображается
Пример клиент 4564199  по бумаге US29760G1031
!image-2022-10-26-13-15-15-607.png!  ",,32.0,Мобильный терминал
ADIRINC-754,2655258,U_M0WVN,Закрыт,26.10.2022 13:17,,,,,Дефект промсреды,12.12.2022 11:58,2022-12-08 00:00:00.0,"*Описание:*

Клиент переведенный из ВТБ видит что уровень риска по счету отличается от уровня риска по бумагам

Пример

!image-2022-10-26-13-08-35-829.png!

 

*Фактический результат:* могут возникать проблемы с расчетом лимитов по клиенту.

*Ожидаемый результат:* предварительный анализ показал, что данные значения у клеинта долждны быть идентичными.

Необходимо провести анализ и понять какой уровень риска приоритетный, чтобы массово выявить и исправить таких клиентов.

Приходится точечно постоянно устранять такие проблемы апдейтами в базе, что занимает время и ресурсы.

*Допинфо:*

исходя из вышеследующего делаем вывод, что таких клиентов из ВТБ потенциально порядка 98398 , с учетом уже закрытых счетов

select COUNT (*) from [import_data].[dbo].[importing_clients] a 
left join hell.[mrgn].[Accounts] b on a.treaty = b.treaty 
left join hell.[dbo].[accounts] c on a.treaty = c.treaty 
where IdAccountGroup != IdPaperGroup 
and c.status_type != 'W';

 ",,2.0,Core
ADIRINC-753,2655252,U_M1BFA,Закрыт,26.10.2022 13:08,,,,,Дефект промсреды,23.11.2022 15:06,2022-12-08 00:00:00.0,"Клиент заходит в веб-терминал и пытается сделать перевод в Альфа-банк
ОР: Клиент успешно делает вывод ДС
ФР: Клиенту не подтягиваются текущие счета

Пример: Клиент с двумя ГС 5868001, 4255414  
по одному счету счета подтянулись по другому нет
При этом в логах сервиса WSCustomerAccountListGBA счет выводится 
!image-2022-10-26-13-06-59-817.png!!image-2022-10-26-13-07-07-820.png!",,,АИ ПРО
ADIRINC-752,2654892,U_M1B7L,Закрыт,26.10.2022 12:20,,,,,Дефект промсреды,21.03.2023 13:13,2022-12-08 00:00:00.0,"Коллеги, добрый день! 

Стали поступать обращения от клиентов, у которых уц по облигациям якобы в 10 раз больше реальной. 

Сейчас 83 перевода с похожей проблемой от 06-10-2022
{code:java}
select bp_percent, acc_code, * from a_hell_opers.dbo.a_all_transfers where bp_percent > 800 and tran_type = 'EXTRA' and a_date > '2022-10-01 00:00:00.000'
{code}
При этом, если не привязываться к дате, таких кейсов 639
{code:java}
select bp_percent, acc_code, * from a_hell_opers.dbo.a_all_transfers where bp_percent > 800 and tran_type = 'EXTRA' {code}
Кажется, надо массово править. 
+ делать проверку для таки кейсов. Явно, цена более 200% практически нереальна. 

Данные переводы генерируют поток обращений в поддержку. 

 ",,32.0,Core
ADIRINC-751,2654327,U_M00ZM,Отклонен,26.10.2022 11:24,,,,,Дефект промсреды,12.05.2023 14:58,2022-12-08 00:00:00.0,"При попытке открыть брокерский счёт в МТ клиент получается стандартную ошибку «Нужен второй заход». Ошибка возникает из-за отсутствия подключенных каналов УКД, но у клиента подключен канал C2.

 ",,,Core
ADIRINC-750,2653203,U_M1AYE,Отклонен,25.10.2022 19:13,,,,,Дефект промсреды,26.10.2022 18:53,2023-01-26 00:00:00.0,"При покупке облигации RU000A1054W1 у клиента цена покупки отображается в рублях

В справочнике бумага заведена корректно

!image-2022-10-25-19-17-11-854.png!

 

!image-2022-10-25-19-12-53-185.png!",,,Мобильный терминал
ADIRINC-749,2652148,U_M0YQB,На исправление,25.10.2022 14:46,,,,,Дефект промсреды,,2022-12-07 00:00:00.0,"Добрый день! 
У клиента скачет цена в зависимости, торгуемое сейчас время/день или нет.
У клиента позиция (YNDX) на 119 борде (idfi= 764478).
Ликвидный рынок для инструмента - 92 (idfi = 162016).
В торговое время в МТ отображается цена из PrevLast (цена последней сделки от 28.02.2022), при этом в неторговое время цена закрытия на 92 рынке (Москве), конвертированная в доллары (так как валюта рисков - USD)
{code:java}
--  Последняя сделка
select top(1)* from addatafeed.alltrades.LastTrades where idfi in (764478) order by TradeTime desc
SELECT 'fi.FinInfoExt',* FROM AdFront.fi.FinInfoExt WHERE IdFi in (162016,764478){code}
Почему-то FairPrice не равен цене последней сделки",,23.0,Core
ADIRINC-748,2651410,U_M1AYE,Отклонен,25.10.2022 13:12,,,,,Дефект промсреды,25.10.2022 13:13,2022-12-07 00:00:00.0,"19/10/2022 у клиентов возникли проблемы с исполнением заявок по CNY: заявки не исполнялись.

Заявки не отправлялись на биржу из-за зависшего агента статусов селта, adwabmcx01

После рестарта агента проблема ушла. Причину зависания определить не удалось из-за отсутствия логов

По проблеме был заведен значительный инцидент IM14072977 

Обсуждение велось тут https://rc.alfa-bank.net/channel/adir-avarii?msg=dTPM5hRECx9EMBnJj",,,Core
ADIRINC-747,2650889,U_M1FE1,Закрыт,25.10.2022 11:15,ОТЭИСФЛ,,,,Дефект промсреды,14.02.2024 16:20,2023-01-25 00:00:00.0,"По некоторым инструментам не отображается, либо отображается неактуальная информация во вкладке Дивиденды(календарь выплат, история выплат)
 ",,121.0,Сатурн
ADIRINC-746,2650579,U_M00ZM,Отклонен,25.10.2022 09:57,,,,,Дефект промсреды,12.01.2023 17:19,2022-12-07 00:00:00.0,Инцидент от 19.10.2022 - Наблюдаются проблемы с исполнением заявок по CNY,,,Core
ADIRINC-744,2648488,U_M1AXK,Отклонен,24.10.2022 15:18,,,,,Дефект промсреды,23.11.2022 17:04,2022-12-06 00:00:00.0,"Добрый день!

Обращается клиент с проблемой, что пуши доставляются на другое (старое устройство).

По логам входов видим, что в последнее время клиент входит с устройства ""Смартфон HUAWEI P30 Aurora (ELE-L29)""
{code:java}
select * from adfront.dbo.clientsessions where login = 'akrivchenkov' order by LoginTime desc
{code}
пуши доставляются на Планшет Samsung Galaxy Tab Pro 8.4 SM-T325 последний вход с которого был 2022-07-07 16:20:07.000
{code:java}
select * from adfront.dbo.clientsessions where login = 'akrivchenkov' and DeviceModel = 'SM-T325' order by LoginTime desc
{code}
В наших логах видим вызов с девайсом SM-J260F, которого вообще нет в логах входов:
{code:java}
request body={ 
    ""deviceAddress"" : ""gcmw8gujzog0am3ta7qar3i7g2mxm08bj5"", 
    ""deviceName"" : ""j2corelte (SM-J260F)"", 
    ""deviceUID"" : ""3b3b406aae0ecb4f9475a20c5ab0289bafdbb8f8"" 
}{code}
Вызов МФМ:
{code:java}
2022-10-22 14:52:08,206 DEBUG [PushChannelPushWriter-1] [mfmsPushClient] << OUT_MESSAGE_SEND
{
   ""id=""""447331454597873975"",
   ""messageId=""""447331454597873975"",
   ""typeCode=""""A12"",
   ""typeName=""""A12"",
   ""priority=NORMAL"",
   ""stopTime=22.10.22 14"":""53"":08,
   ""push=Push""{
      ""recipients=""[
         ""Recipient""{
            ""deviceAddresses=""[
               gcmsl4yh8sqcnh2i6oe353q9vogpmyzhp6
            ]
         }
      ],
      ""fullMessage="""""",
      ""shortMessage=""""Оцените обслуживание в чате"",
      ""secured=false"",
      ""needSessionKey=false"",
      ""onlyPush=true"",
      ""attributes=""[
         ""Attribute""{
            ""key=""""aps/alert/title"",
            ""value=""""Ваше мнение — это важно""
         },
         ""Attribute""{
            ""key=""""gcm/title"",
            ""value=""""Ваше мнение — это важно""
         },
         ""Attribute""{
            ""key=""""deeplink"",
            ""value=""""https://adirect.onelink.me/8NPE/5e297195?type=vocEvent&value=155872755""         },
         ""Attribute""{
            ""key=""""type"",
            ""value=""""12""
         },
         ""Attribute""{
            ""key=""""aps/alert/body"",
            ""value=""""Оцените обслуживание в чате""
         },
         ""Attribute""{
            ""key=""""gcm/alert"",
            ""value=""""Оцените обслуживание в чате""
         },
         ""Attribute""{
            ""key=""""gateMessageId"",
            ""value=""""447331454597873975""
         }
      ]
   }
}
{code}
 

 ",,,Мобильный терминал
ADIRINC-743,2645035,U_M0SLM,На исправление,23.10.2022 14:54,,,,,Дефект промсреды,,2023-01-24 00:00:00.0,"Клиент пытается выставить заявку
ОР: Заявка успешно выставляется
ФР: Заявка отклоняется с ошибками \\\\\\\\\\\\\\\""Торговые поручения по портфелю не разрешены\\\\\\\\\\\\\\\"" или \\\\\\\\\\\\\\\""Не открыт торговый раздел\\\\\\\\\\\\\\\""
Ошибка возникает из-за непротранслированных прав по счету
Скрипт проверки:
{code:java}
select ins.treaty AS IdAccountselect ins.treaty AS IdAccount ,asa.SubAccAllowLevel ,ins.db_date AS CreateDateSubAccount ,Isnull(NULLIF(ins.nick_name, ''), CASE  WHEN Stuff(ins.acc_code, 1, Charindex('-', ins.acc_code), '') = '000' THEN 'Основной' ELSE 'Доп' + Stuff(ins.acc_code, 1, Charindex('-', ins.acc_code), '') END) AS nick_name ,ins.acc_codefrom hell.dbo.sub_accounts as ins join ADFront.dbo.SubAccounts as asa on asa.IdAccount = ins.treaty and asa.IdSubAccount = ins.id_sub_account4INNER JOIN [hell].[dbo].[accounts] AS acc ON acc.treaty = ins.treatyOUTER APPLY ( SELECT Count(*) AS cntSPEX FROM [hell].[dbo].[positions] AS pos WHERE pos.treaty = ins.treaty AND pos.place_code = 'SPBEX_FSHR' AND pos.acc_code = ins.acc_code ) AS oposWHERE ins.treaty < 100000000AND asa.SubAccAllowLevel < 31AND asa.SubAccAllowLevel <>  CASE  WHEN Isnull(acc.disable_orders, 'Y') = 'N' AND Isnull(ins.disable_orders, 'Y') = 'N' AND Isnull(ins.front_id, 0) <> 1 THEN + 1 + CASE  WHEN Isnull(acc.disable_forts, 'Y') = 'N' AND Isnull(acc.isforeignactivetrader, 0) <> 0 THEN 2 ELSE 0 END + 4 + 8 + Iif(Isnull(opos.cntspex, 0) = 0, 0, 16) ELSE 0 ENDAND asa.SubAccAllowLevel <  CASE  WHEN Isnull(acc.disable_orders, 'Y') = 'N' AND Isnull(ins.disable_orders, 'Y') = 'N' AND Isnull(ins.front_id, 0) <> 1 THEN + 1 + CASE  WHEN Isnull(acc.disable_forts, 'Y') = 'N' AND Isnull(acc.isforeignactivetrader, 0) <> 0 THEN 2 ELSE 0 END + 4 + 8 + Iif(Isnull(opos.cntspex, 0) = 0, 0, 16) ELSE 0 ENDorder by asa.SubAccAllowLevel desc
{code}
 ",,713.0,Core
ADIRINC-742,2645030,U_M173X,Закрыт,23.10.2022 13:18,,,,,Дефект промсреды,14.11.2023 12:37,2023-01-24 00:00:00.0,"Клиент заходит в МТ и хочет выполнить операцию с портфелем (вывод ДС, выставление заявки) 

ОР: клиент успешно выполняет операцию
ФР: возникает ошибка ""Нет прав доступа""

Ошибка возникла из-за расхождения данных в БД 
{code:java}
selectselect h.sys_name, h.acc_code, h.access_level, adf.acc_code, adf.IdAccessType, adb.acc_code, adb.IdAccessTypefrom [hell].[dbo].[acc_access] as h join adfront.dbo.SubAccountAccesses as adf on adf.acc_code=h.acc_code and adf.sys_name = h.sys_namejoin ADBack.dbo.SubAccountAccesses as adb on adf.IdSubAccountAccess = adb.IdSubAccountAccesswhere ((h.access_level <> adf.IdAccessType AND h.access_level <> -adf.IdAccessType)     OR (adf.IdAccessType <> adb.IdAccessType AND adf.IdAccessType <> -adb.IdAccessType))and adf.DateDenyAccess = '2100-01-01 00:00:00.000'and h.last_date = '2100-01-01 00:00:00.000'
{code}",,,Core
ADIRINC-741,2645008,U_M1E0U,Закрыт,22.10.2022 22:12,,,,,Дефект промсреды,02.03.2023 16:24,2022-12-26 00:00:00.0,"Добрый день! 

Обращается клиент с проблемой:

В портфеле 2 сущности:
1) Реальный инструмент ALRS RU0007252813
2) Подарочная акция ALRS 62dff919c49d82ba1502af61

При клике на инструмент, открывается подарочная акция, а не позиция. ",,,Мобильный терминал
ADIRINC-740,2645002,U_M1AYE,Закрыт,22.10.2022 19:53,ОТЭИСФЛ,,,,Дефект промсреды,12.01.2024 12:10,2023-01-24 00:00:00.0," Добрый день!  Добрый день! 
Клиенты обращаются с проблемой, что при переходе по кнопке ""Закрыть ИИС"" через баннер, то выходит ошибка ""Функциональность временно недоступна"" 
Обсуждали с коллегами из ЛК и выяснилось, что навешивание баннеры и включение функциональность происходит асинхронно и разными людьми, из-за чего происходят случаи, когда клиентам включают баннер, а функциональность - нет. 
Необходимо синхронизировать данный процесс, так как клиенты нагружают саппорт из-за данного процесса.",,76.0,Личный кабинет
ADIRINC-738,2643422,U_M173X,Закрыт,21.10.2022 15:42,,,,,Дефект промсреды,06.04.2023 15:59,2022-12-05 00:00:00.0,"Добрый день!

Обратился клиент с проблемой отображения бумаги в МТ (0 доходность, УЦ, стоимость)
В ответе в multy-markets не приходит нужный рынок для инструмента. 

Стали разбираться дальше и выяснили, что у данного инструмента 2 записи в матчиге. 
{code:java}
select * from Adfront.dbo.objects where idObject in (293742, 823628)
select * from adback.[hell].[MatchActives2Objects] where act_id = 110688{code}
У клиентов в позициях старый idObject, а бумага висит на новом. 
Провели анализ, таких инструментов 53. Всего позиций 15553

 
{code:java}
-- Бумаги с более 1 матчингом
declare @tbl table (act_id int, cnt int)
insert into @tbl select act_id, count(IdObject) AS cnt from adback.[hell].[MatchActives2Objects]
group by act_id
delete from @tbl where cnt = 1
select * from @tbl
-- Кол-во позиций
select count(idPosition) from adback.[hell].[MatchActives2Objects] m
join adfront.bs.Positions p
on p.IdObject = m.IdObject
where act_id in (select act_id from @tbl)
{code}
Как проявляется:

1) Ошибка на фронте при открытии раздела ""Портфель"" (см. скрин)
2) Некорректный расчет стоимости портфеля
Это только из видимых проблем. 

Необходимо:
1) Создать проверку при добавлении записей в MatchActives2Objects на наличие act_id ИЛИ idObject, чтобы не записывались дубли. 
2) Сделать процесс перевешивания позиций у клиентов с одного idObject на другой.
3) Исправить уже некорректно созданные записи в позициями клиентов. Править руками 15к записей - нереально. 
Обсуждали тут - https://rc.alfa-bank.net/channel/adir_duty?msg=6oFAabM3J7xwmyMRm",,2.0,Core
ADIRINC-737,2642952,U_M0RCG,Отклонен,21.10.2022 13:45,,,,,Дефект промсреды,10.04.2023 18:49,2023-01-23 00:00:00.0,"В мобильном терминале не обновляется цена на графике Индекса мосбиржи, но изменяется в Сводке и на экране Котировок

Проблема возникает из-за того, что ФЕ31 не присылает секундные реалтаим свечи(ChartArchiveEntity) по индексам",,1.0,Core
ADIRINC-736,2642132,U_M186M,Отклонен,21.10.2022 10:58,,,,,Дефект промсреды,15.03.2023 12:46,2022-12-05 00:00:00.0,"Добрый день!

При начислении акций сервис не проверяет ГС на принадлежность к ИИС или Инвесткопилке. Также не проверяет, закрыт счет или нет. 
 Счетов, которые не удовлетворяют условиям (являются ИИСами, Инвесткопилками или закрытыми - 3435шт.)
{code:java}
select count(*) from hell.dbo.accounts where treaty in ({список всех ГС в коллекции gifts.Portfolio со статусом gift}) and (closed != 'N' or iia_type_id != 0 or tp_code = 'Microinvestment')
{code}
Список счетов, где ГС не соответствует ПИНу - 39657!!!",,,Мобильный терминал
ADIRINC-735,2640675,U_M186M,Отклонен,20.10.2022 21:41,,,,,Дефект промсреды,15.03.2023 12:45,2022-12-05 00:00:00.0,"Добрый день!

При начислении акций сервис не проверяет принадлежность ISINa к типу инструмента.
В следствии чего было произведено дарение облигаций. Так как сервис рассчитан на дарение только Акций, стоимость облигации (98.77%) превратилось в кол-во рублей.

Теперь у клиентов отображается большая отрицательная доходность, что влияет на общую доходность портфеля",,,Мобильный терминал
ADIRINC-732,2639856,U_M1DKF,Закрыт,20.10.2022 15:57,,,,,Дефект промсреды,22.03.2023 13:14,2022-12-02 00:00:00.0,"В ЛК актуальность технической карты проверяется сроком действия, а статус не учитывается. Из-за этого некоторые клиенты не могут пополнить ДС с карты. 
Связан дефект с ADIRINC-731",,,Личный кабинет
ADIRINC-731,2639307,U_M173X,Закрыт,20.10.2022 15:33,ОТЭИСФЛ,,,,Дефект промсреды,11.09.2024 18:03,2023-06-20 00:00:00.0,"|Клиент пытается пополнить БС с помощью карты
ОР Перевод успешно проходит
ФР Ошибка ""Зачисления временно недоступны"" и в логах ЛК ошибка ""У брокерского счета 30601810300039665332 более одной актуальной технической карты""|


 !image-2022-10-20-15-33-03-301.png!",,65.0,Личный кабинет
ADIRINC-730,2639273,U_M1BFA,Закрыт,20.10.2022 14:59,,,,,Дефект промсреды,12.01.2023 17:21,2022-12-02 00:00:00.0,"Описание:

У клиента открыт график по инструменту за весь день.

ФР:

График постоянно мерцает , причины не ясны.

Допинфо:

Видео и логи во вложении[^Logs (4).zip]

 ",,,АИ ПРО
ADIRINC-728,2638440,,Отклонен,20.10.2022 11:57,,,,,Дефект промсреды,21.10.2022 16:19,2022-12-02 00:00:00.0,"Не обновляется quotes.PriceInfo.PricesFromSource на серверах 445р1, 445р, prod2 из источника ""Депонет"" начиная с 08.31-01.09. При этом на prod1 данные поступают.

Из-за этого в ХЧЦ транслируется неактуальная цена. И в свою очередь, в брокерских отчетах и СФА отображаются некорректные данные и оценка клиента.

SELECT * FROM [quotes].[PriceInfo].[PricesFromSource]  
 where dateprice > = '2022-08-29' and SourceId = 14
 order by OriginalDatePrice desc

Также данные округляются, при записи. По CH0579775807 цена пришла 0.87, а в хранилище мы записали ""1"".

!image-2022-10-20-12-05-40-619.png!  ",,,Core
ADIRINC-727,2638208,U_M1BFA,Отклонен,20.10.2022 11:35,,,,,Дефект промсреды,24.11.2022 17:04,2022-12-02 00:00:00.0,"У клиента не отображается текущая цена в веб терминале по бумаге US55279C2008

!image-2022-10-20-11-32-49-299.png!",,,Мобильный терминал
ADIRINC-726,2637760,U_M00ZM,Закрыт,20.10.2022 10:28,,,,,Дефект промсреды,22.11.2022 11:13,2022-12-22 00:00:00.0,"Ошибка возникла из-за того что не протранслировалось поле full_name в hell_cache.hell.clients

В тексте поручения не было заполнено поле  Клиент

Проверить можно скриптом 


 select c.client_id, c.full_name
 from [hell_cache].[hell].[accounts] as a
 inner join [hell_cache].[hell].[clients] as c on a.client_id = c.client_id
 where a.treaty = 4505704;
 На данный момент протранслировали массово
 Ссылка на трансляцию [https://rc.alfa-bank.net/channel/adir_duty?msg=oFEfW8BXkSmgBDLhK]",,12.0,Core
ADIRINC-723,2634510,U_M0WVN,Закрыт,19.10.2022 11:44,,,,,Дефект промсреды,21.03.2023 17:54,2022-12-01 00:00:00.0,"При попытке вывода ДС у клиента возникает ошибка «При расчёте лимитов произошла ошибка. Обратитесь в службу клиентского сервиса», в логах adirelkprod ошибка по сервису adir-orders-limit-service: IdSubAccount не найден

Логи тут: [http://adirelkprod.alfadirect.ru/goto/dee5d69b6974ea81a4f3b042eea5a338]

Ошибка возникает из-за отсутствия данных в [hell_cache].[hell].[sub_accounts] в поле adfront_sub_acc_id

!image-2022-10-19-11-42-27-031.png!",,,Core
ADIRINC-721,2633366,U_M1BFA,Отклонен,18.10.2022 18:31,,,,,Дефект промсреды,23.11.2022 15:03,2022-12-01 00:00:00.0,"На почту обращается клиент Шевелев Степан Владимирович, AW19C5, 5670692 не может вывести деньги

ошибка расчета лимитов в веб-терминале",,,АИ ПРО
ADIRINC-718,2632925,U_M1QLD,На исправление,18.10.2022 17:52,,,,,Дефект промсреды,,2022-11-30 00:00:00.0,"Добрый день! 
 
При одинаковых настройках индикатор на iOS и Android отличаются. 
iOS:
!image-2022-10-18-17-47-38-268.png|width=222,height=490!
!image-2022-10-18-17-48-01-494.png|width=220,height=477!
Android: 
!image-2022-10-18-17-49-42-229.png|width=220,height=468!
!image-2022-10-18-17-49-59-885.png|width=219,height=461!",,2.0,Мобильный терминал
ADIRINC-716,2627754,U_M19YV,Закрыт,17.10.2022 14:18,,,,,Дефект промсреды,06.04.2023 16:03,2023-01-17 00:00:00.0,"Добрый день! 

Ранее общались в рамках https://jira.moscow.alfaintra.net/browse/AM-15094 дефекта, однако выглядит так, что править необходимо на стороне АИ. 

При открытии БС присваивается номер счета, оканчивающийся на ген. соглашение, однако такой счет уже может быть занят в ЕКу. 

Это приводит к проблемам при зачислении ДС, так как зачисление идет на другой счет. 
Нужна проверка на открытие счета в ЕКу и запрос номера, а после его присваивать счету в А-Директе. 

Пример клиента (AKIOBZ) отличаются счета в Директе и Альфа-Мобайле.
При попытке пополнить БС, деньги зачисляются в EQ, но в директе их нет. Клиент не может ими пользоваться.

В eq          - 30601810200019395311
В директе - 30601810800011395311

!image-2022-10-17-14-02-29-842.png!

!image-2022-10-17-14-02-47-209.png!",,19.0,Core
ADIRINC-715,2622231,U_M00ZM,Отклонен,14.10.2022 11:08,,,,,Дефект промсреды,12.04.2023 15:24,2022-11-28 00:00:00.0,"*Описание проблемы бизнес-процесса:*

Пользователь открывает карточку клиента А-Клуба, переходит в меню Портфель -Инвестиции-Альфа-Директ и видит, что по активам Альфа-Директ некорректная оценка и доходность, что вводит в заблуждение как самого клиентского менеджера, так и клиента.
----
Привязывать к проблеме *{color:#ff0000}PM38065{color}*

Некорректная оценка бонда Минфина РФ в SFA RU000A0JXTS9 в Альфа-Директ.
Во вложении брокерский отчет и письмо 

 

Ссылка на дефект на стороне SFA - https://jira.moscow.alfaintra.net/browse/SFAONPEGA-85427",,,Core
ADIRINC-714,2612665,U_M00ZM,Закрыт,11.10.2022 14:47,,,,,Дефект промсреды,12.04.2023 15:14,2022-11-23 00:00:00.0,"При пополнении ИИС с карты у клиента дважды начисляется лимит FLIIS1Y. 

Первый запрос на накрутку лимита приходит из МПК, второй - из Директа.

Лимит по одной проводке накручивается дважды, из-за чего превышение происходит раньше, чем зачисляется 1 миллион рублей
|!image-2022-10-11-14-42-03-743.png!|!image-2022-10-11-14-42-39-163.png!|

 ",,20.0,Core
ADIRINC-712,2595726,U_M00ZM,Закрыт,05.10.2022 12:50,,,,,Дефект промсреды,06.12.2022 15:12,2022-12-07 00:00:00.0,"Привет! 

Обращается вип
 У нас не отображается индекс RGBI в терминалах.
 Есть подозрения, что из-за наличия пробелов в indexcode в
{code:java}
select indexcode, * from adfront.micex.Indexes where indexcode in ('RGBI'){code}

 При этом в LinkedFI их нет{{
{code:java}
SELECT * FROM ADFront.fi.LinkedFI WHERE IdFi in (SELECT IdFi FROM ADFront.dbo.FinInstruments WHERE Idobject in (451967)) SELECT * FROM ADFront.intrfc.LinkedFI WHERE Idobject in (SELECT Idobject FROM ADFront.bs.Objects WHERE Idobject in (451967)){code}
Кажется, что надо избавляться от пробелов в Indexes
 При этом в LinkedFI уже много записей с пробелами
{code:java}
SELECT count(*) FROM ADFront.fi.LinkedFI where codefi like '% %'
SELECT count(*) FROM ADFront.intrfc.LinkedFI where codefi like '% %'{code}
!image-2022-10-05-12-40-20-457.png!

 

Как я понял. тут
 правили процесс наполнения таблицы, но существующие остались.
 Можем для всех скорректировать в adfront.micex.Indexes?

Мб тогда стоит обновить все в LinkedFI на основании данных в Indexes, чтобы массово полечить проблему и больше к ней не возвращаться?",,,Core
ADIRINC-711,2592714,U_M1W6T,На исправление,04.10.2022 14:41,,,,,Дефект промсреды,,2022-12-28 00:00:00.0,"При попытке запроса ДС через СБП из других банков у клиента выдает ошибку
«Не удалось отправить запрос на пополнение»
|!image-2022-10-04-14-34-54-888.png!|!image-2022-10-04-14-35-01-190.png!|
 !image-2022-10-21-17-15-20-846.png!",,8.0,Elbrus
ADIRINC-710,2590672,U_M0S8K,Закрыт,04.10.2022 10:10,,,,,Дефект промсреды,03.07.2023 11:08,2022-12-13 00:00:00.0,"Альфа-Директ. Закончилось место в in-memory db data-cash

Сбой от 29.09 и 30.09. ",,,Core
ADIRINC-709,2585628,U_M00ZM,Закрыт,03.10.2022 10:15,,,,,Дефект промсреды,06.12.2022 15:14,2022-12-05 00:00:00.0,"Части клиентов, после конвертации расписок, были зачислены бумаги на неторговые борды ""НРД_НТР"" и ""РДЦ_НТР"" в ад3. Данные борды отсутствуют в ад4, из-за этого отсутсвуют позиции в adfront и из-за этого, клиенты не видят свои бумаги в терминале.

Например, клиенту 4120670 зачислили таким образом бумаги Ленты - RU000A102S15

!image-2022-10-03-10-11-07-456.png|width=730,height=135!

!image-2022-10-03-10-11-41-878.png!",,,Core
ADIRINC-705,2572411,U_M00ZM,Закрыт,27.09.2022 14:10,,,,,Дефект промсреды,30.09.2022 17:33,2022-11-29 00:00:00.0,"Клиент заходит в приложение -> пытается вывести ДС



ОР: Клиент успешно вывел ДС

ФР: Возникает ошибка: “Сформированный текст заявки на стороне сервера не совпадает с заявкой сформированной на клиенте”

Ошибка возникает потому что процедура hell.eq.anket_main_date_set  устанавливает ФИО клиента в верхнем регистре.



!image-2022-09-27-14-09-49-753.png!

На прод доработка была залита 23.09.2022 с этого времени увеличился рост ошибок
!image-2022-09-27-14-09-08-452.png!",,,Core
ADIRINC-701,2572170,,Отклонен,27.09.2022 12:48,,,,,Дефект промсреды,27.09.2022 12:49,2022-11-09 00:00:00.0,"В какой-то момент при создании ЭЦП зависает на экране ""Создаем электронную подпись"". Отменить процесс невозможно, никаких сообщений об ошибке так же нет.

В теории может отвалиться само, но многие клиенты пишут, что ошибка не уходит.

Этапы воспроизведения:
 # Открыть МТ > Еще > Безопасность > Электронная подпись
 # Запросить подпись несколько раз, пока ошибка не появится",,,Мобильный терминал
ADIRINC-704,2572160,U_M19LL,Отклонен,27.09.2022 12:35,,,,,Дефект промсреды,22.01.2024 10:39,2022-11-09 00:00:00.0,"При попытке создания ЭЦП появляется ошибка *RS1AS101003,*  которая возникает, когда у клиента не указан номер мобильного телефона в EQ.

Воспроизведение ошибки:
 # Открыть МТ > Еще > Безопасность > пункт ""Электронная подпись""
 # 

Возможно ли поменять текст ошибки, чтобы сразу указать, что у клиента проблема с номером телефона?

  !image-2022-09-27-12-41-58-927.png!",,,Core
ADIRINC-702,2572158,U_M1DQU,Отклонен,27.09.2022 12:33,,,,,Дефект промсреды,10.11.2022 12:37,2022-11-09 00:00:00.0,"В какой-то момент при создании ЭЦП зависает на экране ""Создаем электронную подпись"". Отменить процесс невозможно, никаких сообщений об ошибке так же нет.

В теории может отвалиться само, но многие клиенты пишут, что ошибка не уходит.

Этапы воспроизведения:
 # Открыть МТ > Еще > Безопасность > Электронная подпись
 # Запросить подпись несколько раз, пока ошибка не появится",,,Мобильный терминал
ADIRINC-703,2572130,U_M262S,На исправление,27.09.2022 12:02,,,,,Дефект промсреды,,2022-11-09 00:00:00.0,"При попытке создания ЭЦП появляется ошибка *RS1AS101017*.
Важно, что при воспроизведении ошибки у одного из наших коллег ошибка появилась спустя >10 запросов кода подтверждения, а у другого- на 2 или 3 нажатие.
Воспроизведение ошибки:
 # Открыть МТ > Еще > Безопасность > пункт \\\\\\\\\\\\\\\""Электронная подпись\\\\\\\\\\\\\\\""
 # Несколько раз подряд запросить код под подтверждения
  !image-2022-09-27-12-40-18-620.png!",,23.0,Мобильный терминал
ADIRINC-700,2570114,U_M0Z22,Закрыт,26.09.2022 17:33,,,,,Дефект промсреды,01.06.2023 15:47,2022-12-20 00:00:00.0,"Сервис FE32Prices падает из-за утечки памяти

!image-2022-09-26-17-30-48-231.png!",,,Core
ADIRINC-699,2564263,U_M0A0R,Отклонен,23.09.2022 16:50,,,,,Дефект промсреды,02.12.2022 15:13,2022-11-07 00:00:00.0,,,,Core
ADIRINC-698,2564232,U_M1DCS,Отклонен,23.09.2022 16:21,,,,,Дефект промсреды,13.04.2023 15:40,2022-11-25 00:00:00.0,"Добрый день! 

При подписании поручения обрезается ошибка, из-за чего клиенты не видят полностью описание и генерируют обращения в поддержку.

!image-2022-09-23-16-06-57-970.png|width=256,height=554!

Текст ошибки тянется из процедуры  [hell].[TestChangeAccountGroup]
!image-2022-09-23-16-17-23-529.png!
Просьба взять задачу в работу, для исправления.",,,Core
ADIRINC-697,2558872,U_M00ZM,Отклонен,22.09.2022 09:29,,,,,Дефект промсреды,22.09.2022 09:50,2022-11-03 00:00:00.0,"Клиент  ГС 1614738 заходит в приложение открывает портфель 

ОР: Портфель пустой

ФР: Отображаются инструменты в кол-ве 0 шт 

В Альфа-Админе тоже есть данные позиции
!image-2022-09-22-09-29-38-741.png!

!image-2022-09-22-09-29-33-333.png!",,,Core
ADIRINC-693,2553017,U_M13J8,Отклонен,20.09.2022 10:41,,,,,Дефект промсреды,21.12.2022 12:28,2022-11-01 00:00:00.0,"Не приходят уведомления о достижении цены для юаня.

Для примера можно посмотреть по пину AT1DJ3.

Шаги воспроизведения:
 # Открыть терминал, найти юань;
 # Установить любую ожидаемую цену;
 # Не получить пуш;

Есть аналогичная проблема с юанем- там, согласно комментариям [~U_M0SE7] в [треде|https://rc.alfa-bank.net/channel/a-inv-mt?msg=EfXJjqL2GSCQwQoRx], проблема в в отсутствии нужного IdObjectGroup.

Симптомы здесь такие же- клиент выставляет трекер, но при его срабатывании пуш не формируется.",,,Мобильный терминал
ADIRINC-692,2543493,U_M1B1C,Закрыт,15.09.2022 14:06,,,,,Дефект промсреды,29.06.2023 16:20,2022-11-17 00:00:00.0,"# Не приходят уведомления о достижении цены для юаня.

Для примера можно посмотреть по пину AT1DJ3.

Шаги воспроизведения:
 # Открыть терминал, найти юань;
 # Установить любую ожидаемую цену;
 # Не получить пуш.

Согласно комментариям [~U_M0SE7] в [треде|[https://rc.alfa-bank.net/channel/a-inv-mt?msg=BsqeW2pKxnCrPCtXn]]:
 _> Для USD справочная информация подтягивается из контракта (помимо валюты IdObjectGroup=8 есть запись с IdObjectGroup=14)_
{code:java}
select top 100 IdObjectFaceUnit,* from ADFront.ts.Objects where IdFiBalance=149262
{code}
_> а для CNY такого нет_
{code:java}
select top 100 IdObjectFaceUnit,* from ADFront.ts.Objects where IdFiBalance=1963534
{code}
  ",,3.0,Мобильный терминал
ADIRINC-691,2541514,U_M1FXC,Закрыт,14.09.2022 17:56,,,,,Дефект промсреды,15.09.2022 15:57,2022-11-16 00:00:00.0,"Дивиденды и купоны в предстоящих выплатах отображаются не по порядку

!image-2022-09-14-17-50-15-588.png!

Investments-api возвращает данные не по порядку:

!image-2022-09-14-17-56-41-705.png!

 ",,,Мобильный терминал
ADIRINC-690,2541250,U_M1DQU,Закрыт,14.09.2022 16:44,,,,,Дефект промсреды,29.09.2022 11:24,2022-11-16 00:00:00.0,Не по порядку отображается выплата дивидендов !image-2022-09-14-16-42-48-389.png!,,,Мобильный терминал
ADIRINC-689,2538979,U_M0Z22,Закрыт,14.09.2022 10:18,,,,,Дефект промсреды,29.01.2024 17:53,2022-10-26 00:00:00.0,"Добрый день! 

Моментами на tariffs-api начинает приходить очень большое кол-во ошибок (58% от всего кол-ва запросов) с текстом ""Площадка с идентификатором 18 не найдена"".
{code:java}
r.a.m.e.RemoteException: Площадка с идентификатором 18 не найдена
	at r.a.m.e.RemoteException$RemoteExceptionBuilderImpl.build(RemoteException.java:54)
	at r.a.m.i.c.s.f.e.AlfaDirectHttpClientErrorDecoder.createRemoteException(AlfaDirectHttpClientErrorDecoder.java:71)
	at r.a.m.i.c.s.f.e.AlfaDirectHttpClientErrorDecoder.decode(AlfaDirectHttpClientErrorDecoder.java:42)
	at r.c.s.ReactiveStatusHandlers$1.lambda$decode$0(ReactiveStatusHandlers.java:49)
	at r.c.p.FluxMap$MapSubscriber.onNext(FluxMap.java:106)
	at r.c.p.FluxDefaultIfEmpty$DefaultIfEmptySubscriber.onNext(FluxDefaultIfEmpty.java:101)
	at r.c.p.FluxPeek$PeekSubscriber.onNext(FluxPeek.java:200)
	at r.c.p.FluxDefaultIfEmpty$DefaultIfEmptySubscriber.onNext(FluxDefaultIfEmpty.java:101)
	at r.c.p.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:127)
	at r.c.p.FluxContextWrite$ContextWriteSubscriber.onNext(FluxContextWrite.java:107)
	at r.c.p.FluxMapFuseable$MapFuseableConditionalSubscriber.onNext(FluxMapFuseable.java:295)
	at r.c.p.FluxFilterFuseable$FilterFuseableConditionalSubscriber.onNext(FluxFilterFuseable.java:337)
	at r.c.p.Operators$MonoSubscriber.complete(Operators.java:1816)
	at r.c.p.MonoCollect$CollectSubscriber.onComplete(MonoCollect.java:159)
	at r.c.p.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at r.c.p.FluxMap$MapSubscriber.onComplete(FluxMap.java:142)
	at o.s.c.s.i.r.ScopePassingSpanSubscriber.onComplete(ScopePassingSpanSubscriber.java:103)
	at r.c.p.FluxPeek$PeekSubscriber.onComplete(FluxPeek.java:260)
	at o.s.c.s.i.r.ScopePassingSpanSubscriber.onComplete(ScopePassingSpanSubscriber.java:103)
	at r.c.p.FluxMap$MapSubscriber.onComplete(FluxMap.java:142)
	at r.n.c.FluxReceive.onInboundComplete(FluxReceive.java:400)
	at r.n.c.ChannelOperations.onInboundComplete(ChannelOperations.java:419)
	at r.n.c.ChannelOperations.terminate(ChannelOperations.java:473)
	at r.n.h.c.HttpClientOperations.onInboundNext(HttpClientOperations.java:703)
	at r.n.c.ChannelOperationsHandler.channelRead(ChannelOperationsHand.
{code}
 

 ",,,Core
ADIRINC-688,2532417,U_M1BGZ,Отклонен,12.09.2022 12:46,,,,,Дефект промсреды,28.11.2022 15:48,2022-10-24 00:00:00.0,"Из за того что на проде не раскатана процедура,  которая пересчитывает коэффициенты в срезах  операций, формирующих остаток по инструментам для клиентов на определенную дату. Используется при ночном расчете учетной цены для исключения просмотра архивных таблиц на неопределенную глубину. У клиентов по некоторым инструментам (US02079K3059, US02079K1079) после сплита не пересчитывается УЦ. ",,28.0,Core
ADIRINC-687,2527635,U_M1DKF,NEW,09.09.2022 15:27,,,,,Дефект промсреды,,2022-10-21 00:00:00.0,"Добрый день! 
 *Шаги воспроизведения:*
 Зайти в ЛК в раздел ""Еще"" -> ""Профиль""
 и посмотреть номер телефона
 *Фактический результат:*
 !image-2022-09-09-15-20-42-092.png!
 *Ожидаемый результат:*
 Отображение номера телефона
 Данные для отображения берутся из [hell].[cabinet].[AnketAccountInfo_Get]
 Данная процедура получает номер телефона из ** hell.dbo.anket_person, но для юр лиц номера лежат в hell.dbo.anket_firm, но процедура получает из этой таблицы только foreign_pie и name_rus.
 Необходимо делать проверку на принадлежность к юр лицу.
 Тред с обсуждением [https://rc.alfa-bank.net/channel/adir_duty?msg=BQ5Jx3FRsRBkYDKHd]",,3.0,Core
ADIRINC-686,2513436,U_M00ZM,Закрыт,06.09.2022 10:10,,,,,Дефект промсреды,06.09.2022 10:11,2022-10-18 00:00:00.0,Сбой расчета лимитов.,,,Core
ADIRINC-685,2509712,U_M1AYE,Закрыт,05.09.2022 11:41,,,,,Дефект промсреды,16.06.2023 10:23,2022-11-07 00:00:00.0,"Некорректная цена облигаций, у которых валюта номинала != рублям в МТ в режиме Lite.
Не идет умножение на курс валюты.
Режим Lite:
!image-2022-09-05-11-42-10-166.png!
Режим Pro:
!image-2022-09-05-11-42-18-420.png!
Воспроизведение:
Открыть облигацию в режиме \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""Lite\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"", у которой валюта номинала != рублям. 
Например, XS0088543193
ОР:
Цена будет = Цене в Рублях 
ФР:
Цена = Цене в Валюте",,8.0,Мобильный терминал
ADIRINC-684,2495026,U_M00ZM,Закрыт,30.08.2022 10:22,,,,,Дефект промсреды,30.08.2022 16:32,2022-10-11 00:00:00.0,"Частично не исполнялись выставленные заявки на ФОРТС, после рестарта шлюза дошли до конечного статуса.

В ЛС в одном месте не всегда корректно определяется тип InitFinished",,,Core
ADIRINC-683,2492673,U_M1DQU,Отклонен,29.08.2022 13:28,,,,,Дефект промсреды,29.11.2022 19:00,2022-11-22 00:00:00.0,"При попытке установить размер купона на IOS 2.17.0  при первичном размещении фронт не дает ввести сотые доли процента.

!image-2022-08-29-13-26-39-308.png!

 

 ",,,Мобильный терминал
ADIRINC-682,2486600,U_M0Z22,Закрыт,25.08.2022 17:55,,,,,Дефект промсреды,23.10.2022 13:13,2022-10-26 00:00:00.0,"При обращении к методу /rest/account/\{client_pin}/detailed у сервисов на кластерах Мобайла и Директа периодически случаются таймауты- запросы от них рубятся observer'ом. 

Задержки можно увидеть, если посмотреть на [http://adirelkprod.alfadirect.ru/goto/986f034bd5b8bf161abb8254c9fb3ac9] - здесь видно, что процедуры [hell].[clients_info_get] и [hell].[accounts_info_get] отрабатывают более 6 и 9 секунд каждая, что и является причиной ошибок.",,,Core
ADIRINC-681,2483762,U_M00ZM,Отклонен,24.08.2022 18:13,,,,,Дефект промсреды,25.08.2022 11:12,2022-10-06 00:00:00.0,"IM13524282 
 [https://alfaadmin/reporting/orders/112533-000/36031508984/1|http://sm-web1/sm/detail.do?preserveMessage=1#]
 Заявка в 11:03 перевелась в неактивный статус, а в 11:44 по этой заявке прошли сделки

Судя по общению с биржей, было выставлено 2 заявки сначала 1892947359016348627, а потом была перевыставлена с новым номером 1892947363299855284 в 18:54:06.367 2022-05-27, в 11:44:45 2022-05-30 по заявке 1892947363299855284 прошли сделки, информации о закрытии этой заявки в 11:03:45 2022-05-30 у биржи нет, есть предположение, что заявку пытались снять по ее старому номеру (1892947359016348627), и из-за этого у нас в базе отображается не правильно

```
select num_edocument, ts_time, * from hell.dbo.a_trades where acc_code = '112533-000' and num_edocument = '36031508984' select idOrderStatus,BrokerComment, DtUpdate, * from ADFrontArchive.[Logs].[Orders] where NumEDocument = '36031508984' order by OrderUpdateTime desc
```

Не уверен что проблема воспроизводится 

!image-2022-08-24-18-10-16-555.png!",,,Core
ADIRINC-680,2477174,U_M16SR,Отклонен,22.08.2022 18:07,,,,,Дефект промсреды,16.03.2023 17:33,2022-10-04 00:00:00.0,"Отображение графика не всегда подгружает данные за пятницу после выходных . Пример ниже.

ГС 229097

Данные в addatafeed.dbo.candles присутствуют

!image-2022-08-22-11-53-26-727.png!
!image-2022-08-22-11-53-42-942.png!",,,Core
ADIRINC-679,2474528,U_M19YV,На исправление,22.08.2022 11:14,,,,,Дефект промсреды,,2022-10-03 00:00:00.0,"Добрый день!
 Клиент 4433659 выводил ДС 15.08.22 во внешний банк.
 Деньги списались с брокерского, но из ЕКу вернулась ошибка
 {{*\\\\\\\\\\\\\\\""ЭПД отменен: LTC0055 Превышен лимит допустимого баланса\\\\\\\\\\\\\\\""*}}
{code:java}
select text_result, * FROM hell.equision.ADCP_PROD_CP_request 
where client_account = '30601810000024433659' and amount = '28000.00'
order by crt_date desc`{code}
В ЕКу действительно видим на балансе брокерского 28000, но при этом на балансе у клиента их нет
 
 SELECT * FROM [hell].[dbo].[balance] where acc_code like '4433659-%' 
{code}
Подскажите, пожалуйста, почему не вернулись ДС, при наличии ошибки из ЕКу?
 Обсуждается тут - [https://rc.alfa-bank.net/channel/adir_duty?msg=649BomgfS9sEyFmkK]",,1.0,Core
ADIRINC-678,2472771,U_M12MD,Закрыт,19.08.2022 16:34,,,,,Дефект промсреды,22.11.2022 11:12,2022-10-20 00:00:00.0,"С версии 2.17.0 Portfolio-rebalance-api вызывается по всем клиентам
!image-2022-08-19-16-35-12-842.png!",,,Мобильный терминал
ADIRINC-677,2459923,U_M0AXT,Отклонен,15.08.2022 17:06,,,,,Дефект промсреды,16.08.2022 10:24,2022-09-26 00:00:00.0,Недоступен http://adirelkprod.alfadirect.ru/,,,Core
ADIRINC-676,2450509,U_M1FE1,Отклонен,11.08.2022 18:02,,,,,Дефект промсреды,04.04.2024 15:19,2022-09-23 00:00:00.0,"Добрый день! 

Спамит ошибками issures-api, клиенты видят ошибку на экране, если отсутствуют данные в 
{code:java}
SELECT * FROM news_cache.direct.instruments
SELECT * FROM news_cache.direct.emitents{code}
 

Сейчас много ошибок по след. идентификаторам:

 
{code:java}
HKD
EUR
RU000A0JR5Z5
KYG017191142
RU000A0JP195
RU000A0HF1L0
{code}
1) Почему вызывается сервис по валютам? (HKD, EUR)
2) Необходимо добавить данные по недостащим бумагам, чтобы сейчас прекратились ошибки [~U_M172H] 



 ",,,Core
ADIRINC-675,2446993,U_M17ZW,Закрыт,10.08.2022 17:36,,,,,Дефект промсреды,24.10.2022 17:52,2022-09-21 00:00:00.0,"Возникает большое кол-во таймаутов по сервису adir-portfolio-analytics.

В МТ не прогружается отчет (portfolio-analytics-api), так как апи таймаутит из-за проблем с бд.

Как временное решение - перегрузка службы Olap и прогрев кеш с нуля.

!image-2022-08-10-17-37-13-695.png|width=1578,height=526!

!image-2022-08-10-17-38-05-091.png|width=1620,height=698!

!image-2022-08-10-17-29-15-469.png|width=1182,height=407!

!image-2022-08-10-17-30-00-561.png|width=1319,height=721!",,,Мобильный терминал
ADIRINC-674,2446984,U_M1QLD,Отклонен,10.08.2022 17:09,to_fix,,,,Дефект промсреды,06.03.2024 15:54,2022-11-23 00:00:00.0,"При покупке части инструментов на МБ в рублях, учетная цена по ним отображается на графике в валюте.

Клиент 1164586 купила СПБ за рубли на МБ, но на графике у неё отражена учетная цена в $:
 !image-2022-08-10-16-45-48-081.png!
 !image-2022-08-10-16-46-23-717.png!
  
 У этих инструментов в таблице ADFront.cf.RegPrices.IdObjectUchPriceCurr = 174366 (usd)
 Хотя в adfront.bs/ts.objects IdObjectFaceUnit & IdObjectRiskCurrency = 174368 (rub) (для СПБ, например)",,9.0,Мобильный терминал
ADIRINC-673,2438394,U_M16U0,Отклонен,08.08.2022 11:29,unreproducе,,,,Дефект промсреды,06.03.2024 15:52,2022-10-07 00:00:00.0,"После обновления до версии МТ 2.16 (Android) перестали подтягиваться фич-тоглы из Firebase. Не отображается вкладка \\\\\\\\\\\\\\\""Дивиенды\\\\\\\\\\\\\\\"", старый чат, старая аналитика, отсутствует пополнение из приложения и т.е.
Переустановка приложения, установка старых версий (2.15, 2.14) или dev сборок (2.15, 2.16) не помогли. Кэш чистил, папки с кэшем(включая скрытые папки) удалял.
*Проблема встречается у клиентов, а так же у меня.*
Возможно, поможет в исследовании проблемы:
У меня (гс 4756901): Android 11, Oneplus 10 pro. Рут. 
Ранее скрывал рут от МТ Magisk'ом. Сейчас без разницы, скрыт/не скрыт, фич-тоглы все равно не работают.
Так же, ставил приложение вторым экземпляром через песочницу \\\\\\\\\\\\\\\""App Cloner\\\\\\\\\\\\\\\"". Ранее в нем все корректно работало, после обновления до 2.16, перестало.
Ощущение, что обновившись, остался какой-то кэш Firebase'a, в котором у меня якобы версия приложения не попадает под фич-тоглы.
!image-2022-08-08-11-27-53-336.png|width=193,height=434!!image-2022-08-08-11-28-17-687.png|width=298,height=659!
!image-2022-08-08-11-28-45-939.png|width=210,height=468!!image-2022-08-08-11-29-16-902.png|width=293,height=642!
 ",,18.0,Мобильный терминал
ADIRINC-672,2437634,U_M173X,Закрыт,08.08.2022 09:43,,,,,Дефект промсреды,28.04.2023 12:40,2022-10-07 00:00:00.0,"Таймауты из за разрывов связи с FE32, на подключение и первичную закачку требуется время. !image-2022-08-08-09-43-39-173.png!",,,Core
ADIRINC-671,2437409,U_M172H,Отклонен,08.08.2022 09:37,,,,,Дефект промсреды,12.08.2022 09:41,2022-09-19 00:00:00.0,"В истории сделок некорректно отображается сумма сделки по облигациям.

Например, клиент 4540232. Купил облигации Альфы по 20757.6. В operations_cache.hell.trades & в [hell_cache].[adfront].[operations_history] цена 20757. Но если дергать ручку /api/operations-history? (или на фронте), то цена 35152.

Проблема возникает из-за того, что в сумме идет умножение на НКД по формуле:

_Цена price (указывается в %) и ""Стоимость с НКД в валюте операции"" (указывается в валюте) trade_volume+paper_volume*nkd_

 

!image-2022-08-08-09-27-12-563.png|width=199,height=438!

!image-2022-08-08-09-28-06-767.png|width=1054,height=279!

!image-2022-08-08-09-28-35-869.png|width=1063,height=211!

Обсуждали тут - https://rc.alfa-bank.net/channel/adir-history?msg=ar2pt8a6JFxgcouDp",,51.0,Мобильный терминал
ADIRINC-670,2434321,U_M1FPP,Закрыт,05.08.2022 10:36,,,,,Дефект промсреды,15.09.2022 10:02,2022-10-06 00:00:00.0,"При покупке части инструментов на МБ в рублях, валюта сделки в истории отображается в $, а не в рублях.

Так же, учетная цена отражена в $, хотя инструмент покупался в рублях.

В брокерском отчете, при этом, валюта отражена корректно.

Воспроизводится на Android МТ 2.16

Например, клиент гс 4538033 купил RU000A0JQ9P9 (Бумаги СПБ биржи) по 89.9р., в истории отражена покупка за 89.9$

 

Как воспроизвести: Покупаем акции СПБ биржи, после чего заходим в историю. Цена отображается в $.

 

!image-2022-08-08-16-20-00-967.png!

Клиент 4543208 купил Polymetal JE00B6T5S470 за рубли, но так же в истории отражена валюта $.

Гс 4491178 продал US7496552057 (Русагро) за рубли, но в истории $.

!image-2022-08-08-16-20-40-839.png|width=471,height=833!

 

У этих инструментов в таблице ADFront.cf.RegPrices.IdObjectUchPriceCurr = 174366 (usd)

Хотя в adfront.bs/ts.objects IdObjectFaceUnit & IdObjectRiskCurrency = 174368 (rub) (для СПБ, например)",,46.0,Мобильный терминал
ADIRINC-669,2415273,U_M16SR,Отклонен,28.07.2022 17:21,to_fix,,,,Дефект промсреды,09.01.2024 14:53,2022-09-08 00:00:00.0,"Добрый день! 

Не отображаются лого по некоторым активам:

RU000A103X66
RU0009091573
RU000A0JUQN2

Таких инструментов немало...

 ",,,Личный кабинет
ADIRINC-668,2413920,U_M13J8,Отклонен,28.07.2022 14:11,to_fix,,,,Дефект промсреды,02.03.2023 16:29,2022-09-08 00:00:00.0,"Добрый день!

При выставлении цены для уведомления, не нажимается запятая.
При этом корректно отрабатывает с точкой, но выше указана цена через запятую
Из-за чего клиенты путаются.

 

Просьба либо изменить запятую для цен, либо дать возможность вводить цену через запятую.
Видео прикладываю",,,
ADIRINC-667,2410247,U_M13J8,Закрыт,27.07.2022 12:06,to_fix,,,,Дефект промсреды,30.11.2022 17:01,2022-09-27 00:00:00.0,"Добрый день! 

После начисления акции у клиента выходит попап, так как в ответе в gifts-api/portfolios приходит ""showGift"" : false
После того, как клиент его скрывает, мы отправляем gifts-api/portfolios PUT и меняем на false в монге
ответ gifts-api/portfolios кэшируется на 15 минут [https://git.moscow.alfaintra.net/projects/AINVEST/repos/infra-configs/browse/gifts-api-prod.yml#40] 

Из-за этого клиент в течение 15 минут при переходе на экран ""Портфель"" видит попап.

 ",,,Мобильный терминал
ADIRINC-665,2408776,U_M12MD,Закрыт,26.07.2022 19:16,to_fix,,,,Дефект промсреды,26.08.2022 09:41,2022-09-27 00:00:00.0,"Добрый день! 

При попытке двигать ставку купона пропадает поле.
Предполагаю, что связано с тем, что шаг изменения 0,1, а в данном инструменте 0,01
Видео во вложении",,,Мобильный терминал
ADIRINC-664,2402099,U_M0SLM,На исправление,25.07.2022 10:05,,,,,Дефект промсреды,,2022-09-05 00:00:00.0,"*Воспроизведение проблемы*

Наблюдались проблемы с вызовом сервиса adir/assetprices/v11/rest + FE32 Prices
 # !image-2022-07-25-09-56-55-045.png!

!image-2022-07-25-09-57-50-921.png!

При этом наблюдались проблемы с выводами с инвесткопилки в УКД + проблемы с отображением карточки Инвесткопилки

Рестарт сервисов не помогал, причиной оказалось нехватка места в разделе /var на хостах логирования.

Данный раздел предназначен только для логов кибаны.

*Фактически:*

Очистка места (и расширение места в разделе) + рестарт сервисов решили проблему.

Вызовы сервисов восстановились, операции выводов в УКД пошли, проблем с отображением карточки БС не стало.

 

*Необходимо:*

Предусмотреть и реализовать схему хранения и откидывания логов через kafka очередь во избежание подобных проблем в будущем.

Исключить прямое влияние схемы логирования на боевые сервисы и функциональность систем.

 

 ",,,Ядро
ADIRINC-662,2393507,U_M1BYG,Закрыт,20.07.2022 13:47,,,,,Дефект промсреды,31.08.2022 17:46,2022-08-31 00:00:00.0,"Перестали останавливаться сервисы на всех агентах. После остановки их ахесус снова запускает. Это ведет к тому что данные о проданных инструментах в заявке не переносятся на следующий день. Поле EntryFilledQuantity = 0, вместо оставшегося количества.

Например:

select IdOrderStatus, Quantity - Rest - EntryFilledQuantity , * from adfront.ts.orders where idaccount = 4350108 and idobject = 599503",,,Core
ADIRINC-661,2391653,U_M1EP6,Закрыт,19.07.2022 18:15,to_external_system,,,,Дефект промсреды,06.05.2024 06:34,2022-11-29 00:00:00.0,"Обращаются клиенты по причине того, что видят в портфеле и на графике цену закрытия по своим бумагам неактуальную в выходной.
Например в субботу видят цену закрытия на четверг
 
Примеры:
ГС 4641024 AVTPS0 Коваль-Зайцев Алексей Анатольевич на 16.07 отображалась в мобильном приложении цена закрытия за 14.07 по акциям  Лукойл.
 Цена закрытия на 14.07 была 3608 руб(у клиента 16.07 отображается 3608 руб), однако торги по акции шли 15.07, цена закрытия 15.07 составила 3709 руб. в приложении также цена предзакрытия за 14.07- 3608 руб.
!image-2022-07-19-18-10-05-031.png!!image-2022-07-19-18-12-06-691.png!!image-2022-07-19-18-10-59-190.png!!image-2022-07-19-18-10-36-978.png!
ГС 4601072 Никитин Сергей Александрович на 16.07
Цена закрытия по акциям(по всем ценным бумагам в портфеле) не совпадает с ценой закрытия на МБ. Цена закрытия транслируется за 14.07, 15.07 цена закрытия другая.
*Пример от 9.07* (тоже выходной)
48058 Федорова Виктория Васильевна OS устройства: android Версия МП: 2.15.0 Привел в пример акции Распадская RU000A0B90N8 https://www.moex.com/ru/issue.aspx?board=TQBR&code=RASP&utm_source=www.moex.com&utm_term=%D1%80%D0%B0%D1%81%D0%BF%D0%B0%D0%B4%D1%81%D0%BA%D0%B0%D1%8F В приложении отображается цена закрытия от четверга 7.07.2022, а не от пятницы. ",,40.0,Core
ADIRINC-658,2368417,U_M1FPP,Отклонен,11.07.2022 15:47,,,,,Дефект промсреды,30.03.2023 16:14,2022-08-22 00:00:00.0,"Позиции у клиентов на спб рынке (в первую очередь у переведенных, у кого инструменты на СПб фиктивно заведены) каждый день в терминалах постоянно пропадают-появляются-пропадают-появляются.

Происходит это из-за смены статуса в таблице Adfront.dbo.FinInstruments. Поле ""IsEnabledFinInstrument"".

Процедура adfront.SPBEX.ProcessAll проверяет, есть и торгуется ли данный инструмент на самом деле на спб (по таблице спбшной - adfront.spbex.Issue) и если нет, то меняет поле на ""0"". Через некоторое время уже другой джоб меняет статус у ФИ на ""1"" (активный инструмент). 

Таким образом, в течение дня, разные джобы меняют статус активности инструментов.

Необходимо или отключить проверку на наличие инструмента на СПБ или реализовать другой механизм, чтобы инструменты не переходили в неактивный статус. 

Обращений много.
 Обсуждали вот тут - [https://rc.alfa-bank.net/channel/adir_duty?msg=uhR38sThSjSdDYBZt]",,41.0,Core
ADIRINC-657,2354791,U_M1FPP,Отклонен,06.07.2022 16:07,,,,,Дефект промсреды,25.07.2022 17:36,2022-08-17 00:00:00.0,"В АА висит оборот, хотя клиент продал бумаги еще в апреле. 

Не обновляется поле ""Turnover"" в таблице hell.dbo.balance.

Из-за этого невозможно закрыть счет.

!image-2022-07-06-15-56-42-712.png!

!image-2022-07-06-15-57-37-266.png!

!image-2022-07-06-16-07-48-834.png!",,8.0,Core
ADIRINC-656,2346821,U_M00ZM,Отклонен,04.07.2022 14:58,,,,,Дефект промсреды,02.09.2022 17:25,2022-08-15 00:00:00.0,"Клиент пытается открыть БС через Альфа-Инвестиции.

Вместо успешного открытия получает ошибку «Нужен второй заход»

В логах директа ошибка «Отсутствует информация о каналах»

!image-2022-07-04-14-55-27-137.png!!image-2022-07-04-14-55-29-792.png!",,,Мобильный терминал
ADIRINC-655,2341476,U_M1AYE,Закрыт,01.07.2022 12:19,to_external_system,,,,Дефект промсреды,23.12.2022 17:08,2022-08-12 00:00:00.0,"Клиент пытается вывести остатки < 1 с валютного БС на валютный счёт.

В результате расчет лимита на вывод средств возвращает отрицательный результат и не дает вывести средства

!image-2022-07-01-12-09-38-436.png!",,,Core
ADIRINC-654,2340216,U_M1B1C,Закрыт,01.07.2022 09:35,,,,,Дефект промсреды,13.10.2023 11:04,2023-06-13 00:00:00.0,"У клиента есть доверенность на счет -> открывает раздел тарифы
ОР: Вкладка открывается
ФР: Выходит ошибка ""Кое-что сломалось""

Временно решение переключить счет в разделе ЕЩЕ -> личный кабинет -> Счет
 !image-2022-07-01-09-33-05-277.png|thumbnail!",,7.0,Мобильный терминал
ADIRINC-653,2338290,U_M13J8,Закрыт,30.06.2022 16:05,to_fix,,,,Дефект промсреды,26.12.2022 11:17,2022-08-31 00:00:00.0,"При проваливании в акцию и установлении уведомления об изменении цены акции не проставляет запятую, а смещает на один символ влево, точку поставить дает. Обратился клиент(4360358) (версия 2.15). Я попробовал самостоятельно выполнить, деффект воспроизводится(версия 2.14).",,,Мобильный терминал
ADIRINC-652,2335140,U_M159X,Закрыт,29.06.2022 18:47,,,,,Дефект промсреды,15.03.2023 12:36,2022-08-31 00:00:00.0,"Клиент подтверждает Инвест профиль

Возникает ошибка 

!image-2022-06-29-18-44-55-642.png!

 

В опции ДИК отсутствует телефон и версия Клик

Связано с тем, что во флоу оформления клиента, через другие каналы эти признаки не проставляются, но в механизме подтверждения они используются",,7.0,Мобильный терминал
ADIRINC-651,2318529,U_M1ME9,Закрыт,24.06.2022 09:33,,,,,Дефект промсреды,18.11.2022 09:40,2022-08-05 00:00:00.0,"Клиент заходит в МТ с помощью кросавторизации из мобайла 
ОР: микросервисы в МТ вызываются с каналом I1
ФР: микросервисы в МТ вызываются с каналом M2
!image-2022-06-24-09-29-24-301.png|thumbnail! ",,,Мобильный терминал
ADIRINC-650,2318495,U_M0DRY,Закрыт,24.06.2022 09:09,,,,,Дефект промсреды,01.07.2022 09:20,2022-08-05 00:00:00.0,"Агент записывает в БД нули и из-за этого фронт рисует нулевые свечки 
 !image-2022-06-24-09-07-44-075.png|thumbnail! 
 !image-2022-06-24-09-06-39-485.png|thumbnail! 
Обсуждение в треде https://alfamobile.slack.com/archives/C0152MPGQEB/p1655277981614799",,,Core
ADIRINC-649,2318482,U_M0X4M,Закрыт,24.06.2022 09:02,Фронт,,,,Дефект промсреды,22.07.2022 11:46,2022-08-05 00:00:00.0,"На андройде дергается метод multi-markets-api с пустыми параметрами, это сильно нагружает бэк и мидл слой.
 !image-2022-06-24-09-02-20-678.png|thumbnail! ",,,Мобильный терминал
ADIRINC-648,2310777,U_M177U,Закрыт,21.06.2022 18:31,to_fix,,,,Дефект промсреды,03.12.2022 15:56,2022-08-23 00:00:00.0,"Шаги воспроизведения:
 # Клиент хочет пополнить свой счет ИИС по реквизитам.
 # Заходит в раздел Портфель – Переводы--Пополнить по реквизитам 

Фактически :

Реквизиты брокерского счета указаны

Ожидаемый результат:

Отображать корректные реквизиты, так как клиенты переводят не на тот счет

Видео во вложении, на нем видно , что в обоих случаях счет получателя одинаковый в реквизитах. Если заходить в ИИС и БС",,2.0,Мобильный терминал
ADIRINC-647,2305894,U_M1GPT,Отклонен,20.06.2022 16:40,Вывод_ДС,Инвесткопилка,,,Дефект промсреды,27.10.2022 09:58,2022-08-01 00:00:00.0,"Шаги воспроизведения:
 # Клиент заходит в МТ;
 # Пытается перевести средства со счета на счет/на счет в банк;
 # Получает ошибку ""Недостаточно средств на счете"":
 в поле ""Откуда"" видны средства, в то время как в поле ""Доступно"" стоит 0.
 # В логах расчета лимитов в поел Quantity стоит 0.

Фактический результат: клиент не может вывести средства сегодня, в лучшем случае вывод становится доступным через день;

Ожидаемый результат: клиент вывдит средства или не видит доступных средств к выводу.",,,Core
ADIRINC-635,2295498,U_M177U,Закрыт,16.06.2022 12:01,to_fix,,,,Дефект промсреды,26.08.2022 09:43,2022-08-17 00:00:00.0,"У клиентов на IOS с версией приложения Альфа-инвестиции 2.11 не отображается баланс на БС и стоимость ценных бумаг, в логах видно что от multi-markets-api приходят 404. На остальных версиях ответы корректные и отображение тоже.",,1.0,Мобильный терминал
ADIRINC-634,2295456,U_M19LL,Закрыт,16.06.2022 11:42,,,,,Дефект промсреды,17.05.2023 12:46,2022-07-28 00:00:00.0,"Коллеги,  у нас в МТ курс тенге за 1 штуку указан 13.... рублей, в то время как на сайте ЦБ РФ это стоимость 100 тенге [https://www.cbr.ru/currency_base/daily/]",,3.0,Core
ADIRINC-633,2295409,U_M1DKF,На исправление,16.06.2022 11:34,,,,,Дефект промсреды,,2022-07-28 00:00:00.0,"Клиент пытается пополнить БС с карты
ОР: Клиент успешно пополняет БС
ФР: У клиента возникает ошибка \\\\\\\\\\\\\\\""Произошла ошибка при создании операции перевода\\\\\\\\\\\\\\\""
В логах ЛК ошибка ERRMNU9999  !image-2022-06-16-11-30-30-847.png|thumbnail! 
В логах pipe сервис WSClickPaymentCreatePerson2Person#Add возвращает ошибку: \\\\\\\\\\\\\\\""(245 мс.) KSM2010  Card \\\\\\\\\\\\\\\""132079831\\\\\\\\\\\\\\\"" does not exist on the database\\\\\\\\\\\\\\\""
Где \\\\\\\\\\\\\\\""132079831\\\\\\\\\\\\\\\"" -  это идентификатор пластика карты, которого нет в таблицах acomop1.cc3pf, acomop1.cc2pf в EQ.  Непонятно почему он туда не попал, при этом пополнение FAKE карты через Альфа-Мобайл проходит успешно.",,48.0,Личный кабинет
ADIRINC-632,2289974,U_M07DK,Отклонен,14.06.2022 18:00,,,,,Дефект промсреды,08.07.2022 18:58,2022-07-27 00:00:00.0,"У клиента на брокерском счету 495 евро, в  Альфа админ портфель пустой. Посмотрели в ad3 и ad4, записей нет. В EQ отображается, что дс на евро-брокерском счету есть. Получены в следствии операции дарения. Сслыка на тред прекрепляю  https://alfamobile.slack.com/archives/C0152MPGQEB/p1654517705957089 ",,,Core
ADIRINC-631,2289131,U_M0WVN,Закрыт,14.06.2022 15:37,,,,,Дефект промсреды,17.01.2024 14:50,2022-07-26 00:00:00.0,"Добрый день! 

Клиенты 88848 (XS0088543193) и 4248104 (RU000A101PS2) обратились с проблемой, что не могут перевести свои бумаги (нрд) к другому брокеру, так как доступное кол-во = 0.
 В hell.dbo.v_arm_transfers депо. переводы в просроченном статусе.
 (задача, где делали статусы - ADIRTECH-63 Депозитарные переводы. Зачисления и списания - Alfa-bank Issue Tracker (alfaintra.net)
 [http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=271469873&preview=%2F271469873%2F273431477%2F%D0%A1%D1%82%D0%B0%D1%82%D1%83%D1%81%D1%8B+%D0%BF%D0%BE%D1%80%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B9.docx])
 Судя по задаче, какой-то иной статус для перевода, который еще не совершился, кроме ""Просрочено"" не подразумевается.
 Что приводит к дезинформации сотрудников 1 линии, которые видят такой статус, при этом клиенты не видят бумаг в портфеле клиентов, ни у нас, ни у других брокеров, так как процесс перевода пока еще в процессе.

!image-2022-06-14-15-30-27-935.png!

Данный статус транслируется в Альфа-Админ, где его смотрят сотрудники 1 и 2 линии.
 Кажется, необходим какой-то промежуточный статус, либо увеличивать сроки для ""Просрочено"", а не < сегодня 

 
Обсуждалось тут - https://alfamobile.slack.com/archives/C0152MPGQEB/p1655205669393039",,42.0,Core
ADIRINC-630,2285568,U_M00ZM,Закрыт,14.06.2022 09:42,,,,,Дефект промсреды,26.07.2022 17:37,2022-08-15 00:00:00.0,Не проходят переводы на срочный рынок (ФОРТС) из-за рефакторинга процедуры. ,,,Core
ADIRINC-628,2277726,U_M1CUE,Закрыт,09.06.2022 11:19,,,,,Дефект промсреды,09.01.2024 10:36,2022-09-02 00:00:00.0,"Добрый день! 
У клиента (AQWKEV) по Инвесткопилке и БС отображается баланс из EQ (без учета стоимости активов) из-за того, что сервис [http://esbwsreco/adir/assetprices/v10/rest] не возвращает цену по какому-то инструменту (в данном случае по IE00BBGT3753)
Ответ investments-api/agreements/balances
{code:java}
{
  \\\\\\\\\\\\\\\""errorId\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""9e69ab14cabc1286\\\\\\\\\\\\\\\"",
  \\\\\\\\\\\\\\\""application\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""investments-api\\\\\\\\\\\\\\\"",
  \\\\\\\\\\\\\\\""errorCode\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""UNKNOWN_ERROR\\\\\\\\\\\\\\\"",
  \\\\\\\\\\\\\\\""messages\\\\\\\\\\\\\\\"": {
    \\\\\\\\\\\\\\\""ru\\\\\\\\\\\\\\\"": \\\\\\\\\\\\\\\""Price for IE00BBGT3753 is missing in brokerage-price cache.\\\\\\\\\\\\\\\""
  }
}
{code}
Из-за данного инструмента страдают все брокерские счета (Инвесткопилка тоже)",,36.0,Core
ADIRINC-627,2277463,U_M1CQQ,Закрыт,09.06.2022 10:22,,,,,Дефект промсреды,31.01.2023 11:07,2022-07-22 00:00:00.0,"Добрый день! 

Поступает много запросов от клиентов, в которых они сообщают, что не могут вывести ДС с инвесткопилки.
 В логах видим, что клиенту возвращается 0 лимит
 [http://adirelkprod.alfadirect.ru/goto/ff726e7cee2da0759cd6e338c8e5221d]
{code:java}
>>>
2022-06-08 10:40:47.61006 Входящий запрос клиентских лимитов/ограничений (NTOperationConstraintsRequest):
{
  ""ProductType"": ""MoneyBox"",
  ""AuthType"": ""Pin"",
  ""AuthToken"": ""AVM98U"",
  ""Channel"": 6,
  ""AccountId"": 4854028,
  ""SubAccountId"": 0,
  ""Section"": ""MAIN"",
  ""AssetId"": ""RUB"",
  ""Amount"": 4000.0,
  ""Operation"": ""OUT""
}
2022-06-08 10:40:47.61008 Вызов процедуры: [client].[check_tax]
2022-06-08 10:40:47.61009 Параметры: 
acc_code:4854028-000
place_code:MICEX_SHR
p_code:RUB
oper_type:OUT
amount:4000

2022-06-08 10:40:48.40155 Время ожидания ответа:791ms
2022-06-08 10:40:48.40160 Ответ БД: (NTOperationCalculateTaxesResponse):
{
  ""TaxSum"": 0.00,
  ""TaxTotal"": 0.00,
  ""TaxRate"": 13.00,
  ""BalancePrice"": 0.00,
  ""AmountToRub"": 1.000000,
  ""IsActual"": true
}
2022-06-08 10:40:48.40166 Результат преобразования входящего запроса (из NTOperationConstraintsRequest в ClientGetWithdrawMoneyLimitReq):
{
  ""IdRequest"": 11189,
  ""IdAccount"": 4854028,
  ""IdSubAccount"": 3013861,
  ""IdRazdel"": 21024646,
  ""IdObjectCurrency"": 174368,
  ""Zone"": ""ALFA""
}
2022-06-08 10:40:48.40171 Результат преобразования ClientGetWithdrawMoneyLimitReq в TsWrapperEntity:
{
  ""IdLogin"": 0,
  ""CameTsTime"": 0,
  ""CameFeTime"": ""2022-06-08T10:40:48.4016876+03:00"",
  ""Entity"": {
    ""IdRequest"": 11189,
    ""IdAccount"": 4854028,
    ""IdSubAccount"": 3013861,
    ""IdRazdel"": 21024646,
    ""IdObjectCurrency"": 174368,
    ""Zone"": ""ALFA""
  },
  ""IdLock"": 4854028,
  ""RequestId"": -1,
  ""IdDevice"": ""ALFAINVEST01"",
  ""SessionId"": 0,
  ""Version"": 0,
  ""Operation"": 0
}
2022-06-08 10:40:48.40180 Время ожидания ответа ЛС:0ms
2022-06-08 10:40:48.40215 Полученный из ЛС ответ на запрос #11189:
{
  ""IdRequest"": 11189,
  ""IdAccount"": 4854028,
  ""IdSubAccount"": 3013861,
  ""IdRazdel"": 21024646,
  ""IdObjectCurrency"": 174368,
  ""Zone"": ""ALFA"",
  ""AmountOwn"": 0.0,
  ""AmountMargin"": 0.0,
  ""CmsTotal"": 0.0,
  ""ExtraCmsPossible"": false,
  ""TaxBase"": 0.0,
  ""TaxRate"": 0.0,
  ""RateToRub"": 1.0,
  ""ErrorCode"": 0,
  ""ErrorText"": null
}
2022-06-08 10:40:48.40218 Результат преобразования ответа ЛС (из ClientGetWithdrawMoneyLimitRsp в NTOperationConstraintsResponse):
{
  ""Limits"": {
    ""Own"": 0.0,
    ""Marginal"": 0.0
  },
  ""Taxes"": {
    ""TaxTotal"": 0.00,
    ""TaxSum"": 0.00,
    ""TaxRate"": 13.00,
    ""BalancePrice"": 0.00,
    ""AmountToRub"": 1.000000,
    ""IsActual"": true
  }
}
{code}
На балансе у клиента только ДС 
 !image-2022-06-09-10-20-26-630.png|width=912,height=254!
 Заявок на покупку БПИФа не выставленно, боланс положительный, а значит и ДС должны быть доступны к выводу.

Выяснили, что проблему также создала зависшая заявка на продажу БПИФ от 25.05, она урезала доступный для вывода лимит (в данном случае на всю сумму).

Эти заявки по умолчанию переводятся в отмененные через 30 дней, необходимо, чтобы это случалось через 1 день",,,Core
ADIRINC-626,2274930,U_M0NT4,Закрыт,08.06.2022 13:41,,,,,Дефект промсреды,22.02.2024 13:56,2022-08-10 00:00:00.0,"Добрый день!


При запросе в multi-markets-api по 3 symbolObjects(""ASZ_DR"", ""EUR"", ""USD""), процедура вызывается только по бумагам? [http://adirelkprod.alfadirect.ru/goto/d70b13747e7dcdcc153e88d8b735a31d]
Вызов multi-markets-api
curl 'http://adappr1:24406/markets' -X POST -H 'AUTH-USER-ID: AHE0NM' -H 'CHANNEL-ID: I1' -H 'Content-type: application/json' -d '\{""symbolObjects"":[ ""ASZ_DR"", ""EUR"", ""USD"" ]}' | jq []
Вызов процедуры:
Тип команды: 'StoredProcedure'
Текст команды: '[actives].[get_symbol_trade_boards]'
Входные параметры: '[\{""name"":""symbol_list"",""value"":{""values"":[{""symbol_object"":""ASZ_DR""}]}}]'

Из-за того, что инструмент ASZ_DR кривой, возвращается пустой список, из-за чего падает отображение всего портфеля (в том числе и валют)Выяснили, что инструмент 

ASZ_DR не должен отображаться в портфеле, так как является дробью, но в любом случае, если у клиента 1 проблемный актив и валюты, то ситуация будет аналогичной.

Ожидается, что вы вернете доступные рынки и по бумагам, чтобы ломалось отображение доходности только по кривым инструментам
!Изображение из iOS.png|width=369,height=799!",,4.0,Core
ADIRINC-625,2268883,U_M187Q,Отклонен,06.06.2022 16:24,,,,,Дефект промсреды,17.05.2023 12:56,2022-07-19 00:00:00.0,"При запуске 2-ух контейнеров с config-server, ломаетcя api-config. В config-server ошибка 
""Cannot pull from remote ssh://git@git.moscow.alfaintra.net/ainvest/infra-configs.git, the working tree is not clean. ""
 !image-2022-06-06-16-22-57-956.png|thumbnail! ",,,Core
ADIRINC-624,2268871,U_M187Q,Отклонен,06.06.2022 16:20,,,,,Дефект промсреды,17.05.2023 12:56,2022-07-19 00:00:00.0,"Мезос  должен гасить все мезос-контейнеры на хостах помеченные как Unreachable и после этого поднимать новые контейнеры, но не всегда контейнеры стопаются. Пример авария 02.06.2022  !image-2022-06-06-16-18-48-928.png|thumbnail! ",,,Core
ADIRINC-623,2268740,U_M1FHQ,Закрыт,06.06.2022 16:04,,,,,Дефект промсреды,06.06.2022 17:38,2022-07-19 00:00:00.0,"Добрый день! 

Клиент 1264688 пытается вывести BYN на текущий в АБ, но выхожит ошибка расчета лимитов.

  !image-2022-06-06-15-56-26-667.png|width=803,height=272!

!image-2022-06-06-15-57-26-992.png!

В секе такое:
{code:java}
Auth: auth:filin_da2
Elapsed: 15
level: Error
Request:
{""authType"":""Login"",""authToken"":""filin_da2"",""channel"":""STAD"",""accountId"":1264688,""subAccountId"":0,""section"":""MAIN"",""assetId"":""BYN"",""amount"":0.0,""operation"":""OUT""}
requestId:
1e7562b1-e9f7-4b47-a298-3a8f87392edd
Response:
{""type"":""https://tools.ietf.org/html/rfc7231#section-6.5.1"",""title"":""One or more validation errors occurred."",""status"":400,""requestId"":""1e7562b1-e9f7-4b47-a298-3a8f87392edd"",""errors"":{""request"":[""The request field is required.""],""$.assetId"":[""The JSON value could not be converted to LimitService.Contracts.Enums.Currency. Path: $.assetId | LineNumber: 0 | BytePositionInLine: 130.""]}}
Source: LK_AlfaDirect
StatusCode: BadRequest
url: /rest/ntoperation/constraints
User: filin_da2
X-Request-Id: 1e7562b1-e9f7-4b47-a298-3a8f87392edd
{code}
Логи: [http://adirelkprod.alfadirect.ru/goto/1185179ebe6a58b3194130fdc7c729aa]
Треды с обсуждением: [https://alfamobile.slack.com/archives/C0152MPGQEB/p1654514090048049]
https://alfamobile.slack.com/archives/C01AY4L37K4/p1654515036427589",,,Core
ADIRINC-622,2268083,U_M177U,Закрыт,06.06.2022 14:47,to_fix,,,,Дефект промсреды,03.12.2022 15:35,2022-09-19 00:00:00.0,"Не обновляется Субсчет на вкладке ""Позиция"", при смене субсчета через вкладку ""График"".

 

Воспроизведение: в одном портфеле переходим в бумагу, выбираем вкладку ""График"", в графике, наверху, в выпадающем списке, меняем портфель, затем переходим на вкладку ""Позиция"".

ОР: отображается позиция по счету, на который переключались из вкладки ""График"".

ФР: отображается позиция по счету, из которого в Портфеле переходили в инструмент.

!image-2022-06-06-14-40-56-595.png|width=236,height=458!

Вверху экрана нулевой, в разделе позиция 006. 

У клиента данный инструмент куплен и на 000 субсчете и на 006 и данный баг вводит его в заблуждение.",,1.0,Мобильный терминал
ADIRINC-621,2266704,U_M1DQU,Закрыт,06.06.2022 11:25,to_closed,,,,Дефект промсреды,23.06.2022 13:07,2022-08-08 00:00:00.0,"МТ 2.14.0. Андроид.

На вкладке ""Заявка"" - ""Продажа"", *в режиме ""Pro""*, не отображается доступное кол-во шт., всегда пишет: ""В портфеле: 0 шт."", хотя в портфеле ЦБ имеются. В режиме ""Lite"" - отображается корректно.

При этом, если руками указать нужное кол-во из доступных в портфеле, заявка выставится.

Режим ""Pro"":

!image-2022-06-06-11-21-37-362.png|width=251,height=492!

Режим ""Lite"":

!image-2022-06-06-11-22-11-716.png|width=259,height=520!",,21.0,Мобильный терминал
ADIRINC-620,2258736,U_M19LL,Отклонен,02.06.2022 10:33,,,,,Дефект промсреды,28.06.2022 11:02,2022-07-15 00:00:00.0,"Клиенты при попытке продать акции (POLY, YNDX, OZON) получают ошибку:  Инструмент не доступен к торгам для данного типа счета.  Запрет на продажу данных бумаг снят 26.05.2022г. ",,18.0,Core
ADIRINC-619,2257007,U_M18H1,Закрыт,01.06.2022 15:44,,,,,Дефект промсреды,22.09.2023 13:32,2022-10-26 00:00:00.0,"При попытке вывода на счет в АБ возникает данная ошибка.

Необходимо корректно обработать ошибкую и представить ее в легком для восприятии клиента виде.

На данный момент клиенту было посоветовано переустановить приложение и перелогиниться.

!http://sm-web1/sm/servlet/attachment/snimok_ekrana.png?application=incidents&topic=SD15220844&type=file&uid=62961a4d003c2204802618b8&key=CERF1UNJsDZABcYsqoYmXKAYwr!",,21.0,Личный кабинет
ADIRINC-618,2250882,U_M00ZM,Отклонен,31.05.2022 09:56,,,,,Дефект промсреды,09.06.2022 10:05,2022-07-13 00:00:00.0,"Не отображаются данные о предстоящих выплатах дивидендов по многим инструментам в МТ.

Для примера - RU0007775219. В МТ последняя дата фиксации: 12.10.21. Но должны быть дивы за 12.07.22 - [https://nsddata.ru/ru/news/view/854921.]

RU000A0DKVS5 - [https://nsddata.ru/ru/news/view/849373] должны быть дивы 05.05.22 + 11.10.21 - [https://nsddata.ru/ru/news/view/771344]. В МТ последняя дата - 07.05.21.

В [hell_cache].[dividends].[history] отсутсвуют данные по этим инструментам. Есть предположение, что проблема в неполучении данных от Micex'a, либо не формировании очереди по дивам в MQ.

Архитектура во вложении.",,,Core
ADIRINC-617,2250771,U_M1CUE,Отклонен,31.05.2022 09:00,,,,,Дефект промсреды,06.08.2024 10:28,2022-08-02 00:00:00.0,"Клиент пытается открыть БС в приложении Альфа-Инвестиции
ОР: Клиент успешно открывает счет
ФР: У клиента высвечивается ошибка \\\\\\\\\\\\\\\""Нужен второй заход\\\\\\\\\\\\\\\"", В логах ошибка, что паспорт РФ просрочен, хотя на самом деле это не так   !image-2022-05-31-08-57-20-632.png|thumbnail!  !image-2022-05-31-08-57-37-679.png|thumbnail!  !image-2022-05-31-08-58-23-046.png|thumbnail! ",,19.0,Core
ADIRINC-615,2242190,U_M00ZM,Закрыт,27.05.2022 09:25,Фронт,,,,Дефект промсреды,15.11.2022 13:22,2022-07-29 00:00:00.0,"Не отображается Ддата погашения и Ближайшая выплата во вкладке ""Позиция"" по активам в версии МТ v.2.14.0 для Android. 

!http://sm-web2/sm/servlet/attachment/16535714283905560899960425146179_%281%29.jpg?application=incidents&topic=SD15181922&type=file&uid=628f188e000a30938025e8a0&key=Kg8VMkvfe5gpQ%2BmX0emPUepLcz|width=250,height=500!",,16.0,Мобильный терминал
ADIRINC-614,2240597,,Закрыт,26.05.2022 16:45,,,,,Дефект промсреды,02.03.2023 16:24,2022-08-19 00:00:00.0,"При попытке вывода с одного счета на дргугой (пока проверили на счетах клиента AVTT3M, РЦБ -> Фортс) появялется ошибка ""При расчете лимитов произошла ошибка. Обратитесь в службу клиентского сериса"".

Если несколько раз переключиться между вкладками- например, прыгнуть на вкладку ""В дргуой банк"", и затем вернуться, то ошибка пропадает и сумма, доступная к выводу считается корректно.

В сразу после в Seq можно найти две почти аналогичные записи- одна с ошибкой, вторая нет.

!image-2022-05-26-16-41-38-487.png!

Скрин ошибки:

!image-2022-05-26-16-45-00-265.png!",,,Core
ADIRINC-613,2239116,U_M1FE1,Закрыт,26.05.2022 09:23,,,,,Дефект промсреды,22.02.2024 12:49,2022-08-19 00:00:00.0,"# В МТ перепутаны местами тестирования по облигациям и акциям в уроках для начинающих.

Воспроизведение:

1.
 # Открыть вкладку ""Обучение""
 # Перейти в ""Уроки для начинающих""
 # Открыть ""Шаг 2. Гид по ценным бумагам"" - ""Стоит купить акции?""
 # Нажать ""Открыть тест""

ОР: Откроется тестирование по акциям.

ФР: Открывается тестирование по облигациям.

2. 
 # Открыть вкладку ""Обучение""
 # Перейти в ""Уроки для начинающих""
 # Открыть ""Шаг 2. Гид по ценным бумагам"" - ""Стоит купить облигации?""
 # Нажать ""Открыть тест""

ОР: Откроется тестирование по облигациям.

ФР: Откроется тестирование по акциям.
  ",,7.0,НТФ (ЛК)
ADIRINC-610,2233442,U_M16WU,Закрыт,24.05.2022 11:27,,,,,Дефект промсреды,10.04.2024 11:55,2023-09-08 00:00:00.0,"Позиции по новым валютам, которыми разрешено торговать в QUIK (CHF, BYN, CNY, TRY,HKD), в файле лимитов обозначаются как бумаги, а не как  деньги.  В связи с этим клиенты не могут провести сделки по продаже и терпят убытки. Просьба исправить.  С климовым Алексеем Петровичем разговаривали на эту тему, он  в курсе проблемы.",,2.0,Core
ADIRINC-607,2228956,U_M198S,Отклонен,23.05.2022 10:34,,,,,Дефект промсреды,02.03.2023 16:18,2022-07-05 00:00:00.0,"Добрый день! 

Неоднократно замечали, что при наличии минуса в ДС на Инвесткопилке, например после удержания комиссии, то баланс не пересчитывается автоматически. Это приводит к тому, что клиенту надо вновь пополнить счёт инвесткопилки, а после уже совершать вывод. 

!image-2022-05-23-10-34-34-306.png!",,,Core
ADIRINC-606,2226698,U_M1AYE,Отклонен,20.05.2022 15:51,,,,,Дефект промсреды,05.05.2023 14:25,2022-07-04 00:00:00.0,"У 1327 активов, которые имеются в портфеле у клиентов (!) Отсутствует текущая и входящая цена в МТ и ДТ. 

Проверить можно следующим скриптом:

select distinct obj.isin from adfront.bs.Objects as obj
 join ADFront.[bs].[Positions] as pos on pos.IdObject = obj.IdObject 

where obj.idObject not in 
 (
 SELECT distinct(fi.IdObject) FROM AdFront.fi.fininfoext as fe 
 join ADFront.dbo.FinInstruments as fi on fe.IdFi = fi.IdFI
 join ADFront.Liquidity.TradeMarketBoards as liq on liq.IdMarketBoard = fi.IdMarketBoard
 where (
 (
 (
 (DATEPART(DD,fe.PrevLastDate)-DATEPART(DD,FE.PrevFairPriceDate)) <= 10)
 and fe.PrevLast != 0 or fe.PrevLast is not null
 ) 
 or fe.FairPrice is not null
 )
 and liq.IsLiquidMarketBoard != 1
 )

and obj.ISIN is not null
 and obj.CodeObjectType != 'CC'
 order by obj.ISIN

 

Скрипт писал на основании, что актив с ценами должен быть на ликвидном рынке - [http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=620499735]

+ формула текущей и входящей цены [http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=588006710]

 

Пример у клиента 4605294. С ISIN'ами: RU000A0JTFL1, RU000A0JP4L0, RU000A0JRMM9

!image-2022-05-20-15-53-31-212.png!",,19.0,Core
ADIRINC-605,2223341,U_M1FPP,Отклонен,19.05.2022 15:53,,,,,Дефект промсреды,30.11.2022 12:07,2022-07-01 00:00:00.0,"Обращаются клиенты с некорректным отображением в брокерском отчете.

Брокерский отчет строится на основании информации полученной из БД quotes и если активы клиента на данный момент не торгуются на бирже, на которой он его покупал, то может возникнуть расхождение с брокерским отчетом, т.к. данные по активу берутся из разных мест.

Необходимо устранить расхождение между брокерским отчетом и торговыми интерфейсами. 

Пример у клиента гс 284081 за 06.04.22:

  !http://sm-web2/sm/servlet/attachment/snimok_ekrana.png?application=incidents&topic=SD14832965&type=file&uid=624d8f6c0018819981cb2790&key=JQlVmRAxB2RUgrxptVxn0tL1Fs|width=297,height=633!

!http://sm-web2/sm/servlet/attachment/snimok_ekrana2.png?application=incidents&topic=SD14832965&type=file&uid=624d8f6c0018819a81cb2790&key=g4xrl6mPZA2A5mC%2FTe97dLSwst!

 ",,,Core
ADIRINC-599,2213091,U_M19LL,Закрыт,16.05.2022 18:45,feature_request,ОТЭИСФЛ,,,Дефект промсреды,10.01.2024 09:57,2022-08-10 00:00:00.0,"Поступают жалобы от клиентов. Нет информации по купонам Только инфо по выплаченным купонам…
Например: Облигация RU000A102V51
Во вкладке купоны нет графика выплаты купонов по данной облигации…
В купонном календаре тоже нет инфо по данной облигации.
Данные по купонному календарю тянутся с Блумберг. На данный момент Блумберг отключил нас от своих сервисов, поэтому информация в календаре неверная. ",,252.0,Сатурн
ADIRINC-598,2204706,U_M1AYE,Закрыт,12.05.2022 16:21,,,,,Дефект промсреды,26.12.2022 11:27,2022-06-24 00:00:00.0,"Чтобы воспроизвести проблему:

Открыть Торговый стакан (DOM) -> Уменьшить ширину стакана

ОР: элементы управления остаются видимыми при изменении ширины окна

!image-2022-05-12-16-17-10-163.png!

ФР: элементы управления скрываются при изменении ширины окна

!image-2022-05-12-16-14-54-548.png!

Если стакан достаточно широкий, то все элементы управления («доллар», автоподбор ширины колонок, оранжевая галочка и проч.) в заголовке видны, и ими можно пользоваться.
Однако если уменьшить ширину стакана до приемлемой (мне такой широкий стакан совсем не нужен), то все элементы управления в заголовке пропадают.

Используемая версия терминала- 4.0.3417.2101.",,,АИ ПРО
ADIRINC-597,2197299,U_M1FPP,Отклонен,06.05.2022 14:12,,,,,Дефект промсреды,20.05.2022 11:37,2022-06-22 00:00:00.0,"Обращаются клиенты с тем, что RU000A101KJ2 торгуется на МБ, а у нас нет.
На самом деле, торги у нас идут на 150 борде (МБ ЦК T+1), а у клиентов инструмент заведен на 14 борде (МБ)
Докупить допустим они смогут из раздела ""Рынки"", но уже имеющиеся продать из портфеля не могут.
Для примера, гсы - 37927,200082,635398,66964
+ RU000A103UY6, RU000A1023L9 Заведены корректно, везде активны, но на МБ торги идут, а у нас с 27 апреля - нет

 ",,,Core
ADIRINC-595,2194460,U_M1FPP,Закрыт,05.05.2022 14:58,,,,,Дефект промсреды,26.10.2022 09:21,2022-07-11 00:00:00.0,"У клиентов не отображаются позиции в портфеле, на рынке, отличном от заведенных в adfront. В большинстве своем, у клиентов ЦБ на СПБ, а СПБ рынок по данной ЦБ не заведен в 4ке. Проверить проблемных клиентов-ЦБ можно скриптом:
{code:java}
 select acc_code, b.p_code, b.real_rest, b.place_code, mb.NameMarketBoard
   from hell.dbo.balance as b
  join hell.dbo.actives as a on a.p_code = b.p_code
  join adback.hell.matchactives2objects as mao on mao.act_id = a.act_id
  left join adfront.bs.positions as p on p.idaccount = b.treaty and p.idobject = mao.idobject
  join adfront.bs.objects as o on o.idobject = mao.idobject 
  join ADFront.dbo.FinInstruments as fi on fi.idobject = o.idobject
  join [ADFront].[dbo].[MarketBoards] as mb on mb.IdMarketBoard = fi.IdMarketBoard
  left join AdFront.fi.FinInfoExt as fie on fie.idfi = fi.idfi
  where 1=1
  and b.p_code not in ('money','USD', 'EUR')
  and b.real_rest > '0.00'
  and p.idobject is null
  and b.treaty > 1000
  and b.treaty < 99999999
  and len(o.isin) =12
    and fie.IdTradePeriodStatus in ('6','10')
  and fie.IdAllowOrderStatus = '4'
 --and mb.namemarketboard not like '%спб%' --нет спб борда
   --and b.place_code = 'SPBEX_FSHR' --спб в портфеле
  order by acc_code desc
{code}
На данный момент, 994 инструмента без СПб маркета, но имеющихся у клиентов.

Обсуждали тут - [https://alfamobile.slack.com/archives/C0152MPGQEB/p1651218671948339]

На случай отключения слака, во вложении также прикрепил переписку.

Список таких инструментов - .[^списокЦБ.txt]",,244.0,Core
ADIRINC-589,2188043,U_M1DQU,Отклонен,30.04.2022 09:37,to_fix,,,,Дефект промсреды,02.09.2022 13:32,2022-06-20 00:00:00.0,"Добрый день! 



Обратился клиент с некорректной суммой величины купона. Скорректировали через АА. На след день на ios данные скорректировались, при этом на Андройде они не изменились.

!02d02012-f37f-46e6-8ad4-5fe3ce383539.jpg|width=269,height=583!

!a68ae359-b651-4240-8e15-49d1ce26c416.jpg|width=272,height=608!

 

 ",,,Мобильный терминал
ADIRINC-588,2188042,U_M0AXT,Отклонен,30.04.2022 09:11,,,,,Дефект промсреды,23.11.2022 20:30,2022-06-20 00:00:00.0,"Добрый день! 

Обращается клиент с вопросом по двум выставленным заявкам -354657700, -354497414
Со слов клиента, он их не выставлял. Да и по логам видно, то инициатор - ADir2010.
Это могут быть роботы? Какой признак даст ответ на это? 

Как мы можем просмотреть весь список роботов по клиенту?

!image-2022-04-30-09-08-25-253.png!

Может стоит в терминалах показывать, что заявка выставлена роботом? Чтобы клиенты не обращались к нам с вопросами? ",,,Core
ADIRINC-587,2188041,U_M177U,Отклонен,30.04.2022 08:21,to_fix,,,,Дефект промсреды,03.12.2022 15:32,2022-06-20 00:00:00.0,"Добрый день! 

Клиент 4472018 
Платформа МТ 
У клиента ИИС. 
При запросе реквизитов счета через МТ → Портфель → Пополнение → Показать реквизиты у клиента показывает реквизиты брокерского счета, а не счета ИИС.

У меня всегда реквизиты брокерского тоже на IOS.",,,Мобильный терминал
ADIRINC-586,2187627,U_M1DQU,Закрыт,29.04.2022 18:48,not_reproduced,,,,Дефект промсреды,15.03.2023 12:29,2023-03-17 00:00:00.0,"Добрый день! 

При переходе в МТ в инструмент иностранного эмитента показывается ошибка.
Даная ошибка расценивается клиентами, как проблема, после чего они формируют обращение в саппорт.

!d1b8c84c-5a89-4cdc-90e0-ac8a1b11a1fe.jpg!

Необходимо возвращать понятную для клиента ошибку.",,3.0,Мобильный терминал
ADIRINC-585,2186379,U_M1FPP,Закрыт,29.04.2022 14:48,,,,,Дефект промсреды,06.04.2023 17:00,2022-06-17 00:00:00.0,"Добрый день!

Приходит много обращений что клиенты не видят позиции в МТ.  Если смотреть скриптом то таких позиций около 20 тысяч. Есть ощущение, что это происходит, когда есть какие то проблемы на базе и в это время позиции не пишутся в ADFront. Просьба проверить. Примеры отдельных клиентов: ГС  4387401 нет позиции по US00165C1045 и CA86730L1094; ГС 2389584 нет позиций по US62914V1061

 
{code:java}
select
	dateadd(second,b.i_last_update,'1/1/99') as time,
	b.acc_code,
	b.p_code,
	o.isin,
	a.act_id,
	mao.IdObject,
	p.IdObject as pos,
	b.real_rest
from hell.dbo.balance as b
join hell.dbo.actives as a on a.p_code = b.p_code
join ADBack.[hell].[MatchActives2Objects] as mao on mao.act_id = a.act_id
left join ADfront.[bs].[Positions] as p on p.IdAccount = b.treaty AND p.IdObject = mao.IdObject
join ADfront.[bs].Objects as o on o.IdObject = mao.IdObject
where 1=1
and b.p_code not in ('money','USD', 'EUR')
and b.real_rest > '0.00'
and p.IdObject is null
and b.treaty > 1000
and b.treaty < 99999999 
order by b.i_last_update desc
{code}",,24.0,Core
ADIRINC-584,2184040,U_M00ZM,Отклонен,28.04.2022 18:18,,,,,Дефект промсреды,02.03.2023 16:06,2022-06-17 00:00:00.0,"У клиента ГС 4482234 на ИИС были фонды ВТБ - Ликвидность с тикером (VTBM), они у нас заведены с тикером VTBL, но у клиента также были фонды ВТБ - Акции европейских компаний, у которых тикер VTBL (RU000A103WS4), в итоге у клиента сейчас 375 фондов на ИИС с тикером VTBL но с названием - ВТБ Ликвидность , это неправильно, так как столько фондов (375) было на ИИС ВТБ - акции европейских компаний.
Остальные фонды с тикером VTBM не отображаются на ИИС (ориентировочно их должно быть около 3000 +-).
У нас некорректно заведен инструмент ВТБ ликвидность, у него тикер VTBM, а не VTBL, что приводит к путанице по фондам. В итоге у клиента сейчас нет фондов ВТБ ликвидность.
График по фондам ВТБ Акции европейских компаний (VTBL) не отображается в МТ и нет позиций вообще.",,,Core
ADIRINC-583,2183243,U_M0WVN,Закрыт,28.04.2022 15:29,,,,,Дефект промсреды,23.12.2022 17:08,2022-07-06 00:00:00.0,"*Обсуждение истории: https://alfamobile.slack.com/archives/C0152MPGQEB/p1651131968584169*

*Шаги воспроизведения:*
 # Клиент заходит в карточку брокерского счета ИИС
 # Смотрит информацию по нему.
 # Вывод с него не должен быть доступен из приложения.

*Фактически:*

В логах видим огромный всплеск запросов при входе в данный раздел к transfers-api/avaliable

*Ожидаемый результат:*

Не вызывать данный метод при открытии карточки по брокерскому счету ИИС+ есть вопросы к количеству данных запросов с фронта. Они не пропорциональны входам в приложение, не то что в данный раздел.

Примеры:

Зашел в свой счет иис на IOS

!image-2022-04-28-15-24-36-082.png!

При этом вызовы на апи такие 

!image-2022-04-28-15-25-40-015.png!

 

С 28.04.2022 10.00 резкий всплеск обращений и ошибок к данной апи, причины мне так и не ясны почему именно в это время и день.

!image-2022-04-28-15-27-50-560.png!

 ",,,Мобильный терминал
ADIRINC-569,2174778,U_M1CUE,К закрытию,26.04.2022 11:21,,,,,Дефект промсреды,,2022-07-04 00:00:00.0,"На данный момент кол-во активов обрезается/округляется до целого числа.
 Необходимо скорректировать это и отображать реальное количество активов (могут быть дробные числа)
 Для примера, после корп действий по AT&T, был начислен инструмент US9344231041 и у клиентов отображается дробное кол-во активов.
 При этом, в Позиции по инструменту, отображается корректно (не сломать!)

Для некоторых клиентов , проблема наблюдается и в отображении актива",,64.0,Montblanc
ADIRINC-568,2173327,U_M00ZM,Закрыт,25.04.2022 17:19,,,,,Дефект промсреды,02.06.2022 10:26,2022-06-16 00:00:00.0,"При переводе в другой банк у клиента возникает ошибка 
""Ошибка при разборе сообщения #IAD220425000AXG: BSM0029PDA7E Требуется пройти идентификацию"". Даже если у клиента уже есть полная идентификация                                                                                                       

В рамках миграции клиентов из ВТБ, была выполнена доработка в системе расчетов, для исключения внешних платежей с брокерских счетов для не идентифицированных клиентов.
http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=803016629 

В рамках этой доработки добавилось проверка условия на идентификацию клиента с помощью следующего алгоритма 

Но коллеги, не учли что в таблице UIDPF нет записей по клиентам зарегистрированным до 2019-03-03, даже если по ним есть полная идентификация.
Из-за этого по клиенту и возникает данная ошибка.",,,АИ ПРО
ADIRINC-567,2167792,U_M173X,Закрыт,22.04.2022 16:28,,,,,Дефект промсреды,02.03.2023 15:58,2022-06-09 00:00:00.0,"При переводе в другой банк нет проверки на идентификацию клиента. У клиента отображается успешный перевод, но через некоторое время деньги возвращаются на счет. При этом у клиента ошибка  #IAD2204200003TU: BSM0029PDA7E Требуется пройти идентификацию                                                                                                             !image-2022-04-22-16-25-50-770.png|thumbnail! . 

Необходимо осуществлять данную проверку на начальном этапе и если у клиента нет идентификации вернуть ошибку с инструкцией по решению проблемы",,,Личный кабинет
ADIRINC-566,2167408,U_M1FPP,Закрыт,22.04.2022 15:12,,,,,Дефект промсреды,22.11.2022 09:53,2022-08-11 00:00:00.0,"У клиента 1071536 не отображается нкд по ABIPd220426 и ABIPd231141.

Бумага у него числится на МБ, но у нас НКД есть только на Евроклире(1 скрин)

Но возникает следующая ситуация:

1. Имеем андроид девайс.
2. подключаем портфель клиента, у которого были эти бонды
3. открываем в портфеле этот бонд, идем в сводку, НКД = 0 _рублей_(!)
4. идем в ""Рынки"", находим инструмент в поиске, открываем сводку и видим в ней нкд = 24.75 _$_(!)
5. Отключаем портфель клиента, идем в рынки, находим бонд, нкд = 24.75_$_.

При этом, на айфоне у коллеги в поиске по рынку отображает 0 _рублей_.
заметил по логам, что в момент, когда я открываю инструмент в рынке, идет обращение к кэшу из инстанса LTRCache - Server=LTRhell_cache.alfadirect.ru;Database=hell_cache;
Соотв. данные по инструменту в рынке тянутся с кэша. Но на инстансе кэша, в bs.object так же null. А цифра 24.75 числится только в AccruedInt - Fi.fininfoext
разница андроид и айос в таймаутах. на андроиде таймаут 10с, как я знаю. и была ситуация, когда я заходил в стакан по этому инструменту, ловил таймаут, прибивал приложение, открывал заново и потом в рынке ловил инфу по кешу.
может быть такое, что кэш вызвается только в случае таймаутов? и поэтому на айфоне мы такую ситауцию не видим
[^22-04-22-11-05-58.mp4]",,,Мобильный терминал
ADIRINC-565,2166751,U_M1BFA,Закрыт,22.04.2022 12:15,,,,,Дефект промсреды,28.05.2022 08:45,2022-06-30 00:00:00.0,"При открытии окна с однострочными и двухстрочными котировками при включенном флаге Информация об эмитенте делается вызов по всем инструментам в данном окне. Что некорректно. По себе удалось вызвать несколько тысяч вызовов.  !image-2022-04-22-12-12-44-762.png|thumbnail!  !image-2022-04-22-12-12-52-640.png|thumbnail! ",,,АИ ПРО
ADIRINC-563,2161618,U_M173X,Закрыт,20.04.2022 18:42,,,,,Дефект промсреды,06.10.2022 14:13,2022-06-08 00:00:00.0,"Клиент пытается перевести средства между счетами. У клиента ошибка ""При формировании текста поручения произошла ошибка""

!image-2022-04-20-18-40-40-295.png|thumbnail! !image-2022-04-20-18-40-48-491.png|thumbnail!",,19.0,Core
ADIRINC-562,2159307,U_M173X,Закрыт,20.04.2022 11:27,,,,,Дефект промсреды,25.08.2022 09:41,2022-06-07 00:00:00.0,"Клиент пытается выставить заявку, возникает ошибка ""Для данной операции нужно пройти тест по акциям, не включенным в котировальные списки"" Хотя у клиента данный тест пройден !image-2022-04-20-11-24-48-865.png|thumbnail!  !image-2022-04-20-11-25-49-904.png|thumbnail! ",,,Core
ADIRINC-561,2156868,U_M00ZM,Закрыт,19.04.2022 14:30,,,,,Дефект промсреды,02.03.2023 15:55,2022-06-06 00:00:00.0,"При покупки валюты заявки отклоняются с ошибка 1297
Ответ от биржи:
""Добрый день!
У альфы в настоящее время есть маркет-мейкер программа по следующим инструментам:
 !image-2022-04-19-14-27-53-723.png|thumbnail! 
Эти ММ программы не ограничены каким-то конкретным ТКС, поэтому все заявки по этим инструментам от идентификаторов альфы считаются ММ-заявками. ММ-заявки разрешено подавать только квал. клиентами.
Возможно будет логично ограничить ММ программы каким-то определённым ТКС, что бы с других ТКС заявки были без признака марке-мейкера.""
",,,Core
ADIRINC-560,2141174,U_M16WU,Отклонен,13.04.2022 11:50,,,,,Дефект промсреды,02.03.2023 15:52,2022-12-30 00:00:00.0,"Клиент пытается совершить сделку с инструментом GAZP, SBER и т.д., но получает в ответ ""ОШИБКА: (972) Данная ценная бумага не допущена к заключению сделок для указанной категории клиентов.""",,,Core
ADIRINC-559,2137458,U_M1ME9,Отклонен,12.04.2022 10:24,,,,,Дефект промсреды,29.11.2022 18:11,2022-05-30 00:00:00.0,"Поручения клиента на покупку ""экзотической"" валюты (CHF, TRY, HKD) отклоняются - ОШИБКА: (1297) Заявка Маркет-мейкера для данного клиента не разрешена. ",,,Core
ADIRINC-558,2136209,U_M1GPT,Закрыт,11.04.2022 18:24,,,,,Дефект промсреды,26.08.2022 09:41,2022-05-30 00:00:00.0,"Добрый день! 

У клиента А-клуба (сотрудника) F99939 3001485 списался налог с Инвесткопилки, загнав счёт в -75к.
Налог действительно был не оплачен, но на другом БС (159946)
В треде [https://alfamobile.slack.com/archives/C0152MPGQEB/p1649158658334959] выяснили, что налог списывается с того счёта, с которого происходит вывод ДС.

Но в данном случае у клиента счёт инвесткопилки стал отрицательным, что вынуждает его заводить ДС на данный счёт.
Кажется, тут стоит учитывать баланс на счёте, при списании налога.",,,Core
ADIRINC-556,2116593,,Отклонен,04.04.2022 12:53,,,,,Дефект промсреды,06.07.2022 09:12,2022-05-20 00:00:00.0,"Добрый день! 
На примере клиента AVG35G (3701441)

Проанализировав рост ошибок при выводе с инвесткопилки обнаружили ошибку ""Количество уходящих активов в D2 превышает позицию (Qty=1852 > PosD=0)""
[http://adirelkprod.alfadirect.ru/goto/b7c6519974de232f0647359fefe01ec4]

Это возникает из-за того, что уже есть активная заявка на продажу данного инструмента (34889004384), однако она выставлена 28.03.2022 10:53.

Не всем клиентам, которые пользуются инвесткопилкой, понятны правила торговли на бирже. Для них это обычный счёт, с которого они подразумевают беспроблемный вывод ДС. 
Кажется, надо делать какой-то лимит по времени",,33.0,Core
ADIRINC-553,2106077,U_M1BFA,Отклонен,30.03.2022 16:24,,,,,Дефект промсреды,30.03.2023 15:49,2022-05-17 00:00:00.0,"Шаги воспроизведения:
 # Клиент заполняет форму ФИО+телефон
 # !image-2022-03-30-16-13-20-385.png!
 # Нажимает продолжить и ждет формы ввода смс\пуш

*Фактически:*

СМС не приходит, кнопка ""Продолжить"" подсвечена серым и потом снова красным

После заполнения формы дергается 

[https://lk.alfadirect.ru/api/onboarding/reg-form-data]

В *логах ЛК* ошибка, что найдено более 1 EQID:

По номеру телефона и ФИО нашлось более 1 cus. model=\{ ""firstName"": ""Ирина"", ""lastName"": ""Круглова"", ""middleName"": ""Евгеньевна"", ""email"": null, ""phone"": ""+7 902 940 76 03"", ""channel"": null, ""mtId"": null, ""accountType"": null, ""platformId"": null, ""googleClientId"": null, ""pin"": null, ""resetPasswordType"": ""LK"" }. searchUsersInEq=\{ ""users"": [ { ""lastName"": ""КРУГЛОВА"", ""firstName"": ""ИРИНА"", ""middleName"": ""ЕВГЕНЬЕВНА"", ""phone"": ""79029407603"", ""cus"": ""AP6YMA"", ""typ"": ""F"" }, \{ ""lastName"": ""Круглова"", ""firstName"": ""Ирина"", ""middleName"": ""Евгеньевна"", ""phone"": ""79029407603"", ""cus"": ""AVYANO"", ""typ"": ""F"" } ],

 

Далее должен быть вызов ссылки паспортовой типо такой:

[https://private.auth.alfabank.ru/passport/cerberus-mini-blue/dashboard-blue/sms?client_id=adirect-web&scope=adirect-web&firstName=%D0%98%D1%80%D0%B8%D0%BD%D0%B0&middleName=%D0%95%D0%B2%D0%B3%D0%B5%D0%BD%D1%8C%D0%B5%D0%B2%D0%BD%D0%B0&lastName=%D0%9A%D1%80%D1%83%D0%B3%D0%BB%D0%BE%D0%B2%D0%B0&mobilePhone=79029407603&redirect_uri=https%3A%2F%2Flk.alfadirect.ru%2Fpassword-restore%2Fuser-info&non_authorized_user=true&acr_values=fullname%3Asms]

Она в свою очередь бы дергала сервис  WSCustomerSearchClients11, который бы вернул такие значения

!image-2022-03-30-16-19-14-449.png!

При таком ответе сервис НЕ знает какое из значений выбрать.

 

В EQ данные по клеинту выглядят так в опции ПФ1

!image-2022-03-30-16-22-08-271.png!

!image-2022-03-30-16-22-19-459.png!",,74.0,Core
ADIRINC-552,2104589,U_M173X,Отклонен,30.03.2022 11:32,,,,,Дефект промсреды,07.04.2022 23:06,2022-05-17 00:00:00.0,"После миграции у клиентов задвоились пины. 
Примеры:  Кудалин Сергей Владимирович - AV2BFU ADJFPF. В таблице import_data.dbo.import_clients по этому клиенту стоит пин ADJFPF и паспорт 22 11 862720 , в eq паспорт 22 11 862720 у пина AV2BFU.  !image-2022-03-30-11-30-10-505.png|thumbnail!  !image-2022-03-30-11-30-24-038.png|thumbnail!  !image-2022-03-30-11-30-44-342.png|thumbnail! ",,,Core
ADIRINC-546,2095323,U_M0X4M,Закрыт,25.03.2022 18:08,,,,,Дефект промсреды,22.07.2022 11:47,2022-05-13 00:00:00.0,"Когда кол-во входов в приложение растет из-за огромного кол-ва вызовов gifts-api, не хватает производительности. На скриншоте видно, что с 9 утра только по 1 клиенту было около 6000 записей. Из-за этого резко вырастает утилизация ЦПУ  !image-2022-03-25-18-01-09-265.png|thumbnail! 

 !image-2022-03-25-17-56-44-656.png|thumbnail! ",,,Мобильный терминал
ADIRINC-545,2094643,U_M0X4M,Закрыт,25.03.2022 14:32,,,,,Дефект промсреды,16.02.2023 15:56,2022-05-12 00:00:00.0,"Добрый день!

При входе на главный экран Альфа-Инвестиции  порождаются большое количество вызовов CHECK_TOKEN на паспорте, даже если никаких действий не предпринимать

  !image-2022-03-25-14-33-30-245.png|width=1043,height=564!

Так же удалось уточнить по вызовам с фронта IOS

При входе в приложение дергаются 

*Running request* *[https://alfainvest.alfabank.ru/invest/api/v1/gifts/portfolios]*
 *Running request* *[https://alfainvest.alfabank.ru/invest/api/v1/gifts/portfolios]*
 *Running request* *[https://sense.alfabank.ru/mobile-invest/api/v1/invest-partners/assets?types=INSURANCE,MUTUAL,TRUST]*
 *Running request* *[https://sense.alfabank.ru/mobile-invest/api/v1/invest-partners/assets?types=INSURANCE,MUTUAL,TRUST]*
 *Running request* *[https://alfainvest.alfabank.ru/invest/api/v1/gifts/portfolios]*
 *Running request* *[https://alfainvest.alfabank.ru/invest/api/v1/gifts/participants]*

Есть предположение , что проблемы с кэшированием на стороне фронта приложения и чаще чем необходимо вызываются в частности [https://alfainvest.alfabank.ru/invest/api/v1/gifts/portfolios] для актуализации виджета Портфель и виджета Акция в подарок.**

Что в свою очередь порождает регулярные обращения CHECK_TOKEN на паспорте

По сравнению с Мобайлом - 20 , против 2-4 вызовов если зайти просто на гравный экран приложения, не углубляясь в остальные функциональности.

 

. 

 

 

 

 ",,,Core
ADIRINC-544,2091461,U_M1CQQ,Закрыт,24.03.2022 15:24,Постмортем,,,,Дефект промсреды,25.03.2022 11:28,2022-04-15 00:00:00.0,"Добрый день! 

Отсутствие кеширование на invest-cerberus-api и многократный вызов паспорта, привело к недоступности Альфа-Инвестиций (МТ) и Альфа-Мобайла.

Коллеги, 24.03 начались торги на МБ после длительного перерыва.
 С 10:00 резко возросло кол-во входов в Альфа-Инвестиции. 

!image-2022-03-24-15-09-39-420.png|width=649,height=91!

Каждый вход клиента в Альфа-Инвестиции приводит к НЕОДНОКРАТНОМУ вызову паспортного сервиса.

!image-2022-03-24-15-18-58-236.png|width=873,height=561!

Из-за увеличения кол-ва входов и многократного вызова паспорта по одному клиенту создалась большая нагрузка на Паспорт, что привело к его падению.

!image-2022-03-24-15-23-12-211.png|width=267,height=512!

 

 

 ",,,Core
ADIRINC-543,2083528,U_M00ZM,Отклонен,22.03.2022 17:21,,,,,Дефект промсреды,07.04.2022 22:58,2022-05-05 00:00:00.0,"Клиент из ВТБ пытается подписать ЭЦП

ОР: клиенту приходит СМС и он успешно подписывает ЭЦП
ФР: клиенту смс не приходит так как в ответе сервиса WSCustomerChannelsInfo12 в поле pho2 пусто",,,Core
ADIRINC-542,2082771,U_M1CQQ,Закрыт,22.03.2022 14:43,,,,,Дефект промсреды,23.03.2022 15:41,2022-03-24 00:00:00.0,"Добрый день! 

Обращаются клиенты, чьи счета были перенесены из ВТБ с проблемой авторизации.
 У этих клиентов нет счетов в EQ.   !image-2022-03-22-14-41-38-304.png!

 

 

 

https://alfamobile.slack.com/archives/C0152MPGQEB/p1647949200891499

 

 ",,,Мобильный терминал
ADIRINC-539,2072419,,Отклонен,17.03.2022 17:17,,,,,Дефект промсреды,23.11.2022 15:10,2022-04-28 00:00:00.0,"Клиент: Гончарова Тамара Нодаровна 259193 AQE49A

Не отображается стоимость активов в портфеле. (Структурные ноты). XS2335610700, XS2359594707. Завис перевод между депозитариями. Статус депоперевода ПРСОСРОЧЕНО",,,Мобильный терминал
ADIRINC-538,2072260,U_M157D,Отклонен,17.03.2022 16:16,,,,,Дефект промсреды,24.11.2022 09:37,2022-04-28 00:00:00.0,"Коллеги, просьба завести бумагу в 4-ку еврооблигация на евроклир, так как не отображается в портфеле у клеинта.

В  ADFront.bs.Objects данные отсутствуют

 

!image-2022-03-17-16-14-38-413.png!

!image-2022-03-17-16-13-41-777.png!",,,Core
ADIRINC-537,2069773,U_M0WVN,Закрыт,16.03.2022 18:10,,,,,Дефект промсреды,16.11.2022 18:36,2022-12-29 00:00:00.0,"Добрый день! 
Обращается ВИП-клиент (134798) с проблемой вывода ДС с брокерского.
Выходит ошибка:
""Недопустимая ситуация: по инструменту PFINad4/1 MKlong/MKshort = 0 или Marge_price = 0. Всего таких инстурментов в позиции: 1""
Данная ошибка возвращается в случае, если хоть один инструмент в позиции не имеет дисконта или имеет цену = 0 ([git|[http://git.moscow.alfaintra.net/projects/ADIR_SQLDB/repos/hell/browse/Hell/Stored%20Procedures/dbo.__newlimit.sql#799]])
Есть 2 поручения (1344093892/6732, 1344093973/5686) на этот инструмент, но они от 20 года.
*Решение:*
Захардкодить клиента в процедуре, чтобы не попадал в запрос:
!image-2022-03-16-18-08-00-249.png!
После того, как клиент успешно выводит ДС, его удаляют из процедуры, после чего опять сталкивается с этой проблемой.
Просьба сообщить ориентировочные сроки исправления данного дефекта или вывода данной процедуры из эксплуатации.",,,Мобильный терминал
ADIRINC-536,2069160,U_M00ZM,Отклонен,16.03.2022 15:15,,,,,Дефект промсреды,10.08.2022 12:23,2022-04-27 00:00:00.0,"Добрый день! 

У клиента (AKKQY9 72999) не отображается баланс по ABIPd231141 (XS2410104736).
 !image-2022-03-16-15-15-10-264.png!

https://alfamobile.slack.com/archives/C0152MPGQEB/p1647430418607299
 Похоже на вчерашнюю проблему из [треда|https://alfamobile.slack.com/archives/C0152MPGQEB/p1646899926649439] , но в данном случае liquidMarketId возвращается:
{code:java}
curl adappn1:8823/markets -X POST -H 'AUTH-USER-ID:AKKQY9' -H 'CHANNEL-ID: I1' -H 'Content-Type: application/json' -d '{""symbolObjects"" : [ ""ABIPd231141"" ]}' | jq[
  {
    ""isin"": ""XS2410104736"",
    ""symbolObject"": ""ABIPd231141"",
    ""exchanges"": [
      {
        ""id"": ""ECL"",
        ""markets"": [
          {
            ""id"": ""EUCL_USD"",
            ""name"": ""ECL с расчетами в USD""
          }
        ],
        ""liquidMarketId"": ""EUCL_USD"",
        ""liquidMarketName"": ""ECL с расчетами в USD""
      },
      {
        ""id"": ""MICEX"",
        ""markets"": [
          {
            ""id"": ""MOEX_EQ_RUB"",
            ""name"": ""МБ""
          }
        ],
        ""liquidMarketId"": ""MOEX_EQ_RUB"",
        ""liquidMarketName"": ""МБ""
      }
    ],
    ""defaultExchangeId"": ""ECL""
  }
]
{code}
Заметил, что в селекте из процедуры [actives].[get_symbol_trade_boards] поле isDefaultExchange равен 0 для MarketID: MOEX_EQ_RUB
{code:java}
USE [hell_cache]
SELECT
    obj.isin
    , obj.symbol_object
    , amb.universal_market_code AS MarketID
    , amb.board_name AS MarketName
    , atb.is_liquid_board AS isLiquidMarket
    , aex.universal_exchange_code AS ExchangeID
    , atb.is_default_universal_exchange AS isDefaultExchange
FROM adfront.objects AS obj
INNER JOIN actives.trade_marketboards AS atb
    ON atb.object_id = obj.object_id
INNER JOIN adfront.marketboards AS amb
    ON amb.board_id = atb.board_id
INNER JOIN actives.universal_exchanges AS aex
    ON aex.universal_exchange_id = atb.universal_exchange_id
	where isin = 'XS2410104736'{code}
!image-2022-03-16-15-14-24-591.png!

Может ли из-за этого не показываться баланс?

 ",,,Мобильный терминал
ADIRINC-535,2068629,U_M1FPP,Закрыт,16.03.2022 14:21,,,,,Дефект промсреды,20.06.2023 09:54,2022-04-27 00:00:00.0,"*Шаги воспроизведения:*
Клиент ГС 71266 сравнивает свой портфль в ЛК и МТ
*Фактически:*
Видит значительную разницу в цене ,в частности по своим облигациям
*Допинфо:*
!image-2022-03-16-14-17-21-830.png! З
!image-2022-03-16-14-16-51-088.png!
Запись в таблицу quotes.PriceInfo.prices
!image-2022-03-16-14-19-10-108.png!
 ",,31.0,Core
ADIRINC-533,2064792,U_M1CQQ,Отклонен,15.03.2022 10:21,,,,,Дефект промсреды,10.08.2022 12:30,2022-03-17 00:00:00.0,,,,Мобильный терминал
ADIRINC-531,2063737,U_M1DKF,На исправление,14.03.2022 17:16,,,,,Дефект промсреды,,2022-06-10 00:00:00.0,"При вызове WSCustomerAccountList19 используются параметры для АЛБО   !image-2022-03-14-17-15-15-721.png|thumbnail!   !image-2022-03-14-17-15-24-197.png|thumbnail! ",,,НТФ (ЛК)
ADIRINC-530,2061906,,Закрыт,14.03.2022 11:34,,,,,Дефект промсреды,31.08.2022 09:42,2022-04-25 00:00:00.0,"У клиента ГС 104915 пропало отображение в МТ инструмента US92766K1060 на OTC EUROCLEAR.
При подключении к клиенту также отображение отсутствует(проблема не в его устройстве). Просьба исправить. Уже обратились несколько клиентов по данной тематике.",,,Мобильный терминал
ADIRINC-529,2057219,U_M1DKF,Закрыт,11.03.2022 09:56,,,,,Дефект промсреды,11.03.2022 17:16,2022-04-22 00:00:00.0,"Клиент нерезедент пытается перевести ДС на текущие счета

ОР: Подтягиваются все счета текущие счета 
ФР: Подтягиваются только счета начинающиеся с 40820",,,АИ ПРО
ADIRINC-528,2052079,U_M00ZM,Отклонен,09.03.2022 12:10,,,,,Дефект промсреды,08.08.2022 15:23,2022-04-20 00:00:00.0,"В таблице hell.dbo.clients не обновляется статус us_sec_status с ""2"" на ""1""  или данный процесс не автоматизированный и необходимо обновлять данный статус каждый раз вручную

 

Пример:
https://alfamobile.slack.com/archives/C0152MPGQEB/p1645165951171299",,,Мобильный терминал
ADIRINC-527,2049956,U_M0YRB,Закрыт,05.03.2022 15:51,,,,,Дефект промсреды,26.08.2022 09:42,2022-04-19 00:00:00.0,"Коллеги, в таблице hell.[dbo].[clients] не обновляются записи по клиентам. 


 *Кейс:*
 ГС 2294177 
 в hell.[dbo].[clients] - Дуванская Карина Александровна
 в Adback.dbo.FLAnkets - Колесникова Карина Александровна
 в EQ AURZGX - Колесникова Карина Александровна

*выгрузка подобных клиентов:*
 select IdAccount
 , ErrorCodeServer
 , ErrorTextServer
 , TextEDocumentClient
 , TextEDocumentServer
 , Date
 from adfront.unk.EDocuments
 where 1 = 1
 --and IdAccount = '82765'
 AND ErrorCodeServer = 40003
 and DATE > dateadd(day, -1, getdate())
 AND (DATALENGTH(TextEDocumentClient) <> DATALENGTH(TextEDocumentServer)
 OR TextEDocumentClient COLLATE Cyrillic_General_CS_AS <> TextEDocumentServer COLLATE Cyrillic_General_CS_AS)
 order by Date desc

*Обсуждение:* https://alfamobile.slack.com/archives/C0152MPGQEB/p1646483207907329",,,Мобильный терминал
ADIRINC-524,2041738,U_M18JH,Отклонен,02.03.2022 12:25,Инвестиции,,,,Дефект промсреды,01.12.2022 16:06,2022-04-14 00:00:00.0,"Добрый день! 

Почему-то у клиента в информационном окне при открытии брокерского счёта отражается не его номер телефона. 
Клиент:
    ГС = 2753252 
    PIN = AUNA0T. 
    Login = grigorev_no
    ClientVersion = 2.11.0 
    DeveloperCode = 201594_892649B5-7694-4925-9EAC-1F719678054B 
    ProtocolVersion = 9.93 
    OSVersion = 10
    OSType = 4
В базе у клиента номер 79852603595. Но когда клиент пытается открыть БС, то высвечивается табличка, что СМС направлен на номер +7 *** *** 08 88. Клиент негодует. Но push реально приходит на его номер.",,,Мобильный терминал
ADIRINC-523,2040182,,Закрыт,01.03.2022 17:30,,,,,Дефект промсреды,31.08.2022 17:48,2022-04-13 00:00:00.0,"Добрый день, Коллеги!
 Клиент: Ильин Дмитрий Александрович AB0FJQ 35271

У клиента в МТ перестали отображаться акции GB00B71N6K86 EVRAZ plc_ORD SHS а.о. Ранее отображались. В АД акции отображаются в портфеле клиента. Ошибок в заведении инструмента в справочник нет.",,,Мобильный терминал
ADIRINC-521,2039090,U_M07DK,Отклонен,01.03.2022 13:11,Инввестиции,,,,Дефект промсреды,15.11.2022 10:08,2022-04-13 00:00:00.0,"Добрый день! 
Отображается ВИП-клиент 242402 Кучина О.В.
К нам перевели 14 бумаг, 2 из которых не отображаются в МТ. # *US3015057074* - нет в 4-ке. У нас есть инструкция для добавления в 4-ку, но для её решения необходимо наличие инструмента в [ADFront.bs|http://adfront.bs/].Objects, но в данном случае там пусто. Как добавить инструмент?
 # *US8288061091* есть и в 3-ке и в 4-ке, однако в ADFront.bs.Objects только на 119 борде, а бумага у клиента на евроклире. Подозреваю, что именно из-за этого и не отображается у клиента. Как отобразить бумагу в МТ?",,,Мобильный терминал
ADIRINC-520,2039086,U_M07DK,Отклонен,01.03.2022 13:07,Инвестиции,,,,Дефект промсреды,02.03.2023 15:39,2022-04-13 00:00:00.0,"Добрый день! 

По US92556H2067 с 20 на 21.02.22 произошли корп. действия.
Изменился тикер с VIAC на PARA и название с ViacomCBS Inc. на Paramount Global.
Название в изменилось, однако тикер изменился только в 3-ке.
В 4-ке остался старый (VIAC).
Подскажите, пожалуйста, есть ли процесс изменения тикера в 4-ке?",,,Core
ADIRINC-519,2035610,U_M12MD,Закрыт,28.02.2022 11:39,Инвестиции,,,,Дефект промсреды,24.11.2022 10:05,2022-05-04 00:00:00.0,"Добрый день! 
Клиент (1822561) видит в портфеле бумагу (XS2410104736), при этом, если искать через поиск в портфеле, то инструмент не отображается.",,,Мобильный терминал
ADIRINC-517,2031159,U_M1DQU,Отклонен,24.02.2022 18:51,unreproducе,,,,Дефект промсреды,05.12.2022 13:44,2022-04-11 00:00:00.0,"У клиента обрезаются значения % в Популярных акциях

2300462 Леонов Олег Андреевич AUR9N8

 

 

!image-2022-02-24-18-50-42-289.png!

 

!popular.PNG!",,,Мобильный терминал
ADIRINC-509,2016679,U_M16SR,Отклонен,17.02.2022 15:49,unreproducе,,,,Дефект промсреды,16.02.2023 15:40,2022-04-04 00:00:00.0,"В МТ у клиентов пропадает список инструментов в Избранном

Обсуждение https://alfamobile.slack.com/archives/C01U3N56V71/p1645099019798479",,,
ADIRINC-508,2011051,RUM101Q,Отклонен,15.02.2022 16:05,,,,,Дефект промсреды,16.02.2022 11:05,2022-03-31 00:00:00.0,"Клиент делает перевод в другой банк:
ОР: Если перевод отменяется, то клиенту на фронт должна выводиться ошибка
ФР: У клиента на фронт выводится сообщение об успешном переводе
",,,Core
ADIRINC-502,2008069,,Закрыт,14.02.2022 15:51,,,,,Дефект промсреды,05.09.2022 09:14,2022-03-30 00:00:00.0,"У клиента 111623 Емельяненко Сергей Владимирович перед выставлением заявки в МТ неверно отображается комиссия за сделку. Клиента на ТП Трейдер, комиссия прописывается как по тарифу Инвестор, это очень смущает клиента.
Просьба исправить отображение комиссии.
Заранее спасибо!",,,
ADIRINC-492,2005197,U_M00ZM,Закрыт,12.02.2022 19:36,to_closed,,,,Дефект промсреды,16.02.2023 15:37,2022-12-06 00:00:00.0,"Шаги воспроизведения:

Клиент 129101 хочет вывести средства на текущий счет

Фактически:

Ловит ошибку 

Переустановка приложения и подписи не помогли.

!image-2022-02-12-19-39-44-584.png!!image-2022-02-12-19-30-43-271.png!!image-2022-02-12-19-31-12-421.png!

Допинфо:

Подробнее проблему обсуждают здесь , продолжают предновогодний тред.

Там была проблема в том что тримятся пробелы где-то на уровне ЛС или ЛК

[https://alfamobile.slack.com/archives/C0152MPGQEB/p164456457382709|https://alfamobile.slack.com/archives/C0152MPGQEB/p1644564573827099]

Последние входы с устройств клиента:

!image-2022-02-12-19-34-08-623.png!

 ",,,
ADIRINC-487,2005178,U_M12MD,Закрыт,12.02.2022 13:48,,,,,Дефект промсреды,29.03.2022 15:31,2022-04-19 00:00:00.0,"На IOS некорректно отображается стоимость облигаций (блог ""Итого"" в разделе заявка) Белый скрин Android, черный IOS  !image-2022-02-12-13-42-12-201.png|thumbnail!  !image-2022-02-12-13-42-32-139.png|thumbnail! ",,,Мобильный терминал
ADIRINC-471,2005165,U_M1DQU,Закрыт,12.02.2022 12:01,unreproducе,,,,Дефект промсреды,24.11.2022 13:26,2022-04-19 00:00:00.0,"Шаги воспроизведения:

Клеинт выставляет заявки на покупку бумаг

Смотрит на сумму комиссии

Фактически:

Комиссия расчитывается не по его ПУ

 ",,,
ADIRINC-470,2005163,U_M1DQU,Отклонен,12.02.2022 10:44,,,,,Дефект промсреды,05.12.2022 13:45,2022-03-30 00:00:00.0,,,,Мобильный терминал
ADIRINC-469,2004204,U_M177U,Отклонен,11.02.2022 15:34,unreproducе,,,,Дефект промсреды,03.12.2022 15:45,2022-03-29 00:00:00.0,"Клиент пытается скролить ""Лидеры изменений в моем списке""

Фактически скрол ведет себя непонятным образм - дергается, улетает вверх

[^logs_and_screenshot.txt]

[^ScreenReord_2022_02_10_09_38_36.mp4]

^Так же в ноябре 21 года были подобные обращения https://alfamobile.slack.com/archives/C01U3N56V71/p1637211150110500^",,,
ADIRINC-468,2002949,U_M18XV,Закрыт,11.02.2022 10:04,,,,,Дефект промсреды,21.03.2022 18:54,2022-03-09 00:00:00.0,"В рандомный момент методы МТРА начинаю долго отвечать. Помогает рестарт МТРА. Из-за этого не подтягиваются курсы валют на сайт Альфа-банка и не работает вывод ДС в МТ , т.к. не может получить лимит 
Треды с проблемой:
https://alfamobile.slack.com/archives/G01GE1851B2/p1644307722433469
https://alfamobile.slack.com/archives/C0152MPGQEB/p1644509808849959
https://alfamobile.slack.com/archives/C0152MPGQEB/p1644558750535789",,,Core
ADIRINC-465,1994061,U_M1AYE,Отклонен,08.02.2022 09:53,to_external_system,,,,Дефект промсреды,17.05.2023 11:53,2022-04-13 00:00:00.0,"Текущее значение стоимости акций на графике и на сводном экране - не совпадает. На двух скриншотах ниже (сняты одновременно) обвёл цифры красным. На скриных также указаны ISIN инструментов.



Данная ситуация воспроизводится утром, до наступления основных торгов",,,Core
ADIRINC-464,1990653,U_M16SR,Отклонен,07.02.2022 11:07,,,,,Дефект промсреды,16.02.2023 15:30,2022-03-23 00:00:00.0,"Добрый день, коллеги! гс 546505 AEOG5B Саузин Владимир Викторович
В терминале на ПК и в мобильном терминале (android)  различаются графики по инструменту, а именно пересечение средних линий на графике, таймфрейм один, на скриншотах видно
Вопрос заключается в том, почему в МТ пересечение под свечей, а на ПК над свечей, если графики одинаковые.

Нв ios данная ситуация с индикаторами не воспроизводится

https://alfamobile.slack.com/archives/C01U3N56V71/p1644218578039669",,,
ADIRINC-462,1984338,U_M0WVN,Закрыт,03.02.2022 12:54,Мобильное_приложение_Альфа_Инвестиции,,,,Дефект промсреды,15.02.2022 15:07,2022-03-21 00:00:00.0,"Шаги воспроизведения:
 # Клиент купил БПИФ Альфа-Капитал
 # При просмотре цены ""За все время"" видит некорректную учетную цену. !Image from iOS (1).png!
 # 

Допинфо:

Цена в портфеле

!image-2022-02-03-12-39-22-360.png!

Цены на разделах MICEX_SHR и MICEX_SHR_T_USD

!image-2022-02-03-12-43-26-308.png!

На сколько нам известно цена при наличии налоговых платежей должна будет из них взяться (hell.tax.interface_income_detail) для отображения цены ""За все время""

Если нет то цена по инструментам за день до депо перевода, если и этого нет то из депо

Налоговые платежи по клиенту в момент создания дефекта  3.02.2022, но пока они не пересчитались клиент видит некорректные данные

!image-2022-02-03-12-52-16-290.png!

 

 

 

 

 

 

 

 

 ",,,
ADIRINC-461,1980476,U_M16SR,Закрыт,02.02.2022 09:27,to_fix,,,,Дефект промсреды,16.02.2023 15:28,2022-03-18 00:00:00.0,"Коллеги, некорректно работает сортировка на вкладке Рынки Лидеры роста/падения



Как есть: акции отображаются в разнобой 

Как должно быть: список акций сортируется корректно от большего к меньшему или наоборот 

 ",,,
ADIRINC-460,1979699,U_M1CUE,Закрыт,01.02.2022 18:17,ОТЭИСФЛ,,,,Дефект промсреды,25.12.2023 10:51,2022-08-19 00:00:00.0,"Добрый день! 
Клиент пытается выставить заявку на бумагу для квалов, не имея такой статус, и получает ошибку ""Спасибо, что получили статус квалифицированного инвестора. Торговля инструментов будет доступна, начиная со следующего дня.""
 !http://sm-web1/sm/servlet/attachment/16437002296998147864735878402676.jpg?application=incidents&topic=SD14295296&type=file&uid=61f7c9ec0035528b814ef850&key=4%2BUB6J7HYfzwrFKfzpIFeXzcCD|width=285,height=637!
 Просьба иначе описать ошибку.",,112.0,
ADIRINC-459,1979354,U_M1C6F,Закрыт,01.02.2022 15:59,,,,,Дефект промсреды,20.01.2023 16:18,2022-04-06 00:00:00.0,"Коллеги, необходимо  добавить инструмент в таблицы ниже 
SELECT isin, instrument_name, *
FROM [news_cache].[direct].[emitents] em
JOIN [news_cache].[direct].[instruments] ins ON em.emitent_id=ins.emitent_id
WHERE emitent_name = 'buffer_emitent'",,,
ADIRINC-458,1978886,U_M0WVN,Отклонен,01.02.2022 14:27,,,,,Дефект промсреды,17.05.2023 13:19,2022-04-28 00:00:00.0,"Шаги воспроизведения:

Клиент хочет посмотреть информацию по купонам бумаги [RU000A103406|http://172.21.0.150:8443/api/Coupon/?assetId=RU000A103406]

Фактически видит ошибку:

!image-2022-02-01-14-25-03-765.png!

 

 

Ответ микросервиса приходит пустой, как и ответ сервиса [http://172.21.0.150:8443/api/Coupon/?assetId=RU000A103406]

В БД данные есть:

 

!image-2022-02-01-14-26-29-944.png!

 

 ",,21.0,
ADIRINC-455,1975313,U_M1CWM,Закрыт,31.01.2022 14:18,,,,,Дефект промсреды,09.02.2023 17:11,2022-03-16 00:00:00.0,"В версии 4.3306.1645 после старта терминала не совсем корректно выравниваются окна по нижней и правой границе экрана, ЕСЛИ на вкладке больше одного окна. Если на вкладке одно окно, то оно выравнивается нормально (см.приложенное видео).",,,АИ ПРО
ADIRINC-454,1975146,U_M1782,Закрыт,31.01.2022 13:03,,,,,Дефект промсреды,30.03.2023 15:45,2022-03-16 00:00:00.0,"Шаги воспроизведения:

Клеинт делает вывод с БС в другой банк.

Получает уведомление об успешной заявке на перевод 

!image-2022-01-31-12-59-06-766.png!

Фактически:

Клиент несколько дней ждет денег, но они не приходят.

У нас не видим перевода тоже.

Как выяснилось в ЛК были ошибки, которые либо не обрабатываются. Либо проверка позже происходит . чем вывод успешной формы клиенту

!image-2022-01-31-12-59-57-716.png!

!image-2022-01-31-13-01-04-499.png!

 

при выводе через ЛК подобная ошибка обрабатывается так  !image-2022-01-31-13-02-46-617.png!",,97.0,
ADIRINC-453,1974903,U_M11PF,Отклонен,31.01.2022 12:43,инвестиции,,,,Дефект промсреды,31.01.2022 14:08,2022-04-05 00:00:00.0,"Добрый день! 

Часто к нам обращаются клиенты с проблемой вывода с БС.
В логах директа видим, что ошибка возвращается с описанием.
При этом, клиенту мы показываем заглушку ""Функциональность временно недоступна. Пожалуйста, попробуйте ещё раз позднее."".

Референс: 
OB43101220001053

Ответ сервиса директа ([http://172.21.0.218:5341/#/events?filter=2aa7e7af-a6d3-4b51-b3bf-0a4e4b405430]): 
Hell error code 1: Сумма вывода 1150.00 money превосходит лимит: 48.34; Поручение сформировано!

В папей ошибка описана так:
!image-2022-01-31-12-40-46-866.png!

[^A010311210115503_pipe_2021-11-03_16.39.34.csv]

 

Данные кейсы генерируют поток обращений клиентов к нам.



 ",,,
ADIRINC-452,1971740,U_M1CWM,Отклонен,28.01.2022 14:36,,,,,Дефект промсреды,05.05.2023 17:30,2022-03-15 00:00:00.0,"Не работает в стакане кнопка автоподбора ширины колонок.
Если уменьшить ширину стакана до определённого значения, то перестаёт работать кнопка автоподбора ширины колонок - при нажатии на неё раскрывается меню выбора инструмента.
Проблема проявляется во всех версиях терминала.",,,АИ ПРО
ADIRINC-451,1969843,U_M17SM,Закрыт,27.01.2022 18:12,Десктопное_приложение_Альфа-Инвестиции,,,,Дефект промсреды,02.02.2023 17:35,2022-04-26 00:00:00.0,"Описание:

У клеинта не работает новый чат в ДТ,  отображается ""нет подключения""

Допинфо:

Логи и скрины (см) во вложении

Обсуждение проблемы и еще немного допинфы тут [https://alfamobile.slack.com/archives/C02HHKRE8CD/p1641922088009400]",,,АИ ПРО
ADIRINC-450,1969590,U_M0WVN,Закрыт,27.01.2022 17:29,unreproducе,Мобильное_приложение_Альфа-Инвестиции,,,Дефект промсреды,19.10.2022 18:14,2022-03-14 00:00:00.0,"*Описание:*

Клиент заходит в чат в приложении Альфа-Инвестиции

*Фактический результат:*

Не видит переписку в чате за предыдущий день

*Допинфо:*

Выходил из приложения и заходил по логину паролю, биометрическим данным, ситуация не меняется. ГС 1267042 Шестюк Иван Викторович 

!image-2022-01-27-17-28-02-345.png!

[^logs.txt.zip]

 ",,,
ADIRINC-449,1965383,U_M1BFA,Отклонен,26.01.2022 13:25,,,,,Дефект промсреды,26.01.2022 13:25,2022-03-11 00:00:00.0,"Добрый день!

 

Суть проблемы:
 # Есть индикатор типа AddShadowSeries, например, такой:
 
 _AddShadowSeries(""VolumeInside"", DrawAs.Custom, Color.Red,_ *_25_*_)_
 
 Параметр, выделенный красным, говорит, что *+индикатор не должен занимать более 25% от высоты окна графика+*.
 # Создаём шаблон с этим индикатором (именованный или по умолчанию — не важно!).
 # Применяем шаблон и получаем следующее:
 
 а должно быть иначе, вот так:

Как видите, при применении шаблона, в котором есть индикатор типа AddShadowSeries, этот самый индикатор отображается, +не принимая во внимание параметр, ограничивающий его высоту на графике+. Приходится всякий раз после применения шаблона удалять и добавлять такие индикаторы вручную, чтобы получить корректное отображение.",,,
ADIRINC-448,1964505,U_M0YRB,Отклонен,26.01.2022 10:49,,,,,Дефект промсреды,03.09.2024 10:11,2022-03-11 00:00:00.0,"Обращается клиент КУСТОВИНОВ СЕРГЕЙ АЛЬБЕРТОВИЧ, 34433
 Примерно 2-3 обновления назад перестали открываться окна в полноэкранный режим на 2-м мониторе… Приходится дублировать окно на главный монитор и только потом раскрывать.

 

https://rc.alfa-bank.net/channel/adir-terminal-support?msg=slack-C02QH6113-1643182515-097300",,,Pro terminal
ADIRINC-447,1964278,U_M1DQU,Закрыт,26.01.2022 10:04,,,,,Дефект промсреды,03.03.2022 11:02,2022-03-31 00:00:00.0,"В режиме Lite отображается корректная цена по этой бумаге
В режиме Pro цена автоматически указана выше, чем есть.

Пример: Клиент 1502510 AHZ41I Логвиненко Алексей Николаевич в приложении проверяет ОФЗ 26211",,,
ADIRINC-445,1962888,U_M1DQU,Отклонен,25.01.2022 15:17,Мобильное_приложение_Альфа_Инвестиции,,,,Дефект промсреды,29.11.2022 18:42,2022-03-10 00:00:00.0,"Шаги воспроизведения:
 # Клиент смотрит календарь купонный по облигации на МБ

Фактически:

Выплаты купонов не совпадают с данными на сайте биржи.

Допинфо:

Пример,

по RU000A101P92 график выплаты купонов в hell.actives.couponredemptionschedule не совпадает с данными биржи [https://www.moex.com/ru/issue.aspx?board=TQIR&code=RU000A101P92&utm_source=www.moex.com&utm_term=ru000a101p92#/bond_4]

!image-2022-01-25-15-07-30-268.png!

По информации от [~U_M1B5W] должны выкатить до середины февраля 2022 новый сервис выкачивания данных из Блумберга, который это поправит",,,
ADIRINC-444,1962521,U_M12MD,Закрыт,25.01.2022 14:40,,,,,Дефект промсреды,29.03.2022 14:50,2022-03-10 00:00:00.0,"# Клиент открывал счет по СМЭВ
 # Заходит в приложение АИ и пытается выпустить сертификат.

Фактически:

Ловит ошибку ""Что-то пошло не так. Не удалось запросить СМС. Актуализируйте мобильный телефон для системы Альфа-Клик или в отделении Банка""

!image-2022-01-25-14-27-57-595.png!

Допинфо:

Входы !image-2022-01-25-14-27-35-406.png!

В опции ДИК (B7PF) EQ не указан номер телефона у клиента

!image-2022-01-25-14-29-09-415.png!

Соответственно смс отправить для подтверждения ЭЦП не удастся, пока он не будет добавлен.

Как вариант использовать kfilop1.y#6pf , где хранятся все контакты клиентов и брать определенные типы, вот как они выглядят в EQ

!image-2022-01-25-14-39-09-797.png!

 

 ",,,
ADIRINC-439,1954622,U_M18JH,Закрыт,21.01.2022 16:23,,,,,Дефект промсреды,20.01.2023 16:10,2022-03-28 00:00:00.0,"# Клиент пришел в отделение и первый раз открывает БС, пополнил его в Мобайле
 # ""в течение 1 часа в приложение не смогли зайти ,пишет сервис временно не доступен ""
 # По истечении часа  на  экране видит сообщение , что счет открыт + ""Подождите 10 мин

Фактически:
 # Не может войти в приложение и более чем через час

Пример:

ГС 3340413 AHLX63

Входов в МТ нет до сих пор с 20.01 после того как открыл счет и пополнил его.

!image-2022-01-21-16-22-11-852.png!

!image-2022-01-21-16-21-49-710.png!

!image-2022-01-21-16-21-40-107.png!

 ",,116.0,
ADIRINC-437,1952128,U_M13J8,Закрыт,20.01.2022 18:18,to_closed,,,,Дефект промсреды,30.11.2022 16:55,2022-03-28 00:00:00.0,"гс 293420 Захаров Владимир Михайлович AEG4WA не отправляются сообщения в чате. При отправке сообщения поле ввода очищается, но сообщение не появляется в главном окне чата.
Обновление приложения до последней версии и чистка кэша не помогли.



!image-2022-01-20-18-12-56-075.png![^logs.zip]!image-2022-01-20-18-12-33-606.png!

!image-2022-01-20-18-10-30-565.png!",,,
ADIRINC-435,1951117,U_M1AYY,Отклонен,20.01.2022 13:48,,,,,Дефект промсреды,07.12.2022 10:24,2022-03-04 00:00:00.0,"У клиентов в течение дня отображается некорректная учетная цена по ФОРТС, связанно это с различным колличеством учтенных сделок в 4-ке и тройке. Процесс дневного обсчета так устроен, что не гарантируется порядок обработки операций. А некоторые операции могут вообще потеряться и не быть обработаны. Отсюда и возможность появления таких феноменов. !image-2022-01-20-13-47-12-458.png|thumbnail!  !image-2022-01-20-13-47-30-536.png|thumbnail! ",,,
ADIRINC-432,1949646,U_M1BFA,Закрыт,19.01.2022 18:21,,,,,Дефект промсреды,09.12.2022 14:33,2022-03-25 00:00:00.0,"Клиенты обращаются массово, что в торговом терминале на ПК, в стакане цена по инструментам отстает от котировок и на графике.

Примеры ГС:

2335 

199948

145186 ",,,
ADIRINC-431,1948178,U_M1DQU,Закрыт,19.01.2022 12:33,,,,,Дефект промсреды,17.03.2022 11:29,2022-03-24 00:00:00.0,"Шаги воспроизведения:

Клиент делает обмен валюты с главного экрана МТ

После ввода суммы , он видит черный экран (см.видео)

[^Video.MOV]

Клиент с IOS входит

 ",,,
ADIRINC-429,1946769,U_M16SR,Закрыт,18.01.2022 17:21,to_external_system,,,,Дефект промсреды,30.11.2022 16:50,2022-03-02 00:00:00.0,"Некорректное описание показателя ""Маржа чистой прибыли"" во вкладке Показатели

На данный момент: Отношение чистой выручки к прибыли

Должно быть:  _Маржа чистой прибыли_ (МЧП) определяется как соотношение чистой прибыли к доходу (выручке), полученному организацией.",,,
ADIRINC-428,1946737,U_00IPG,Отклонен,18.01.2022 16:43,,,,,Дефект промсреды,18.01.2022 16:49,2022-03-02 00:00:00.0,"При открытии счета, не подтягиваются автоматически счета для выводов. При попытке отозвать средства возникает ошибка ""Нет счетов для вывода"".

Сотрудникам КЦ приходится отжимать кнопку в админе ""Загрузить счета из Эквейжн""",,,
ADIRINC-425,1945673,U_M19LL,Закрыт,18.01.2022 13:25,,,,,Дефект промсреды,14.03.2022 15:16,2022-03-02 00:00:00.0,"При открытии счета, не подтягиваются автоматически счета для выводов. При попытке отозвать средства возникает ошибка ""Нет счетов для вывода"". Сотрудникам приходится отжимать кнопку в админе ""Загрузить счета из Эквейжн ",,,Core
ADIRINC-424,1945149,U_M17SM,Закрыт,18.01.2022 11:27,,,,,Дефект промсреды,20.01.2023 16:07,2022-03-02 00:00:00.0,"Необходимо переформулировать сообщение для клиентов, т.к. в текущем виде оно не информативно.
Сообщение: Нарушение бизнес-ограничей по получению FinInfoEntity....",,,
ADIRINC-423,1944400,U_M17SM,Закрыт,18.01.2022 09:45,,,,,Дефект промсреды,20.01.2023 16:06,2022-03-02 00:00:00.0,"Баги новой версии 4.0.3300.7. 
1. не работает на графике режим курсора (перекрестия и информации)
2. лампочка в строке меню с идеями перестала работать после обновления
3. индикатор объема VOL отображается одним цветом на рост и падение
4. невозможно удалить последний список из окна Списки инструментов
5. в красную кнопку надо целиться, что открыть меню, не работает, если нажать в левую часть красной кнопки
6. если на закладке несколько окон, то при запуске приложения их нижняя граница не выравнивается точно по уровню панели задач windows, а уходит чуть ниже, даже если выровнять, то при перезапуске сбивается выравнивание.",,,АИ ПРО
ADIRINC-417,1943643,U_M12MD,Отклонен,17.01.2022 17:08,,,,,Дефект промсреды,25.01.2022 11:03,2022-03-01 00:00:00.0,"Шаги воспроизведения:

котировки--акции–США

Фактически:

При любой сортировке изменение цены будет отображаться как 0%

!image-2022-01-17-17-07-54-864.png!",,,
ADIRINC-416,1943609,U_M1C6F,Отклонен,17.01.2022 17:04,,,,,Дефект промсреды,18.01.2022 11:24,2022-03-01 00:00:00.0,"Если у бумаги last_buy_day > текущего дня, но при этом событие не исполнилось, запись все равно попадает в Историю",,,
ADIRINC-414,1943107,U_M0WVN,Закрыт,17.01.2022 15:41,to_fix,,,,Дефект промсреды,28.04.2023 15:36,2023-02-15 00:00:00.0,"Шаги воспроизведения:

Пытается клеинт выставить заявку

Крутит колесико для установки цены (например в Лимитной заявке)

Фактически:

иногда прокручиваются вместо цифр - многоточия(см видео)

[^RPReplay_Final1642422410.mov]

 ",,1.0,
ADIRINC-413,1942602,U_M17VN,Отклонен,17.01.2022 14:45,Инвестиции,,,,Дефект промсреды,07.04.2022 23:07,2022-03-01 00:00:00.0,"При смене языка в приложении часть информации отображается на русском, а часть на английском  !image-2022-01-17-14-44-01-006.png|thumbnail! , проблема и на андроиде и на IOS",,,
ADIRINC-407,1922470,U_M19LL,Закрыт,03.01.2022 17:40,,,,,Дефект промсреды,05.09.2022 09:33,2022-02-21 00:00:00.0,"Клиент 266811. Не может создать субсчет в ЛК.
Ошибка: Violation of PRIMARY KEY constraint...Cannot insert duplicate key...",,,
ADIRINC-399,1918496,,Закрыт,28.12.2021 12:59,МТ,,,,Дефект промсреды,28.12.2021 13:02,2022-03-10 00:00:00.0,нкенкенкен,,,
ADIRINC-398,1917533,U_023HG,Закрыт,27.12.2021 16:33,,,,,Дефект промсреды,31.08.2022 17:49,2022-02-15 00:00:00.0,"Коллеги, добрый день! После обновления АИ на андроиде до версии 2.10.0 у клиентом в портфеле при выборе ""за сегодня"" отображаются цены которые должны отображаться как ""за все время"" и наоборот.",,,
ADIRINC-397,1916918,U_M00ZM,Закрыт,27.12.2021 14:11,МТ,,,,Дефект промсреды,28.12.2021 13:01,2022-03-10 00:00:00.0,"Тест

Тест

Тест",,,
ADIRINC-385,1905443,,Закрыт,20.12.2021 14:06,,,,,Дефект промсреды,07.12.2022 12:02,2022-03-01 00:00:00.0,"Добрый день!

 
Столкнулся сейчас с такой ситуацией, что при попытке завести бумагу в АА возникает ошибка: ""Инструмента нет в АД 4.0""
Речь про бумагу RU000A1047Z8
SELECT * FROM ADFront.bs.Objects WHERE ISIN = 'RU000A1047Z8'
По бумаге пустое значение IdFiBalance
Как мне объяснили коллеги, IdFiBalance = IdFi
Бумага есть на двух площадках - 31 и 150
select * from ADFront.intrfc.LinkedFI where CodeFi = 'RU000A1047Z8' and IdMarketBoard in (SELECT IdMarketBoard FROM ADFront.dbo.FinInstruments WHERE Idobject = (SELECT Idobject FROM ADFront.bs.Objects WHERE ISIN = 'RU000A1047Z8' ) and IsEnabledFinInstrument = 1)
В таблице ADfront.[micex].[Securities] idfi тоже есть
select * from ADfront.[micex].[Securities] where Isin = 'RU000A1047Z8' and IdFi in (SELECT IdFi FROM ADFront.dbo.FinInstruments WHERE Idobject = (SELECT Idobject FROM ADFront.bs.Objects WHERE ISIN = 'RU000A1047Z8' ) and IsEnabledFinInstrument = 1)
Подскажи, пожалуйста из-за чего может отсутствовать IdFiBalance?
 
 
 
 ",,,
ADIRINC-374,1902948,RUM16HW,Закрыт,17.12.2021 14:16,Инвестиции,,,,Дефект промсреды,07.04.2022 23:11,2022-02-07 00:00:00.0,"Обратился клиент 6218 с проблемой, что у него ночью заявки отображаются, как отозванные https://alfamobile.slack.com/archives/C0152MPGQEB/p1639721789055800, при этом если менеджер заходит под клиентом, то у него они отображаются как активные ",,,
ADIRINC-373,1900268,U_00IPG,Отклонен,16.12.2021 13:51,Инвестиции,,,,Дефект промсреды,28.05.2022 08:52,2022-02-04 00:00:00.0,"Текущая цена тянется с СПБ, а на график с EUROTRADE",,,
ADIRINC-372,1899378,U_00IPG,Отклонен,16.12.2021 10:18,Инвестиции,,,,Дефект промсреды,07.04.2022 23:16,2022-02-04 00:00:00.0,"У клиента в тройке есть позиция с place_code=MICEX_SHR , при этом инструмент включен только EUROTRADE, в итоге в тройке позиция отображается, а в МТ нет. При этом если инстурмент был куплен на EUROTRADE, то позиция в МТ отображается",,,
ADIRINC-370,1895006,,Отклонен,14.12.2021 14:45,,,,,Дефект промсреды,06.01.2022 13:50,2022-02-02 00:00:00.0,"Клиент 148046-000. Не не отображаются в терминале 4.0 в операциях и соответственно не считаются в общих позициях сделки по облигациям Урожай-БО-01 ISIN код : RU000A101TA2
В МТ данный инструмент имеется.",,,
ADIRINC-368,1890049,U_M17VN,Отклонен,12.12.2021 15:35,Инвестиции,,,,Дефект промсреды,10.11.2022 12:11,2022-02-01 00:00:00.0,"Клиент заходит в окно обмен валюты, вводит сумму

ОР: у клиента корректно отображается окно и доступна кнопка ""купить""
ФР: у клиента клавиатура перекрывает кнопку ""купить""",,,
ADIRINC-366,1871284,U_M17SM,Закрыт,02.12.2021 14:03,Инвестиции,,,,Дефект промсреды,12.01.2023 17:26,2022-03-05 00:00:00.0,"В настройках Windows поменять разделитель с запятой на точку -> зайти или перезайти в ДТ -> проставить на графике линию -> зайти в настройки графика -> в графический объектах поменять значение.

ОР: Линия меняет свое положение
ФР: Линия не меняет свое положение",,,АИ ПРО
ADIRINC-365,1870620,U_M0DRY,Отклонен,02.12.2021 11:45,Инвестиции,,,,Дефект промсреды,24.11.2022 10:02,2022-01-21 00:00:00.0,"Клиент выбирает на графике таймфрейм M10-M30

ОР: график прогружается корректно
ФР: график либо не прогружается либо прогружается только часть 

Проблема из-за того, что фронтенд отдает битый пакет. если запрашивать не 3 дня, а 2 или 4, то всё работает",,,
ADIRINC-364,1863766,U_M13LB,Закрыт,29.11.2021 18:54,,,,,Дефект промсреды,11.03.2022 10:12,2022-03-03 00:00:00.0,"Шаги воспроизведения:
 # Клиент меняет ник в Профиле в ЛК
 # Ждет что он изменится в Общем чате в МТ

Фактически:

Ничего не меняется

Необходимо проверить во все ли таблицы прокидывается новый ник и как быстро

Так же тут Михаил Федоров по себе менял [https://alfamobile.slack.com/archives/C0272PR6MEF/p1638193466179800]

По доке тут реально не разобраться с ходу как оно работает, чтобы насобирать адекватной инфы по проблеме из боя быстро [http://confluence.moscow.alfaintra.net/pages/viewpage.action?pageId=229241676]",,,
ADIRINC-362,1855496,U_M12MD,Отклонен,25.11.2021 12:42,,,,,Дефект промсреды,22.12.2021 17:10,2022-01-14 00:00:00.0,"Проблема в приложении Альфа-Инвестиции: в разделе Портфель не работает опция Заявки, когда нажимаешь на соответствующую кнопку, «выбрасывает» из Приложения, надо заходить заново с вводом пароля.
Установлена последняя версия Приложения. ""Версия приложения: 2.9.1 (1103)
Логин: ezarifiants
Устройство: iPhone12,8
Прошивка: iOS 15.1
Время: 24.11.2021, 14:01:42 (3)
Время сервера: 24.11.2021, 14:01:42
Статус работы серверов: + + + +
Интернет соединение: WiFi
VPN: OFF",,,
ADIRINC-361,1855183,U_M12MD,Закрыт,25.11.2021 10:59,,,,,Дефект промсреды,24.01.2022 14:46,2022-02-03 00:00:00.0,Периодически не прогружается вкладка Портфель,,,
ADIRINC-358,1854217,U_M16Z9,Отклонен,24.11.2021 17:31,Инвестиции,,,,Дефект промсреды,01.12.2021 10:40,2022-01-13 00:00:00.0,"Данный запрос
http://172.21.0.134/v2/users/AEMJKP/accounts?channel=mobile
возвращает баланс только по одному 306-му счету из трех счетов для БС. Из-за этого у нас падает карточка брокерского счета, т.к. у себя в brokerage-account-api/withdrawal/accountNumber#GET ожидаем балансы по трем счетам.
Воспроизводится не у всех, но у AEMJKP уже второй день ",,,
ADIRINC-354,1850183,U_M157D,Отклонен,23.11.2021 13:37,Инвестиции,,,,Дефект промсреды,15.12.2021 12:21,2022-01-12 00:00:00.0,"Нет автоматического процесса изменения графиков после корпоративных действий 

Пререквизит - наличие в клиентском портфеле бумаги, по которой произошли корп.действия
Шаги воспроизведения:

Авторизоваться в МТ или ДТ.
Провалиться в график по данной бумаге.
ОР: График корректный, цены скорректированы с учетом корп.действия.

ФР: В момент корпоративного действия на графиках виден разрыв в цене .",,,
ADIRINC-353,1845910,U_M16W0,Отклонен,22.11.2021 09:28,,,,,Дефект промсреды,22.12.2022 12:50,2022-01-11 00:00:00.0,"На данный момент есть проблема с Блумббергом. Из источника  присылаются неверные купоны, завышенные или заниженные в 10, 50, 100 раз.

Временного решения нет. 

В итоге единственным решением остался переход на новый источкник ""data Licence""",,,
ADIRINC-352,1844581,U_M0YRB,Закрыт,19.11.2021 15:14,,,,,Дефект промсреды,22.12.2022 12:49,2023-01-23 00:00:00.0,"Первая линия обращается с пробемой. К ним в день приходит по 70 обращений в чат с проблемой, что когда клиенты открывают себе брокерские счет и регистрируются в приложении, то вкладка портфель не загружается.

Сотрудники первой линии уже знают об этой ошибке, идут в АА во вкладку Анкета счета->Уполномоченные лица и у УЛ ( самого клиента) стоит признак N в поле Интернет и карточка не верна ( не галочки) . Сотрудники проставляет, что карточка верна -> автоматически проставляется признак Y в поле интернет и к клиента портфель  начинает загружать.  ",,,
ADIRINC-350,1843918,U_M07DK,Отклонен,19.11.2021 12:59,,,,,Дефект промсреды,22.12.2021 19:56,2022-01-10 00:00:00.0,"Клиенту зачислили 2.5 акции ROL (US7757111049) в результате корп.действия. В налоговом отчете не указана сумма зачисления, в терминале неверная учетная цена.
https://spbexchange.ru/ru/listing/news.aspx?news=22445",,,
ADIRINC-344,1836655,U_M12MD,Отклонен,16.11.2021 15:31,,,,,Дефект промсреды,24.12.2021 14:51,2021-12-28 00:00:00.0,"Задержка в 4 минуты с открытием торгов,",,,
ADIRINC-337,1827020,U_M1BFA,Закрыт,11.11.2021 15:21,,,,,Дефект промсреды,24.11.2022 10:04,2022-03-03 00:00:00.0,"ГС 1601422 Трейлинг-стоп заявки не работают.
После обновления терминала Альфа-Инвестиции до версии 4.0.3219.1610 перестали работать Трейлинг-стоп заявки. Выставляются, но не двигаются за ценой.",,,
ADIRINC-334,1825508,U_M12MD,Закрыт,11.11.2021 09:48,,,,,Дефект промсреды,25.01.2022 11:04,2022-01-20 00:00:00.0,"Шаги воспроизведение:

-в котировках выбрать любую акцию

-зайти в стакан и выбрать цену

-в заявку перекидывает с другой ценой",,,
ADIRINC-333,1825492,U_M17SM,Отклонен,11.11.2021 09:17,,,,,Дефект промсреды,22.12.2022 12:44,2021-12-23 00:00:00.0,"В ДТ нет архивных фьючерсов, хотя в БД они есть.

Обсуждение: https://alfamobile.slack.com/archives/C02HHKRE8CD/p1636555366042800",,,
ADIRINC-329,1820255,U_M1BFA,Закрыт,09.11.2021 10:33,,,,,Дефект промсреды,12.01.2022 09:16,2021-12-21 00:00:00.0,"# на графике открываем редактор (кнопка карандаш) и рисуем тренд (или луч или фибоначчи)
2. закрываем режим редактора (кнопка карандаш) - переключаем курсор на перекрестие со сводкой - не отображается сводка на графике.


 # WA Лечится это выбором курсора с перекрестием - потом уже выбираем перекрестие со сводкой - тогда работает.",,,
ADIRINC-322,1802592,U_M17SM,Отклонен,28.10.2021 11:31,,,,,Дефект промсреды,22.12.2022 12:40,2021-12-13 00:00:00.0,"Сейчас на ДТ и МТ разные алгоритмы расчета и вероятно разные источники для расчета % изм.

 

Заведены задачи в дорожной карте на 4кв 2021 и 1кв 2022",,,
ADIRINC-320,1797570,U_M17SM,Закрыт,26.10.2021 15:16,,,,,Дефект промсреды,22.12.2022 12:37,2021-12-09 00:00:00.0,"*Шаги воспроизведения:*

ГС 237668. АИ 4.0.3192.1639

1. Клиент постоянно работает с окнами Однострочных котировок. Всего инструментов менее 500 в сохраненном списке.

2. Клиент даже уменьшил их кол-во, но ошибка по прежнему появляется при КАЖДОМ (!) переходе с одного инструменту на другой в списках инструментов (в любом из списков - по рынкам, валютам. «Ограничение на подписку! Превышен лимит 100 на подписку инструментов».

!image-2021-10-26-15-14-56-680.png!",,,АИ ПРО
ADIRINC-318,1793837,U_M0A0R,Отклонен,25.10.2021 12:55,,,,,Дефект промсреды,15.11.2022 10:01,2021-12-08 00:00:00.0,"В ЛК невозможно перевести бумагу с одного суб. счета на другой, т.к. лимит. сервис возвращает 0.

В лимитном модуле:
[http://backupsrv01.alfadirect.ru:8081/ReportServer/Pages/ReportViewer.aspx?/PreTrade%20Cont[…]D0%B8%D1%82%D0%BE%D0%B2&rs:Command=Render&ID=70019189|http://backupsrv01.alfadirect.ru:8081/ReportServer/Pages/ReportViewer.aspx?/PreTrade%20Control/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D0%BB%D0%BE%D0%B3%D0%B0%20%D1%80%D0%B0%D1%81%D1%87%D0%B5%D1%82%D0%B0%20%D0%BB%D0%B8%D0%BC%D0%B8%D1%82%D0%BE%D0%B2&rs:Command=Render&ID=70019189]
Процедура hell.[dbo].[__newlimit] возвращает 0 в out параметре @limit_ad. Просьба подсказать из-за чего лимит 0, хотя бумаг 5 ?",,,
ADIRINC-317,1793415,U_M17SM,Отклонен,25.10.2021 11:58,,,,,Дефект промсреды,16.02.2023 10:34,2021-12-08 00:00:00.0,График FXUS на МБ ЦК USD показывает рублевую позицию.,,,АИ ПРО
ADIRINC-311,1790653,U_M1DQU,Закрыт,22.10.2021 12:50,,,,,Дефект промсреды,09.06.2022 09:43,2021-12-27 00:00:00.0,"*Шаги воспроизведения:*
 # Ставлю заявку на покупку еврооблигации Еврооблигации CBOM Finance P.L.C. о.к. Бессрочная, ISIN XS1601094755
 # Захожу в стаканг

*Фактический результат:*

стакан еврооблигаций перестаёт грузиться (колёсико прокрутки крутится вечно), а после снятия заявки всё хорошо.

*Допинфо:*

ГС 35629
 Вчера методом случайного тыка обнаружил (я для валютных инструментов завёл отдельный субсчёт 002), что если выбрать основной субсчёт 000, то стакан виден и с активной заявкой, но заявка не помечена как своя

 

Последние входы с устройств

!image-2021-10-22-12-47-51-253.png!

!image-2021-10-22-12-48-22-320.png!

!image-2021-10-22-12-48-49-014.png!",,,
ADIRINC-305,1771357,U_M18E0,Отклонен,13.10.2021 15:59,Альфа-Директ,,,,Дефект промсреды,13.10.2021 16:00,2021-11-26 00:00:00.0,"Задача является головной для привязки всех инцидентов, связанных с некорректной учетной ценой. Assignee - Вишнякова Елена 

В задаче необходимо указать:
1. ГС клиента
2. ISIN инструмента, название
3. Указать вид корпоративного действия
4. Текущая учетная цена/ расчет корректной учетной цены",,,
ADIRINC-303,1757232,U_M0SHC,Закрыт,06.10.2021 17:19,,,,,Дефект промсреды,22.12.2022 12:25,2021-12-09 00:00:00.0,"Агенты сразу отправляют клиентам и на запись в ДК. А ДК отдают в базу по мере того, как она успевает забрать. База не успевает обработать, и потому к концу дня на ДК образуются очереди, которые разгребаются только к следующему утру. 

 

Обсуждение: [https://alfamobile.slack.com/archives/C0152MPGQEB/p1633511004012400]
Пример: http://jira.moscow.alfaintra.net/browse/ADIRINC-302

--Выгрузка значений свечей по инстурменту
select * from addatafeed.dbo.candles where IdFI = 604471 and Time >= getdate() - 2 order by Time desc",,,
ADIRINC-298,1738914,U_M12MD,Закрыт,28.09.2021 09:20,,,,,Дефект промсреды,25.01.2022 11:28,2021-11-11 00:00:00.0,"Выявлены случаи, что на определенных устройствах некорректно определяется сертифика, хотя в БД записи по клиентам корректны

https://alfamobile.slack.com/archives/C0152MPGQEB/p1628170266127900?thread_ts=1628170018.126500&cid=C0152MPGQEB 



https://alfamobile.slack.com/archives/C0152MPGQEB/p1632726162330100",,,
ADIRINC-295,1728965,U_M173X,Закрыт,22.09.2021 09:10,,,,,Дефект промсреды,11.03.2022 10:08,2021-11-03 00:00:00.0,"Описание проблемы:
ОР: 
 1. Клиент заходит в ЛК
 2. Меняет никнейм
 3. В мобильном и десктопном терминале никнейм изменился

ФР:
 1. Клиент заходит в ЛК
 2. Меняет никнейм
 3. В мобильном и десктопном терминале никнейм остался прежним",,,
ADIRINC-291,1722646,U_M17SM,Отклонен,17.09.2021 18:25,,,,,Дефект промсреды,15.11.2022 14:28,2021-11-23 00:00:00.0,"Шаги воспроизведения:

Клиент смотрит раздел Операции в ДТ

Фактически:

Видит там сделки , которые якобы не должны отображаться, пример на скрине

Под клиентом зашли, аналогично

!image-2021-09-17-18-21-48-277.png!",,,
ADIRINC-285,1706793,U_00IPG,Закрыт,09.09.2021 11:11,,,,,Дефект промсреды,14.09.2021 16:53,2021-10-21 00:00:00.0,"Коллеги, на постоянной основе приходят обращения в темой: Заявка #30618347484 отклонена. Торговые поручения по портфелю не разрешены. 

Ошибка возникает из-за некорректных прав по суб.счету или портфелю. 

Необходимо разобраться в причине некорректной трансляции прав.",,,
ADIRINC-276,1692378,U_M0YRB,Закрыт,01.09.2021 14:11,,,,,Дефект промсреды,14.09.2021 13:02,2021-10-13 00:00:00.0,"Недоступность инструмента US5854641009

Инструмент заведен в 3 и в 4 . Заведен на 119 борд  СПБ Основной режим торгов T+ SPBEX_USD, но данный борд не активен. Из-за чего инструмент  недоступен к торгам. 


select * from adfront.ts.FinInfoExt where 1=1 and idfi=229160 select * from adfront.ts.FinInfoExt where 1=1 and idfi=229160 
select * from adfront.fi.FinInfoExt where idfi=229160 

Сессия по данному idfi очень старая, хотя инструмент торгуется на бирже 

В select * from adfront.spbex.issue where isin = 'Us5854641009' запись по инструменту есть

Временное решение обновить данные записи вручную. 

Необходимо провести аналитику и понять из-за чего инструмент заведен на 119 борд или почему он не активен. 

 

Обсуждение: https://alfamobile.slack.com/archives/C0152MPGQEB/p1630481781136400

 ",,,
ADIRINC-274,1690844,U_M12MD,Отклонен,31.08.2021 17:03,,,,,Дефект промсреды,08.09.2021 16:58,2021-10-12 00:00:00.0,"*Шаги воспроизведения:*

Клиент приобрел облигацию US69269L1044 OZON, валюта USD ( приобрел на московской и СПб биржах. )

Смотрит свой портфель в МТ.

*Фактически:*

Видит в портфеле стоимость акций только в рублях.

*Ожидаемый результат:*

Стоимость бумаг отображается в той валюте, в которой приобретена. ",,,
ADIRINC-273,1688945,U_M12MD,Закрыт,31.08.2021 09:05,,,,,Дефект промсреды,25.01.2022 11:51,2021-10-12 00:00:00.0,"Путь клиента:

Клиент открывает брокерский счет в Альфа-мобайле или в другой системе

ОР: Клиент успешно заходит в приожение Альфа-Инвестиции

ФР: Клиент не может авторизовать возникает ошибка 90011

Примеры: 1768634 , 1768596

В связи с изменением схемы трансляции логинов (из цепочки баз исключена cash) необходимо доработать процедуру cash.dbo.push_acc_access. Связывать резалтсет необходимо с таблицей hell.dbo.managers.",,,
ADIRINC-272,1685164,U_M0WVN,Закрыт,27.08.2021 15:33,,,,,Дефект промсреды,29.08.2022 10:21,2022-11-22 00:00:00.0,"У клиента при попытке выставить заявку появляется ошибка ""Нет подключения к интернету"", хотя при этом стаканы, графики и котировки подгружаются. 

 

Шаги для воспроизведения:
 # Залогиниться в приложение Альфа-Инвестиции
 # Перейти во вкладку выставления заявок

ОР:

Заявка успешно выставляется

ФР:

Появляется ошибка нет подключения к интернету",,,
ADIRINC-271,1685138,U_M16VQ,Закрыт,27.08.2021 15:01,,,,,Дефект промсреды,07.04.2022 23:15,2021-10-08 00:00:00.0,"Клиент в EQ сменил иностранный паспорт на паспорт РФ, данные в таблице hell.dbo.anket_person актуализируются некорректно.  Пример : IM12379635  AR6VKD !image-2021-08-27-14-58-26-414.png!",,,
ADIRINC-270,1684250,U_M12MD,Закрыт,27.08.2021 11:18,,,,,Дефект промсреды,24.11.2022 13:07,2021-12-13 00:00:00.0,"У клиента возникает проблема с отображением графиков при переходе на темную тему.

Клиент использует iPhone XR, iOS 14

Этапы для воспроизведения:
 # Переключиться в настройках телефона на темную тему
 # Залогиниться в приложении
 # Открыть график любого инструмента

ОР:

Графики отображаются корректно на тёмном фоне, с ценой и датой для навигации по котировкам.

ФР:

Графики строятся на белом фоне цифры и даты не отображаются.",,,
ADIRINC-266,1677603,U_M0WVN,Закрыт,24.08.2021 12:47,,,,,Дефект промсреды,29.08.2022 10:23,2021-10-05 00:00:00.0,"Пререквизит - клиент 173621, инструмент RU000A103HT3.
Шаги воспроизведения:
1. Заключить сделку по финансовому инструменту.
ОР:
Сделка заключается с корректной ценой инструмента.
ФР:
Сделка заключается с некорректной ценой инструмента.",,,
ADIRINC-265,1672403,U_M1AHA,Отклонен,20.08.2021 10:42,,,,,Дефект промсреды,29.09.2021 16:44,2021-10-01 00:00:00.0,"У ряда инструментов торгующихся на СПБ бирже имеется проблема с отображением котировок вне времени торгов, вместо котировок можно увидеть ""No data about the instrument"". Когда торги по инструменту идут, котировки отображаются корректно.

 

Как было выяснено, ошибка связана с тем, что в биржевом файле инструмента, который приходит с биржи trading_status = 18, в fi.LinkedFi же, CodeMarketBoard значение 1001/37 - что соответствует другому борду. 

Скрипты для проверки ниже:

Первый скрипт показывает, что указано в биржевом файле

select * from adfront.SPBEX.Issue where isin='US33734X8469'
select * from adfront.SPBEX.Instrument where symbol = 'CIBR'

Второй скрипт показывает, какой борд присваивается инструменту у нас

select top 10 * from adfront.fi.linkedFi where IdFI= 711481",,1.0,
ADIRINC-263,1662144,,Отклонен,13.08.2021 16:58,,,,,Дефект промсреды,05.10.2021 15:57,2021-09-24 00:00:00.0,"Добрый день, коллеги! У клиента 249306 Лобачев некорректная учетная цена по доллару, просьба поправить.",,,
ADIRINC-262,1659010,U_M12MD,Закрыт,12.08.2021 14:07,,,,,Дефект промсреды,16.03.2022 09:57,2021-11-08 00:00:00.0,"Т.к. сертификат привязан к idLogin, привожу его IdLogin = 101385172

Шаги воспроизведения:
 # Авторизоваться в АМ
 # Перейти на вкладку инструмента
 # Выставить заявка на покупку или продажу инструменту

ОР: 

Заявка выставлена.

ФР: 

Ошибка ""Что-то пошло не так. Потрясите устройство для отправки отчёта""

 

В таблице select * from adfront.unk.EDocuments where IdAccount = 1048417 можно найти ошибку Signature's verification failed: [error:2E09D08A:CMS routines:CMS_verify:signer certificate not found][(null)] при попытке выставить заявку.",,,
ADIRINC-261,1658992,,Закрыт,12.08.2021 13:55,,,,,Дефект промсреды,24.11.2022 13:08,2021-11-26 00:00:00.0,"Шаги воспроизведения: 
 # Авторизоваться в АМ.
 # Перейти во вкладку ""Больше"" перейти в ""Персональные сервисы"", ""Электронная подпись"", ""Выпустить электронную подпись""

ОР: 

Получение СМС с кодом подтверждения и выпуск ЭЦП

ФР:

Появляется ошибка ""Сервер недоступен. Проверьте соединение с интернетом""",,,
ADIRINC-251,1643179,U_M0YRB,Закрыт,03.08.2021 14:44,,,,,Дефект промсреды,21.09.2021 14:33,2021-09-14 00:00:00.0,"При смахивании с одного суб счета на другой, если портфель не успел загрузиться по предыдущему суб счету, то при перелистывании на другой суб счет перепрыгивает на преддущий суб счет

Ошибка воспроизводится и на своем устройстве.
У клиента версия ПО 2.3.0
Устройство SM-G998B
ОС 11
Подробности:
SELECT* FROM ADFront.dbo.ClientSessions 
where 1=1
and Login = 'esmolikov' 
and LoginTime > getdate() -1 order by LoginTime DESC",,,
ADIRINC-249,1640911,,Отклонен,02.08.2021 16:09,,,,,Дефект промсреды,01.12.2021 13:41,2021-09-13 00:00:00.0,"Коллеги, клиент 276198 (резонансный) выставляет заявку на покупку инструмента US8740801043 в 29.07.2021 18:15 и 29.07.2021 18:15 , номера заявок 29884731084 и 29884726784 в стакане у него отображается что это заявки на продажу, хотя это не так, просьба проверить и исправить. клиент хочет обращаться в ЦБ, просьба взять задачу в приоритетет. Заявки исполнены верно. То есть он эти бумаги купил. Вопрос только в том, почему в стакане заявки были как будто на продажу.",,,
ADIRINC-245,1638241,U_M12MD,Закрыт,30.07.2021 17:34,,,,,Дефект промсреды,06.10.2021 09:32,2021-09-10 00:00:00.0,"Шаги воспроизведения:

1. Авторизоваться в МТ. Зайти в Портфель.

2. Пролистать до инструмента XS1693971043

ОР:
Стоимость актива отображается корректно.
ФР:
Стоимость актива 0$

Пример:
IM12265195 
У клиентa 274586 не отображается цена по бумаге SIBUR SECURITIES.",,,
ADIRINC-244,1638114,U_M12MD,Закрыт,30.07.2021 17:17,,,,,Дефект промсреды,25.01.2022 12:56,2021-09-10 00:00:00.0,"Пререквизит: клиент с двумя субсчетами, имеющий на одном из них не целую сумму в долларах (с центами).

Шаги воспроизведения:
1. Авторизоваться в МТ или ЛК.

2. Попытаться перевести ДС с долларового счета между субсчетами.

ОР:
В сумму перевода возможно вписать центы.

ФР:
В сумму перевода невозможно вписать центы.",,,
ADIRINC-243,1637904,U_M1CQQ,Закрыт,30.07.2021 16:03,,,,,Дефект промсреды,01.12.2021 13:28,2021-09-30 00:00:00.0,"*Шаги воспроизведения:*

Клиент совершил перевод в ЛК между субсчетами

Смотрит НПУ в портфеле

*Ожидаемый результат:*

Хочет видеть значения

*Фактический результат:*

Столбцы становятся пустыми

*Допинфо:*

клиент 1331138 перевел с 000 на 001 субсчет ценные бумаги, после этого дневное НПУ перестало отображать в терминале на ПК Ад 4.0, но в мобильном терминале все норм

 ",,,
ADIRINC-242,1637616,U_M00ZM,Отклонен,30.07.2021 15:53,,,,,Дефект промсреды,16.02.2023 15:13,2021-09-10 00:00:00.0,"В терминале недоступны архивные данные по фьючерсу si, например sih1 за 21 год и ни одного si за 20 год.",,,
ADIRINC-241,1637190,U_M1CWM,Закрыт,30.07.2021 13:12,,,,,Дефект промсреды,16.02.2023 17:15,2021-09-10 00:00:00.0,"Шаги воспроизведения:

Клиент на графике хочет посмотреть свои позиции (выбирает галочку позиции на графике)

Фактически:

Позиции не появляются

Ожидаемый результат:

Позиции с учетной ценой видны

Допинфо:

клиент 41412, примеры на скриншоте

Обращение:

""если клиент на графике ставит галочку напротив""позиции"",то на графике эти позиции с учетной ценой не появляются""

 ",,,АИ ПРО
ADIRINC-240,1636945,U_M12MD,Отклонен,30.07.2021 12:07,,,,,Дефект промсреды,24.08.2021 12:09,2021-09-10 00:00:00.0,"*Шаги воспроизведения:*

Клиент смотри график по инструменту

*Ожидаемый р-т:*

Хочет видеть все свои заявки на графике

*Фактический р-т:*

Нет ни одной заявки

*Допинфо:*

Клиент 37156-000 Ерохин

!untitled1.png!

 

 ",,,
ADIRINC-239,1636203,U_M12MD,Закрыт,30.07.2021 09:31,,,,,Дефект промсреды,25.01.2022 11:58,2021-09-10 00:00:00.0,"Некорректное отображение свечей в МТ
Пример: Проблема с отображением графиков наблюдается и по другим инструментам: например US8740801043

В МТ на графике последняя свеча по времени 29 июля 2021 22:59, хотя в таблице записи есть и после",,,
ADIRINC-238,1635980,U_M177U,Закрыт,29.07.2021 19:10,to_fix,,,,Дефект промсреды,26.01.2023 12:13,2023-04-03 00:00:00.0,"Шаги воспроизведения:
 1. Авторизоваться в МТ.

2. Зайти в Портфель

ОР:
 Расчет доходности осуществляется корректно.

ФР:
 Расчет доходности осуществляется некорректно.

Пример:

IM12187038 

У клиента ГС 259445 отображается в рублях +4120 рублей, но в % указан -60,03%

 ",,,
ADIRINC-237,1635967,U_M12MD,Закрыт,29.07.2021 18:47,,,,,Дефект промсреды,15.09.2021 15:53,2021-09-10 00:00:00.0,"Шаги воспроизведения:

Клиент зашел в инфо по облигации

Ожидаемый результат:

Хочет увидеть свои купоны по ней

Фактически:

Вкладка всегда падает в ошибку

Допинфо:

Клиент 68852

 РЖД 23 обл.",,,
ADIRINC-236,1635680,U_M1FPP,Закрыт,29.07.2021 17:08,,,,,Дефект промсреды,17.05.2023 16:55,2021-09-09 00:00:00.0,"КАРПАЧЕВ АНДРЕЙ ВЛАДИМИРОВИЧ ГС 69535

При переводе между субсчетами была изменена уч. цена. ",,,
ADIRINC-235,1635762,U_M177U,Закрыт,29.07.2021 17:08,to_external_system,,,,Дефект промсреды,22.12.2022 12:11,2021-09-29 00:00:00.0," 

 Шаги воспроизведения:

1. Авторизоваться в МТ. Зайти в Портфель.

2. Через некоторое время перезайти в МТ и зайти в Портфель.

ОР:
 Нет расхождения по балансу и доходности.

ФР:
 Есть расхождение по балансу и доходности.

Пример:

IM12276432 

Клиент 189756 не правильно рассчитывается прибыль/убыток по позициям За сегодня.
3 позиции если сложить 98+18+8=124., а у него отображается 101 доллар. просьба проверить, нет ли сбоя в системе. У клиента в портфеле так же учитывает убыток по валюте, в данном случае если прибавить к 101 доллару 1753/72.97, то получиться 124 доллара*.*",,,
ADIRINC-234,1635528,U_M12MD,Закрыт,29.07.2021 16:30,,,,,Дефект промсреды,24.01.2022 14:47,2021-09-29 00:00:00.0,"Клиент 169346

Клиент обратился с проблемой, что у него не очищается журнал уведомлений, клиенту было предложено очистить журнал (снять уведомления), уведомления снимаются, после перезахода в терминал все восстанавливается.
Версия приложения: 2.3.0 (812)
Логин: ilshashkin
Устройство: iPhone XS Max
Прошивка: iOS 14.6
Время: 28.07.2021, 00:58:06 (3)
Время сервера: 28.07.2021, 00:58:06
Статус работы серверов: + + + +
Интернет соединение: WiFi
VPN: OFF",,,
ADIRINC-233,1635559,U_M0WVN,Закрыт,29.07.2021 16:11,,,,,Дефект промсреды,07.09.2021 18:37,2021-09-09 00:00:00.0,"Шаги воспроизведения:

Клиент переводит дс между РЦБ на ФОРТС 

Ожидаемый результат:

Он сделает перевод между своими счетами

Фактический результат:

Один из счетов у него отображается другого клиента

Допинфо:

Клиент 127444 Долгов Михаил Владиславович",,,
ADIRINC-232,1635263,U_M0WVN,Закрыт,29.07.2021 15:11,,,,,Дефект промсреды,01.09.2022 09:58,2021-09-09 00:00:00.0,"Шаги воспроизведения:

Клиент смотрит среднюю цену по купленной акции на графике.

Ожидаемый результат:

Клиент видит корректную цифру со средней ценой

Фактически:

Цифра некорректная

 

Допинфо:

NL0009434992

ГС 6847 ",,,
ADIRINC-230,1634257,U_00IPG,Закрыт,29.07.2021 10:42,,,,,Дефект промсреды,08.09.2021 14:03,2021-08-02 00:00:00.0,"Шаги воспроизведения:
1. Авторизоваться в МТ.

2. Зайти в сводку по инструменту, торгуемому на СПБ.

ОР:
Входящая цена обновляется ежедневно.

ФР:
Входящая цена не обновляется с пятницы.",,,
ADIRINC-229,1633651,,Закрыт,28.07.2021 19:14,,,,,Дефект промсреды,14.09.2021 10:05,2021-09-09 00:00:00.0,"клиент Зальцберг Артур Андреевич аклуб ГС 1012961 купил 
1500 21/07/21 1 23/07/21 БПИФ Доход 
в админе данный инструмент виден в QUIK отсутствует. Прошу внести данные в файл загрузки лимитов.",,,
ADIRINC-227,1633269,U_M12MD,Закрыт,28.07.2021 17:27,,,,,Дефект промсреды,21.09.2021 14:32,2021-09-08 00:00:00.0,,,,
ADIRINC-219,1631028,U_M12MD,Отклонен,27.07.2021 17:09,,,,,Дефект промсреды,01.12.2021 14:01,2021-09-07 00:00:00.0,"Пререквизит: позиция в валюте, например я, 241405

Шаги воспроизведения: 
1. Авторизоваться в МТ.

ОР:
Позиции отображаются корректно.

ФР:
Произвольные входящие цены по позициям (чаще всего по валюте) обнуляются.

Доп.инфо:
Как отображается - во вложениях.

 ",,2.0,
ADIRINC-217,1630947,U_M1DQU,Отклонен,27.07.2021 15:53,,,,,Дефект промсреды,22.12.2022 11:41,2021-09-07 00:00:00.0,"Пререквизиты отсутствуют.
Шаги воспроизведения:
1. Авторизоваться в МТ к началу торгов.

ОР:
Торги начинаются ровно в 07:00 по Москве.

ФР:
Торги начинаются с задержкой около 30 секунд.
Доп.инфо:
Воспроизводится у всех клиентов на всех версиях ОС и МТ.",,3.0,
ADIRINC-214,1627885,U_M12MD,Отклонен,26.07.2021 13:26,,,,,Дефект промсреды,25.01.2022 13:17,2021-09-06 00:00:00.0,"*Шаги воспроизведения:*
Клиент смотрит свои заявки на графике
*Фактически:*
Через 10 мин не отрабатывают на графике
*Ожидаемый результат:*
На графиках заявки в актуальном статусе всегда

*Допинфо:*
Клиент 302491 обратился с проблемой:
Почему заявки в терминале еще неделю назад отрабатывались мгновенно а сейчас и через 10 мин не отрабатывают на графике. Если нажать кнопку закрыть все мне предложит закрыть 120 заявок, а из уже в маштабах трейдинга давно 70. За последний месяц после обновлений стало просто невозможно совершать быстрые сделки, сплошные глюки со средней и количеством заявок. уже сижу сам в голове считаю.",,,
ADIRINC-196,1607363,U_M0WVN,Закрыт,13.07.2021 17:29,,,,,Дефект промсреды,15.09.2021 15:49,2021-07-15 00:00:00.0,"Пререквизиты:
Клиент с >1 ГС, например я - ANI86I.
Шаги воспроизведения:
 # Авторизоваться в АМ.
 # Провалиться в любой из своих брокерских счетов.

ОР:
Открывается карточка брокерского счета, возможно вывести деньги или пополнить БС.

ФР:
Раздел падает со стандартной ошибкой. В логах старого ИС АД видно следующую ошибку:
!image-2021-07-13-12-43-37-062.png!

Доп. инфо:
Получается, что ни ОДИН из клиентов из тех, кто подписал второе генсоглашение, не сможет ни следить за своим актуальным балансом через АМ, ни пополнять/выводить ДС ни с одного из своих БС.",,,
ADIRINC-192,1605589,U_M12MD,Отклонен,13.07.2021 09:18,,,,,Дефект промсреды,25.01.2022 13:13,2021-08-24 00:00:00.0,"Интструмент который не доступен к торгам отображается пустой строкой во вкладке Мои избранные

Решение: Данные инструмент должен отображаться корректно или же не отображаться",,,
ADIRINC-183,1598225,U_00IPG,Закрыт,08.07.2021 07:52,,,,,Дефект промсреды,02.08.2021 14:12,2021-07-30 00:00:00.0,"После поставки на MTRA + DataCache 28.06 с частотой до нескольких раз в сутки DC перестает отдавать данные в MTRA, из-за чего у систем потребителей, в числе которых Альфа-Мобайл, полностью не отображается портфель клиента в Альфа-Директ и  витрина в разделе Инвестиции.
Количество значительных инцидентов, первопричиной которых является данный дефект, на текущий момент равно 13.
В логах MTRA наблюдается формализованая ошибка, что MTRA не успевает вычитать данные из DC до таймаута, по факту теряется подписка на DC.",,,
ADIRINC-170,1585725,U_M0YRB,Закрыт,01.07.2021 10:04,,,,,Дефект промсреды,29.09.2021 18:37,2021-08-12 00:00:00.0,Каждодневное срабатывание триггера делает недоступным US89151E1091 из-за некорректности заведения данного инструмента,,,
ADIRINC-158,1572259,U_M07D8,Закрыт,23.06.2021 17:02,,,,,Дефект промсреды,14.09.2021 15:33,2021-08-04 00:00:00.0,"Клиент на ФОРТС не может выставить заявку по фьючерсу IRZ1 - IRAO-12.21.

В вебадмине виден комментарий, что Инструмент недоступен к торгам",,,
ADIRINC-157,1571499,U_M157D,Отклонен,23.06.2021 15:19,,,,,Дефект промсреды,15.12.2021 12:18,2021-08-04 00:00:00.0,"Фактический результат:

Клиент 886792 20.10.21 купил ПИФ RU000A1011S9 за  0,1102 $ по курсу на 20.10.21 это 70,96*0,1102=7,8205 р, а каждую ночь учетная цена пересчитывается по текущему курсу и на 27.10.21 у клиента отобржается учетная цена 0,1125 $= 7,8205 /69,50 . 

Ожидаемый результат:

Учетная цена не должна изменяться из-за изменения курса покупки, в данном случае она должна быть равна 0,1102%.

 ",,,
ADIRINC-156,1571577,U_M0A0R,Отклонен,23.06.2021 14:58,,,,,Дефект промсреды,24.11.2022 10:02,2021-08-04 00:00:00.0,"При выставлении заявки, у клиента в МТ возникает ошибка: доступно ""0"". Хотя это не так и ошибка из-за некорректно подсчитанных остатков

WA выполнить reborn заявки с корректными значениями",,,
ADIRINC-142,1563736,U_M1CQQ,Закрыт,18.06.2021 11:32,,,,,Дефект промсреды,01.12.2021 13:22,2021-08-19 00:00:00.0," 

*Шаги воспроизведения:*

1. Ошибка при заведении стоп-заявки на Iphone 11 pro 14.6 IOs. Когда завел сумму стопа и хочешь переключится на поле для тейка.

*Фактически:*

Форма заявки схлопывается вверх и остается только кнопка Продать. Лечится только свайпом право и влево

*Допинфо:*

[^Logs.txt1.zip]",,,
ADIRINC-137,1559361,U_M173X,Отклонен,16.06.2021 12:46,,,,,Дефект промсреды,16.02.2023 10:23,2021-09-08 00:00:00.0,,,,АИ ПРО
ADIRINC-126,1553065,U_M0UPU,Отклонен,10.06.2021 17:48,,,,,Дефект промсреды,22.04.2022 12:48,2021-07-23 00:00:00.0,"*Шаги воспроизведения:*

Клиент смотрит в Альфа-Мобайл свои акции

*Фактическии:*

По некоторым из них цена некорректная приходит.

 

!image-2021-06-10-17-13-07-027.png!

 

*Допинфо:*

ABXQ0W

 

*ГС 399408*

В ответе апи видим такие данные по двум акциям на скрине:

{""assetId"":113149,""name"":""*Infineon Technologies AG, а.о.*"",""toolType"":""STOCK"",""purchasePricePerOne"":null,""iconUrl"":""https://click.alfabank.ru/cs/groups/public/documents/document/investments_de0006231004.png"",""couponPaymentDate"":null,""percentageSalePrice"":null,""percentagePurchasePrice"":null,""isin"":""*DE0006231004*"",""coupon"":-3.20,""couponPercent"":null,""maturityDate"":null,""couponPeriod"":null,""aciTotal"":null,""sellPrice"":null,""quantity"":*10*,""nominalPrice"":{""value"":*821*,""currency"":""EUR"",""minorUnits"":100},""salePricePerOne"":null,""tradeStatus"":""NOTTRADED"",""tax"":null,""income"":\{""percent"":-3.20,""amount"":{""value"":-1092,""currency"":""EUR"",""minorUnits"":100}},""structBondPeriod"":null,""structBondDescription"":null,""disclaimer"":"""",""ytm"":null}

 

{""assetId"":97453,""name"":""*Deutsche Lufthansa Aktiengesellschaft*, а.о."",""toolType"":""STOCK"",""purchasePricePerOne"":null,""iconUrl"":""https://click.alfabank.ru/cs/groups/public/documents/document/investments_de0008232125.png"",""couponPaymentDate"":null,""percentageSalePrice"":null,""percentagePurchasePrice"":null,""isin"":""*DE0008232125*"",""coupon"":5.22,""couponPercent"":null,""maturityDate"":null,""couponPeriod"":null,""aciTotal"":null,""sellPrice"":null,""quantity"":*10*,""nominalPrice"":{""value"":*821*,""currency"":""EUR"",""minorUnits"":100},""salePricePerOne"":null,""tradeStatus"":""NOTTRADED"",""tax"":null,""income"":\{""percent"":5.22,""amount"":{""value"":540,""currency"":""EUR"",""minorUnits"":100}},""structBondPeriod"":null,""structBondDescription"":null,""disclaimer"":"""",""ytm"":null}

 

Ответы сервиса Директа:

{""id"":97453,""activity"":""NotTraded"",""aci"":0.0,""aciTotal"":0.0,""buyPrice"":0.0,""coupon"":0.0,""couponText"":"""",""couponPeriod"":0,""couponPeriodText"":"""",""paymentsTotal"":0.0,""duration"":0.0,""isin"":""DE0008232125"",""maturityDate"":null,""name"":""*Deutsche Lufthansa Aktiengesellschaft*, а.о."",""tradePlace"":""1"",""nominalCurrency"":""EUR"",*""nominalCurrencyValue"":8.219995*,""nominal"":0.00,""priceCurrency"":""USD"",""quantity"":10.00,""registryNumber"":""DE0008232125"",""sellPrice"":0.0,""ticker"":""DLUF"",""toolType"":""A"",""ytm"":0.0,""expense"":108.90,""grossIncome"":5.40,""yield"":0.0522,""holdingTotalDays"":100,""qualifiedOnly"":false,""currentValue"":8.219995,""issuer"":""Deutsche Lufthansa Aktiengesellschaft"",""isPerpetual"":false,""corpActionStartDate"":null,""corpActionEndDate"":null,""priority"":0,""income"":\{""initialValue"":108.90,""revaluation"":5.40,""revaluationPercent"":0.05220},""quotesPlace"":""SPBEX_FSHR""}

 

 

{""id"":113149,""activity"":""NotTraded"",""aci"":0.0,""aciTotal"":0.0,""buyPrice"":0.0,""coupon"":0.0000,""couponText"":"""",""couponPeriod"":0,""couponPeriodText"":"""",""paymentsTotal"":0.0,""duration"":0.0,""isin"":""*DE0006231004*"",""maturityDate"":null,""name"":""Infineon Technologies AG, а.о."",""tradePlace"":""1"",""nominalCurrency"":""EUR"",*""nominalCurrencyValue"":8.219995*,""nominal"":0.00,""priceCurrency"":""USD"",*""quantity"":10.00*,""registryNumber"":""DE0006231004"",""sellPrice"":0.0,""ticker"":""INFI"",""toolType"":""A"",""ytm"":0.0,""expense"":330.00,""grossIncome"":-10.92,""yield"":-0.0320,""holdingTotalDays"":100,""qualifiedOnly"":false,""currentValue"":8.219995,""issuer"":""Infineon Technologies AG"",""isPerpetual"":false,""corpActionStartDate"":null,""corpActionEndDate"":null,""priority"":0,""income"":\{""initialValue"":330.00,""revaluation"":-10.92,""revaluationPercent"":-0.03200},""quotesPlace"":""SPBEX_FSHR""}

При этом в БД:

!image-2021-06-10-17-46-39-161.png!

 

 

 ",,,
ADIRINC-123,1549370,U_M0UPU,Отклонен,09.06.2021 10:31,,,,,Дефект промсреды,01.12.2021 15:34,2021-07-22 00:00:00.0,"Пререквизит:
Клиент (например 397592) с активом, учетная цена штуки которого меньше 1 у.е. В контексте клиента выше это БПИФ Тинькофф с учтеной ценой 0,1016. 
Шаги воспроизведения:
1. Авторизоваться в АМ.

2. Зайти в ""Инвестиции"" или ""Обзор активов"".

ОР:
Цена по инструментам отображается корректно.

ФР:
Цена возвращается нулевая, на стороне АМ она округляется до 1 у.е.
Доп. инфо
Скрин из АМ во вложении, ответ сервиса ниже:
_[_
 _{_
 _""assetId"": ""XS1513741311"",_
 _""accountId"": 397592,_
 _""subAccountId"": 0,_
 _""section"": ""БЭБ"",_
 _""qtyCurrent"": 5,_
 _""qtyForward"": 5,_
 _""accruedInt"": {_
 _""value"": 8,_
 _""currency"": ""USD""_
 _},_
 _""qtyOpen"": 5,_
 _""accPrice"": {_
 _""value"": 104.17,_
 _""currency"": ""%""_
 _}_
 _},_
 _{_
 _""assetId"": ""USD"",_
 _""accountId"": 397592,_
 _""subAccountId"": 0,_
 _""section"": ""Рынок ценных бумаг"",_
 _""qtyCurrent"": 178.92,_
 _""qtyForward"": 178.92,_
 _""accruedInt"": {_
 _""value"": 0,_
 _""currency"": ""USD""_
 _},_
 _""qtyOpen"": 178.92,_
 _""accPrice"": {_
 _""value"": 72.835,_
 _""currency"": ""RUB""_
 _}_
 _},_
 _{_
 _""assetId"": ""RU000A102EQ8"",_
 _""accountId"": 397592,_
 _""subAccountId"": 0,_
 _""section"": ""НРД"",_
 _""qtyCurrent"": 20000,_
 _""qtyForward"": 20000,_
 _""accruedInt"": {_
 _""value"": 0,_
 _""currency"": ""USD""_
 _},_
 _""qtyOpen"": 20000,_
 _""accPrice"": {_
 _""value"": 7.689141,_
 _""currency"": ""RUB""_
 _}_
 _},_
 _{_
 _""assetId"": ""RUB"",_
 _""accountId"": 397592,_
 _""subAccountId"": 0,_
 _""section"": ""Рынок ценных бумаг"",_
 _""qtyCurrent"": 7356.81,_
 _""qtyForward"": 7356.81,_
 _""accruedInt"": {_
 _""value"": 0,_
 _""currency"": ""RUB""_
 _},_
 _""qtyOpen"": 7356.81,_
 _""accPrice"": {_
 _""value"": 0,_
 _""currency"": ""RUB""_
 _}_
 _},_
 _{_
 _""assetId"": ""RU000A101X68"",_
 _""accountId"": 397592,_
 _""subAccountId"": 0,_
 _""section"": ""НРД"",_
 _""qtyCurrent"": 50000,_
 _""qtyForward"": 50000,_
 _""accruedInt"": {_
 _""value"": 0,_
 _""currency"": ""USD""_
 _},_
 _""qtyOpen"": 50000,_
 _""accPrice"": {_
 _""value"": 7.428398,_
 _""currency"": ""RUB""_
 _}_
 _}_
_]_",,2.0,
ADIRINC-121,1548282,U_M16SB,Отклонен,08.06.2021 16:25,,,,,Дефект промсреды,16.09.2021 09:12,2021-09-01 00:00:00.0,"Пререквизит: клиент 417588 
Шаги воспроизведения:
1. Авторизоваться в МТ.

2. Зайти в ""Котировки"" - ""Фючерсы"".

3. Нажать на фюч MAIL-6.21

ОР:
Карточка инструмента открывается корректно.

ФР:
МТ зависает, при попытке собрать логи телефон на встряхивание не реагирует.

Доп. инфо:
Логов соответственно нет, есть видеозапись экрана, во вложении. Воспроизвел на своем устройстве - не вылетело, но карточка грузилась сильно дольше обычного(свои логи прилепил вместе с видеозаписью экрана).",,4.0,
ADIRINC-109,1540913,U_M05RC,Отклонен,03.06.2021 18:32,,,,,Дефект промсреды,06.12.2022 13:43,2021-07-19 00:00:00.0,"Шаги воспроизведения:

Клиент ставит заявку на покупку валюты, средств на покупку и на комиссию достаточно.

Фактически:

Заявка отлоняется лимитным модулем, как будто денег не хватает.

[https://alfaadmin/reporting/orderlimitlog/929426742]

Допинфо:

Клиент 1273735 Майзельс

При выставлении заявки на покупку долларов система не видит рубли на счете. 

!image-2021-06-03-18-30-46-652.png!

 

 

!image-2021-06-03-18-30-22-233.png!

 

*Корневая проблема:*

select distinct aa.idaccount
from hell.dbo.accounts a
join adfront.dbo.subaccounts aa on a.treaty = aa.idaccount
join adfront.dbo.razdels r on aa.idsubaccount = r.idsubaccount and r.IdRazdelType in (20, 21)
where efr_dt is not null
and idrazdeltypebalance is null",,,
ADIRINC-103,1538451,U_M16EL,Отклонен,02.06.2021 17:29,,,,,Дефект промсреды,14.09.2021 15:35,2021-07-15 00:00:00.0,"Шаги воспроизведения:

В котировках начать искать ""Алроса""

Фактически:

Бесконечно крутится поиск, даже если бумага уже нашлась

Допинфо:

 

Проверил на ""Газпром"", ""Сбер"", ""Северсталь"" такого не наблюдается

Видео и логи прилагаю:

[^Video.mov] [^Logs.7z]

Версия приложения: 2.0.1 (738)
Логин: svzorina
Устройство: iPhone 7
Прошивка: iOS 14.4.2
Время: 02.06.2021, 09:27:54 (3)
Время сервера: 02.06.2021, 09:27:54
Статус работы серверов: + + + +
Интернет соединение: WiFi
VPN: OFF",,,
ADIRINC-102,1537307,U_M0UPU,Закрыт,02.06.2021 12:45,,,,,Дефект промсреды,02.08.2021 14:13,2021-08-04 00:00:00.0,"Пререквизит: клиенты 316510 и 621958
Шаги воспроизведения:
1. Авторизоваться в АМ.
2. Зайти в ""Инвестции"" или ""Обзор активов"". 

ОР:
Балансы на БС соответствуют реальным.

ФР:
Наблюдается несуществующий минус по одному из БС.

Ошибка не связана с Мобайлом, такой ответ возвращает /adir/portfolios/v10/rest/\{pin}
В тройке и четверке я не вижу таких минусов по клиентам.
Ответ сервиса на примере 316510:
[
 {
 ""assetId"": ""USD"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""Рынок ценных бумаг"",
 ""qtyCurrent"": 0,
 ""qtyForward"": 0,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""USD""
 },
 ""qtyOpen"": 0,
 ""accPrice"": {
 ""value"": 0,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""USD"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""Рынок ценных бумаг"",
 ""qtyCurrent"": 0,
 ""qtyForward"": 0,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""USD""
 },
 ""qtyOpen"": 0,
 ""accPrice"": {
 ""value"": 0,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""USD"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""Рынок ценных бумаг"",
 ""qtyCurrent"": 0,
 ""qtyForward"": 0,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""USD""
 },
 ""qtyOpen"": 100,
 ""accPrice"": {
 ""value"": 0,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""RU000A102EQ8"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""НРД"",
 ""qtyCurrent"": 0,
 ""qtyForward"": 0,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""USD""
 },
 ""qtyOpen"": 0,
 ""accPrice"": {
 ""value"": 0,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""IE00BD3QHZ91"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""НРД"",
 ""qtyCurrent"": 353,
 ""qtyForward"": 353,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""GBP""
 },
 ""qtyOpen"": 353,
 ""accPrice"": {
 ""value"": 5685.130311,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""IE00BMDKNM37"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""НРД"",
 ""qtyCurrent"": 26132,
 ""qtyForward"": 26132,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""USD""
 },
 ""qtyOpen"": 26132,
 ""accPrice"": {
 ""value"": 76.360163,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""EUR"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""Рынок ценных бумаг"",
 ""qtyCurrent"": 0,
 ""qtyForward"": -7000,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""EUR""
 },
 ""qtyOpen"": 0,
 ""accPrice"": {
 ""value"": 0,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""IE00BD3QJ757"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""НРД"",
 ""qtyCurrent"": 193,
 ""qtyForward"": 193,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""USD""
 },
 ""qtyOpen"": 193,
 ""accPrice"": {
 ""value"": 10362.621761,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""IE00BD3QFB18"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""НРД"",
 ""qtyCurrent"": 512,
 ""qtyForward"": 512,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""RUB""
 },
 ""qtyOpen"": 512,
 ""accPrice"": {
 ""value"": 3893.845703,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""RU000A0ZZH92"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""НРД"",
 ""qtyCurrent"": 1094,
 ""qtyForward"": 1094,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""RUB""
 },
 ""qtyOpen"": 1094,
 ""accPrice"": {
 ""value"": 1827.5,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""RU000A101X68"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""НРД"",
 ""qtyCurrent"": 0,
 ""qtyForward"": 0,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""USD""
 },
 ""qtyOpen"": 0,
 ""accPrice"": {
 ""value"": 0,
 ""currency"": ""RUB""
 }
 },
 {
 ""assetId"": ""RUB"",
 ""accountId"": 316510,
 ""subAccountId"": 0,
 ""section"": ""Рынок ценных бумаг"",
 ""qtyCurrent"": 5004.09,
 ""qtyForward"": 5004.09,
 ""accruedInt"": {
 ""value"": 0,
 ""currency"": ""RUB""
 },
 ""qtyOpen"": 5004.09,
 ""accPrice"": {
 ""value"": 0,
 ""currency"": ""RUB""
 }
 }
]
Скрин из АМ во вложении:",,5.0,
ADIRINC-91,1527480,U_M0YRB,Отклонен,27.05.2021 18:00,unreproducе,,,,Дефект промсреды,22.12.2022 12:05,2021-07-12 00:00:00.0,,,,
ADIRINC-87,1525079,U_00IPG,Отклонен,26.05.2021 19:45,,,,,Дефект промсреды,11.06.2021 11:46,2021-07-09 00:00:00.0,"*Шаги воспроизведения:*

Клиент купил еврооблигацию в валюте

*Фактически:*

Он видит ту же сумму , но в рублях

В бэке данные аналогичные

*Ожидаемый результат:*

Валюта заявок и сделок не может расходиться.

*Допинфо:*

*Сейчас решается вручную примерно так*

*1)Удалить сделку*
*2)Осуществить вызов:*
*EXEC dbo.rt_op_set_trade*",,,
ADIRINC-83,1523886,U_M0WVN,Закрыт,26.05.2021 13:43,,,,,Дефект промсреды,07.10.2022 17:55,2021-07-08 00:00:00.0,"*Шаги воспроизведения:*

Клиент выставляет заявку и видит доступное кол-во лотов

*Фактически:*

Получает ошибку в логах расчетов лимитов, так как у него уже много заявок висит на СПБ

И это корректно.

*Ожидаемый результат:*

Отображать на этапе выставления заявки доступное кол-во лотов с учетом проверки лимитов. Иначе клиента это вводит в заблуждение и порождает обращения такого рода

*Допинфо:*

*249182_Бучминский Альберт Романович*

*!Снимок.PNG!*",,,
ADIRINC-79,1522605,U_M0WVN,Закрыт,25.05.2021 19:02,,,,,Дефект промсреды,21.09.2021 14:23,2021-07-08 00:00:00.0,"*Шаги воспроизведения:*
 # Клиент купил бумаги BSPBP Банк Санкт-Петербург привилегированные акции

*Фактически:*

Видит в портфеле позицию по бумагам Банка Санкт-Петербург STBKP

*Ожидаемый результат:*

Корректное отображение бумаг в позиции BSPBP 

*Допинфо:*

Вот какую то инфу нашел по STBKP еще погуглив

http://mfd.ru/marketdata/ticker/?id=8139#id=8139&start=24.08.2011&timeframe=1440&i0=EMA&i1=EMA&i1_Period=50&i2=MACD&count=NaN

!image-2021-05-25-18-54-18-480.png!

!image-2021-05-25-18-54-38-180.png!

Заявки по BSPBP, по STBKP нет :

Вот одна из них [https://alfaadmin/reporting/orders/596134-000/28562531184/1]

!image-2021-05-25-18-55-49-964.png!",,,
ADIRINC-78,1522581,U_M12MD,Закрыт,25.05.2021 18:19,,,,,Дефект промсреды,29.09.2021 12:58,2021-07-28 00:00:00.0,"*Шаги воспроизведения:*

Клиент выставляет заявку

267166 kershanskiy@gmail.com

*Фактически:*

При выставление заявки все время ещё высвечивается вторая заявка на графике с ценой ""0""
!image-2021-05-25-18-13-11-680.png!

 

*Допинфо:*

[^logs_and_screenshot.7z]

 ",,,
ADIRINC-72,1522089,U_M18E0,Отклонен,25.05.2021 16:12,,,,,Дефект промсреды,29.09.2021 13:37,2021-07-07 00:00:00.0,"*Шаги воспроизведения:*

Заводим в АА инструмент, например US05379B1070

*Фактически:*

При проверке в 4-ке видим, что не меняется поле IdAllowOrderStatus

По умолчанию проставляется 0, должно быть 4 в данном случае.

Приходится просить апдейтить вручную в БД

 ",,,
ADIRINC-59,1515890,U_M0WVN,Закрыт,21.05.2021 17:15,,,,,Дефект промсреды,07.10.2022 17:51,2021-07-05 00:00:00.0,"*Шаги воспроизведения:*

Клиент  ATF3I2 при переходе из мобайла, выставляет заявку в МТ

*Фактически:*

Ловит !image-2021-05-21-17-11-56-553.png!

*Ожидаемы результат:*

Демо режим уже выпилен должен быть везде.

*Допинфо*

Демо режим засвечивает на андройде - пока не исправиликак купить - перезайти в АИ но не из АМ, должно быть все хорошо

Воспроизводится:
 зайти в АМ - перейти в инвестиции - тапнуть по инструменту - перейти в АИ
 и дальше в заявку - особенно на 2-3-4 раз есть шанс словить демо-режим.
 В первый раз - никогда.
 2-3-4 раз вернуться в АМ и опять в АИ


Скрипт для проверки:
{code:java}
select acc_code, b.p_code, b.real_rest, b.place_code, mb.NameMarketBoard
 from hell.dbo.balance as b
 join hell.dbo.actives as a on a.p_code = b.p_code
 join adback.hell.matchactives2objects as mao on mao.act_id = a.act_id
 left join adfront.bs.positions as p on p.idaccount = b.treaty and p.idobject = mao.idobject
 join adfront.bs.objects as o on o.idobject = mao.idobject 
 join ADFront.dbo.FinInstruments as fi on fi.idobject = o.idobject
 join [ADFront].[dbo].[MarketBoards] as mb on mb.IdMarketBoard = fi.IdMarketBoard
 left join AdFront.fi.FinInfoExt as fie on fie.idfi = fi.idfi
 where 1=1
 and b.p_code not in ('money','USD', 'EUR')
 and b.real_rest > '0.00'
 and p.idobject is null
 and b.treaty > 1000
 and b.treaty < 99999999
 and len(o.isin) =12
 -- and fie.IdTradePeriodStatus in ('6','10')
 -- and fie.IdAllowOrderStatus = '4'
 -- and mb.namemarketboard not like '%спб%'
 and acc_code like '4249088%'
 order by b.p_code desc{code}",,5.0,
ADIRINC-51,1510267,U_M0WVN,Закрыт,19.05.2021 15:27,,,,,Дефект промсреды,01.09.2022 10:05,2021-12-09 00:00:00.0,"*Шаги вопспроизведения:*

Клиент пытается вывести средства

*Фактически:*

Ловит ошибку 

!image-2021-05-19-15-06-22-262.png!

Ожидаемый результат:

Успешный вывод средств.

*Допинфо:*
 # Андроид 157392 ген.сог.
Паневин Роман Игоревич
[panromanrent@gmail.com|mailto:panromanrent@gmail.com]
Клиент не может вывести средства. Пишет система, что нужен второй заход.
Терминал переустанавливал, проблема сохранилась.
 # ГС 200588 
Версия приложения: 2.0.2
Логин: iazaplatin
Устройство: PRO 6 Plus
Прошивка: 6.0.1
Время: 1621335144346 (2)
Время сервера (OperServer): 1621342383655
Статус работы серверов: + + + +
Connected: true
DataEnabled: false
Is 4G: false
WiFi enabled: true
WiFi connected: true
Available by ping: false
Network operator name: MegaFon
Network type name: NETWORK_WIFI
IP address: 192.168.137.22

 

 ",,144.0,
ADIRINC-48,1507184,U_M0WVN,Закрыт,18.05.2021 12:44,,,,,Дефект промсреды,08.09.2021 14:14,2021-06-30 00:00:00.0,"*Шаги воспроизведения:*

Клиент 265739 заходит в свой портфель

*Фактически:*

Не видит там еврооблигации Газпрома (XS1721463500)

*Ожидаемый результат:*

Видит все свои бумаги без исключения.

*Допинфо:*

Бумага торгуется на борде TQOE. Он отсутствует в 

select * from adfront.dbo.marketboardcodes where SysBoardCode = 'TQOE'

Не все разделы есть в таблицах, что препятствует их корректному заведению в бой.

Корневая проблема решается тут http://jira.moscow.alfaintra.net/browse/ADIRTECH-7355",,3.0,
ADIRINC-47,1505663,,Отклонен,17.05.2021 17:53,,,,,Дефект промсреды,06.10.2022 14:54,2021-06-29 00:00:00.0,"Описание: У клиента 261273 ИЛЬЯНЕС САН МАРТИН Анастасия Сергеевна в верхнем левом углу некорректно подтягивает Имя. Подтягивается часть фамилии . Заведена корректно.

ФР: Подтягивается второе слово после разделителя.

ОР: Должно подтягиваться имя

!image-2021-05-17-17-55-01-872.png!",,,
ADIRINC-45,1498120,U_M0UPU,Отклонен,13.05.2021 14:04,,,,,Дефект промсреды,07.10.2022 12:24,2021-06-25 00:00:00.0,"Шаги воспроизведения:
Вызвать сервис /adir/accounts/v10/rest/documents/ по клиентам *AJT1DW,*  *ABXG40.*
ОР:
По клиенту возвращаются инвестиционные документы.

ФР:
По клиенту получаем ошибку business.error.not.found.

Доп. инфо:

Источник ошибок:
 - старый интеграционный сервис АД: GET /account/\{userId}/documents
 - новый сервис UWS от АД: GET /adir/accounts/v10/rest/documents/<userId>

По клиентам, у которых есть БС сервисы возвращают 404 ошибку. ",,,
ADIRINC-44,1498068,U_M0UPU,Отклонен,13.05.2021 10:42,,,,,Дефект промсреды,07.09.2021 18:17,2021-06-25 00:00:00.0,"Шаги воспроизведения:
Иметь в портфеле в АД любую бумагу, которая торгуется в валюте, отличной от валюты номинала, и была куплена в валюте, отличной от валюты номинала.
ОР:
Бумага в разделе ""Инвестиции"" в АМ отображается в валюте сделки.

ФР:

Бумага в разделе ""Инвестиции"" в АМ отображается в валюте номинала.

 ",,11.0,
ADIRINC-43,1497086,U_M0WVN,Закрыт,12.05.2021 14:54,,,,,Дефект промсреды,28.04.2023 15:39,2023-05-03 00:00:00.0,"*Шаги воспроизведения:*

Клиент хочет купить бумагу на СПБ XS1513741311

*Фактически:*

Возникает ошибка ""Инструмент недоступен к торгам""

[https://alfaadmin/reporting/orders/1180522-000/8430184681/1]

*Ожидаемый результат:*

Клиент не должен ловить ошибку , если бумага активна и торгуется на бирже.

*Допинфо:*

*Вахтина Юлия Анатольевна_ген.сог.1180522*

Бумага заведена и в 3-ке и в 4-ке. При этом она заведена для торгов и на СПБ и на Мосбирже, вероятно из-за этого не получается выставить заявку на СПБ

select * from ADFront.dbo.marketboards where IdMarketBoard in (select IdMarketBoard from adfront.dbo.fininstruments where IdMarketBoard in (select IdMarketBoard from ADFront.dbo.marketboards where IdObject in ('457237')) and IsEnabledFinInstrument = 1)

!image-2021-05-12-14-50-40-912.png!",,5.0,
ADIRINC-41,1492361,U_M0WVN,Закрыт,07.05.2021 14:15,,,,,Дефект промсреды,25.01.2022 14:47,2022-03-10 00:00:00.0,"*Шаги воспроизвдения:*

Клиент ставит стоп цену в заявке 0,052

*Фактически:*

В сформированной заявке ему отображается 0,05

!image-2021-05-07-14-11-41-447.png!

*Ожидаемый результат:*

Отображать фактическую стоп-цену и количество знаков после запятой. Иначе вводит клиентов в заблуждение

*Допинфо:*

Клиент 106167 Федоров Никита Анатольевич

Версия приложения: 2.0.1
 Логин: na_fedorov
 Устройство: YAL-L21
 Прошивка: 10
 Время: 1620207417111 (3)
 Время сервера (OperServer): 1620218215630
 Статус работы серверов: + + + +
 Connected: true
 DataEnabled: true
 Is 4G: false
 WiFi enabled: true
 WiFi connected: true
 Available by ping: true
 Network operator name: Tele2
 Network type name: NETWORK_WIFI
 IP address: 192.168.31.186

 В логах расчета лимитов нашел, что там тоже 0,05. Тогда вопрос почему клеинт может устанавливать с тремя знаками , а у нас везде видно только два

!image-2021-05-07-14-21-42-013.png!",,2.0,
ADIRINC-40,1490890,U_M1DQU,Отклонен,07.05.2021 11:48,to_fix,,,,Дефект промсреды,30.08.2023 15:13,2021-08-03 00:00:00.0,"Пререквизит - клиент с фамилией из нескольких слов.
Шаги воспроизведения:
Авторизоваться в МТ.
ОР:
В верхнем левом углу на главной странице отображается имя клиента.
ФР:
В верхнем левом углу на главной странице отображается второе слово из фамилии клиента.
Скриншоты во вложении.
 ",,3.0,
ADIRINC-39,1488090,U_M12MD,Закрыт,05.05.2021 16:43,,,,,Дефект промсреды,24.01.2022 14:48,2021-07-08 00:00:00.0,"*Шаги воспроизведения:*

Клиент редактирует заявки на графике на аднроиде

Снимает заявку.

*Фактически:*

После этого не может выставить тут же новую

*Допинфо:*

Воспроизводится

Пример по клиенту 224811 Гришин Михаил Александрович

Версия приложения: 2.0.1
 Логин: mgrishin8
 Устройство: M2007J3SG
 Прошивка: 10
 Время: 1619593866441 (3)
 Время сервера (OperServer): 1619604666421
 Статус работы серверов: + + + +
 Connected: true
 DataEnabled: true
 Is 4G: false
 WiFi enabled: true
 WiFi connected: true
 Available by ping: true
 Network operator name: YOTA
 Network type name: NETWORK_WIFI
 IP address: 192.168.1.105",,5.0,
ADIRINC-38,1485847,U_M0NT4,Отклонен,05.05.2021 12:53,,,,,Дефект промсреды,01.12.2021 17:26,2021-06-18 00:00:00.0,"*Шаги воспроизведения:*

Пропадают индексы Мосбиржи и другие, например GLTI, FIXP, GRBI

*Фактически:*

Клиеинты их не видят

*Ожидаемый результат:*

Искоренить причину самопроизвольного исчезновения индексов, устранить конфликты в логике отображения.

*Детальная информация:*

Когда включен параметр isenabledfininstrument, флаг DisplayGroup может сам меняться, не смотря на то что его вручную меняли уже.
 --установить DisplayGroup = 101
 select DisplayGroup, * from ADFront.ts.objects AS ax WHERE IdObject = 611956 
 В {{ [intrfc].[TSObjects_Upd_Adapter_SaveData] корректно срабатывает условие:}}
 CASE
 WHEN og.CodeObjectGroup IN ('Stocks', 'Receipts')
 AND spb.IdObjectCurrency = @IdObjectCurrencyUSD THEN
 102 – 'StockUsa'
 WHEN og.CodeObjectGroup IN ('Stocks', 'Receipts')
 AND spb.IdObjectCurrency IS NULL THEN
 101 – 'StockRf'
 WHEN ot.CodeObjectType IN ('BC', 'BB', 'BI') THEN
 105 --'CorporateBonds'
 WHEN ((ot.CodeObjectType IN ('BC', 'BB', 'BI')) OR (ot.CodeObjectType = 'BG' AND nom.SymbolObject <> 'RUB')) THEN
 106 – 'EuroBonds'
 WHEN ((ot.CodeObjectType IN ('BS', 'BM', 'BR')) OR (ot.CodeObjectType = 'BG' AND nom.SymbolObject = 'RUB')) THEN
 107 – 'GovernmentBonds'
 WHEN og.CodeObjectGroup IN ('Stocks', 'Receipts')
 AND spb.IdObjectCurrency = @IdObjectCurrencyEUR THEN
 108 – 'StockEC'
 ELSE
 og.IdObjectGroup
 END AS DisplayGroup

Проблема в логике отображения инструментов в МТ.

 ",,4.0,
ADIRINC-37,1482489,U_M0NT4,Отклонен,05.05.2021 09:14,,,,,Дефект промсреды,25.05.2021 18:17,2021-05-27 00:00:00.0,"Шаги воспроизведения:
Зайти в МТ или ДТ, попытаться найти инструмент DE0008430026.

ОР:
Инструмент находится, доступен к торгам.

ФР:
Инструмент не находится, соответственно им невозможно торговать.

Доп. инфо:
DE0008430026 есть и в тройке, и в четверке. Но записана на 118 борд, что означает недоступность торгов по инструменту в терминалах. Необходимо добавить инструмент на торгуемый раздел. Известных ограничений на торговлю бумагами, эмитироваными в евро, на СПБ, мне неизвестно. Скрипты ниже
select * from adfront.dbo.objects where IdObject in ('572666')
select * from adfront.ts.objects where IdObject in ('572666')
 select DisplayGroup,* from ADFront.ts.objects
where IdObject = 572666
 select * from ADFront.bs.objects 
where IdObject = 572666
select IsEnabledFinInstrument, * from adfront.dbo.fininstruments where IdObject in ('572666') 
select IdAllowOrderStatus, * from adfront.ts.FinInfoExt where idfi=643788 
select IdAllowOrderStatus, * from adfront.fi.FinInfoExt where idfi=643788",,,
ADIRINC-36,1482484,U_M0WVN,Закрыт,05.05.2021 08:54,,,,,Дефект промсреды,28.04.2023 15:39,2023-07-27 00:00:00.0,"Клиент 192418, МТ 2.0.1 версии:
Шаги воспроизведения:
Авторизоваться в МТ.
ОР:
Баннеры на главной прогружаются корректно.
ФР:
Баннеры разъехались и отображаются некорректно.",,3.0,
ADIRINC-35,1482437,U_M0NT4,Закрыт,04.05.2021 16:15,,,,,Дефект промсреды,24.05.2021 09:39,2021-05-06 00:00:00.0,"Бумаги RU000A102K96 нет в МТ и ДТ, есть в тройке и четверке. Необходимо вернуть инструмент в терминалы.",,,
ADIRINC-34,1481183,U_M0NT4,Закрыт,04.05.2021 13:08,,,,,Дефект промсреды,24.05.2021 10:51,2021-05-06 00:00:00.0,"Бумага US37949E2046  есть и в тройке, и в четверке, но в МТ не отображается. ",,,
ADIRINC-33,1474933,U_M0NT4,Закрыт,28.04.2021 17:48,,,,,Дефект промсреды,24.05.2021 16:38,2021-04-30 00:00:00.0,"Бумага RU000A0ZZ4B9 пропала из терминалов. По информации от Вишняковой Елены, вызвано это значением DisplayGroup = 105 в  ADFront.ts.objects. Необходима смена на 101, но адаптер intrfc.TSObjects_Upd_Adapter_SaveData затирает значение обратно на 105. Существующая рекомендация проблему не решает, необходимо вернуть инструмент в терминалы.

Допинфо:

*Условие, по которому определяется 101:* CodeObjectGroup IN ('Stocks', 'Receipts') AND
(
        SELECT mb.IdObjectCurrency
        FROM dbo.FinInstruments AS fin
        INNER JOIN dbo.MarketBoards AS mb
            ON fin.IdMarketBoard = mb.IdMarketBoard
        WHERE mb.IdMarket = 10
            AND fin.IdObject = tsobj.IdObject
) IS NULL

 

*условие для 105:* CodeObjectType IN ('BC', 'BB', 'BI') -- 105 'CorporateBonds'",,,
ADIRINC-32,1473819,U_M0WVN,Закрыт,28.04.2021 17:22,,,,,Дефект промсреды,07.10.2022 17:43,2021-06-11 00:00:00.0,"Шаги воспроизведения:
Клиент 293491.
1. Попытаться авторизоваться по биометири в МТ.
ОР:
Авторизация происходит успешно.
ФР:
Авторизация не проходит, возникает сообщение об ошибке.

Доп. инфо:
Версия приложения: 2.0.1
Логин: dgodovnikov
Устройство: SM-A305FN
Прошивка: 10
Время: 1619019358967 (3)
Время сервера (OperServer): 1619019358967
Connected: true
DataEnabled: false
Is 4G: false
WiFi enabled: true
WiFi connected: true
Available by ping: true
Network operator name: MTS RUS
Network type name: NETWORK_WIFI
IP address: 192.168.1.65",,14.0,
ADIRINC-31,1473818,U_M0NT4,Отклонен,28.04.2021 17:16,,,,,Дефект промсреды,06.10.2022 14:47,2021-06-11 00:00:00.0,"Шаги воспроизведения:
Зайти в МТ, нажать на позицию Акции ETC - RU000A0JULB8.
ОР:
Сводка по позиции прогружается корректно.

ФР:
Сводка по позиции прогружается с некорректными данными.",,31.0,
ADIRINC-30,1474689,U_M0NT4,Закрыт,28.04.2021 16:55,,,,,Дефект промсреды,22.12.2022 11:52,2021-06-11 00:00:00.0,"*Фактический результат:* НКД отображается некорректно ( в 10 раз больше, чем нужно)

*Ожидаемый результат:*  Корректное отображение НКД

*Описание:*
Клиенту (ГС 421013 ) купил бумагу  RU000A101HQ3 06.04.2021 с нкд 7,40, НКД не мог составить 369,90. На данный момент в [ADFront.bs|http://adfront.bs/].Objects AccruedIntT0
850.70000000. Последняя запись в quotes.PriceInfo.Prices  по 116006 с NkdCurrencyId и nkd - NULL. В портфеле у клиента по данной бумаге income_nkd_saldo -7.40",,,
ADIRINC-29,1472902,U_M18JH,Закрыт,28.04.2021 11:09,,,,,Дефект промсреды,22.12.2022 11:48,2021-06-11 00:00:00.0,"Шаги воспроизведения:
Открыть МТ.
Попытаться авторизоваться.

ОР:
Этап авторизации проходит успешно.

ФР:
Бесконечная загрузка при авторизации.

Доп. инфо:
Версия приложения: 2.0.1
Логин: elkin_aa
Устройство: SM-T715
Прошивка: 7.0
Время: 1619011531849 (4)
Время сервера (OperServer): 1619011531850
Connected: true
DataEnabled: true
Is 4G: false
WiFi enabled: true
WiFi connected: true
Available by ping: true
Network operator name: Beeline
Network type name: NETWORK_WIFI
IP address: 192.168.5.69 
Логи и видеодемонстрация проблемы во вложениях.",,33.0,
ADIRINC-28,1472894,U_M0WVN,Закрыт,28.04.2021 10:55,,,,,Дефект промсреды,28.04.2023 15:34,2023-06-15 00:00:00.0,"Шаги воспроизведения:
Клиент 17786 авторизуется в МТ и заходит в ""Сделки"",

ОР:
История сделок прогружается корректно.

ФР:
История сделок не прогружается.

Доп. Инфо:
Версия приложения: 2.0.1
Логин: mtrusfus
Устройство: Nokia 7.1
Прошивка: 10
Время: 1619020832059 (3)
Время сервера (OperServer): 1619031608056
Статус работы серверов: + + + +
Connected: true
DataEnabled: true
Is 4G: false
WiFi enabled: true
WiFi connected: true
Available by ping: true
Network operator name: Tele2
Network type name: NETWORK_WIFI
IP address: 192.168.1.10

Логи во вложении",,5.0,
ADIRINC-27,1472877,U_M16SB,Отклонен,28.04.2021 10:09,,,,,Дефект промсреды,27.12.2021 18:36,2021-06-11 00:00:00.0,"Шаги воспроизведения:
Авторизоваться в МТ.
Нажать на ""Портфель""
ОР:
Наполнение окна прогружается корректно.
ФР:
Наполнение окна не прогружается в принципе.",,33.0,
ADIRINC-25,1472072,U_M1ME9,Закрыт,27.04.2021 15:40,,,,,Дефект промсреды,22.12.2022 11:44,2022-11-16 00:00:00.0,"Коллеги, у различных клиентов после обновления возниикает зависание ПО.

*Примеры:*

1) 64928 Самойленко Сергей Николаевич

+Описание:+ ** Листаешь котировки и приложение виснет каждые 5 минут!
 Индексы в закладках залипли и исчезли после обновления. Теперь если на них щёлкать, то приложение зависает и падает.""

Версия приложения: 2.0.0 (736)
 Логин: ssamoylenko
 Устройство: iPad8,9
 Прошивка: iOS 14.4.2
 Время: 25.04.2021, 16:50:30 (3)
 Время сервера: 25.04.2021, 16:50:30
 Статус работы серверов: + + + +
 Интернет соединение: WiFi
 VPN: OFF

2) 289108 , 257828

+Описание:+ ** Не работают кнопки ПОПОЛНИТЬ ПЕРЕВЕСТИ АНАЛИТИКА ИСТОРИ

3) 103105 

+Описание:+  **  Долгая загрузка мобильного терминала

4) 163462 Новохатская

+Описание:+ Виснет терминал по возвращении к нему после просмотра интернета,звонков ,итд

5) 312398 Холкина

+Описание:+ У клиента медленно загружается приложение

Версия приложения: 2.0.0 (736)
 Логин: aaholkina
 Устройство: iPhone13,4
 Прошивка: iOS 14.4.2
 Время: 22.04.2021, 15:25:46 (7)
 Время сервера: 22.04.2021, 11:25:46
 Статус работы серверов: + + + +
 Интернет соединение: Cellular (4G)
 VPN: OFF

 

6) 99303 Хвостов

+Описание:+ не прогружается вкладка сделки в МТ

Версия приложения: 2.0.1
 Логин: anhvostov
 Устройство: Mi 9T
 Прошивка: 10
 Время: 1619079642068 (3)
 Время сервера (OperServer): 1619090442512
 Статус работы серверов: + + + +
 Connected: true
 DataEnabled: true
 Is 4G: false
 WiFi enabled: true
 WiFi connected: true
 Available by ping: true
 Network operator name: YOTA
 Network type name: NETWORK_WIFI
 IP address: 192.168.31.25

7) 176472 

+Описание:+ не кликабельны кнопки приложения, просьба проверить

Версия приложения: 2.0.0 (736)
 Логин: sshugakin
 Устройство: iPhone13,3
 Прошивка: iOS 14.4.2
 Время: 21.04.2021, 15:54:26 (3)
 Время сервера: 21.04.2021, 15:54:26
 Статус работы серверов: + + + +
 Интернет соединение: WiFi
 VPN: OFF

 

8) 105807 Макарьянц Алексей Михайлович
 +Описание:+ Коллеги у клиента после обновления не загружается портфель в  МТ.

9)587868 Мамай

+Описание:+ Зависание приложения при загрузке профиля/портфеля

Версия приложения: 2.0.1
 Логин: gmamay
 Устройство: EML-L29
 Прошивка: 10
 Время: 1619028363119 (3)
 Время сервера (OperServer): 1619039164259
 Статус работы серверов: + + + +
 Connected: true
 DataEnabled: true
 Is 4G: false
 WiFi enabled: true
 WiFi connected: true
 Available by ping: true
 Network operator name: MTS RUS
 Network type name: NETWORK_WIFI
 IP address: 192.168.1.69

10) ГС  81448 не загружаются вкладки в мобильном терминале, не только вкладка главная, но и котировки

[^logi_181448.txt]

!image-2021-05-20-11-13-03-608.png!

 

11) 171792  Мобильное приложение после обновление не прогружает данные по несколько минут, ненадолго иногда помогает перезагрузка. Просьба помочь в решении. Скриншоты и логи во вложениях. 

Версия приложения: 2.1.0 (745)
Логин: ivpoddubniy
Устройство: iPhone XS
Прошивка: iOS 14.5.1
Время: 02.06.2021, 13:30:51 (3)
Время сервера: 02.06.2021, 13:30:51
Статус работы серверов: + + + +
Интернет соединение: Cellular (4G)
VPN: OFF

!image-2021-06-03-11-40-30-488.png!",,32.0,
ADIRINC-24,1471333,U_M0WVN,Закрыт,27.04.2021 12:28,,,,,Дефект промсреды,15.09.2021 15:49,2021-04-29 00:00:00.0,"Пререквизит:
Клиент с >1 ГС, например AGRR03 с гс 1064093 и 153714.
Шаги воспроизведения:
В АМ зайти в ""Инвестиции"".
ОР:
Раздел прогружается нормально, операции по счетам доступны.

ФР:
Портфель падает с ошибкой, операции по счетам недоступны.

Доп. инфо:
В логах микросервисов АМ ошибка :
_""Unrecognized token 'More': was expecting (JSON String, Number, Array, Object or token 'null', 'true' or 'false')\n at [Source: (String)\""More than one user agreement\""; line: 1, column: 5]""_

В логах старых апи Директа:
More than one user agreement",,,
ADIRINC-22,1470382,U_M0NT4,Отклонен,27.04.2021 10:19,,,,,Дефект промсреды,25.05.2021 18:15,2021-05-27 00:00:00.0,"Бумага *XS0088543193* пропала из терминалов. Многократные ручные правки заставляют бумагу то пропадать из терминалов вообще, то нормально отображаться при поиске и покупке, но отображаться внутри портфеля как n/a. Необходимо исключить повторение подобных ситуаций в дальнейшем.",,,
ADIRINC-20,1470376,U_M0WVN,Закрыт,27.04.2021 09:53,,,,,Дефект промсреды,15.09.2021 15:49,2021-04-29 00:00:00.0,"Бумага RU000A101616 имеет валюту номинала - EUR, торгуется с расчетами и в евро, и в рублях. Автоматически для бумаги проставился режим торгов, соответствующий расчетам в рублях, что не соответствует требованию расчетов бумаг в валюте номинала, из-за чего бумага к торгам через терминалы недоступна. Ручной правкой было восстановлено отображение в терминалах, но операции по бумаге все еще недоступны, т.к. в системах нет необходимого борда под торги в EUR на МБ.",,3.0,
ADIRINC-19,1470527,U_M0NT4,Отклонен,27.04.2021 09:25,,,,,Дефект промсреды,02.08.2021 14:09,2021-06-10 00:00:00.0,"*Фактических результат:*

Коллеги, инструмент RU000A0JXU48  не отображался в МТ и ДТ. 

Как выяснилось, что данный инструмент не корректно заведен. Доступен на 139 и 116 бордах, но в [ADFront.bs|http://adfront.bs/].Objects указана за IdMarketBoardBalance-150

26.04.2021 запись была обновлена вручную (""прошу установить по этой облигации IdMarketBoardBalance = 139 и IdFiBalance = 243648:"")

Но на следующей день (27.04.2021) запись была обновлена на старое значение (""Доброе утро по {{select * from }}{{[ADFront.bs|http://adfront.bs/]}}{\{.Objects where IdObject = 463268 }}IdMarketBoardBalance - 150 и IdFiBalance - 243629"")",,,
ADIRINC-18,1469638,U_M0UPU,Отклонен,26.04.2021 16:01,,,,,Дефект промсреды,24.08.2021 11:21,2021-06-09 00:00:00.0,"*Шаги воспроизведения:*

Клиент хочет вывести средства.

*Фактический результат:*

Возникает ошибка ""Имеются заявки на СПБ при выводе средств.""

!image-2021-04-26-15-43-44-753.png!

*Ожидаемый результат:*

Корректная трансляция данных по процессу ADFront.ts.Orders --> ADFront.ts.Orders -->в repl_data.spbex.Orders во всех таблицах и отсутствие влияния на операции пользователей.

*Допинформация:*

Пример на скрине по ГС 204735

В момент ошибки  скапливается много подвисших заявок в некорректных статусах

Скрипт отбора:

SELECT
so.NumEDocument
, so.IdAccount
, so.IdOrderStatus
, ord40.IdOrderStatus
, ord40.NumEDocument
FROM repl_data.spbex.Orders AS so
LEFT JOIN ADFront.ts.Orders AS ord40
ON so.NumEDocument = ord40.NumEDocument
WHERE so.IdOrderStatus < 18
AND ISNULL(ord40.IdOrderStatus, 21) <> so.IdOrderStatus
AND (ord40.IdOrderStatus IN (18, 20, 21) OR ord40.IdOrderStatus IS NULL)

Периодически правки силами отдела sql-разработчиков помогают решить проблему.

Предположительно проблема где-то в процесе трансляции данных из ADFront.ts.Orders в repl_data.spbex.Orders.

 ",,22.0,
ADIRINC-17,1464751,U_M15NY,Отклонен,22.04.2021 17:23,,,,,Дефект промсреды,07.09.2021 18:04,2021-06-07 00:00:00.0,"В ДТ собираются в файл логи уровня DEBUG, которые нужны исключительно для отладки в тестовых средах. Для сопровождения это усложняет процесс анализа логов, клиентам приходится вычищать огромные файлы логов.

Шаги воспроизведения:
Пользоваться МТ.

ОР:
В логи не пишутся записи для дебага.

ФР:
В логи пишутся записи для дебага.",,,
ADIRINC-15,1463273,U_M16Z9,Отклонен,22.04.2021 10:38,,,,,Дефект промсреды,22.12.2022 11:41,2021-06-07 00:00:00.0,"В таблице hell.[SPBEX].[tax_identification] есть определенное кол-во актуальных записей с application_status is NULL. Данная ошибка из-за некорректно заведеных клиентских анкет. В следствии чего по данным клиентам возникнет ошибка получения налогового идентификатора ( т.к. данные не верны и данные клиенты не попадают в выгрузку) 

 

Скрипт на записи:
 select t1.* from hell.[SPBEX].[tax_identification] as t1select t1.* from hell.[SPBEX].[tax_identification] as t1 INNER JOIN (select treaty, MAX(doc_date) as maxdate from hell.[SPBEX].[tax_identification] GROUP BY treaty ) as t2 ON t1.treaty=t2.treaty AND t1.doc_date=t2.maxdate where 1=1 and application_status is NULL

Клиент: 1004540

!image-2021-04-22-09-12-18-072.png|width=495,height=423!

После редактирования анкеты через п/я  AD_clients application_status стал RECEIVED

 

Необходимо:Выявить список обязательных полей к заполнению, сделать соответствующие проверки в АА на проверку ручного ввода адресов",,,Core
ADIRINC-14,1462004,U_M0V2E,Отклонен,21.04.2021 15:48,,,,,Дефект промсреды,21.04.2021 15:51,2021-06-04 00:00:00.0,"Шаги воспроизведения: 

1) Клиент выставляет заявку на СПБ

{color:#ff8b00}ФР{color} Заявка отклоняется с ошибкой DENY_INSTRUMENT

{color:#57d9a3}ОР{color} Заявка исполнилась

*Доп. инфо:*
На примере клиента 58622
При повторной передачи информации по клиенту в биржу СПБ (отправка файла FATCA_QUESTIONNAIRE_REPLY_2021-04-14_MFBIM00003706655.xml) получаем ошибку:
13392 Список клиентских кодов не соответствует данному клиенту %s.

По данному ДУЛ две записи:
select treaty, application_status, * from hell.[SPBEX].[tax_identification] where document_number = '04 17 046199'

 

*Причина:* в какой-то момент идентификатор клиента на бирже перестал совпадать с ген. соглашением и при повторной регистрации клиента в АД , при передачи информации на биржу статус клиента application_status = REJECTED.

На данный момент  в таблице 12 тыс. дублей с одинаковыми ДУЛ:
select document_number, treaty, first_name,second_name, patronymic_name, application_type, application_status  from hell.[SPBEX].[tax_identification] select document_number, treaty, first_name,second_name, patronymic_name, application_type, application_status  from hell.[SPBEX].[tax_identification]  where document_number in (select document_number  from hell.[SPBEX].[tax_identification] group by document_number HAVING count(*)>1)

Необходимо добавить дополнительные условия для отбора клиентов для массового исправления.",,,
ADIRINC-13,1462003,U_M16Z9,Отклонен,21.04.2021 15:48,,,,,Дефект промсреды,06.10.2022 14:40,2021-06-04 00:00:00.0,"Шаги воспроизведения: 

1) Клиент выставляет заявку на СПБ

{color:#ff8b00}ФР{color} Заявка отклоняется с ошибкой DENY_INSTRUMENT

{color:#57d9a3}ОР{color} Заявка исполнилась

*Доп. инфо:*
На примере клиента 58622
При повторной передачи информации по клиенту в биржу СПБ (отправка файла FATCA_QUESTIONNAIRE_REPLY_2021-04-14_MFBIM00003706655.xml) получаем ошибку:
13392 Список клиентских кодов не соответствует данному клиенту %s.

По данному ДУЛ две записи:
select treaty, application_status, * from hell.[SPBEX].[tax_identification] where document_number = '04 17 046199'

 

*Причина:* в какой-то момент идентификатор клиента на бирже перестал совпадать с ген. соглашением и при повторной регистрации клиента в АД , при передачи информации на биржу статус клиента application_status = REJECTED.

На данный момент  в таблице 12 тыс. дублей с одинаковыми ДУЛ:
select document_number, treaty, first_name,second_name, patronymic_name, application_type, application_status  from hell.[SPBEX].[tax_identification] select document_number, treaty, first_name,second_name, patronymic_name, application_type, application_status  from hell.[SPBEX].[tax_identification]  where document_number in (select document_number  from hell.[SPBEX].[tax_identification] group by document_number HAVING count(*)>1)

Необходимо добавить дополнительные условия для отбора клиентов для массового исправления.",,,
ADIRINC-11,1462034,U_00IPG,Отклонен,21.04.2021 15:39,,,,,Дефект промсреды,29.09.2021 16:55,2021-06-04 00:00:00.0,"Пререквизит - перевести цб с одного субсчета на другой.

 

Шаги воспроизведения:
 Авторизоваться в МТ или ДТ, зайди во вкладку ""Портфель"".
 ОР:
 Все параметры ЦБ отображаются корректно.
 ФР:
 Учетная цена рассчитывается не на момент покупки ЦБ, но на момент перевода.",,149.0,
ADIRINC-10,1461137,U_M0WVN,Закрыт,21.04.2021 12:09,,,,,Дефект промсреды,07.10.2022 17:40,2021-06-04 00:00:00.0,"После корпоративных действий эмитента по сплиту доли в пифе 1:10 учетная цена по активу в портфеле клиента отображается некорректно, требуя ручного исправления. Ручное исправление будет выполнено в рамках http://jira.moscow.alfaintra.net/browse/ADIRTECH-7706.

Пример во вложении.

Пререквизит - наличие в клиентском портфеле бумаги, по которой произошли корп.действия, изменившие учетную цену по позиции.
Шаги воспроизведения:
 # Авторизоваться в МТ или ДТ.
 # Провалиться в портфель.

ОР: учетная цена отображается в соответствии с произошедшим изменением.

ФР: учетная цена формируется некорректно.",,125.0,
ADIRINC-8,1457610,U_00IPG,Закрыт,19.04.2021 18:11,,,,,Дефект промсреды,02.06.2021 14:53,2021-04-22 00:00:00.0,"*Шаги воспроизведения:*

Необходимо завести фьючерсный контракт , например MAIL-6.21

*Фактически:*

Инструмент заводится вручную в 3-ке и в 4-ке, что приводит к ошибкам при ручных манипуляциях.

 ",,5.0,
ADIRINC-7,1456705,U_M0WVN,Закрыт,19.04.2021 17:04,,,,,Дефект промсреды,29.08.2022 10:28,2021-06-02 00:00:00.0,"Шаги воспроизведения:
 1. Авторизоваться в МТ.

2. Зайти во вкладку ""Портфель"".

ОР: в портфеле нет пустых позиций.

ФР: в портфеле присутствуют пустые позиции.

Пример во вложении, клиент 31167",,24.0,
ADIRINC-6,1456565,U_M0WVN,Закрыт,19.04.2021 14:47,,,,,Дефект промсреды,21.09.2021 14:29,2021-06-02 00:00:00.0,"*Шаги воспроизведения:*

Клиент хочет вывести ДС с брокерского счета 

*Фактически:*

У него возникает ошибка

!image-2021-04-19-14-47-56-778.png!

*Доп.инфо:*

*AQ2LGH Чичканов Владимир Андреевич*

*Счет открывал НЕ в УКД (Клик , Мобайл) Вероятно в отделении.*

**В Директе ошибка ""по переданному счёту не найдено ГС"" , когда пришел запрос по рублевому с ГС 9013140

!image-2021-04-19-14-46-08-600.png!

В EQ у клиента заведен брокерский рублевый счет с генсоглашением , которое отличается от брокерских счетов в валюте. Такая пролема касается брокерских рублевых счетов, заведенных в отделении и 7-значным генсоглашением.

Вместо единицы стоит 9 или 8:

!image-2021-04-19-14-56-48-338.png!

В EQ последние 6 цифр генерируются рандомно. При том что в Директе все генсоглашения уже с 7-ю знаками заводятся.

В данном примере директ ожидает 1013140, а приходит 9013140.

Хотел оценить сколько таких в EQ и похоже , что 7-ая цифра с конца такая  во всх счетах GK рублевых. Означают ВР и ФР. Она зарезервирована под другие цели. 

!image-2021-04-19-14-36-54-187.png!",,3.0,
ADIRINC-5,1453583,U_00IPG,Закрыт,16.04.2021 14:12,,,,,Дефект промсреды,24.05.2021 09:35,2021-04-20 00:00:00.0,"Шаги воспроизведения:
Зайти в МТ или ДТ АИ, попытаться найти по ISIN=IE00BMDKNM37 инструмент

ОР:
Инструмент находится и доступен к торгам.
ФР:
Инструмент не находится, торги невозможны.

Доп инфо:
Процедура/триггер, забирающие данные из таблиц MICEX в таблицы adfront, не смогли корректно отработать в случае данного инструмента.",,,
ADIRINC-4,1453582,U_00IPG,Отклонен,16.04.2021 14:10,,,,,Дефект промсреды,24.05.2021 16:40,2021-06-01 00:00:00.0,"Биржевая облигация RU000A102TX2, торгуемая на МБ, не завелась ни в четверку, ни в тройку.

Шаги воспроизведения:
Выполнить команды на prod1
select * from adfront.dbo.objects where isin in ('RU000A102TX2')
select * from hell.dbo.actives where isin in ('RU000A102TX2')
ОР:
По данному ISIN находится цб.
ФР:
По данному ISIN совпадений не найдено,",,,
ADIRINC-3,1452359,U_M0WVN,Закрыт,15.04.2021 19:11,,,,,Дефект промсреды,22.04.2022 14:20,2021-06-22 00:00:00.0,"*Шаги воспроизведения:*
 # Клиент AD4EEB Петрова Екатерина Николаевна  заходит Мои продукты, внизу видет список брокерских счетов.
|2020-12-23 23:06:48|Вход по ПИНу|6783376|Android 10.0|11.20|HUAWEI HMA-L29|

2. Нажимает на один из них и получает ошибку

!image-2020-12-25-12-30-29-480.png!

!image-2020-12-25-14-11-59-267.png!

*Фактически:*

Все клиенты получают такую ошибку при вызове сервиса [http://172.21.0.181:448/v2/users/F99939/accounts/30601810300009159946/limits]

когда у них есть открытые заявки.

Сервис не может корректно расчитать налог и сумму, доступную для вывода.

Вот так экран выглядит, если все хорошо и заявок нет:

!image-2020-12-25-14-16-12-823.png!

На адроиде ловили ошибку у Саши Бутхудзе F99939  , можно попросить проверить .потестить (ошибка логов Директа на скрине выше по нему)

[http://172.21.0.181:448/v2/users/F99939/accounts/30601810300009159946/limits]

Количество обращений выросло.",,,
ADIRINC-2,1452356,U_M0WVN,Закрыт,15.04.2021 19:02,,,,,Дефект промсреды,29.08.2022 10:30,2021-06-01 00:00:00.0,"*Шаги воспроизведения:*

1. Клиент заходит в раздел Инвестиции Альфа-Мобайл

2. Нажимает кнопку Открыть брокерский счет и доходит до шага подписания документов, подтверждает подписание.

*Фактически:*

Клиент видит формализованную ошибку в приложении  ""Из-за ошибки сервера не получилось сформирвать для вас документы, попробуйте еще раз""

!1.PNG!

*Дополнительная информация:*

Видим весомое количество следующих ошибок в логах микроервисов Мобайла при получении клиентом документов для подписании для открытия БС - ""errorMessage"": ""PREREGESIA returns BadRequest error on pin='AN7E8P', channel=''""
 PREREGESIA - предположительно связано со скорингом/проверками клиента в Директ?
 Пример ответа сервиса при вызове сервис UWS POST /adir/accounts/v10/rest/approval/<userId>

:

{     ""apiVersion"": ""1"",     ""requestId"": ""652bb907-1ef2-45bd-a295-7ba623301f03"",     ""requestSource"": ""RECO"",     ""userCode"": ""BROKERAGE-API"",     ""serviceName"": ""AlfaInvestment.Nontrading.Service"",     ""errorCode"": ""BAD_REQUEST"",     ""errorMessage"": ""PREREGESIA returns BadRequest error on pin='ARHFJO', channel=''"",     ""severity"": 3 }

!2.PNG|thumbnail!

!3.PNG|thumbnail!

 

Количество таких ошибок большое, порядка 20 в 5 минут, обращения от клиентов поступают регулярно.

По некоторым клиентам из логов с ошибкой счет открыт, однако те кто обращается , его действительно открыть не могут",,,
ADIRINC-1,1451913,U_M0WVN,Закрыт,15.04.2021 16:45,,,,,Дефект промсреды,01.09.2022 10:00,2021-05-31 00:00:00.0,"*Шаги воспроизведения:*

Клиент покупает определенный ETF в долларах (либо часть в долларах, часть в другой валюте)

Смотрит свой портфель в МТ или АД 4.0

*Фактически:*

Видит один инструмент с оценкой в одной валюте (в примере в рублях)

*Ожидаемый результат:*

Паи купленные ранее в рублях - отдельная позиция в портфеле в рублях

Эти же паи купленные в валюте - другая позиция в валюте

*Допинфо:*

Пример

Клиент 149259 19.03.2021 приобретал Finex CHINA в USD.

После приобретения они отображаются в рублях и сальдированы с позициями, которые торгуются на московской бирже.

Подобный инструмент находится в порядка 3950 портфелях

!image-2021-04-15-16-00-15-400.png!

 ",,9.0,
